<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿé…ç½® - ComfyUIæœåŠ¡å™¨é…ç½®</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .config-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #303133;
            margin: 0;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .form-tip {
            font-size: 12px;
            color: #909399;
            margin-top: 4px;
            line-height: 1.4;
        }
        .el-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .demo-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .demo-info h3 {
            margin: 0 0 8px 0;
            color: #0369a1;
        }
        .demo-info p {
            margin: 4px 0;
            color: #0c4a6e;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="config-page">
            <div class="page-header">
                <h1 class="page-title">ç³»ç»Ÿé…ç½®</h1>
                <div class="header-actions">
                    <el-button @click="testConnection" :loading="testing">
                        <el-icon><Connection /></el-icon>
                        æµ‹è¯•è¿æ¥
                    </el-button>
                    <el-button type="primary" @click="saveConfig" :loading="saving">
                        <el-icon><Check /></el-icon>
                        ä¿å­˜é…ç½®
                    </el-button>
                </div>
            </div>

            <div class="demo-info">
                <h3>ğŸ¯ åŠŸèƒ½è¯´æ˜</h3>
                <p>â€¢ åˆ é™¤äº†åŸºç¡€é…ç½®å’ŒAIæœåŠ¡é…ç½®æ¨¡å—</p>
                <p>â€¢ æ–°å¢ComfyUIæœåŠ¡å™¨é…ç½®ï¼Œæ”¯æŒä¸»æœåŠ¡å™¨å’Œå¤‡ç”¨æœåŠ¡å™¨è®¾ç½®</p>
                <p>â€¢ æ”¯æŒè¯·æ±‚è¶…æ—¶æ—¶é—´å’Œå¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´é…ç½®</p>
                <p>â€¢ æä¾›è¿æ¥æµ‹è¯•åŠŸèƒ½ï¼ŒéªŒè¯æœåŠ¡å™¨å¯ç”¨æ€§</p>
                <p>â€¢ æ”¯æŒè‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨å’Œé‡è¯•æœºåˆ¶</p>
            </div>
            
            <el-card>
                <template #header>
                    <div class="card-header">
                        <span>ğŸ–¥ï¸ ComfyUIæœåŠ¡å™¨é…ç½®</span>
                        <el-tag v-if="connectionStatus" :type="connectionStatus.type" size="small">
                            {{ connectionStatus.text }}
                        </el-tag>
                    </div>
                </template>
                
                <el-form 
                    :model="config" 
                    :rules="rules"
                    ref="configForm"
                    label-width="180px"
                    v-loading="loading"
                >
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="ä¸»æœåŠ¡å™¨åœ°å€" prop="serverUrl" required>
                                <el-input 
                                    v-model="config.serverUrl" 
                                    placeholder="your-comfyui-server.com"
                                    clearable
                                >
                                    <template #prepend>HTTPS://</template>
                                </el-input>
                                <div class="form-tip">ComfyUIä¸»æœåŠ¡å™¨çš„å®Œæ•´åœ°å€</div>
                            </el-form-item>
                            
                            <el-form-item label="å¤‡ç”¨æœåŠ¡å™¨åœ°å€" prop="backupServers">
                                <el-input 
                                    v-model="config.backupServers" 
                                    type="textarea"
                                    :rows="3"
                                    placeholder="backup1.example.com&#10;backup2.example.com"
                                    clearable
                                />
                                <div class="form-tip">æ¯è¡Œä¸€ä¸ªå¤‡ç”¨æœåŠ¡å™¨åœ°å€ï¼Œä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢</div>
                            </el-form-item>
                        </el-col>
                        
                        <el-col :span="12">
                            <el-form-item label="è¯·æ±‚è¶…æ—¶æ—¶é—´" prop="requestTimeout" required>
                                <el-input-number 
                                    v-model="config.requestTimeout" 
                                    :min="5000" 
                                    :max="600000"
                                    :step="1000"
                                    style="width: 100%"
                                />
                                <div class="form-tip">å•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®è®¾ç½®ä¸º30000-300000</div>
                            </el-form-item>
                            
                            <el-form-item label="å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´" prop="healthCheckTimeout" required>
                                <el-input-number 
                                    v-model="config.healthCheckTimeout" 
                                    :min="1000" 
                                    :max="30000"
                                    :step="1000"
                                    style="width: 100%"
                                />
                                <div class="form-tip">å•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®è®¾ç½®ä¸º5000-15000</div>
                            </el-form-item>
                            
                            <el-form-item label="è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨">
                                <el-switch 
                                    v-model="config.autoSwitch"
                                    active-text="å¯ç”¨"
                                    inactive-text="ç¦ç”¨"
                                />
                                <div class="form-tip">ä¸»æœåŠ¡å™¨æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨</div>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    
                    <el-divider content-position="left">é«˜çº§è®¾ç½®</el-divider>
                    
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="å®¢æˆ·ç«¯ID" prop="clientId">
                                <el-input 
                                    v-model="config.clientId" 
                                    placeholder="your-comfyui-client-id"
                                    clearable
                                />
                                <div class="form-tip">ComfyUIå®¢æˆ·ç«¯æ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼‰</div>
                            </el-form-item>
                        </el-col>
                        
                        <el-col :span="12">
                            <el-form-item label="æœ€å¤§é‡è¯•æ¬¡æ•°" prop="maxRetries">
                                <el-input-number 
                                    v-model="config.maxRetries" 
                                    :min="0" 
                                    :max="10"
                                    style="width: 100%"
                                />
                                <div class="form-tip">è¯·æ±‚å¤±è´¥æ—¶çš„æœ€å¤§é‡è¯•æ¬¡æ•°</div>
                            </el-form-item>
                        </el-col>
                    </el-row>
                </el-form>
            </el-card>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            setup() {
                const loading = ref(false);
                const saving = ref(false);
                const testing = ref(false);
                const configForm = ref(null);
                const connectionStatus = ref(null);

                // é…ç½®æ•°æ®
                const config = reactive({
                    serverUrl: 'demo-comfyui-server.com',
                    backupServers: 'backup1.example.com\nbackup2.example.com',
                    requestTimeout: 30000,
                    healthCheckTimeout: 10000,
                    autoSwitch: true,
                    clientId: 'demo-client-id',
                    maxRetries: 3
                });

                // è¡¨å•éªŒè¯è§„åˆ™
                const rules = {
                    serverUrl: [
                        { required: true, message: 'è¯·è¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€', trigger: 'blur' },
                        { 
                            pattern: /^[a-zA-Z0-9.-]+$/, 
                            message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„åŸŸåæˆ–IPåœ°å€', 
                            trigger: 'blur' 
                        }
                    ],
                    requestTimeout: [
                        { required: true, message: 'è¯·è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´', trigger: 'blur' },
                        { 
                            type: 'number', 
                            min: 5000, 
                            max: 600000, 
                            message: 'è¯·æ±‚è¶…æ—¶æ—¶é—´åº”åœ¨5000-600000æ¯«ç§’ä¹‹é—´', 
                            trigger: 'blur' 
                        }
                    ],
                    healthCheckTimeout: [
                        { required: true, message: 'è¯·è®¾ç½®å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´', trigger: 'blur' },
                        { 
                            type: 'number', 
                            min: 1000, 
                            max: 30000, 
                            message: 'å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´åº”åœ¨1000-30000æ¯«ç§’ä¹‹é—´', 
                            trigger: 'blur' 
                        }
                    ]
                };

                // ä¿å­˜é…ç½®
                const saveConfig = async () => {
                    if (!configForm.value) return;
                    
                    try {
                        await configForm.value.validate();
                    } catch (error) {
                        ElMessage.warning('è¯·æ£€æŸ¥è¡¨å•è¾“å…¥');
                        return;
                    }
                    
                    saving.value = true;
                    try {
                        // æ¨¡æ‹Ÿä¿å­˜é…ç½®
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ');
                        connectionStatus.value = null; // é‡ç½®è¿æ¥çŠ¶æ€
                    } catch (error) {
                        console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                        ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥');
                    } finally {
                        saving.value = false;
                    }
                };

                // æµ‹è¯•è¿æ¥
                const testConnection = async () => {
                    if (!config.serverUrl) {
                        ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€');
                        return;
                    }
                    
                    testing.value = true;
                    connectionStatus.value = { type: 'warning', text: 'æµ‹è¯•ä¸­...' };
                    
                    try {
                        // æ¨¡æ‹Ÿè¿æ¥æµ‹è¯•
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        // æ¨¡æ‹ŸæˆåŠŸç»“æœ
                        connectionStatus.value = { type: 'success', text: 'è¿æ¥æ­£å¸¸' };
                        ElMessage.success('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•æˆåŠŸ');
                    } catch (error) {
                        console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error);
                        connectionStatus.value = { type: 'danger', text: 'è¿æ¥å¤±è´¥' };
                        ElMessage.error('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•å¤±è´¥');
                    } finally {
                        testing.value = false;
                    }
                };

                return {
                    loading,
                    saving,
                    testing,
                    configForm,
                    connectionStatus,
                    config,
                    rules,
                    saveConfig,
                    testConnection
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
