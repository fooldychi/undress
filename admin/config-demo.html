<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统配置 - ComfyUI服务器配置</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .config-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #303133;
            margin: 0;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .form-tip {
            font-size: 12px;
            color: #909399;
            margin-top: 4px;
            line-height: 1.4;
        }
        .el-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .demo-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .demo-info h3 {
            margin: 0 0 8px 0;
            color: #0369a1;
        }
        .demo-info p {
            margin: 4px 0;
            color: #0c4a6e;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="config-page">
            <div class="page-header">
                <h1 class="page-title">系统配置</h1>
                <div class="header-actions">
                    <el-button @click="testConnection" :loading="testing">
                        <el-icon><Connection /></el-icon>
                        测试连接
                    </el-button>
                    <el-button type="primary" @click="saveConfig" :loading="saving">
                        <el-icon><Check /></el-icon>
                        保存配置
                    </el-button>
                </div>
            </div>

            <div class="demo-info">
                <h3>🎯 功能说明</h3>
                <p>• 删除了基础配置和AI服务配置模块</p>
                <p>• 新增ComfyUI服务器配置，支持主服务器和备用服务器设置</p>
                <p>• 支持请求超时时间和健康检查超时时间配置</p>
                <p>• 提供连接测试功能，验证服务器可用性</p>
                <p>• 支持自动切换备用服务器和重试机制</p>
            </div>
            
            <el-card>
                <template #header>
                    <div class="card-header">
                        <span>🖥️ ComfyUI服务器配置</span>
                        <el-tag v-if="connectionStatus" :type="connectionStatus.type" size="small">
                            {{ connectionStatus.text }}
                        </el-tag>
                    </div>
                </template>
                
                <el-form 
                    :model="config" 
                    :rules="rules"
                    ref="configForm"
                    label-width="180px"
                    v-loading="loading"
                >
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="主服务器地址" prop="serverUrl" required>
                                <el-input 
                                    v-model="config.serverUrl" 
                                    placeholder="your-comfyui-server.com"
                                    clearable
                                >
                                    <template #prepend>HTTPS://</template>
                                </el-input>
                                <div class="form-tip">ComfyUI主服务器的完整地址</div>
                            </el-form-item>
                            
                            <el-form-item label="备用服务器地址" prop="backupServers">
                                <el-input 
                                    v-model="config.backupServers" 
                                    type="textarea"
                                    :rows="3"
                                    placeholder="backup1.example.com&#10;backup2.example.com"
                                    clearable
                                />
                                <div class="form-tip">每行一个备用服务器地址，主服务器不可用时自动切换</div>
                            </el-form-item>
                        </el-col>
                        
                        <el-col :span="12">
                            <el-form-item label="请求超时时间" prop="requestTimeout" required>
                                <el-input-number 
                                    v-model="config.requestTimeout" 
                                    :min="5000" 
                                    :max="600000"
                                    :step="1000"
                                    style="width: 100%"
                                />
                                <div class="form-tip">单位：毫秒，建议设置为30000-300000</div>
                            </el-form-item>
                            
                            <el-form-item label="健康检查超时时间" prop="healthCheckTimeout" required>
                                <el-input-number 
                                    v-model="config.healthCheckTimeout" 
                                    :min="1000" 
                                    :max="30000"
                                    :step="1000"
                                    style="width: 100%"
                                />
                                <div class="form-tip">单位：毫秒，建议设置为5000-15000</div>
                            </el-form-item>
                            
                            <el-form-item label="自动切换备用服务器">
                                <el-switch 
                                    v-model="config.autoSwitch"
                                    active-text="启用"
                                    inactive-text="禁用"
                                />
                                <div class="form-tip">主服务器故障时自动切换到备用服务器</div>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    
                    <el-divider content-position="left">高级设置</el-divider>
                    
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="客户端ID" prop="clientId">
                                <el-input 
                                    v-model="config.clientId" 
                                    placeholder="your-comfyui-client-id"
                                    clearable
                                />
                                <div class="form-tip">ComfyUI客户端标识符（可选）</div>
                            </el-form-item>
                        </el-col>
                        
                        <el-col :span="12">
                            <el-form-item label="最大重试次数" prop="maxRetries">
                                <el-input-number 
                                    v-model="config.maxRetries" 
                                    :min="0" 
                                    :max="10"
                                    style="width: 100%"
                                />
                                <div class="form-tip">请求失败时的最大重试次数</div>
                            </el-form-item>
                        </el-col>
                    </el-row>
                </el-form>
            </el-card>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            setup() {
                const loading = ref(false);
                const saving = ref(false);
                const testing = ref(false);
                const configForm = ref(null);
                const connectionStatus = ref(null);

                // 配置数据
                const config = reactive({
                    serverUrl: 'demo-comfyui-server.com',
                    backupServers: 'backup1.example.com\nbackup2.example.com',
                    requestTimeout: 30000,
                    healthCheckTimeout: 10000,
                    autoSwitch: true,
                    clientId: 'demo-client-id',
                    maxRetries: 3
                });

                // 表单验证规则
                const rules = {
                    serverUrl: [
                        { required: true, message: '请输入主服务器地址', trigger: 'blur' },
                        { 
                            pattern: /^[a-zA-Z0-9.-]+$/, 
                            message: '请输入有效的域名或IP地址', 
                            trigger: 'blur' 
                        }
                    ],
                    requestTimeout: [
                        { required: true, message: '请设置请求超时时间', trigger: 'blur' },
                        { 
                            type: 'number', 
                            min: 5000, 
                            max: 600000, 
                            message: '请求超时时间应在5000-600000毫秒之间', 
                            trigger: 'blur' 
                        }
                    ],
                    healthCheckTimeout: [
                        { required: true, message: '请设置健康检查超时时间', trigger: 'blur' },
                        { 
                            type: 'number', 
                            min: 1000, 
                            max: 30000, 
                            message: '健康检查超时时间应在1000-30000毫秒之间', 
                            trigger: 'blur' 
                        }
                    ]
                };

                // 保存配置
                const saveConfig = async () => {
                    if (!configForm.value) return;
                    
                    try {
                        await configForm.value.validate();
                    } catch (error) {
                        ElMessage.warning('请检查表单输入');
                        return;
                    }
                    
                    saving.value = true;
                    try {
                        // 模拟保存配置
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        ElMessage.success('配置保存成功');
                        connectionStatus.value = null; // 重置连接状态
                    } catch (error) {
                        console.error('保存配置失败:', error);
                        ElMessage.error('保存配置失败');
                    } finally {
                        saving.value = false;
                    }
                };

                // 测试连接
                const testConnection = async () => {
                    if (!config.serverUrl) {
                        ElMessage.warning('请先输入主服务器地址');
                        return;
                    }
                    
                    testing.value = true;
                    connectionStatus.value = { type: 'warning', text: '测试中...' };
                    
                    try {
                        // 模拟连接测试
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        // 模拟成功结果
                        connectionStatus.value = { type: 'success', text: '连接正常' };
                        ElMessage.success('ComfyUI服务器连接测试成功');
                    } catch (error) {
                        console.error('连接测试失败:', error);
                        connectionStatus.value = { type: 'danger', text: '连接失败' };
                        ElMessage.error('ComfyUI服务器连接测试失败');
                    } finally {
                        testing.value = false;
                    }
                };

                return {
                    loading,
                    saving,
                    testing,
                    configForm,
                    connectionStatus,
                    config,
                    rules,
                    saveConfig,
                    testConnection
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
