<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‰çº§å¡æ‰¹é‡ç”ŸæˆåŠŸèƒ½æ¼”ç¤º</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #303133;
            margin: 0;
        }
        .demo-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .cards-table {
            max-height: 400px;
            overflow-y: auto;
        }
        .result-summary {
            margin-bottom: 16px;
        }
        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="demo-container">
            <div class="page-header">
                <h1 class="page-title">ğŸ« ç­‰çº§å¡æ‰¹é‡ç”ŸæˆåŠŸèƒ½æ¼”ç¤º</h1>
                <div class="header-actions">
                    <el-button type="success" @click="showGenerateDialog">
                        <el-icon><Plus /></el-icon>
                        ç”Ÿæˆä½“éªŒå¡
                    </el-button>
                    <el-button type="primary" @click="showBatchGenerateDialog">
                        <el-icon><Plus /></el-icon>
                        æ‰¹é‡ç”Ÿæˆç­‰çº§å¡
                    </el-button>
                </div>
            </div>

            <div class="demo-section">
                <h3>ğŸ“‹ åŠŸèƒ½è¯´æ˜</h3>
                <ul>
                    <li>âœ… æ”¯æŒé€‰æ‹©ç­‰çº§å¡ç±»å‹ï¼ˆä½“éªŒå¡ã€åŸºç¡€å¡ã€é«˜çº§å¡ã€è‡³å°Šå¡ï¼‰</li>
                    <li>âœ… æ”¯æŒè®¾ç½®ç”Ÿæˆæ•°é‡ï¼ˆ1-100å¼ ï¼‰</li>
                    <li>âœ… æ‰¹é‡ç”Ÿæˆç­‰çº§å¡å·å’Œå¡å¯†</li>
                    <li>âœ… ç”Ÿæˆç»“æœå±•ç¤ºå’Œä¸€é”®å¤åˆ¶åŠŸèƒ½</li>
                    <li>âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ</li>
                </ul>
            </div>

            <!-- æ‰¹é‡ç”Ÿæˆç­‰çº§å¡å¼¹çª— -->
            <el-dialog
                v-model="batchGenerateDialogVisible"
                title="æ‰¹é‡ç”Ÿæˆç­‰çº§å¡"
                width="500px"
                :close-on-click-modal="false"
            >
                <el-form :model="batchGenerateForm" label-width="100px">
                    <el-form-item label="ç­‰çº§å¡ç±»å‹" required>
                        <el-select 
                            v-model="batchGenerateForm.cardTypeId" 
                            placeholder="è¯·é€‰æ‹©ç­‰çº§å¡ç±»å‹"
                            style="width: 100%"
                            :loading="cardTypesLoading"
                        >
                            <el-option
                                v-for="cardType in cardTypes"
                                :key="cardType.id"
                                :label="`${cardType.icon} ${cardType.name} (${cardType.points}ç§¯åˆ† - Â¥${cardType.price})`"
                                :value="cardType.id"
                            />
                        </el-select>
                    </el-form-item>
                    <el-form-item label="ç”Ÿæˆæ•°é‡" required>
                        <el-input-number 
                            v-model="batchGenerateForm.count" 
                            :min="1" 
                            :max="100" 
                            style="width: 100%"
                        />
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="batchGenerateDialogVisible = false">å–æ¶ˆ</el-button>
                    <el-button 
                        type="primary" 
                        @click="handleBatchGenerate"
                        :loading="batchGenerating"
                    >
                        ç”Ÿæˆ
                    </el-button>
                </template>
            </el-dialog>

            <!-- ç”Ÿæˆç»“æœå¼¹çª— -->
            <el-dialog
                v-model="resultDialogVisible"
                :title="resultDialogTitle"
                width="80%"
                :close-on-click-modal="false"
                class="result-dialog"
            >
                <div class="result-content">
                    <div class="result-summary">
                        <el-alert
                            :title="`æˆåŠŸç”Ÿæˆ ${generatedCards.length} å¼ ${selectedCardTypeName}ï¼`"
                            type="success"
                            :closable="false"
                            show-icon
                        />
                    </div>
                    
                    <div class="cards-table">
                        <el-table :data="generatedCards" border style="width: 100%">
                            <el-table-column prop="cardNumber" label="å¡å·" width="200" />
                            <el-table-column prop="cardPassword" label="å¡å¯†" width="200" />
                            <el-table-column prop="typeName" label="ç±»å‹" width="120" />
                            <el-table-column prop="points" label="ç§¯åˆ†" width="100" />
                            <el-table-column prop="price" label="ä»·æ ¼" width="100">
                                <template #default="{ row }">
                                    Â¥{{ row.price }}
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
                
                <template #footer>
                    <div class="dialog-footer">
                        <el-button @click="resultDialogVisible = false">å…³é—­</el-button>
                        <el-button type="primary" @click="copyAllCards">
                            <el-icon><DocumentCopy /></el-icon>
                            ä¸€é”®å¤åˆ¶æ‰€æœ‰å¡å·å¡å¯†
                        </el-button>
                    </div>
                </template>
            </el-dialog>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            setup() {
                // å“åº”å¼æ•°æ®
                const batchGenerateDialogVisible = ref(false);
                const cardTypes = ref([]);
                const cardTypesLoading = ref(false);
                const batchGenerating = ref(false);
                const resultDialogVisible = ref(false);
                const resultDialogTitle = ref('');
                const generatedCards = ref([]);
                const selectedCardTypeName = ref('');

                const batchGenerateForm = reactive({
                    cardTypeId: null,
                    count: 5
                });

                // æ¨¡æ‹Ÿç­‰çº§å¡ç±»å‹æ•°æ®
                const mockCardTypes = [
                    { id: 1, name: 'ä½“éªŒå¡', icon: 'ğŸ', points: 20, price: 0.00, description: 'å…è´¹ä½“éªŒå¡ï¼Œæ¯å¼ 20ç§¯åˆ†' },
                    { id: 2, name: 'åŸºç¡€å¡', icon: 'ğŸ¥‰', points: 300, price: 9.90, description: 'é€‚åˆè½»åº¦ä½¿ç”¨çš„ç”¨æˆ·' },
                    { id: 3, name: 'é«˜çº§å¡', icon: 'ğŸ¥ˆ', points: 1000, price: 30.00, description: 'é€‚åˆä¸­åº¦ä½¿ç”¨çš„ç”¨æˆ·' },
                    { id: 4, name: 'è‡³å°Šå¡', icon: 'ğŸ¥‡', points: 2000, price: 50.00, description: 'é€‚åˆé‡åº¦ä½¿ç”¨çš„ç”¨æˆ·' }
                ];

                // æ–¹æ³•
                const showGenerateDialog = () => {
                    ElMessage.info('ä½“éªŒå¡ç”ŸæˆåŠŸèƒ½ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰');
                };

                const showBatchGenerateDialog = async () => {
                    await loadCardTypes();
                    batchGenerateDialogVisible.value = true;
                };

                const loadCardTypes = async () => {
                    cardTypesLoading.value = true;
                    try {
                        // æ¨¡æ‹ŸAPIè°ƒç”¨
                        await new Promise(resolve => setTimeout(resolve, 500));
                        cardTypes.value = mockCardTypes;
                    } catch (error) {
                        console.error('åŠ è½½ç­‰çº§å¡ç±»å‹å¤±è´¥:', error);
                        ElMessage.error('åŠ è½½ç­‰çº§å¡ç±»å‹å¤±è´¥');
                    } finally {
                        cardTypesLoading.value = false;
                    }
                };

                const handleBatchGenerate = async () => {
                    if (!batchGenerateForm.cardTypeId) {
                        ElMessage.warning('è¯·é€‰æ‹©ç­‰çº§å¡ç±»å‹');
                        return;
                    }

                    if (!batchGenerateForm.count || batchGenerateForm.count <= 0) {
                        ElMessage.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”Ÿæˆæ•°é‡');
                        return;
                    }

                    batchGenerating.value = true;
                    try {
                        // æ¨¡æ‹Ÿç”Ÿæˆç­‰çº§å¡
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        const selectedCardType = cardTypes.value.find(type => type.id === batchGenerateForm.cardTypeId);
                        selectedCardTypeName.value = selectedCardType?.name || 'ç­‰çº§å¡';
                        
                        // ç”Ÿæˆæ¨¡æ‹Ÿå¡ç‰‡æ•°æ®
                        const cards = [];
                        for (let i = 1; i <= batchGenerateForm.count; i++) {
                            const cardNumber = `DEMO${Date.now().toString().slice(-6)}${i.toString().padStart(3, '0')}`;
                            const cardPassword = Math.random().toString(36).substring(2, 10).toUpperCase();
                            
                            cards.push({
                                cardNumber,
                                cardPassword,
                                typeName: selectedCardType.name,
                                points: selectedCardType.points,
                                price: selectedCardType.price
                            });
                        }
                        
                        generatedCards.value = cards;
                        resultDialogTitle.value = `ç”Ÿæˆç»“æœ - ${selectedCardTypeName.value}`;
                        
                        batchGenerateDialogVisible.value = false;
                        resultDialogVisible.value = true;
                        
                        ElMessage.success(`æˆåŠŸç”Ÿæˆ${batchGenerateForm.count}å¼ ${selectedCardTypeName.value}ï¼`);
                    } catch (error) {
                        console.error('æ‰¹é‡ç”Ÿæˆç­‰çº§å¡å¤±è´¥:', error);
                        ElMessage.error('æ‰¹é‡ç”Ÿæˆç­‰çº§å¡å¤±è´¥');
                    } finally {
                        batchGenerating.value = false;
                    }
                };

                const copyAllCards = async () => {
                    if (generatedCards.value.length === 0) {
                        ElMessage.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å¡ç‰‡ä¿¡æ¯');
                        return;
                    }

                    try {
                        let copyText = `${selectedCardTypeName.value} - å…±${generatedCards.value.length}å¼ \n\n`;
                        copyText += 'å¡å·\tå¡å¯†\tç±»å‹\tç§¯åˆ†\tä»·æ ¼\n';
                        copyText += '----------------------------------------\n';
                        
                        generatedCards.value.forEach(card => {
                            copyText += `${card.cardNumber}\t${card.cardPassword}\t${card.typeName}\t${card.points}\tÂ¥${card.price}\n`;
                        });
                        
                        copyText += '\nç”Ÿæˆæ—¶é—´: ' + new Date().toLocaleString();

                        await navigator.clipboard.writeText(copyText);
                        ElMessage.success('å¡å·å¡å¯†ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    } catch (error) {
                        console.error('å¤åˆ¶å¤±è´¥:', error);
                        ElMessage.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    }
                };

                return {
                    batchGenerateDialogVisible,
                    cardTypes,
                    cardTypesLoading,
                    batchGenerating,
                    resultDialogVisible,
                    resultDialogTitle,
                    generatedCards,
                    selectedCardTypeName,
                    batchGenerateForm,
                    showGenerateDialog,
                    showBatchGenerateDialog,
                    handleBatchGenerate,
                    copyAllCards
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
