<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>等级卡批量生成功能演示</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #303133;
            margin: 0;
        }
        .demo-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .cards-table {
            max-height: 400px;
            overflow-y: auto;
        }
        .result-summary {
            margin-bottom: 16px;
        }
        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="demo-container">
            <div class="page-header">
                <h1 class="page-title">🎫 等级卡批量生成功能演示</h1>
                <div class="header-actions">
                    <el-button type="success" @click="showGenerateDialog">
                        <el-icon><Plus /></el-icon>
                        生成体验卡
                    </el-button>
                    <el-button type="primary" @click="showBatchGenerateDialog">
                        <el-icon><Plus /></el-icon>
                        批量生成等级卡
                    </el-button>
                </div>
            </div>

            <div class="demo-section">
                <h3>📋 功能说明</h3>
                <ul>
                    <li>✅ 支持选择等级卡类型（体验卡、基础卡、高级卡、至尊卡）</li>
                    <li>✅ 支持设置生成数量（1-100张）</li>
                    <li>✅ 批量生成等级卡号和卡密</li>
                    <li>✅ 生成结果展示和一键复制功能</li>
                    <li>✅ 完善的错误处理和用户体验</li>
                </ul>
            </div>

            <!-- 批量生成等级卡弹窗 -->
            <el-dialog
                v-model="batchGenerateDialogVisible"
                title="批量生成等级卡"
                width="500px"
                :close-on-click-modal="false"
            >
                <el-form :model="batchGenerateForm" label-width="100px">
                    <el-form-item label="等级卡类型" required>
                        <el-select 
                            v-model="batchGenerateForm.cardTypeId" 
                            placeholder="请选择等级卡类型"
                            style="width: 100%"
                            :loading="cardTypesLoading"
                        >
                            <el-option
                                v-for="cardType in cardTypes"
                                :key="cardType.id"
                                :label="`${cardType.icon} ${cardType.name} (${cardType.points}积分 - ¥${cardType.price})`"
                                :value="cardType.id"
                            />
                        </el-select>
                    </el-form-item>
                    <el-form-item label="生成数量" required>
                        <el-input-number 
                            v-model="batchGenerateForm.count" 
                            :min="1" 
                            :max="100" 
                            style="width: 100%"
                        />
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="batchGenerateDialogVisible = false">取消</el-button>
                    <el-button 
                        type="primary" 
                        @click="handleBatchGenerate"
                        :loading="batchGenerating"
                    >
                        生成
                    </el-button>
                </template>
            </el-dialog>

            <!-- 生成结果弹窗 -->
            <el-dialog
                v-model="resultDialogVisible"
                :title="resultDialogTitle"
                width="80%"
                :close-on-click-modal="false"
                class="result-dialog"
            >
                <div class="result-content">
                    <div class="result-summary">
                        <el-alert
                            :title="`成功生成 ${generatedCards.length} 张${selectedCardTypeName}！`"
                            type="success"
                            :closable="false"
                            show-icon
                        />
                    </div>
                    
                    <div class="cards-table">
                        <el-table :data="generatedCards" border style="width: 100%">
                            <el-table-column prop="cardNumber" label="卡号" width="200" />
                            <el-table-column prop="cardPassword" label="卡密" width="200" />
                            <el-table-column prop="typeName" label="类型" width="120" />
                            <el-table-column prop="points" label="积分" width="100" />
                            <el-table-column prop="price" label="价格" width="100">
                                <template #default="{ row }">
                                    ¥{{ row.price }}
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
                
                <template #footer>
                    <div class="dialog-footer">
                        <el-button @click="resultDialogVisible = false">关闭</el-button>
                        <el-button type="primary" @click="copyAllCards">
                            <el-icon><DocumentCopy /></el-icon>
                            一键复制所有卡号卡密
                        </el-button>
                    </div>
                </template>
            </el-dialog>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            setup() {
                // 响应式数据
                const batchGenerateDialogVisible = ref(false);
                const cardTypes = ref([]);
                const cardTypesLoading = ref(false);
                const batchGenerating = ref(false);
                const resultDialogVisible = ref(false);
                const resultDialogTitle = ref('');
                const generatedCards = ref([]);
                const selectedCardTypeName = ref('');

                const batchGenerateForm = reactive({
                    cardTypeId: null,
                    count: 5
                });

                // 模拟等级卡类型数据
                const mockCardTypes = [
                    { id: 1, name: '体验卡', icon: '🎁', points: 20, price: 0.00, description: '免费体验卡，每张20积分' },
                    { id: 2, name: '基础卡', icon: '🥉', points: 300, price: 9.90, description: '适合轻度使用的用户' },
                    { id: 3, name: '高级卡', icon: '🥈', points: 1000, price: 30.00, description: '适合中度使用的用户' },
                    { id: 4, name: '至尊卡', icon: '🥇', points: 2000, price: 50.00, description: '适合重度使用的用户' }
                ];

                // 方法
                const showGenerateDialog = () => {
                    ElMessage.info('体验卡生成功能（原有功能）');
                };

                const showBatchGenerateDialog = async () => {
                    await loadCardTypes();
                    batchGenerateDialogVisible.value = true;
                };

                const loadCardTypes = async () => {
                    cardTypesLoading.value = true;
                    try {
                        // 模拟API调用
                        await new Promise(resolve => setTimeout(resolve, 500));
                        cardTypes.value = mockCardTypes;
                    } catch (error) {
                        console.error('加载等级卡类型失败:', error);
                        ElMessage.error('加载等级卡类型失败');
                    } finally {
                        cardTypesLoading.value = false;
                    }
                };

                const handleBatchGenerate = async () => {
                    if (!batchGenerateForm.cardTypeId) {
                        ElMessage.warning('请选择等级卡类型');
                        return;
                    }

                    if (!batchGenerateForm.count || batchGenerateForm.count <= 0) {
                        ElMessage.warning('请输入有效的生成数量');
                        return;
                    }

                    batchGenerating.value = true;
                    try {
                        // 模拟生成等级卡
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        const selectedCardType = cardTypes.value.find(type => type.id === batchGenerateForm.cardTypeId);
                        selectedCardTypeName.value = selectedCardType?.name || '等级卡';
                        
                        // 生成模拟卡片数据
                        const cards = [];
                        for (let i = 1; i <= batchGenerateForm.count; i++) {
                            const cardNumber = `DEMO${Date.now().toString().slice(-6)}${i.toString().padStart(3, '0')}`;
                            const cardPassword = Math.random().toString(36).substring(2, 10).toUpperCase();
                            
                            cards.push({
                                cardNumber,
                                cardPassword,
                                typeName: selectedCardType.name,
                                points: selectedCardType.points,
                                price: selectedCardType.price
                            });
                        }
                        
                        generatedCards.value = cards;
                        resultDialogTitle.value = `生成结果 - ${selectedCardTypeName.value}`;
                        
                        batchGenerateDialogVisible.value = false;
                        resultDialogVisible.value = true;
                        
                        ElMessage.success(`成功生成${batchGenerateForm.count}张${selectedCardTypeName.value}！`);
                    } catch (error) {
                        console.error('批量生成等级卡失败:', error);
                        ElMessage.error('批量生成等级卡失败');
                    } finally {
                        batchGenerating.value = false;
                    }
                };

                const copyAllCards = async () => {
                    if (generatedCards.value.length === 0) {
                        ElMessage.warning('没有可复制的卡片信息');
                        return;
                    }

                    try {
                        let copyText = `${selectedCardTypeName.value} - 共${generatedCards.value.length}张\n\n`;
                        copyText += '卡号\t卡密\t类型\t积分\t价格\n';
                        copyText += '----------------------------------------\n';
                        
                        generatedCards.value.forEach(card => {
                            copyText += `${card.cardNumber}\t${card.cardPassword}\t${card.typeName}\t${card.points}\t¥${card.price}\n`;
                        });
                        
                        copyText += '\n生成时间: ' + new Date().toLocaleString();

                        await navigator.clipboard.writeText(copyText);
                        ElMessage.success('卡号卡密信息已复制到剪贴板');
                    } catch (error) {
                        console.error('复制失败:', error);
                        ElMessage.error('复制失败，请手动复制');
                    }
                };

                return {
                    batchGenerateDialogVisible,
                    cardTypes,
                    cardTypesLoading,
                    batchGenerating,
                    resultDialogVisible,
                    resultDialogTitle,
                    generatedCards,
                    selectedCardTypeName,
                    batchGenerateForm,
                    showGenerateDialog,
                    showBatchGenerateDialog,
                    handleBatchGenerate,
                    copyAllCards
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
