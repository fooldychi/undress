import{_ as F,b as w,e as T,z as q,K as $,r as P,h as _,o as d,g as o,k,L as re,p as u,t as L,M as ce,N as de,n as ae,w as S,c as R,j as B,F as K,C as te,f as N,O as J,d as W,P as U,Q as V,q as Z,H as ue,J as ee,T as g,u as se,R as oe,S as O,y as D}from"./index-BhtH8ggh.js";const me={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},label:{type:String,default:""},placeholder:{type:String,default:""},leftIcon:{type:String,default:""},rightIcon:{type:String,default:""},clearable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},rules:{type:Array,default:()=>[]},validateTrigger:{type:String,default:"blur"},autoTrim:{type:Boolean,default:!1}},emits:["update:modelValue","focus","blur","input","clear","enter"],setup(l,{expose:s,emit:a}){const e=l,p=a,c=w(null),i=w(!1),h=w(!1),v=w(""),m=T({get:()=>e.modelValue,set:n=>p("update:modelValue",n)}),f=T(()=>e.type==="password"?h.value?"text":"password":e.type),M=T(()=>!!v.value),y=async()=>{if(v.value="",!e.rules||e.rules.length===0)return!0;for(const n of e.rules)if(typeof n=="function"){const j=await n(m.value);if(j!==!0)return v.value=j,!1}else{if(n.required&&!m.value)return v.value=n.message||"此字段为必填项",!1;if(n.pattern&&!n.pattern.test(m.value))return v.value=n.message||"格式不正确",!1;if(n.min&&m.value.length<n.min)return v.value=n.message||`最少输入${n.min}个字符`,!1;if(n.max&&m.value.length>n.max)return v.value=n.message||`最多输入${n.max}个字符`,!1}return!0},r=n=>{i.value=!0,p("focus",n)},I=async n=>{i.value=!1,e.autoTrim&&typeof m.value=="string"&&(m.value=m.value.trim()),p("blur",n),e.validateTrigger==="blur"&&await y()},E=async n=>{e.autoTrim&&typeof n.target.value=="string"&&(n.target.value=n.target.value.trim(),m.value=n.target.value),p("input",n),e.validateTrigger==="input"&&await y()},C=()=>{m.value="",v.value="",p("clear"),$(()=>{var n;(n=c.value)==null||n.focus()})},A=n=>{p("enter",n)},z=()=>{h.value=!h.value};q(()=>e.modelValue,()=>{e.validateTrigger==="change"&&y()}),s({focus:()=>{var n;return(n=c.value)==null?void 0:n.focus()},blur:()=>{var n;return(n=c.value)==null?void 0:n.blur()},validate:y,clearError:()=>{v.value=""}});const t={props:e,emit:p,inputRef:c,isFocused:i,showPassword:h,errorMessage:v,inputValue:m,inputType:f,hasError:M,validateInput:y,handleFocus:r,handleBlur:I,handleInput:E,handleClear:C,handleEnter:A,togglePasswordVisibility:z,ref:w,computed:T,watch:q,nextTick:$};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}},fe={class:"input-wrapper"},ge={key:0,class:"input-icon input-icon-left"},pe={key:1,class:"input-label"},ve=["type","placeholder","disabled","readonly"],_e={key:4,class:"input-icon input-icon-right"},he={key:0,class:"input-error"};function be(l,s,a,e,p,c){const i=P("van-icon");return d(),_("div",{class:ae(["base-input",{"is-focused":e.isFocused,"has-error":e.hasError}])},[o("div",fe,[a.leftIcon?(d(),_("div",ge,[u(i,{name:a.leftIcon,size:"16"},null,8,["name"])])):k("",!0),a.label?(d(),_("div",pe,L(a.label),1)):k("",!0),re(o("input",{ref:"inputRef","onUpdate:modelValue":s[0]||(s[0]=h=>e.inputValue=h),type:e.inputType,placeholder:a.placeholder,disabled:a.disabled,readonly:a.readonly,class:"input-control",onFocus:e.handleFocus,onBlur:e.handleBlur,onInput:e.handleInput,onKeyup:de(e.handleEnter,["enter"])},null,40,ve),[[ce,e.inputValue]]),a.clearable&&e.inputValue&&!a.disabled&&!a.readonly?(d(),_("div",{key:2,class:"input-icon input-icon-clear",onClick:e.handleClear},[u(i,{name:"clear",size:"14"})])):k("",!0),a.type==="password"?(d(),_("div",{key:3,class:"input-icon input-icon-password",onClick:e.togglePasswordVisibility},[u(i,{name:e.showPassword?"eye-o":"closed-eye",size:"16"},null,8,["name"])])):k("",!0),a.rightIcon?(d(),_("div",_e,[u(i,{name:a.rightIcon,size:"16"},null,8,["name"])])):k("",!0)]),e.errorMessage?(d(),_("div",he,L(e.errorMessage),1)):k("",!0)],2)}const ne=F(me,[["render",be],["__scopeId","data-v-82c69faf"],["__file","D:/workspace/AIMagic/client/src/components/BaseInput.vue"]]),we={name:"PointsModal",components:{BaseInput:ne},props:{show:{type:Boolean,default:!1}},emits:["update:show","points-updated"],setup(l,{emit:s}){const a=T({get:()=>l.show,set:t=>s("update:show",t)}),e=w(!1),p=w(!1),c=w(null),i=w(!1),h=w([]),v=T(()=>N.isLoggedIn()),m=T(()=>h.value.some(t=>t.type_name==="体验卡"&&t.remaining_points>0)),f=J({cardNumber:"",cardPassword:""}),M=[{required:!0,message:"请输入卡号"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"卡号格式不正确"}],y=[{required:!0,message:"请输入卡密"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"卡密格式不正确"}],r=()=>{f.cardNumber="",f.cardPassword=""},I=()=>{a.value=!1,i.value=!1,r()},E=()=>{window.open("https://t.me/tgcomfy","_blank"),g.success("正在跳转到Telegram客服")},C=async()=>{if(!N.isLoggedIn()){c.value={total_points:0,cards_count:0,cards_breakdown:[]},h.value=[],e.value=!1;return}try{e.value=!0;const[t,n]=await Promise.all([ue.getUserPoints(),ee.getMyCards()]);t.success?c.value=t.data:(console.error("获取积分信息失败:",t.message),t.message&&t.message.includes("令牌")?(g.fail("请先登录"),c.value={total_points:0,cards_count:0,cards_breakdown:[]}):g.fail("获取积分信息失败")),n.success?h.value=n.data.cards||[]:(console.error("获取用户卡片信息失败:",n.message),h.value=[])}catch(t){console.error("加载积分信息失败:",t),t.message&&(t.message.includes("令牌")||t.message.includes("401")||t.message.includes("登录已过期"))?(g.fail("登录已过期，请重新登录"),c.value={total_points:0,cards_count:0,cards_breakdown:[]}):t.message&&t.message.includes("网络连接失败")?g.fail("网络连接失败，请检查服务器状态"):g.fail("获取积分信息失败"),h.value=[]}finally{e.value=!1}},A=async()=>{if(!p.value){if(!N.isLoggedIn()){g.fail("请先登录");return}if(!f.cardNumber.trim()){g.fail("请输入卡号");return}if(!f.cardPassword.trim()){g.fail("请输入卡密");return}p.value=!0;try{console.log("🎫 尝试绑定等级卡:",{cardNumber:f.cardNumber.trim(),hasUnusedExperienceCard:m.value,userCards:h.value});const t=await ee.bindCard(f.cardNumber.trim(),f.cardPassword.trim());if(console.log("🎫 绑定响应:",t),t.success){g.success(t.message||"绑定成功，正在更新积分..."),g.loading({message:"正在更新积分信息...",forbidClick:!0,duration:0});try{await C(),g.clear(),g.success("等级卡绑定成功，积分已更新"),s("points-updated",t.data)}catch(n){g.clear(),console.error("更新积分信息失败:",n),g.fail("积分更新失败，请刷新页面")}r()}else console.error("绑定失败:",t.message),t.message&&t.message.includes("令牌")?g.fail("请先登录"):t.message&&t.message.includes("体验卡")?g.fail(t.message):g.fail(t.message||"绑定失败")}catch(t){if(console.error("🎫 绑定等级卡失败:",t),console.error("🎫 错误详情:",{message:t.message,hasUnusedExperienceCard:m.value,userCards:h.value}),t.message&&(t.message.includes("令牌")||t.message.includes("401")||t.message.includes("登录已过期")))g.fail("登录已过期，请重新登录");else if(t.message&&t.message.includes("体验卡")){const n=t.message.replace(/^请求失败:\s*/,"");g({type:"fail",message:n,duration:4e3})}else t.message&&t.message.includes("网络连接失败")?g.fail("网络连接失败，请检查服务器状态"):g.fail(t.message||"绑定失败")}finally{p.value=!1}}};q(a,t=>{t?C():(r(),i.value=!1)});const z=async()=>{console.log("🔄 PointsModal 收到积分更新事件，刷新积分信息"),l.show&&v.value&&await C()};return W(()=>{U.on(V.POINTS_UPDATED,z),U.on(V.POINTS_CONSUMED,z)}),Z(()=>{U.off(V.POINTS_UPDATED,z),U.off(V.POINTS_CONSUMED,z)}),{visible:a,loading:e,bindLoading:p,pointsInfo:c,bindForm:f,cardNumberRules:M,cardPasswordRules:y,showPurchaseModal:i,isLoggedIn:v,userCards:h,hasUnusedExperienceCard:m,closeModal:I,loadPointsInfo:C,handleBindCard:A,contactCustomerService:E}}},ye={class:"points-modal"},ke={class:"modal-header"},Ce={class:"modal-title"},Pe={key:1,class:"modal-content"},Me={key:0,class:"login-prompt"},Ie={class:"points-overview"},Se={class:"points-total"},Te={class:"points-number"},xe={class:"purchase-btn-container"},Be={class:"bind-section"},Ne={class:"section-title"},Le={key:0,class:"experience-card-notice"},Ae={class:"bind-actions"},Ue={class:"purchase-modal"},Ve={class:"modal-header"},ze={class:"modal-title"},De={class:"modal-content"},Ee={class:"contact-section"};function Re(l,s,a,e,p,c){const i=P("van-icon"),h=P("van-loading"),v=P("van-button"),m=P("van-notice-bar"),f=P("BaseInput"),M=P("van-popup");return d(),_(K,null,[u(M,{show:e.visible,"onUpdate:show":s[4]||(s[4]=y=>e.visible=y),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>{var y;return[o("div",ye,[o("div",ke,[o("h2",Ce,[u(i,{name:"diamond-o",size:"24"}),s[7]||(s[7]=B(" 我的积分 "))]),u(i,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),e.loading?(d(),R(h,{key:0,class:"loading-center",size:"24px",vertical:""},{default:S(()=>s[8]||(s[8]=[B(" 加载中... ")])),_:1,__:[8]})):(d(),_("div",Pe,[e.isLoggedIn?(d(),_(K,{key:1},[o("div",Ie,[o("div",Se,[o("div",Te,L(((y=e.pointsInfo)==null?void 0:y.total_points)||0),1),s[13]||(s[13]=o("div",{class:"points-label"},"总积分",-1))]),o("div",xe,[u(v,{type:"primary",round:"",onClick:s[0]||(s[0]=r=>e.showPurchaseModal=!0),class:"purchase-btn"},{default:S(()=>[u(i,{name:"shopping-cart-o",size:"14"}),s[14]||(s[14]=B(" 购买等级卡 "))]),_:1,__:[14]})])]),o("div",Be,[o("h3",Ne,[u(i,{name:"credit-pay",size:"16"}),s[15]||(s[15]=B(" 绑定等级卡 "))]),e.hasUnusedExperienceCard?(d(),_("div",Le,[u(m,{"left-icon":"info-o",color:"#ff6b35",background:"rgba(255, 107, 53, 0.1)",text:"提示：您已有可用的体验卡，体验卡在使用前不可叠加绑定。"})])):k("",!0),o("form",{onSubmit:s[3]||(s[3]=te((...r)=>e.handleBindCard&&e.handleBindCard(...r),["prevent"])),class:"bind-form"},[u(f,{modelValue:e.bindForm.cardNumber,"onUpdate:modelValue":s[1]||(s[1]=r=>e.bindForm.cardNumber=r),placeholder:"请输入卡号",rules:e.cardNumberRules,clearable:"","auto-trim":"",class:"bind-input-full"},null,8,["modelValue","rules"]),u(f,{modelValue:e.bindForm.cardPassword,"onUpdate:modelValue":s[2]||(s[2]=r=>e.bindForm.cardPassword=r),type:"password",placeholder:"请输入卡密",rules:e.cardPasswordRules,clearable:"","auto-trim":"",class:"bind-input-full"},null,8,["modelValue","rules"]),o("div",Ae,[u(v,{type:"primary","native-type":"submit",round:"",block:"",loading:e.bindLoading,disabled:e.bindLoading,class:"bind-button"},{default:S(()=>[B(L(e.bindLoading?"绑定中...":"绑定"),1)]),_:1},8,["loading","disabled"])])],32)])],64)):(d(),_("div",Me,[s[10]||(s[10]=o("div",{class:"prompt-icon"},"🔐",-1)),s[11]||(s[11]=o("div",{class:"prompt-title"},"请先登录",-1)),s[12]||(s[12]=o("div",{class:"prompt-desc"},"登录后即可查看积分信息和绑定等级卡",-1)),u(v,{type:"primary",round:"",block:"",onClick:e.closeModal,class:"login-btn"},{default:S(()=>s[9]||(s[9]=[B(" 去登录 ")])),_:1,__:[9]},8,["onClick"])]))]))])]}),_:1},8,["show"]),u(M,{show:e.showPurchaseModal,"onUpdate:show":s[6]||(s[6]=y=>e.showPurchaseModal=y),position:"center",style:{width:"95%",maxWidth:"450px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ue,[o("div",Ve,[o("h2",ze,[u(i,{name:"shopping-cart-o",size:"24"}),s[16]||(s[16]=B(" 购买等级卡 "))]),u(i,{name:"cross",size:"20",class:"close-btn",onClick:s[5]||(s[5]=y=>e.showPurchaseModal=!1)})]),o("div",De,[s[18]||(s[18]=o("div",{class:"card-types-grid"},[o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥉"),o("div",{class:"card-name"},"基础卡"),o("div",{class:"card-price"},"¥9.9"),o("div",{class:"card-points"},"300积分")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥈"),o("div",{class:"card-name"},"高级卡"),o("div",{class:"card-price"},"¥30"),o("div",{class:"card-points"},"1000积分")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥇"),o("div",{class:"card-name"},"至尊卡"),o("div",{class:"card-price"},"¥50"),o("div",{class:"card-points"},"2000积分")])],-1)),s[19]||(s[19]=o("div",{class:"exchange-process"},[o("h4",{class:"process-title"},"兑换流程"),o("div",{class:"process-steps"},[o("div",{class:"process-step"},[o("div",{class:"step-number"},"1"),o("div",{class:"step-text"},"加客服")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"2"),o("div",{class:"step-text"},"发红包")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"3"),o("div",{class:"step-text"},"收卡号")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"4"),o("div",{class:"step-text"},"绑定")])])],-1)),o("div",Ee,[u(v,{type:"primary",round:"",onClick:e.contactCustomerService,class:"contact-btn"},{default:S(()=>[u(i,{name:"chat-o",size:"14"}),s[17]||(s[17]=B(" 联系客服 "))]),_:1,__:[17]},8,["onClick"])])])])]),_:1},8,["show"])],64)}const Oe=F(we,[["render",Re],["__scopeId","data-v-5b8f686e"],["__file","D:/workspace/AIMagic/client/src/components/PointsModal.vue"]]),Fe={name:"AuthModal",components:{BaseInput:ne},props:{show:{type:Boolean,default:!1},defaultMode:{type:String,default:"login",validator:l=>["login","register"].includes(l)}},emits:["update:show","success"],setup(l,{emit:s}){const a=T({get:()=>l.show,set:r=>s("update:show",r)}),e=w(l.defaultMode==="login"),p=w(!1),c=J({username:"",password:"",confirmPassword:""}),i=[{required:!0,message:"请输入用户名"},{pattern:/^[a-zA-Z0-9]{3,30}$/,message:"用户名只能包含字母和数字，长度3-30位"}],h=[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"}],v=T(()=>[{required:!0,message:"请确认密码"},{validator:r=>r===c.password,message:"两次输入的密码不一致"}]),m=()=>{c.username="",c.password="",c.confirmPassword=""},f=()=>{e.value=!e.value,m()},M=()=>{a.value=!1,m()},y=async()=>{if(!p.value){if(!c.username.trim()){g.fail("请输入用户名");return}if(!c.password.trim()){g.fail("请输入密码");return}if(!e.value&&c.password!==c.confirmPassword){g.fail("两次输入的密码不一致");return}p.value=!0;try{let r;if(e.value?r=await N.login(c.username,c.password):r=await N.register(c.username,c.password),r.success){console.log("认证成功，响应数据:",r),e.value?g.success("登录成功，正在加载用户数据..."):g.success(r.message||"注册成功");const I={type:e.value?"login":"register",user:r.data.user};console.log("触发success事件，数据:",I),s("success",I),M()}else console.log("认证失败，响应数据:",r),g.fail(r.message||(e.value?"登录失败":"注册失败"))}catch(r){console.error("认证失败:",r),g.fail(r.message||(e.value?"登录失败":"注册失败"))}finally{p.value=!1}}};return q(a,r=>{r&&(e.value=l.defaultMode==="login",m())}),{visible:a,isLogin:e,loading:p,formData:c,usernameRules:i,passwordRules:h,confirmPasswordRules:v,toggleMode:f,closeModal:M,handleSubmit:y}}},Ge={class:"auth-modal"},je={class:"auth-header"},qe={class:"auth-title"},Je={class:"auth-form"},He={class:"auth-actions"},Ke={class:"auth-switch"},We={class:"switch-text"};function Ze(l,s,a,e,p,c){const i=P("van-icon"),h=P("BaseInput"),v=P("van-button"),m=P("van-popup");return d(),R(m,{show:e.visible,"onUpdate:show":s[4]||(s[4]=f=>e.visible=f),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ge,[o("div",je,[o("h2",qe,L(e.isLogin?"登录":"注册"),1),u(i,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),o("div",Je,[o("form",{onSubmit:s[3]||(s[3]=te((...f)=>e.handleSubmit&&e.handleSubmit(...f),["prevent"]))},[u(h,{modelValue:e.formData.username,"onUpdate:modelValue":s[0]||(s[0]=f=>e.formData.username=f),label:"用户名",placeholder:"请输入用户名","left-icon":"user-o",rules:e.usernameRules,clearable:""},null,8,["modelValue","rules"]),u(h,{modelValue:e.formData.password,"onUpdate:modelValue":s[1]||(s[1]=f=>e.formData.password=f),type:"password",label:"密码",placeholder:"请输入密码","left-icon":"lock",rules:e.passwordRules,clearable:""},null,8,["modelValue","rules"]),e.isLogin?k("",!0):(d(),R(h,{key:0,modelValue:e.formData.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=f=>e.formData.confirmPassword=f),type:"password",label:"确认密码",placeholder:"请再次输入密码","left-icon":"lock",rules:e.confirmPasswordRules,clearable:""},null,8,["modelValue","rules"])),o("div",He,[u(v,{type:"primary","native-type":"submit",block:"",round:"",loading:e.loading,disabled:e.loading,class:"auth-submit-btn"},{default:S(()=>[B(L(e.loading?e.isLogin?"登录中...":"注册中...":e.isLogin?"登录":"注册"),1)]),_:1},8,["loading","disabled"])])],32),o("div",Ke,[o("span",We,L(e.isLogin?"还没有账号？":"已有账号？"),1),u(v,{type:"primary",plain:"",size:"small",onClick:e.toggleMode},{default:S(()=>[B(L(e.isLogin?"立即注册":"立即登录"),1)]),_:1},8,["onClick"])])])])]),_:1},8,["show"])}const Qe=F(Fe,[["render",Ze],["__scopeId","data-v-c3c6d662"],["__file","D:/workspace/AIMagic/client/src/components/AuthModal.vue"]]),Xe={__name:"TopNavigation",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(l,{expose:s,emit:a}){const e=l,p=a,c=se(),i=oe(),h=T(()=>e.title?e.title:{"/":"AI Magic","/clothes-swap":"一键换衣","/face-swap":"极速换脸","/text-to-image":"文生图","/profile":"个人中心"}[i.path]||"AI Magic"),v=T(()=>e.showBack!==null?e.showBack:i.path!=="/"),m=w(!1),f=w(!1),M=w("login"),y=w(!1),r=w(!1),I=w(null),E=T(()=>{const b=N.isLoggedIn(),x=!!I.value;return b&&x}),C=J({current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}),A=async()=>{if(console.log("🔄 更新积分状态，当前登录状态:",O.isLoggedIn(),E.value),!O.isLoggedIn()||!E.value){console.log("❌ 未登录，设置默认积分状态"),r.value=!1,Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1});return}try{r.value=!0,console.log("🚀 发送积分API请求...");const b=await O.getPointsStatus();console.log("✅ 积分状态更新成功:",b),Object.assign(C,b)}catch(b){console.error("❌ 更新积分状态失败:",b),b.message&&(b.message.includes("令牌")||b.message.includes("401"))&&(console.log("🔒 认证错误，重置积分状态"),Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}))}finally{r.value=!1}},z=()=>{M.value="login",f.value=!0},t=async b=>{console.log("认证成功，更新用户信息:",b),I.value=b.user,b.user&&localStorage.setItem("user_info",JSON.stringify(b.user)),p("login",b);try{r.value=!0,console.log("🚀 登录成功，直接获取积分状态...");const x=await O.getPointsStatus();console.log("✅ 积分状态更新成功:",x),Object.assign(C,x)}catch(x){console.error("❌ 更新积分状态失败:",x)}finally{r.value=!1}f.value=!1},n=()=>{v.value&&c.push("/")},j=()=>{c.push("/")},le=()=>{c.push("/profile")},ie=async()=>{console.log("🔄 收到积分更新事件，强制刷新积分状态"),O.clearCache(),await A()},Q=()=>{console.log("🔄 初始化用户信息...");const b=N.getToken(),x=N.getLocalUserInfo();console.log("Token存在:",!!b),console.log("本地用户信息:",x),b&&x?(I.value=x,C.isLoggedIn=!0,console.log("✅ 设置用户信息:",I.value),console.log("✅ 设置登录状态为true"),X()):(console.log("❌ 未找到有效的登录信息"),I.value=null,C.isLoggedIn=!1)},X=async()=>{try{(await N.getCurrentUser()).success||console.warn("Token验证失败，但不立即登出用户")}catch(b){console.warn("Token验证出错，但不立即登出用户:",b)}},G=async()=>{console.log("🔄 收到积分更新事件，刷新积分显示"),await A()};W(()=>{Q(),A(),U.on(V.POINTS_UPDATED,G),U.on(V.POINTS_CONSUMED,G)}),Z(()=>{U.off(V.POINTS_UPDATED,G),U.off(V.POINTS_CONSUMED,G)}),s({updatePointsStatus:A,getCurrentPoints:()=>C.current,hasEnoughPoints:()=>C.canGenerate,showLoginModal:()=>{M.value="login",f.value=!0}});const Y={props:e,emit:p,router:c,route:i,pageTitle:h,showBackButton:v,showPointsModal:m,showAuthModal:f,authMode:M,loading:y,pointsLoading:r,userInfo:I,isLoggedIn:E,pointsStatus:C,updatePointsStatus:A,showLoginModal:z,handleAuthSuccess:t,handleLeftClick:n,goToHome:j,goToProfile:le,handlePointsUpdated:ie,initUserInfo:Q,validateTokenSilently:X,handlePointsUpdateEvent:G,ref:w,reactive:J,computed:T,onMounted:W,onUnmounted:Z,get useRouter(){return se},get useRoute(){return oe},get Toast(){return g},get authApi(){return N},get levelCardPointsManager(){return O},PointsModal:Oe,AuthModal:Qe,get eventBus(){return U},get EVENTS(){return V}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},Ye={class:"nav-left"},$e={key:0,class:"back-button"},es={class:"nav-right"},ss={key:0,class:"points-text"},os={class:"nav-user"};function as(l,s,a,e,p,c){const i=P("van-icon"),h=P("van-loading"),v=P("van-nav-bar");return d(),_(K,null,[u(v,{"left-arrow":e.showBackButton,onClickLeft:e.handleLeftClick,class:"top-navigation",fixed:"",placeholder:""},{left:S(()=>[o("div",Ye,[e.showBackButton?(d(),_("div",$e,[u(i,{name:"arrow-left",size:"18",color:"#fff"})])):(d(),_("div",{key:1,class:"nav-branding",onClick:e.goToHome},s[3]||(s[3]=[o("span",{class:"palette-emoji"},"🎨",-1),o("span",{class:"brand-text"},"AI Magic",-1)])))])]),title:S(()=>s[4]||(s[4]=[])),right:S(()=>[o("div",es,[e.isLoggedIn?(d(),_("div",{key:0,class:"nav-points",onClick:s[0]||(s[0]=m=>e.showPointsModal=!0),title:"点击查看积分详情"},[u(i,{name:"diamond-o",size:"16"}),e.pointsLoading?(d(),R(h,{key:1,size:"12",color:"var(--primary-color)"})):(d(),_("span",ss,L(e.pointsStatus.current),1))])):k("",!0),o("div",os,[e.isLoggedIn?(d(),_("div",{key:1,onClick:e.goToProfile,title:"点击进入个人中心"},[u(i,{name:"user-o",size:"16"})])):(d(),_("div",{key:0,onClick:e.showLoginModal,title:"点击登录"},[u(i,{name:"user-o",size:"16"}),s[5]||(s[5]=o("span",{class:"user-text"},"登录",-1))]))])])]),_:1},8,["left-arrow"]),u(e.PointsModal,{show:e.showPointsModal,"onUpdate:show":s[1]||(s[1]=m=>e.showPointsModal=m),onPointsUpdated:e.handlePointsUpdated},null,8,["show"]),u(e.AuthModal,{show:e.showAuthModal,"onUpdate:show":s[2]||(s[2]=m=>e.showAuthModal=m),"default-mode":e.authMode,onSuccess:e.handleAuthSuccess},null,8,["show","default-mode"])],64)}const ts=F(Xe,[["render",as],["__scopeId","data-v-5f73bff2"],["__file","D:/workspace/AIMagic/client/src/components/TopNavigation.vue"]]),ns={__name:"MobilePageContainer",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(l,{expose:s}){const a=w(null);s({showLoginModal:()=>{a.value&&a.value.showLoginModal()}});const e={topNavigationRef:a,ref:w,TopNavigation:ts};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},ls={class:"mobile-page"},is={key:0,class:"mobile-page-notice"},rs={class:"mobile-page-content"},cs={key:0,class:"mobile-page-header"},ds={class:"mobile-page-main"},us={key:1,class:"mobile-page-footer"};function ms(l,s,a,e,p,c){return d(),_("div",ls,[u(e.TopNavigation,{ref:"topNavigationRef",title:a.title,"show-back":a.showBack,onLogin:s[0]||(s[0]=i=>l.$emit("login",i)),onLogout:s[1]||(s[1]=i=>l.$emit("logout",i))},null,8,["title","show-back"]),l.$slots.notice?(d(),_("div",is,[D(l.$slots,"notice",{},void 0)])):k("",!0),o("div",rs,[l.$slots.header?(d(),_("div",cs,[D(l.$slots,"header",{},void 0)])):k("",!0),o("div",ds,[D(l.$slots,"default",{},void 0)]),l.$slots.footer?(d(),_("div",us,[D(l.$slots,"footer",{},void 0)])):k("",!0)])])}const Ps=F(ns,[["render",ms],["__scopeId","data-v-99cf0221"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobilePageContainer.vue"]]),fs={__name:"MobileCard",props:{title:{type:String,default:""},icon:{type:String,default:""},iconSize:{type:[String,Number],default:16},iconColor:{type:String,default:"var(--van-primary-color, #1989fa)"},clickable:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},inset:{type:Boolean,default:!1}},emits:["click"],setup(l,{expose:s,emit:a}){s();const e=l,p=a,i={props:e,emit:p,handleClick:()=>{e.clickable&&p("click")}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}},gs={key:0,class:"mobile-card-header"},ps={key:0,class:"mobile-card-title"},vs={key:0,class:"mobile-card-custom-icon"},_s={class:"mobile-card-title-text"},hs={class:"mobile-card-content"},bs={key:1,class:"mobile-card-footer"};function ws(l,s,a,e,p,c){const i=P("van-icon");return d(),_("div",{class:ae(["mobile-card",{"mobile-card--clickable":a.clickable,"mobile-card--inset":a.inset}]),onClick:e.handleClick},[a.title||l.$slots.header?(d(),_("div",gs,[a.title?(d(),_("div",ps,[l.$slots.icon?(d(),_("div",vs,[D(l.$slots,"icon",{},void 0)])):a.icon?(d(),R(i,{key:1,name:a.icon,size:a.iconSize,color:a.iconColor,class:"mobile-card-icon"},null,8,["name","size","color"])):k("",!0),o("span",_s,L(a.title),1)])):k("",!0),D(l.$slots,"header",{},void 0),a.clickable&&a.showArrow?(d(),R(i,{key:1,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow-in-header"})):k("",!0)])):k("",!0),o("div",hs,[D(l.$slots,"default",{},void 0)]),l.$slots.footer?(d(),_("div",bs,[D(l.$slots,"footer",{},void 0)])):k("",!0),a.clickable&&a.showArrow&&!a.title&&!l.$slots.header?(d(),R(i,{key:2,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow"})):k("",!0)],2)}const Ms=F(fs,[["render",ws],["__scopeId","data-v-ab97c450"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobileCard.vue"]]),H=(l={})=>({maxSize:10*1024*1024,accept:"image/*",tips:["支持 JPG、PNG 格式","建议尺寸 512x512 以上","图片清晰度影响处理效果"],...l}),ys={"clothes-swap":{id:"clothes-swap",title:"一键褪衣",description:"上传人物照片，AI智能移除服装",processButtonText:"开始处理（消耗20积分）",processingTitle:"正在处理图片...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"main-image",title:"人物照片",icon:"photograph",iconColor:"var(--van-primary-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"选择人物照片",showCount:!1,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","人脸清晰、正面效果更佳"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}},"face-swap":{id:"face-swap",title:"极速换脸",description:"上传人脸照片和目标图片，AI智能换脸",processButtonText:"开始换脸（消耗20积分）",processingTitle:"正在处理换脸...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"face-photos",title:"人脸照片",icon:"friends-o",iconColor:"var(--van-warning-color)",uploadType:"multi",minCount:1,maxCount:4,uploadText:"添加人脸",showCount:!0,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","人脸清晰、正面效果更佳"]})},{id:"target-image",title:"目标图片",icon:"photo-o",iconColor:"var(--van-success-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"选择目标图片",showCount:!1,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","图片清晰度影响换脸效果"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}}};function ks(l){return ys[l]||null}async function Is(l){return await new Promise(s=>setTimeout(s,100)),ks(l)}export{Qe as A,Ms as M,Ps as a,Is as f,ks as g};
