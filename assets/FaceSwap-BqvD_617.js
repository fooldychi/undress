import{_ as x,c as E,o as A,b as n,e as I,d as U,q as P,s as y,x as C,T as t}from"./index-B9-9S23K.js";import"./UnifiedImageProcessingTemplate.vue_vue_type_style_index_0_scoped_1007aace_lang-BKBt1ioy.js";import{U as M}from"./UnifiedImageProcessingTemplate-CT25CNty.js";import"./MobileActionButton-ThDW0Sz7.js";import"./SvgIcon-C5m6uGUh.js";const R={__name:"FaceSwap",setup(S,{expose:h}){h(),console.log("FaceSwapUnified组件已加载，ComfyUI服务已导入");const g=n(null),o=n([]),l=n(null),p=n(null),r=n(null),i=n(!1),u=n(""),d=n(""),f=n(""),m=n(0),v=n(null),w=I(()=>o.value.length>0&&l.value!==null),T=(e,a)=>{if(e==="face-photos"){let s=Array.isArray(a)?a.map(c=>c.url||c):[];if(s.length>0&&s.length<4){const c=s[s.length-1];for(;s.length<4;)s.push(c)}o.value=s,r.value!==null&&(r.value=null),a.length>0&&t.success(`已选择 ${a.length} 张照片${a.length<4?"，自动补齐至4张":""}`)}else e==="target-image"&&(l.value=a,r.value!==null&&(r.value=null))},F=async()=>{if(!w.value){t.fail("请先上传人脸照片和目标图片");return}i.value=!0,u.value="正在初始化...",m.value=0,v.value=Date.now();try{console.log("🚀 开始极速换脸处理");const e=await C({facePhotos:o.value,targetImage:l.value,onProgress:(a,s)=>{u.value=a,m.value=s||0}});if(e.success&&e.imageUrl){r.value=e.imageUrl,p.value=e.targetImageUrl||l.value,d.value=e.promptId||"";const a=Date.now(),s=Math.round((a-v.value)/1e3);f.value=`${s}秒`;const c=e.pointsConsumed?`
消耗${e.pointsConsumed}点积分`:"";t.success(`🎉 换脸完成！${c}`),console.log("✅ 换脸处理完成")}else throw new Error(e.error||"换脸处理失败")}catch(e){console.error("❌ 换脸处理失败:",e),y(e,"换脸处理")||t.fail(`换脸失败: ${e.message}`)}finally{i.value=!1,u.value="",m.value=0}},b=()=>{if(o.value=[],l.value=null,p.value=null,r.value=null,u.value="",d.value="",f.value="",g.value){const{uploadData:e}=g.value;e["face-photos"]&&(e["face-photos"]=[]),e["target-image"]&&(e["target-image"]=null)}t.success("已重置，可以重新选择图片")},D=e=>{if(!e)return;const a=document.createElement("a");a.href=e,a.download=`faceswap_result_${Date.now()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),t.success("图片下载已开始")},L=e=>{console.log("用户登录成功:",e)},k=()=>{console.log("用户已登出")};U(()=>{console.log("FaceSwap组件已挂载，ComfyUI服务已准备就绪")}),P(()=>{i.value&&(i.value=!1)});const _={templateRef:g,facePhotos:o,targetImage:l,originalImageForComparison:p,resultImage:r,isLoading:i,processingStatus:u,promptId:d,processingTime:f,progressPercent:m,startTime:v,canProcess:w,handleUploadChange:T,processImages:F,resetProcess:b,handleDownload:D,handleUserLogin:L,handleUserLogout:k,ref:n,computed:I,onMounted:U,onUnmounted:P,get Toast(){return t},get UnifiedImageProcessingTemplate(){return M},get processFaceSwapImage(){return C},get handleError(){return y}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}};function B(S,h,g,o,l,p){return A(),E(o.UnifiedImageProcessingTemplate,{"function-id":"face-swap","title-icon-name":"face-swap","title-icon-color":"var(--van-warning-color)","process-button-icon-name":"face-swap","is-processing":o.isLoading,progress:o.progressPercent,"processing-description":o.processingStatus,"processing-info":{promptId:o.promptId,processingTime:o.processingTime},"result-data":o.resultImage,"original-image-for-comparison":o.originalImageForComparison,onLogin:o.handleUserLogin,onLogout:o.handleUserLogout,onProcess:o.processImages,onReset:o.resetProcess,onDownload:o.handleDownload,onUploadChange:o.handleUploadChange,ref:"templateRef"},null,8,["is-processing","progress","processing-description","processing-info","result-data","original-image-for-comparison"])}const z=x(R,[["render",B],["__scopeId","data-v-76085970"],["__file","D:/workspace/AIMagic/client/src/views/FaceSwap.vue"]]);export{z as default};
