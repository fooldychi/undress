import{_ as R,b as w,e as T,z as q,K as $,r as P,h as v,o as d,g as o,k,L as re,p as u,t as L,M as ce,N as de,n as ae,w as S,c as E,j as N,F as K,C as ne,f as B,O as J,d as W,P as A,Q as U,q as Z,H as ue,J as ee,T as f,u as se,R as oe,S as G,y as z}from"./index-bHZisnB1.js";const me={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},label:{type:String,default:""},placeholder:{type:String,default:""},leftIcon:{type:String,default:""},rightIcon:{type:String,default:""},clearable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},rules:{type:Array,default:()=>[]},validateTrigger:{type:String,default:"blur"}},emits:["update:modelValue","focus","blur","input","clear","enter"],setup(t,{expose:s,emit:a}){const e=t,p=a,r=w(null),l=w(!1),_=w(!1),g=w(""),h=T({get:()=>e.modelValue,set:i=>p("update:modelValue",i)}),m=T(()=>e.type==="password"?_.value?"text":"password":e.type),I=T(()=>!!g.value),y=async()=>{if(g.value="",!e.rules||e.rules.length===0)return!0;for(const i of e.rules)if(typeof i=="function"){const j=await i(h.value);if(j!==!0)return g.value=j,!1}else{if(i.required&&!h.value)return g.value=i.message||"此字段为必填项",!1;if(i.pattern&&!i.pattern.test(h.value))return g.value=i.message||"格式不正确",!1;if(i.min&&h.value.length<i.min)return g.value=i.message||`最少输入${i.min}个字符`,!1;if(i.max&&h.value.length>i.max)return g.value=i.message||`最多输入${i.max}个字符`,!1}return!0},c=i=>{l.value=!0,p("focus",i)},M=async i=>{l.value=!1,p("blur",i),e.validateTrigger==="blur"&&await y()},D=async i=>{p("input",i),e.validateTrigger==="input"&&await y()},C=()=>{h.value="",g.value="",p("clear"),$(()=>{var i;(i=r.value)==null||i.focus()})},x=i=>{p("enter",i)},V=()=>{_.value=!_.value};q(()=>e.modelValue,()=>{e.validateTrigger==="change"&&y()}),s({focus:()=>{var i;return(i=r.value)==null?void 0:i.focus()},blur:()=>{var i;return(i=r.value)==null?void 0:i.blur()},validate:y,clearError:()=>{g.value=""}});const n={props:e,emit:p,inputRef:r,isFocused:l,showPassword:_,errorMessage:g,inputValue:h,inputType:m,hasError:I,validateInput:y,handleFocus:c,handleBlur:M,handleInput:D,handleClear:C,handleEnter:x,togglePasswordVisibility:V,ref:w,computed:T,watch:q,nextTick:$};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}},fe={class:"input-wrapper"},pe={key:0,class:"input-icon input-icon-left"},ge={key:1,class:"input-label"},ve=["type","placeholder","disabled","readonly"],_e={key:4,class:"input-icon input-icon-right"},he={key:0,class:"input-error"};function be(t,s,a,e,p,r){const l=P("van-icon");return d(),v("div",{class:ae(["base-input",{"is-focused":e.isFocused,"has-error":e.hasError}])},[o("div",fe,[a.leftIcon?(d(),v("div",pe,[u(l,{name:a.leftIcon,size:"16"},null,8,["name"])])):k("",!0),a.label?(d(),v("div",ge,L(a.label),1)):k("",!0),re(o("input",{ref:"inputRef","onUpdate:modelValue":s[0]||(s[0]=_=>e.inputValue=_),type:e.inputType,placeholder:a.placeholder,disabled:a.disabled,readonly:a.readonly,class:"input-control",onFocus:e.handleFocus,onBlur:e.handleBlur,onInput:e.handleInput,onKeyup:de(e.handleEnter,["enter"])},null,40,ve),[[ce,e.inputValue]]),a.clearable&&e.inputValue&&!a.disabled&&!a.readonly?(d(),v("div",{key:2,class:"input-icon input-icon-clear",onClick:e.handleClear},[u(l,{name:"clear",size:"14"})])):k("",!0),a.type==="password"?(d(),v("div",{key:3,class:"input-icon input-icon-password",onClick:e.togglePasswordVisibility},[u(l,{name:e.showPassword?"eye-o":"closed-eye",size:"16"},null,8,["name"])])):k("",!0),a.rightIcon?(d(),v("div",_e,[u(l,{name:a.rightIcon,size:"16"},null,8,["name"])])):k("",!0)]),e.errorMessage?(d(),v("div",he,L(e.errorMessage),1)):k("",!0)],2)}const te=R(me,[["render",be],["__scopeId","data-v-82c69faf"],["__file","D:/workspace/AIMagic/client/src/components/BaseInput.vue"]]),we={name:"PointsModal",components:{BaseInput:te},props:{show:{type:Boolean,default:!1}},emits:["update:show","points-updated"],setup(t,{emit:s}){const a=T({get:()=>t.show,set:n=>s("update:show",n)}),e=w(!1),p=w(!1),r=w(null),l=w(!1),_=w([]),g=T(()=>B.isLoggedIn()),h=T(()=>_.value.some(n=>n.type_name==="体验卡"&&n.remaining_points>0)),m=J({cardNumber:"",cardPassword:""}),I=[{required:!0,message:"请输入卡号"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"卡号格式不正确"}],y=[{required:!0,message:"请输入卡密"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"卡密格式不正确"}],c=()=>{m.cardNumber="",m.cardPassword=""},M=()=>{a.value=!1,l.value=!1,c()},D=()=>{window.open("https://t.me/tgcomfy","_blank"),f.success("正在跳转到Telegram客服")},C=async()=>{if(!B.isLoggedIn()){r.value={total_points:0,cards_count:0,cards_breakdown:[]},_.value=[],e.value=!1;return}try{e.value=!0;const[n,i]=await Promise.all([ue.getUserPoints(),ee.getMyCards()]);n.success?r.value=n.data:(console.error("获取积分信息失败:",n.message),n.message&&n.message.includes("令牌")?(f.fail("请先登录"),r.value={total_points:0,cards_count:0,cards_breakdown:[]}):f.fail("获取积分信息失败")),i.success?_.value=i.data.cards||[]:(console.error("获取用户卡片信息失败:",i.message),_.value=[])}catch(n){console.error("加载积分信息失败:",n),n.message&&(n.message.includes("令牌")||n.message.includes("401")||n.message.includes("登录已过期"))?(f.fail("登录已过期，请重新登录"),r.value={total_points:0,cards_count:0,cards_breakdown:[]}):n.message&&n.message.includes("网络连接失败")?f.fail("网络连接失败，请检查服务器状态"):f.fail("获取积分信息失败"),_.value=[]}finally{e.value=!1}},x=async()=>{if(!p.value){if(!B.isLoggedIn()){f.fail("请先登录");return}if(!m.cardNumber.trim()){f.fail("请输入卡号");return}if(!m.cardPassword.trim()){f.fail("请输入卡密");return}p.value=!0;try{console.log("🎫 尝试绑定等级卡:",{cardNumber:m.cardNumber.trim(),hasUnusedExperienceCard:h.value,userCards:_.value});const n=await ee.bindCard(m.cardNumber.trim(),m.cardPassword.trim());if(console.log("🎫 绑定响应:",n),n.success){f.success(n.message||"绑定成功，正在更新积分..."),f.loading({message:"正在更新积分信息...",forbidClick:!0,duration:0});try{await C(),f.clear(),f.success("等级卡绑定成功，积分已更新"),s("points-updated",n.data)}catch(i){f.clear(),console.error("更新积分信息失败:",i),f.fail("积分更新失败，请刷新页面")}c()}else console.error("绑定失败:",n.message),n.message&&n.message.includes("令牌")?f.fail("请先登录"):n.message&&n.message.includes("体验卡")?f.fail(n.message):f.fail(n.message||"绑定失败")}catch(n){if(console.error("🎫 绑定等级卡失败:",n),console.error("🎫 错误详情:",{message:n.message,hasUnusedExperienceCard:h.value,userCards:_.value}),n.message&&(n.message.includes("令牌")||n.message.includes("401")||n.message.includes("登录已过期")))f.fail("登录已过期，请重新登录");else if(n.message&&n.message.includes("体验卡")){const i=n.message.replace(/^请求失败:\s*/,"");f({type:"fail",message:i,duration:4e3})}else n.message&&n.message.includes("网络连接失败")?f.fail("网络连接失败，请检查服务器状态"):f.fail(n.message||"绑定失败")}finally{p.value=!1}}};q(a,n=>{n?C():(c(),l.value=!1)});const V=async()=>{console.log("🔄 PointsModal 收到积分更新事件，刷新积分信息"),t.show&&g.value&&await C()};return W(()=>{A.on(U.POINTS_UPDATED,V),A.on(U.POINTS_CONSUMED,V)}),Z(()=>{A.off(U.POINTS_UPDATED,V),A.off(U.POINTS_CONSUMED,V)}),{visible:a,loading:e,bindLoading:p,pointsInfo:r,bindForm:m,cardNumberRules:I,cardPasswordRules:y,showPurchaseModal:l,isLoggedIn:g,userCards:_,hasUnusedExperienceCard:h,closeModal:M,loadPointsInfo:C,handleBindCard:x,contactCustomerService:D}}},ye={class:"points-modal"},ke={class:"modal-header"},Ce={class:"modal-title"},Pe={key:1,class:"modal-content"},Ie={key:0,class:"login-prompt"},Me={class:"points-overview"},Se={class:"points-total"},Te={class:"points-number"},xe={class:"purchase-btn-container"},Ne={class:"bind-section"},Be={class:"section-title"},Le={key:0,class:"experience-card-notice"},Ae={class:"bind-actions"},Ue={class:"purchase-modal"},Ve={class:"modal-header"},ze={class:"modal-title"},De={class:"modal-content"},Ee={class:"contact-section"};function Re(t,s,a,e,p,r){const l=P("van-icon"),_=P("van-loading"),g=P("van-button"),h=P("van-notice-bar"),m=P("BaseInput"),I=P("van-popup");return d(),v(K,null,[u(I,{show:e.visible,"onUpdate:show":s[4]||(s[4]=y=>e.visible=y),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>{var y;return[o("div",ye,[o("div",ke,[o("h2",Ce,[u(l,{name:"diamond-o",size:"24"}),s[7]||(s[7]=N(" 我的积分 "))]),u(l,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),e.loading?(d(),E(_,{key:0,class:"loading-center",size:"24px",vertical:""},{default:S(()=>s[8]||(s[8]=[N(" 加载中... ")])),_:1,__:[8]})):(d(),v("div",Pe,[e.isLoggedIn?(d(),v(K,{key:1},[o("div",Me,[o("div",Se,[o("div",Te,L(((y=e.pointsInfo)==null?void 0:y.total_points)||0),1),s[13]||(s[13]=o("div",{class:"points-label"},"总积分",-1))]),o("div",xe,[u(g,{type:"primary",round:"",onClick:s[0]||(s[0]=c=>e.showPurchaseModal=!0),class:"purchase-btn"},{default:S(()=>[u(l,{name:"shopping-cart-o",size:"14"}),s[14]||(s[14]=N(" 购买等级卡 "))]),_:1,__:[14]})])]),o("div",Ne,[o("h3",Be,[u(l,{name:"credit-pay",size:"16"}),s[15]||(s[15]=N(" 绑定等级卡 "))]),e.hasUnusedExperienceCard?(d(),v("div",Le,[u(h,{"left-icon":"info-o",color:"#ff6b35",background:"rgba(255, 107, 53, 0.1)",text:"提示：您已有可用的体验卡，体验卡在使用前不可叠加绑定。"})])):k("",!0),o("form",{onSubmit:s[3]||(s[3]=ne((...c)=>e.handleBindCard&&e.handleBindCard(...c),["prevent"])),class:"bind-form"},[u(m,{modelValue:e.bindForm.cardNumber,"onUpdate:modelValue":s[1]||(s[1]=c=>e.bindForm.cardNumber=c),placeholder:"请输入卡号",rules:e.cardNumberRules,clearable:"",class:"bind-input-full"},null,8,["modelValue","rules"]),u(m,{modelValue:e.bindForm.cardPassword,"onUpdate:modelValue":s[2]||(s[2]=c=>e.bindForm.cardPassword=c),type:"password",placeholder:"请输入卡密",rules:e.cardPasswordRules,clearable:"",class:"bind-input-full"},null,8,["modelValue","rules"]),o("div",Ae,[u(g,{type:"primary","native-type":"submit",round:"",block:"",loading:e.bindLoading,disabled:e.bindLoading,class:"bind-button"},{default:S(()=>[N(L(e.bindLoading?"绑定中...":"绑定"),1)]),_:1},8,["loading","disabled"])])],32)])],64)):(d(),v("div",Ie,[s[10]||(s[10]=o("div",{class:"prompt-icon"},"🔐",-1)),s[11]||(s[11]=o("div",{class:"prompt-title"},"请先登录",-1)),s[12]||(s[12]=o("div",{class:"prompt-desc"},"登录后即可查看积分信息和绑定等级卡",-1)),u(g,{type:"primary",round:"",block:"",onClick:e.closeModal,class:"login-btn"},{default:S(()=>s[9]||(s[9]=[N(" 去登录 ")])),_:1,__:[9]},8,["onClick"])]))]))])]}),_:1},8,["show"]),u(I,{show:e.showPurchaseModal,"onUpdate:show":s[6]||(s[6]=y=>e.showPurchaseModal=y),position:"center",style:{width:"95%",maxWidth:"450px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ue,[o("div",Ve,[o("h2",ze,[u(l,{name:"shopping-cart-o",size:"24"}),s[16]||(s[16]=N(" 购买等级卡 "))]),u(l,{name:"cross",size:"20",class:"close-btn",onClick:s[5]||(s[5]=y=>e.showPurchaseModal=!1)})]),o("div",De,[s[18]||(s[18]=o("div",{class:"card-types-grid"},[o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥉"),o("div",{class:"card-name"},"基础卡"),o("div",{class:"card-price"},"¥9.9"),o("div",{class:"card-points"},"300积分")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥈"),o("div",{class:"card-name"},"高级卡"),o("div",{class:"card-price"},"¥30"),o("div",{class:"card-points"},"1000积分")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"🥇"),o("div",{class:"card-name"},"至尊卡"),o("div",{class:"card-price"},"¥50"),o("div",{class:"card-points"},"2000积分")])],-1)),s[19]||(s[19]=o("div",{class:"exchange-process"},[o("h4",{class:"process-title"},"兑换流程"),o("div",{class:"process-steps"},[o("div",{class:"process-step"},[o("div",{class:"step-number"},"1"),o("div",{class:"step-text"},"加客服")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"2"),o("div",{class:"step-text"},"发红包")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"3"),o("div",{class:"step-text"},"收卡号")]),o("div",{class:"process-arrow"},"→"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"4"),o("div",{class:"step-text"},"绑定")])])],-1)),o("div",Ee,[u(g,{type:"primary",round:"",onClick:e.contactCustomerService,class:"contact-btn"},{default:S(()=>[u(l,{name:"chat-o",size:"14"}),s[17]||(s[17]=N(" 联系客服 "))]),_:1,__:[17]},8,["onClick"])])])])]),_:1},8,["show"])],64)}const Oe=R(we,[["render",Re],["__scopeId","data-v-5b8f686e"],["__file","D:/workspace/AIMagic/client/src/components/PointsModal.vue"]]),Fe={name:"AuthModal",components:{BaseInput:te},props:{show:{type:Boolean,default:!1},defaultMode:{type:String,default:"login",validator:t=>["login","register"].includes(t)}},emits:["update:show","success"],setup(t,{emit:s}){const a=T({get:()=>t.show,set:c=>s("update:show",c)}),e=w(t.defaultMode==="login"),p=w(!1),r=J({username:"",password:"",confirmPassword:""}),l=[{required:!0,message:"请输入用户名"},{pattern:/^[a-zA-Z0-9]{3,30}$/,message:"用户名只能包含字母和数字，长度3-30位"}],_=[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"}],g=T(()=>[{required:!0,message:"请确认密码"},{validator:c=>c===r.password,message:"两次输入的密码不一致"}]),h=()=>{r.username="",r.password="",r.confirmPassword=""},m=()=>{e.value=!e.value,h()},I=()=>{a.value=!1,h()},y=async()=>{if(!p.value){if(!r.username.trim()){f.fail("请输入用户名");return}if(!r.password.trim()){f.fail("请输入密码");return}if(!e.value&&r.password!==r.confirmPassword){f.fail("两次输入的密码不一致");return}p.value=!0;try{let c;if(e.value?c=await B.login(r.username,r.password):c=await B.register(r.username,r.password),c.success){console.log("认证成功，响应数据:",c),e.value?f.success("登录成功，正在加载用户数据..."):f.success(c.message||"注册成功");const M={type:e.value?"login":"register",user:c.data.user};console.log("触发success事件，数据:",M),s("success",M),I()}else console.log("认证失败，响应数据:",c),f.fail(c.message||(e.value?"登录失败":"注册失败"))}catch(c){console.error("认证失败:",c),f.fail(c.message||(e.value?"登录失败":"注册失败"))}finally{p.value=!1}}};return q(a,c=>{c&&(e.value=t.defaultMode==="login",h())}),{visible:a,isLogin:e,loading:p,formData:r,usernameRules:l,passwordRules:_,confirmPasswordRules:g,toggleMode:m,closeModal:I,handleSubmit:y}}},Ge={class:"auth-modal"},je={class:"auth-header"},qe={class:"auth-title"},Je={class:"auth-form"},He={class:"auth-actions"},Ke={class:"auth-switch"},We={class:"switch-text"};function Ze(t,s,a,e,p,r){const l=P("van-icon"),_=P("BaseInput"),g=P("van-button"),h=P("van-popup");return d(),E(h,{show:e.visible,"onUpdate:show":s[4]||(s[4]=m=>e.visible=m),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ge,[o("div",je,[o("h2",qe,L(e.isLogin?"登录":"注册"),1),u(l,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),o("div",Je,[o("form",{onSubmit:s[3]||(s[3]=ne((...m)=>e.handleSubmit&&e.handleSubmit(...m),["prevent"]))},[u(_,{modelValue:e.formData.username,"onUpdate:modelValue":s[0]||(s[0]=m=>e.formData.username=m),label:"用户名",placeholder:"请输入用户名","left-icon":"user-o",rules:e.usernameRules,clearable:""},null,8,["modelValue","rules"]),u(_,{modelValue:e.formData.password,"onUpdate:modelValue":s[1]||(s[1]=m=>e.formData.password=m),type:"password",label:"密码",placeholder:"请输入密码","left-icon":"lock",rules:e.passwordRules,clearable:""},null,8,["modelValue","rules"]),e.isLogin?k("",!0):(d(),E(_,{key:0,modelValue:e.formData.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=m=>e.formData.confirmPassword=m),type:"password",label:"确认密码",placeholder:"请再次输入密码","left-icon":"lock",rules:e.confirmPasswordRules,clearable:""},null,8,["modelValue","rules"])),o("div",He,[u(g,{type:"primary","native-type":"submit",block:"",round:"",loading:e.loading,disabled:e.loading,class:"auth-submit-btn"},{default:S(()=>[N(L(e.loading?e.isLogin?"登录中...":"注册中...":e.isLogin?"登录":"注册"),1)]),_:1},8,["loading","disabled"])])],32),o("div",Ke,[o("span",We,L(e.isLogin?"还没有账号？":"已有账号？"),1),u(g,{type:"primary",plain:"",size:"small",onClick:e.toggleMode},{default:S(()=>[N(L(e.isLogin?"立即注册":"立即登录"),1)]),_:1},8,["onClick"])])])])]),_:1},8,["show"])}const Qe=R(Fe,[["render",Ze],["__scopeId","data-v-c3c6d662"],["__file","D:/workspace/AIMagic/client/src/components/AuthModal.vue"]]),Xe={__name:"TopNavigation",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(t,{expose:s,emit:a}){const e=t,p=a,r=se(),l=oe(),_=T(()=>e.title?e.title:{"/":"AI Magic","/clothes-swap":"一键换衣","/face-swap":"极速换脸","/text-to-image":"文生图","/profile":"个人中心"}[l.path]||"AI Magic"),g=T(()=>e.showBack!==null?e.showBack:l.path!=="/"),h=w(!1),m=w(!1),I=w("login"),y=w(!1),c=w(!1),M=w(null),D=T(()=>{const b=B.isLoggedIn(),F=!!M.value;return b&&F}),C=J({current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}),x=async()=>{if(console.log("🔄 更新积分状态，当前登录状态:",G.isLoggedIn(),D.value),!G.isLoggedIn()||!D.value){console.log("❌ 未登录，设置默认积分状态"),c.value=!1,Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1});return}try{c.value=!0,console.log("🚀 发送积分API请求...");const b=await G.getPointsStatus();console.log("✅ 积分状态更新成功:",b),Object.assign(C,b)}catch(b){console.error("❌ 更新积分状态失败:",b),b.message&&(b.message.includes("令牌")||b.message.includes("401"))&&(console.log("🔒 认证错误，重置积分状态"),Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}))}finally{c.value=!1}},V=()=>{I.value="login",m.value=!0},n=async b=>{console.log("认证成功，更新用户信息:",b),M.value=b.user,b.user&&localStorage.setItem("user_info",JSON.stringify(b.user)),C.isLoggedIn=!0,p("login",b),await x(),m.value=!1},i=()=>{g.value&&r.push("/")},j=()=>{r.push("/")},le=()=>{r.push("/profile")},ie=async()=>{console.log("🔄 收到积分更新事件，强制刷新积分状态"),G.clearCache(),await x()},Q=()=>{console.log("🔄 初始化用户信息...");const b=B.getToken(),F=B.getLocalUserInfo();console.log("Token存在:",!!b),console.log("本地用户信息:",F),b&&F?(M.value=F,C.isLoggedIn=!0,console.log("✅ 设置用户信息:",M.value),console.log("✅ 设置登录状态为true"),X()):(console.log("❌ 未找到有效的登录信息"),M.value=null,C.isLoggedIn=!1)},X=async()=>{try{(await B.getCurrentUser()).success||console.warn("Token验证失败，但不立即登出用户")}catch(b){console.warn("Token验证出错，但不立即登出用户:",b)}},O=async()=>{console.log("🔄 收到积分更新事件，刷新积分显示"),await x()};W(()=>{Q(),x(),A.on(U.POINTS_UPDATED,O),A.on(U.POINTS_CONSUMED,O)}),Z(()=>{A.off(U.POINTS_UPDATED,O),A.off(U.POINTS_CONSUMED,O)}),s({updatePointsStatus:x,getCurrentPoints:()=>C.current,hasEnoughPoints:()=>C.canGenerate,showLoginModal:()=>{I.value="login",m.value=!0}});const Y={props:e,emit:p,router:r,route:l,pageTitle:_,showBackButton:g,showPointsModal:h,showAuthModal:m,authMode:I,loading:y,pointsLoading:c,userInfo:M,isLoggedIn:D,pointsStatus:C,updatePointsStatus:x,showLoginModal:V,handleAuthSuccess:n,handleLeftClick:i,goToHome:j,goToProfile:le,handlePointsUpdated:ie,initUserInfo:Q,validateTokenSilently:X,handlePointsUpdateEvent:O,ref:w,reactive:J,computed:T,onMounted:W,onUnmounted:Z,get useRouter(){return se},get useRoute(){return oe},get Toast(){return f},get authApi(){return B},get levelCardPointsManager(){return G},PointsModal:Oe,AuthModal:Qe,get eventBus(){return A},get EVENTS(){return U}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},Ye={class:"nav-left"},$e={key:0,class:"back-button"},es={class:"nav-right"},ss={key:0,class:"points-text"},os={class:"nav-user"};function as(t,s,a,e,p,r){const l=P("van-icon"),_=P("van-loading"),g=P("van-nav-bar");return d(),v(K,null,[u(g,{"left-arrow":e.showBackButton,onClickLeft:e.handleLeftClick,class:"top-navigation",fixed:"",placeholder:""},{left:S(()=>[o("div",Ye,[e.showBackButton?(d(),v("div",$e,[u(l,{name:"arrow-left",size:"18",color:"#fff"})])):(d(),v("div",{key:1,class:"nav-branding",onClick:e.goToHome},s[3]||(s[3]=[o("span",{class:"palette-emoji"},"🎨",-1),o("span",{class:"brand-text"},"AI Magic",-1)])))])]),title:S(()=>s[4]||(s[4]=[])),right:S(()=>[o("div",es,[e.isLoggedIn?(d(),v("div",{key:0,class:"nav-points",onClick:s[0]||(s[0]=h=>e.showPointsModal=!0),title:"点击查看积分详情"},[u(l,{name:"diamond-o",size:"16"}),e.pointsLoading?(d(),E(_,{key:1,size:"12",color:"var(--primary-color)"})):(d(),v("span",ss,L(e.pointsStatus.current),1))])):k("",!0),o("div",os,[e.isLoggedIn?(d(),v("div",{key:1,onClick:e.goToProfile,title:"点击进入个人中心"},[u(l,{name:"user-o",size:"16"})])):(d(),v("div",{key:0,onClick:e.showLoginModal,title:"点击登录"},[u(l,{name:"user-o",size:"16"}),s[5]||(s[5]=o("span",{class:"user-text"},"登录",-1))]))])])]),_:1},8,["left-arrow"]),u(e.PointsModal,{show:e.showPointsModal,"onUpdate:show":s[1]||(s[1]=h=>e.showPointsModal=h),onPointsUpdated:e.handlePointsUpdated},null,8,["show"]),u(e.AuthModal,{show:e.showAuthModal,"onUpdate:show":s[2]||(s[2]=h=>e.showAuthModal=h),"default-mode":e.authMode,onSuccess:e.handleAuthSuccess},null,8,["show","default-mode"])],64)}const ns=R(Xe,[["render",as],["__scopeId","data-v-5f73bff2"],["__file","D:/workspace/AIMagic/client/src/components/TopNavigation.vue"]]),ts={__name:"MobilePageContainer",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(t,{expose:s}){const a=w(null);s({showLoginModal:()=>{a.value&&a.value.showLoginModal()}});const e={topNavigationRef:a,ref:w,TopNavigation:ns};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},ls={class:"mobile-page"},is={key:0,class:"mobile-page-notice"},rs={class:"mobile-page-content"},cs={key:0,class:"mobile-page-header"},ds={class:"mobile-page-main"},us={key:1,class:"mobile-page-footer"};function ms(t,s,a,e,p,r){return d(),v("div",ls,[u(e.TopNavigation,{ref:"topNavigationRef",title:a.title,"show-back":a.showBack,onLogin:s[0]||(s[0]=l=>t.$emit("login",l)),onLogout:s[1]||(s[1]=l=>t.$emit("logout",l))},null,8,["title","show-back"]),t.$slots.notice?(d(),v("div",is,[z(t.$slots,"notice",{},void 0)])):k("",!0),o("div",rs,[t.$slots.header?(d(),v("div",cs,[z(t.$slots,"header",{},void 0)])):k("",!0),o("div",ds,[z(t.$slots,"default",{},void 0)]),t.$slots.footer?(d(),v("div",us,[z(t.$slots,"footer",{},void 0)])):k("",!0)])])}const Ps=R(ts,[["render",ms],["__scopeId","data-v-99cf0221"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobilePageContainer.vue"]]),fs={__name:"MobileCard",props:{title:{type:String,default:""},icon:{type:String,default:""},iconSize:{type:[String,Number],default:16},iconColor:{type:String,default:"var(--van-primary-color, #1989fa)"},clickable:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},inset:{type:Boolean,default:!1}},emits:["click"],setup(t,{expose:s,emit:a}){s();const e=t,p=a,l={props:e,emit:p,handleClick:()=>{e.clickable&&p("click")}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},ps={key:0,class:"mobile-card-header"},gs={key:0,class:"mobile-card-title"},vs={key:0,class:"mobile-card-custom-icon"},_s={class:"mobile-card-title-text"},hs={class:"mobile-card-content"},bs={key:1,class:"mobile-card-footer"};function ws(t,s,a,e,p,r){const l=P("van-icon");return d(),v("div",{class:ae(["mobile-card",{"mobile-card--clickable":a.clickable,"mobile-card--inset":a.inset}]),onClick:e.handleClick},[a.title||t.$slots.header?(d(),v("div",ps,[a.title?(d(),v("div",gs,[t.$slots.icon?(d(),v("div",vs,[z(t.$slots,"icon",{},void 0)])):a.icon?(d(),E(l,{key:1,name:a.icon,size:a.iconSize,color:a.iconColor,class:"mobile-card-icon"},null,8,["name","size","color"])):k("",!0),o("span",_s,L(a.title),1)])):k("",!0),z(t.$slots,"header",{},void 0),a.clickable&&a.showArrow?(d(),E(l,{key:1,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow-in-header"})):k("",!0)])):k("",!0),o("div",hs,[z(t.$slots,"default",{},void 0)]),t.$slots.footer?(d(),v("div",bs,[z(t.$slots,"footer",{},void 0)])):k("",!0),a.clickable&&a.showArrow&&!a.title&&!t.$slots.header?(d(),E(l,{key:2,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow"})):k("",!0)],2)}const Is=R(fs,[["render",ws],["__scopeId","data-v-ab97c450"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobileCard.vue"]]),H=(t={})=>({maxSize:10*1024*1024,accept:"image/*",tips:["支持 JPG、PNG 格式","建议尺寸 512x512 以上","图片清晰度影响处理效果"],...t}),ys={"clothes-swap":{id:"clothes-swap",title:"一键褪衣",description:"上传人物照片，AI智能移除服装",processButtonText:"开始处理（消耗20积分）",processingTitle:"正在处理图片...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"main-image",title:"人物照片",icon:"photograph",iconColor:"var(--van-primary-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"选择人物照片",showCount:!1,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","人脸清晰、正面效果更佳"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}},"face-swap":{id:"face-swap",title:"极速换脸",description:"上传人脸照片和目标图片，AI智能换脸",processButtonText:"开始换脸（消耗20积分）",processingTitle:"正在处理换脸...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"face-photos",title:"人脸照片",icon:"friends-o",iconColor:"var(--van-warning-color)",uploadType:"multi",minCount:1,maxCount:4,uploadText:"添加人脸",showCount:!0,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","人脸清晰、正面效果更佳"]})},{id:"target-image",title:"目标图片",icon:"photo-o",iconColor:"var(--van-success-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"选择目标图片",showCount:!1,...H({tips:["支持 JPG、PNG 格式","建议尺寸 1080x1080 以下","图片大小应在 10M 以下","图片清晰度影响换脸效果"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}}};function ks(t){return ys[t]||null}async function Ms(t){return await new Promise(s=>setTimeout(s,100)),ks(t)}export{Qe as A,Is as M,Ps as a,Ms as f,ks as g};
