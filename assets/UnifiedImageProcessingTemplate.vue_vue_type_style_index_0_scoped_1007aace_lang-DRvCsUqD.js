import{_ as R,b as w,e as T,z as q,K as $,r as P,h as v,o as d,g as o,k,L as re,p as u,t as L,M as ce,N as de,n as ae,w as S,c as E,j as N,F as K,C as ne,f as B,O as J,d as W,P as A,Q as U,q as Z,H as ue,J as ee,T as f,u as se,R as oe,S as G,y as z}from"./index-bHZisnB1.js";const me={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},label:{type:String,default:""},placeholder:{type:String,default:""},leftIcon:{type:String,default:""},rightIcon:{type:String,default:""},clearable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},rules:{type:Array,default:()=>[]},validateTrigger:{type:String,default:"blur"}},emits:["update:modelValue","focus","blur","input","clear","enter"],setup(t,{expose:s,emit:a}){const e=t,p=a,r=w(null),l=w(!1),_=w(!1),g=w(""),h=T({get:()=>e.modelValue,set:i=>p("update:modelValue",i)}),m=T(()=>e.type==="password"?_.value?"text":"password":e.type),I=T(()=>!!g.value),y=async()=>{if(g.value="",!e.rules||e.rules.length===0)return!0;for(const i of e.rules)if(typeof i=="function"){const j=await i(h.value);if(j!==!0)return g.value=j,!1}else{if(i.required&&!h.value)return g.value=i.message||"æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹",!1;if(i.pattern&&!i.pattern.test(h.value))return g.value=i.message||"æ ¼å¼ä¸æ­£ç¡®",!1;if(i.min&&h.value.length<i.min)return g.value=i.message||`æœ€å°‘è¾“å…¥${i.min}ä¸ªå­—ç¬¦`,!1;if(i.max&&h.value.length>i.max)return g.value=i.message||`æœ€å¤šè¾“å…¥${i.max}ä¸ªå­—ç¬¦`,!1}return!0},c=i=>{l.value=!0,p("focus",i)},M=async i=>{l.value=!1,p("blur",i),e.validateTrigger==="blur"&&await y()},D=async i=>{p("input",i),e.validateTrigger==="input"&&await y()},C=()=>{h.value="",g.value="",p("clear"),$(()=>{var i;(i=r.value)==null||i.focus()})},x=i=>{p("enter",i)},V=()=>{_.value=!_.value};q(()=>e.modelValue,()=>{e.validateTrigger==="change"&&y()}),s({focus:()=>{var i;return(i=r.value)==null?void 0:i.focus()},blur:()=>{var i;return(i=r.value)==null?void 0:i.blur()},validate:y,clearError:()=>{g.value=""}});const n={props:e,emit:p,inputRef:r,isFocused:l,showPassword:_,errorMessage:g,inputValue:h,inputType:m,hasError:I,validateInput:y,handleFocus:c,handleBlur:M,handleInput:D,handleClear:C,handleEnter:x,togglePasswordVisibility:V,ref:w,computed:T,watch:q,nextTick:$};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}},fe={class:"input-wrapper"},pe={key:0,class:"input-icon input-icon-left"},ge={key:1,class:"input-label"},ve=["type","placeholder","disabled","readonly"],_e={key:4,class:"input-icon input-icon-right"},he={key:0,class:"input-error"};function be(t,s,a,e,p,r){const l=P("van-icon");return d(),v("div",{class:ae(["base-input",{"is-focused":e.isFocused,"has-error":e.hasError}])},[o("div",fe,[a.leftIcon?(d(),v("div",pe,[u(l,{name:a.leftIcon,size:"16"},null,8,["name"])])):k("",!0),a.label?(d(),v("div",ge,L(a.label),1)):k("",!0),re(o("input",{ref:"inputRef","onUpdate:modelValue":s[0]||(s[0]=_=>e.inputValue=_),type:e.inputType,placeholder:a.placeholder,disabled:a.disabled,readonly:a.readonly,class:"input-control",onFocus:e.handleFocus,onBlur:e.handleBlur,onInput:e.handleInput,onKeyup:de(e.handleEnter,["enter"])},null,40,ve),[[ce,e.inputValue]]),a.clearable&&e.inputValue&&!a.disabled&&!a.readonly?(d(),v("div",{key:2,class:"input-icon input-icon-clear",onClick:e.handleClear},[u(l,{name:"clear",size:"14"})])):k("",!0),a.type==="password"?(d(),v("div",{key:3,class:"input-icon input-icon-password",onClick:e.togglePasswordVisibility},[u(l,{name:e.showPassword?"eye-o":"closed-eye",size:"16"},null,8,["name"])])):k("",!0),a.rightIcon?(d(),v("div",_e,[u(l,{name:a.rightIcon,size:"16"},null,8,["name"])])):k("",!0)]),e.errorMessage?(d(),v("div",he,L(e.errorMessage),1)):k("",!0)],2)}const te=R(me,[["render",be],["__scopeId","data-v-82c69faf"],["__file","D:/workspace/AIMagic/client/src/components/BaseInput.vue"]]),we={name:"PointsModal",components:{BaseInput:te},props:{show:{type:Boolean,default:!1}},emits:["update:show","points-updated"],setup(t,{emit:s}){const a=T({get:()=>t.show,set:n=>s("update:show",n)}),e=w(!1),p=w(!1),r=w(null),l=w(!1),_=w([]),g=T(()=>B.isLoggedIn()),h=T(()=>_.value.some(n=>n.type_name==="ä½“éªŒå¡"&&n.remaining_points>0)),m=J({cardNumber:"",cardPassword:""}),I=[{required:!0,message:"è¯·è¾“å…¥å¡å·"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"å¡å·æ ¼å¼ä¸æ­£ç¡®"}],y=[{required:!0,message:"è¯·è¾“å…¥å¡å¯†"},{pattern:/^[A-Za-z0-9]{6,20}$/,message:"å¡å¯†æ ¼å¼ä¸æ­£ç¡®"}],c=()=>{m.cardNumber="",m.cardPassword=""},M=()=>{a.value=!1,l.value=!1,c()},D=()=>{window.open("https://t.me/tgcomfy","_blank"),f.success("æ­£åœ¨è·³è½¬åˆ°Telegramå®¢æœ")},C=async()=>{if(!B.isLoggedIn()){r.value={total_points:0,cards_count:0,cards_breakdown:[]},_.value=[],e.value=!1;return}try{e.value=!0;const[n,i]=await Promise.all([ue.getUserPoints(),ee.getMyCards()]);n.success?r.value=n.data:(console.error("è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥:",n.message),n.message&&n.message.includes("ä»¤ç‰Œ")?(f.fail("è¯·å…ˆç™»å½•"),r.value={total_points:0,cards_count:0,cards_breakdown:[]}):f.fail("è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥")),i.success?_.value=i.data.cards||[]:(console.error("è·å–ç”¨æˆ·å¡ç‰‡ä¿¡æ¯å¤±è´¥:",i.message),_.value=[])}catch(n){console.error("åŠ è½½ç§¯åˆ†ä¿¡æ¯å¤±è´¥:",n),n.message&&(n.message.includes("ä»¤ç‰Œ")||n.message.includes("401")||n.message.includes("ç™»å½•å·²è¿‡æœŸ"))?(f.fail("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"),r.value={total_points:0,cards_count:0,cards_breakdown:[]}):n.message&&n.message.includes("ç½‘ç»œè¿æ¥å¤±è´¥")?f.fail("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€"):f.fail("è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥"),_.value=[]}finally{e.value=!1}},x=async()=>{if(!p.value){if(!B.isLoggedIn()){f.fail("è¯·å…ˆç™»å½•");return}if(!m.cardNumber.trim()){f.fail("è¯·è¾“å…¥å¡å·");return}if(!m.cardPassword.trim()){f.fail("è¯·è¾“å…¥å¡å¯†");return}p.value=!0;try{console.log("ğŸ« å°è¯•ç»‘å®šç­‰çº§å¡:",{cardNumber:m.cardNumber.trim(),hasUnusedExperienceCard:h.value,userCards:_.value});const n=await ee.bindCard(m.cardNumber.trim(),m.cardPassword.trim());if(console.log("ğŸ« ç»‘å®šå“åº”:",n),n.success){f.success(n.message||"ç»‘å®šæˆåŠŸï¼Œæ­£åœ¨æ›´æ–°ç§¯åˆ†..."),f.loading({message:"æ­£åœ¨æ›´æ–°ç§¯åˆ†ä¿¡æ¯...",forbidClick:!0,duration:0});try{await C(),f.clear(),f.success("ç­‰çº§å¡ç»‘å®šæˆåŠŸï¼Œç§¯åˆ†å·²æ›´æ–°"),s("points-updated",n.data)}catch(i){f.clear(),console.error("æ›´æ–°ç§¯åˆ†ä¿¡æ¯å¤±è´¥:",i),f.fail("ç§¯åˆ†æ›´æ–°å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢")}c()}else console.error("ç»‘å®šå¤±è´¥:",n.message),n.message&&n.message.includes("ä»¤ç‰Œ")?f.fail("è¯·å…ˆç™»å½•"):n.message&&n.message.includes("ä½“éªŒå¡")?f.fail(n.message):f.fail(n.message||"ç»‘å®šå¤±è´¥")}catch(n){if(console.error("ğŸ« ç»‘å®šç­‰çº§å¡å¤±è´¥:",n),console.error("ğŸ« é”™è¯¯è¯¦æƒ…:",{message:n.message,hasUnusedExperienceCard:h.value,userCards:_.value}),n.message&&(n.message.includes("ä»¤ç‰Œ")||n.message.includes("401")||n.message.includes("ç™»å½•å·²è¿‡æœŸ")))f.fail("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");else if(n.message&&n.message.includes("ä½“éªŒå¡")){const i=n.message.replace(/^è¯·æ±‚å¤±è´¥:\s*/,"");f({type:"fail",message:i,duration:4e3})}else n.message&&n.message.includes("ç½‘ç»œè¿æ¥å¤±è´¥")?f.fail("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€"):f.fail(n.message||"ç»‘å®šå¤±è´¥")}finally{p.value=!1}}};q(a,n=>{n?C():(c(),l.value=!1)});const V=async()=>{console.log("ğŸ”„ PointsModal æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œåˆ·æ–°ç§¯åˆ†ä¿¡æ¯"),t.show&&g.value&&await C()};return W(()=>{A.on(U.POINTS_UPDATED,V),A.on(U.POINTS_CONSUMED,V)}),Z(()=>{A.off(U.POINTS_UPDATED,V),A.off(U.POINTS_CONSUMED,V)}),{visible:a,loading:e,bindLoading:p,pointsInfo:r,bindForm:m,cardNumberRules:I,cardPasswordRules:y,showPurchaseModal:l,isLoggedIn:g,userCards:_,hasUnusedExperienceCard:h,closeModal:M,loadPointsInfo:C,handleBindCard:x,contactCustomerService:D}}},ye={class:"points-modal"},ke={class:"modal-header"},Ce={class:"modal-title"},Pe={key:1,class:"modal-content"},Ie={key:0,class:"login-prompt"},Me={class:"points-overview"},Se={class:"points-total"},Te={class:"points-number"},xe={class:"purchase-btn-container"},Ne={class:"bind-section"},Be={class:"section-title"},Le={key:0,class:"experience-card-notice"},Ae={class:"bind-actions"},Ue={class:"purchase-modal"},Ve={class:"modal-header"},ze={class:"modal-title"},De={class:"modal-content"},Ee={class:"contact-section"};function Re(t,s,a,e,p,r){const l=P("van-icon"),_=P("van-loading"),g=P("van-button"),h=P("van-notice-bar"),m=P("BaseInput"),I=P("van-popup");return d(),v(K,null,[u(I,{show:e.visible,"onUpdate:show":s[4]||(s[4]=y=>e.visible=y),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>{var y;return[o("div",ye,[o("div",ke,[o("h2",Ce,[u(l,{name:"diamond-o",size:"24"}),s[7]||(s[7]=N(" æˆ‘çš„ç§¯åˆ† "))]),u(l,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),e.loading?(d(),E(_,{key:0,class:"loading-center",size:"24px",vertical:""},{default:S(()=>s[8]||(s[8]=[N(" åŠ è½½ä¸­... ")])),_:1,__:[8]})):(d(),v("div",Pe,[e.isLoggedIn?(d(),v(K,{key:1},[o("div",Me,[o("div",Se,[o("div",Te,L(((y=e.pointsInfo)==null?void 0:y.total_points)||0),1),s[13]||(s[13]=o("div",{class:"points-label"},"æ€»ç§¯åˆ†",-1))]),o("div",xe,[u(g,{type:"primary",round:"",onClick:s[0]||(s[0]=c=>e.showPurchaseModal=!0),class:"purchase-btn"},{default:S(()=>[u(l,{name:"shopping-cart-o",size:"14"}),s[14]||(s[14]=N(" è´­ä¹°ç­‰çº§å¡ "))]),_:1,__:[14]})])]),o("div",Ne,[o("h3",Be,[u(l,{name:"credit-pay",size:"16"}),s[15]||(s[15]=N(" ç»‘å®šç­‰çº§å¡ "))]),e.hasUnusedExperienceCard?(d(),v("div",Le,[u(h,{"left-icon":"info-o",color:"#ff6b35",background:"rgba(255, 107, 53, 0.1)",text:"æç¤ºï¼šæ‚¨å·²æœ‰å¯ç”¨çš„ä½“éªŒå¡ï¼Œä½“éªŒå¡åœ¨ä½¿ç”¨å‰ä¸å¯å åŠ ç»‘å®šã€‚"})])):k("",!0),o("form",{onSubmit:s[3]||(s[3]=ne((...c)=>e.handleBindCard&&e.handleBindCard(...c),["prevent"])),class:"bind-form"},[u(m,{modelValue:e.bindForm.cardNumber,"onUpdate:modelValue":s[1]||(s[1]=c=>e.bindForm.cardNumber=c),placeholder:"è¯·è¾“å…¥å¡å·",rules:e.cardNumberRules,clearable:"",class:"bind-input-full"},null,8,["modelValue","rules"]),u(m,{modelValue:e.bindForm.cardPassword,"onUpdate:modelValue":s[2]||(s[2]=c=>e.bindForm.cardPassword=c),type:"password",placeholder:"è¯·è¾“å…¥å¡å¯†",rules:e.cardPasswordRules,clearable:"",class:"bind-input-full"},null,8,["modelValue","rules"]),o("div",Ae,[u(g,{type:"primary","native-type":"submit",round:"",block:"",loading:e.bindLoading,disabled:e.bindLoading,class:"bind-button"},{default:S(()=>[N(L(e.bindLoading?"ç»‘å®šä¸­...":"ç»‘å®š"),1)]),_:1},8,["loading","disabled"])])],32)])],64)):(d(),v("div",Ie,[s[10]||(s[10]=o("div",{class:"prompt-icon"},"ğŸ”",-1)),s[11]||(s[11]=o("div",{class:"prompt-title"},"è¯·å…ˆç™»å½•",-1)),s[12]||(s[12]=o("div",{class:"prompt-desc"},"ç™»å½•åå³å¯æŸ¥çœ‹ç§¯åˆ†ä¿¡æ¯å’Œç»‘å®šç­‰çº§å¡",-1)),u(g,{type:"primary",round:"",block:"",onClick:e.closeModal,class:"login-btn"},{default:S(()=>s[9]||(s[9]=[N(" å»ç™»å½• ")])),_:1,__:[9]},8,["onClick"])]))]))])]}),_:1},8,["show"]),u(I,{show:e.showPurchaseModal,"onUpdate:show":s[6]||(s[6]=y=>e.showPurchaseModal=y),position:"center",style:{width:"95%",maxWidth:"450px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ue,[o("div",Ve,[o("h2",ze,[u(l,{name:"shopping-cart-o",size:"24"}),s[16]||(s[16]=N(" è´­ä¹°ç­‰çº§å¡ "))]),u(l,{name:"cross",size:"20",class:"close-btn",onClick:s[5]||(s[5]=y=>e.showPurchaseModal=!1)})]),o("div",De,[s[18]||(s[18]=o("div",{class:"card-types-grid"},[o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"ğŸ¥‰"),o("div",{class:"card-name"},"åŸºç¡€å¡"),o("div",{class:"card-price"},"Â¥9.9"),o("div",{class:"card-points"},"300ç§¯åˆ†")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"ğŸ¥ˆ"),o("div",{class:"card-name"},"é«˜çº§å¡"),o("div",{class:"card-price"},"Â¥30"),o("div",{class:"card-points"},"1000ç§¯åˆ†")]),o("div",{class:"card-type-card"},[o("div",{class:"card-icon"},"ğŸ¥‡"),o("div",{class:"card-name"},"è‡³å°Šå¡"),o("div",{class:"card-price"},"Â¥50"),o("div",{class:"card-points"},"2000ç§¯åˆ†")])],-1)),s[19]||(s[19]=o("div",{class:"exchange-process"},[o("h4",{class:"process-title"},"å…‘æ¢æµç¨‹"),o("div",{class:"process-steps"},[o("div",{class:"process-step"},[o("div",{class:"step-number"},"1"),o("div",{class:"step-text"},"åŠ å®¢æœ")]),o("div",{class:"process-arrow"},"â†’"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"2"),o("div",{class:"step-text"},"å‘çº¢åŒ…")]),o("div",{class:"process-arrow"},"â†’"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"3"),o("div",{class:"step-text"},"æ”¶å¡å·")]),o("div",{class:"process-arrow"},"â†’"),o("div",{class:"process-step"},[o("div",{class:"step-number"},"4"),o("div",{class:"step-text"},"ç»‘å®š")])])],-1)),o("div",Ee,[u(g,{type:"primary",round:"",onClick:e.contactCustomerService,class:"contact-btn"},{default:S(()=>[u(l,{name:"chat-o",size:"14"}),s[17]||(s[17]=N(" è”ç³»å®¢æœ "))]),_:1,__:[17]},8,["onClick"])])])])]),_:1},8,["show"])],64)}const Oe=R(we,[["render",Re],["__scopeId","data-v-5b8f686e"],["__file","D:/workspace/AIMagic/client/src/components/PointsModal.vue"]]),Fe={name:"AuthModal",components:{BaseInput:te},props:{show:{type:Boolean,default:!1},defaultMode:{type:String,default:"login",validator:t=>["login","register"].includes(t)}},emits:["update:show","success"],setup(t,{emit:s}){const a=T({get:()=>t.show,set:c=>s("update:show",c)}),e=w(t.defaultMode==="login"),p=w(!1),r=J({username:"",password:"",confirmPassword:""}),l=[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å"},{pattern:/^[a-zA-Z0-9]{3,30}$/,message:"ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œé•¿åº¦3-30ä½"}],_=[{required:!0,message:"è¯·è¾“å…¥å¯†ç "},{min:6,message:"å¯†ç è‡³å°‘6ä½"}],g=T(()=>[{required:!0,message:"è¯·ç¡®è®¤å¯†ç "},{validator:c=>c===r.password,message:"ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"}]),h=()=>{r.username="",r.password="",r.confirmPassword=""},m=()=>{e.value=!e.value,h()},I=()=>{a.value=!1,h()},y=async()=>{if(!p.value){if(!r.username.trim()){f.fail("è¯·è¾“å…¥ç”¨æˆ·å");return}if(!r.password.trim()){f.fail("è¯·è¾“å…¥å¯†ç ");return}if(!e.value&&r.password!==r.confirmPassword){f.fail("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");return}p.value=!0;try{let c;if(e.value?c=await B.login(r.username,r.password):c=await B.register(r.username,r.password),c.success){console.log("è®¤è¯æˆåŠŸï¼Œå“åº”æ•°æ®:",c),e.value?f.success("ç™»å½•æˆåŠŸï¼Œæ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®..."):f.success(c.message||"æ³¨å†ŒæˆåŠŸ");const M={type:e.value?"login":"register",user:c.data.user};console.log("è§¦å‘successäº‹ä»¶ï¼Œæ•°æ®:",M),s("success",M),I()}else console.log("è®¤è¯å¤±è´¥ï¼Œå“åº”æ•°æ®:",c),f.fail(c.message||(e.value?"ç™»å½•å¤±è´¥":"æ³¨å†Œå¤±è´¥"))}catch(c){console.error("è®¤è¯å¤±è´¥:",c),f.fail(c.message||(e.value?"ç™»å½•å¤±è´¥":"æ³¨å†Œå¤±è´¥"))}finally{p.value=!1}}};return q(a,c=>{c&&(e.value=t.defaultMode==="login",h())}),{visible:a,isLogin:e,loading:p,formData:r,usernameRules:l,passwordRules:_,confirmPasswordRules:g,toggleMode:m,closeModal:I,handleSubmit:y}}},Ge={class:"auth-modal"},je={class:"auth-header"},qe={class:"auth-title"},Je={class:"auth-form"},He={class:"auth-actions"},Ke={class:"auth-switch"},We={class:"switch-text"};function Ze(t,s,a,e,p,r){const l=P("van-icon"),_=P("BaseInput"),g=P("van-button"),h=P("van-popup");return d(),E(h,{show:e.visible,"onUpdate:show":s[4]||(s[4]=m=>e.visible=m),position:"center",style:{width:"90%",maxWidth:"400px",borderRadius:"16px"},"close-on-click-overlay":!1},{default:S(()=>[o("div",Ge,[o("div",je,[o("h2",qe,L(e.isLogin?"ç™»å½•":"æ³¨å†Œ"),1),u(l,{name:"cross",size:"20",class:"close-btn",onClick:e.closeModal},null,8,["onClick"])]),o("div",Je,[o("form",{onSubmit:s[3]||(s[3]=ne((...m)=>e.handleSubmit&&e.handleSubmit(...m),["prevent"]))},[u(_,{modelValue:e.formData.username,"onUpdate:modelValue":s[0]||(s[0]=m=>e.formData.username=m),label:"ç”¨æˆ·å",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å","left-icon":"user-o",rules:e.usernameRules,clearable:""},null,8,["modelValue","rules"]),u(_,{modelValue:e.formData.password,"onUpdate:modelValue":s[1]||(s[1]=m=>e.formData.password=m),type:"password",label:"å¯†ç ",placeholder:"è¯·è¾“å…¥å¯†ç ","left-icon":"lock",rules:e.passwordRules,clearable:""},null,8,["modelValue","rules"]),e.isLogin?k("",!0):(d(),E(_,{key:0,modelValue:e.formData.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=m=>e.formData.confirmPassword=m),type:"password",label:"ç¡®è®¤å¯†ç ",placeholder:"è¯·å†æ¬¡è¾“å…¥å¯†ç ","left-icon":"lock",rules:e.confirmPasswordRules,clearable:""},null,8,["modelValue","rules"])),o("div",He,[u(g,{type:"primary","native-type":"submit",block:"",round:"",loading:e.loading,disabled:e.loading,class:"auth-submit-btn"},{default:S(()=>[N(L(e.loading?e.isLogin?"ç™»å½•ä¸­...":"æ³¨å†Œä¸­...":e.isLogin?"ç™»å½•":"æ³¨å†Œ"),1)]),_:1},8,["loading","disabled"])])],32),o("div",Ke,[o("span",We,L(e.isLogin?"è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ":"å·²æœ‰è´¦å·ï¼Ÿ"),1),u(g,{type:"primary",plain:"",size:"small",onClick:e.toggleMode},{default:S(()=>[N(L(e.isLogin?"ç«‹å³æ³¨å†Œ":"ç«‹å³ç™»å½•"),1)]),_:1},8,["onClick"])])])])]),_:1},8,["show"])}const Qe=R(Fe,[["render",Ze],["__scopeId","data-v-c3c6d662"],["__file","D:/workspace/AIMagic/client/src/components/AuthModal.vue"]]),Xe={__name:"TopNavigation",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(t,{expose:s,emit:a}){const e=t,p=a,r=se(),l=oe(),_=T(()=>e.title?e.title:{"/":"AI Magic","/clothes-swap":"ä¸€é”®æ¢è¡£","/face-swap":"æé€Ÿæ¢è„¸","/text-to-image":"æ–‡ç”Ÿå›¾","/profile":"ä¸ªäººä¸­å¿ƒ"}[l.path]||"AI Magic"),g=T(()=>e.showBack!==null?e.showBack:l.path!=="/"),h=w(!1),m=w(!1),I=w("login"),y=w(!1),c=w(!1),M=w(null),D=T(()=>{const b=B.isLoggedIn(),F=!!M.value;return b&&F}),C=J({current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}),x=async()=>{if(console.log("ğŸ”„ æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œå½“å‰ç™»å½•çŠ¶æ€:",G.isLoggedIn(),D.value),!G.isLoggedIn()||!D.value){console.log("âŒ æœªç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç§¯åˆ†çŠ¶æ€"),c.value=!1,Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1});return}try{c.value=!0,console.log("ğŸš€ å‘é€ç§¯åˆ†APIè¯·æ±‚...");const b=await G.getPointsStatus();console.log("âœ… ç§¯åˆ†çŠ¶æ€æ›´æ–°æˆåŠŸ:",b),Object.assign(C,b)}catch(b){console.error("âŒ æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:",b),b.message&&(b.message.includes("ä»¤ç‰Œ")||b.message.includes("401"))&&(console.log("ğŸ”’ è®¤è¯é”™è¯¯ï¼Œé‡ç½®ç§¯åˆ†çŠ¶æ€"),Object.assign(C,{current:0,total_points:0,cards_count:0,canGenerate:!1,generationCost:20,isLoggedIn:!1}))}finally{c.value=!1}},V=()=>{I.value="login",m.value=!0},n=async b=>{console.log("è®¤è¯æˆåŠŸï¼Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯:",b),M.value=b.user,b.user&&localStorage.setItem("user_info",JSON.stringify(b.user)),C.isLoggedIn=!0,p("login",b),await x(),m.value=!1},i=()=>{g.value&&r.push("/")},j=()=>{r.push("/")},le=()=>{r.push("/profile")},ie=async()=>{console.log("ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†çŠ¶æ€"),G.clearCache(),await x()},Q=()=>{console.log("ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...");const b=B.getToken(),F=B.getLocalUserInfo();console.log("Tokenå­˜åœ¨:",!!b),console.log("æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:",F),b&&F?(M.value=F,C.isLoggedIn=!0,console.log("âœ… è®¾ç½®ç”¨æˆ·ä¿¡æ¯:",M.value),console.log("âœ… è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºtrue"),X()):(console.log("âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯"),M.value=null,C.isLoggedIn=!1)},X=async()=>{try{(await B.getCurrentUser()).success||console.warn("TokenéªŒè¯å¤±è´¥ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·")}catch(b){console.warn("TokenéªŒè¯å‡ºé”™ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·:",b)}},O=async()=>{console.log("ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œåˆ·æ–°ç§¯åˆ†æ˜¾ç¤º"),await x()};W(()=>{Q(),x(),A.on(U.POINTS_UPDATED,O),A.on(U.POINTS_CONSUMED,O)}),Z(()=>{A.off(U.POINTS_UPDATED,O),A.off(U.POINTS_CONSUMED,O)}),s({updatePointsStatus:x,getCurrentPoints:()=>C.current,hasEnoughPoints:()=>C.canGenerate,showLoginModal:()=>{I.value="login",m.value=!0}});const Y={props:e,emit:p,router:r,route:l,pageTitle:_,showBackButton:g,showPointsModal:h,showAuthModal:m,authMode:I,loading:y,pointsLoading:c,userInfo:M,isLoggedIn:D,pointsStatus:C,updatePointsStatus:x,showLoginModal:V,handleAuthSuccess:n,handleLeftClick:i,goToHome:j,goToProfile:le,handlePointsUpdated:ie,initUserInfo:Q,validateTokenSilently:X,handlePointsUpdateEvent:O,ref:w,reactive:J,computed:T,onMounted:W,onUnmounted:Z,get useRouter(){return se},get useRoute(){return oe},get Toast(){return f},get authApi(){return B},get levelCardPointsManager(){return G},PointsModal:Oe,AuthModal:Qe,get eventBus(){return A},get EVENTS(){return U}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},Ye={class:"nav-left"},$e={key:0,class:"back-button"},es={class:"nav-right"},ss={key:0,class:"points-text"},os={class:"nav-user"};function as(t,s,a,e,p,r){const l=P("van-icon"),_=P("van-loading"),g=P("van-nav-bar");return d(),v(K,null,[u(g,{"left-arrow":e.showBackButton,onClickLeft:e.handleLeftClick,class:"top-navigation",fixed:"",placeholder:""},{left:S(()=>[o("div",Ye,[e.showBackButton?(d(),v("div",$e,[u(l,{name:"arrow-left",size:"18",color:"#fff"})])):(d(),v("div",{key:1,class:"nav-branding",onClick:e.goToHome},s[3]||(s[3]=[o("span",{class:"palette-emoji"},"ğŸ¨",-1),o("span",{class:"brand-text"},"AI Magic",-1)])))])]),title:S(()=>s[4]||(s[4]=[])),right:S(()=>[o("div",es,[e.isLoggedIn?(d(),v("div",{key:0,class:"nav-points",onClick:s[0]||(s[0]=h=>e.showPointsModal=!0),title:"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…"},[u(l,{name:"diamond-o",size:"16"}),e.pointsLoading?(d(),E(_,{key:1,size:"12",color:"var(--primary-color)"})):(d(),v("span",ss,L(e.pointsStatus.current),1))])):k("",!0),o("div",os,[e.isLoggedIn?(d(),v("div",{key:1,onClick:e.goToProfile,title:"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ"},[u(l,{name:"user-o",size:"16"})])):(d(),v("div",{key:0,onClick:e.showLoginModal,title:"ç‚¹å‡»ç™»å½•"},[u(l,{name:"user-o",size:"16"}),s[5]||(s[5]=o("span",{class:"user-text"},"ç™»å½•",-1))]))])])]),_:1},8,["left-arrow"]),u(e.PointsModal,{show:e.showPointsModal,"onUpdate:show":s[1]||(s[1]=h=>e.showPointsModal=h),onPointsUpdated:e.handlePointsUpdated},null,8,["show"]),u(e.AuthModal,{show:e.showAuthModal,"onUpdate:show":s[2]||(s[2]=h=>e.showAuthModal=h),"default-mode":e.authMode,onSuccess:e.handleAuthSuccess},null,8,["show","default-mode"])],64)}const ns=R(Xe,[["render",as],["__scopeId","data-v-5f73bff2"],["__file","D:/workspace/AIMagic/client/src/components/TopNavigation.vue"]]),ts={__name:"MobilePageContainer",props:{title:{type:String,default:""},showBack:{type:Boolean,default:null}},emits:["login","logout"],setup(t,{expose:s}){const a=w(null);s({showLoginModal:()=>{a.value&&a.value.showLoginModal()}});const e={topNavigationRef:a,ref:w,TopNavigation:ns};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},ls={class:"mobile-page"},is={key:0,class:"mobile-page-notice"},rs={class:"mobile-page-content"},cs={key:0,class:"mobile-page-header"},ds={class:"mobile-page-main"},us={key:1,class:"mobile-page-footer"};function ms(t,s,a,e,p,r){return d(),v("div",ls,[u(e.TopNavigation,{ref:"topNavigationRef",title:a.title,"show-back":a.showBack,onLogin:s[0]||(s[0]=l=>t.$emit("login",l)),onLogout:s[1]||(s[1]=l=>t.$emit("logout",l))},null,8,["title","show-back"]),t.$slots.notice?(d(),v("div",is,[z(t.$slots,"notice",{},void 0)])):k("",!0),o("div",rs,[t.$slots.header?(d(),v("div",cs,[z(t.$slots,"header",{},void 0)])):k("",!0),o("div",ds,[z(t.$slots,"default",{},void 0)]),t.$slots.footer?(d(),v("div",us,[z(t.$slots,"footer",{},void 0)])):k("",!0)])])}const Ps=R(ts,[["render",ms],["__scopeId","data-v-99cf0221"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobilePageContainer.vue"]]),fs={__name:"MobileCard",props:{title:{type:String,default:""},icon:{type:String,default:""},iconSize:{type:[String,Number],default:16},iconColor:{type:String,default:"var(--van-primary-color, #1989fa)"},clickable:{type:Boolean,default:!1},showArrow:{type:Boolean,default:!0},inset:{type:Boolean,default:!1}},emits:["click"],setup(t,{expose:s,emit:a}){s();const e=t,p=a,l={props:e,emit:p,handleClick:()=>{e.clickable&&p("click")}};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},ps={key:0,class:"mobile-card-header"},gs={key:0,class:"mobile-card-title"},vs={key:0,class:"mobile-card-custom-icon"},_s={class:"mobile-card-title-text"},hs={class:"mobile-card-content"},bs={key:1,class:"mobile-card-footer"};function ws(t,s,a,e,p,r){const l=P("van-icon");return d(),v("div",{class:ae(["mobile-card",{"mobile-card--clickable":a.clickable,"mobile-card--inset":a.inset}]),onClick:e.handleClick},[a.title||t.$slots.header?(d(),v("div",ps,[a.title?(d(),v("div",gs,[t.$slots.icon?(d(),v("div",vs,[z(t.$slots,"icon",{},void 0)])):a.icon?(d(),E(l,{key:1,name:a.icon,size:a.iconSize,color:a.iconColor,class:"mobile-card-icon"},null,8,["name","size","color"])):k("",!0),o("span",_s,L(a.title),1)])):k("",!0),z(t.$slots,"header",{},void 0),a.clickable&&a.showArrow?(d(),E(l,{key:1,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow-in-header"})):k("",!0)])):k("",!0),o("div",hs,[z(t.$slots,"default",{},void 0)]),t.$slots.footer?(d(),v("div",bs,[z(t.$slots,"footer",{},void 0)])):k("",!0),a.clickable&&a.showArrow&&!a.title&&!t.$slots.header?(d(),E(l,{key:2,name:"arrow",size:"16",color:"var(--van-text-color-3, #c8c9cc)",class:"mobile-card-arrow"})):k("",!0)],2)}const Is=R(fs,[["render",ws],["__scopeId","data-v-ab97c450"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobileCard.vue"]]),H=(t={})=>({maxSize:10*1024*1024,accept:"image/*",tips:["æ”¯æŒ JPGã€PNG æ ¼å¼","å»ºè®®å°ºå¯¸ 512x512 ä»¥ä¸Š","å›¾ç‰‡æ¸…æ™°åº¦å½±å“å¤„ç†æ•ˆæœ"],...t}),ys={"clothes-swap":{id:"clothes-swap",title:"ä¸€é”®è¤ªè¡£",description:"ä¸Šä¼ äººç‰©ç…§ç‰‡ï¼ŒAIæ™ºèƒ½ç§»é™¤æœè£…",processButtonText:"å¼€å§‹å¤„ç†ï¼ˆæ¶ˆè€—20ç§¯åˆ†ï¼‰",processingTitle:"æ­£åœ¨å¤„ç†å›¾ç‰‡...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"main-image",title:"äººç‰©ç…§ç‰‡",icon:"photograph",iconColor:"var(--van-primary-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"é€‰æ‹©äººç‰©ç…§ç‰‡",showCount:!1,...H({tips:["æ”¯æŒ JPGã€PNG æ ¼å¼","å»ºè®®å°ºå¯¸ 1080x1080 ä»¥ä¸‹","å›¾ç‰‡å¤§å°åº”åœ¨ 10M ä»¥ä¸‹","äººè„¸æ¸…æ™°ã€æ­£é¢æ•ˆæœæ›´ä½³"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}},"face-swap":{id:"face-swap",title:"æé€Ÿæ¢è„¸",description:"ä¸Šä¼ äººè„¸ç…§ç‰‡å’Œç›®æ ‡å›¾ç‰‡ï¼ŒAIæ™ºèƒ½æ¢è„¸",processButtonText:"å¼€å§‹æ¢è„¸ï¼ˆæ¶ˆè€—20ç§¯åˆ†ï¼‰",processingTitle:"æ­£åœ¨å¤„ç†æ¢è„¸...",processingDescription:"",pointsCost:20,uploadPanels:[{id:"face-photos",title:"äººè„¸ç…§ç‰‡",icon:"friends-o",iconColor:"var(--van-warning-color)",uploadType:"multi",minCount:1,maxCount:4,uploadText:"æ·»åŠ äººè„¸",showCount:!0,...H({tips:["æ”¯æŒ JPGã€PNG æ ¼å¼","å»ºè®®å°ºå¯¸ 1080x1080 ä»¥ä¸‹","å›¾ç‰‡å¤§å°åº”åœ¨ 10M ä»¥ä¸‹","äººè„¸æ¸…æ™°ã€æ­£é¢æ•ˆæœæ›´ä½³"]})},{id:"target-image",title:"ç›®æ ‡å›¾ç‰‡",icon:"photo-o",iconColor:"var(--van-success-color)",uploadType:"single",minCount:1,maxCount:1,uploadText:"é€‰æ‹©ç›®æ ‡å›¾ç‰‡",showCount:!1,...H({tips:["æ”¯æŒ JPGã€PNG æ ¼å¼","å»ºè®®å°ºå¯¸ 1080x1080 ä»¥ä¸‹","å›¾ç‰‡å¤§å°åº”åœ¨ 10M ä»¥ä¸‹","å›¾ç‰‡æ¸…æ™°åº¦å½±å“æ¢è„¸æ•ˆæœ"]})}],resultConfig:{showComparison:!0,comparisonType:"slider",downloadEnabled:!0,resetEnabled:!0}}};function ks(t){return ys[t]||null}async function Ms(t){return await new Promise(s=>setTimeout(s,100)),ks(t)}export{Qe as A,Is as M,Ps as a,Ms as f,ks as g};
