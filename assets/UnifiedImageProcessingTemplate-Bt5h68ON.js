import{_ as W,r as C,c as M,o as a,w as T,g as s,h as m,k as y,n as Z,y as X,t as w,p as f,e as v,z as U,q as j,d as F,B as G,b as h,I as ne,C as J,T as x,F as Q,i as Y,j as K,D as ae,m as oe,E as ee}from"./index-bHZisnB1.js";import{M as re,a as ce,f as ie,g as de}from"./UnifiedImageProcessingTemplate.vue_vue_type_style_index_0_scoped_1007aace_lang-DRvCsUqD.js";import{M as ue}from"./MobileActionButton-DoOhqSQV.js";import{S as te}from"./SvgIcon-BUVNGOMx.js";const ge={__name:"MobileStatusCard",props:{status:{type:String,default:"default",validator:i=>["default","loading","success","error","warning","info"].includes(i)},title:{type:String,required:!0},description:{type:String,default:""},progress:{type:Number,default:0,validator:i=>i>=0&&i<=100},showProgress:{type:Boolean,default:!0},iconSize:{type:[String,Number],default:24},inset:{type:Boolean,default:!0}},setup(i,{expose:o}){o();const t=i,e=v(()=>t.description&&t.description.includes("（")&&t.description.includes("）")),d=v(()=>({default:"info-o",loading:"loading",success:"success",error:"close",warning:"warning-o",info:"info-o"})[t.status]||"info-o"),r={props:t,isWorkflowProgress:e,statusIcon:d,computed:v,MobileCard:re};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}},me={class:"status-content"},pe={class:"status-info"},fe={class:"status-title"},ve={key:0,class:"status-description"},_e={key:1,class:"status-progress"},ye={key:2,class:"status-extra"},he={key:0,class:"status-action"};function Ie(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-progress");return a(),M(e.MobileCard,{inset:t.inset,class:"mobile-status-card"},{default:T(()=>[s("div",me,[s("div",{class:Z(["status-icon",`status-icon--${t.status}`])},[i.$slots.icon?X(i.$slots,"icon",{key:1},void 0,!0):(a(),M(n,{key:0,name:e.statusIcon,size:t.iconSize},null,8,["name","size"]))],2),s("div",pe,[s("div",fe,w(t.title),1),t.description?(a(),m("div",ve,w(t.description),1)):y("",!0),t.status==="loading"&&t.showProgress?(a(),m("div",_e,[f(l,{percentage:e.isWorkflowProgress?t.progress:100,"show-pivot":!1,color:"var(--van-primary-color, #1989fa)","track-color":"var(--van-border-color, #ebedf0)",class:Z({"progress-animation":!e.isWorkflowProgress})},null,8,["percentage","class"])])):y("",!0),i.$slots.extra?(a(),m("div",ye,[X(i.$slots,"extra",{},void 0,!0)])):y("",!0)]),i.$slots.action?(a(),m("div",he,[X(i.$slots,"action",{},void 0,!0)])):y("",!0)])]),_:3},8,["inset"])}const we=W(ge,[["render",Ie],["__scopeId","data-v-d3daf91d"],["__file","D:/workspace/AIMagic/client/src/components/mobile/MobileStatusCard.vue"]]),be={__name:"SimpleProgressDisplay",props:{visible:{type:Boolean,default:!1},status:{type:String,default:"loading",validator:i=>["loading","success","error","warning","info"].includes(i)},title:{type:String,default:""},description:{type:String,default:""},progress:{type:Number,default:0},showProgress:{type:Boolean,default:!0}},setup(i,{expose:o}){o();const t=i,e=v(()=>t.description&&t.description.includes("（")&&t.description.includes("）")),d=v(()=>{if(t.title)return t.title;if(!t.description)return"处理中...";if(e.value)return"图片处理中...";const c=t.description.replace(/⚠️.*$/,"").trim();return c&&c!==t.description||c?c:"处理中..."}),r=v(()=>"⚠️请不要离开当前页面，等待处理完成后可自行下载"),n=v(()=>{if(!e.value||!t.description)return"";const c=t.description.match(/^(\d+%（[^）]+）)/);return c&&c[1]?c[1].replace(/（/g,"(").replace(/）/g,")"):""}),l=v(()=>({loading:"loading",success:"success",error:"close",warning:"warning-o",info:"info-o"})[t.status]||"info-o"),p=v(()=>({loading:"rgba(255, 255, 255, 0.9)",success:"rgba(255, 255, 255, 0.9)",error:"rgba(255, 255, 255, 0.9)",warning:"rgba(255, 255, 255, 0.9)",info:"rgba(255, 255, 255, 0.9)"})[t.status]||"rgba(255, 255, 255, 0.9)");U(()=>t.visible,c=>{c?document.body.classList.add("has-progress-display"):document.body.classList.remove("has-progress-display")},{immediate:!0}),j(()=>{document.body.classList.remove("has-progress-display")});const g={props:t,isWorkflowProgress:e,displayTitle:d,displayDescription:r,progressDataText:n,statusIcon:l,iconColor:p,computed:v,watch:U,onMounted:F,onUnmounted:j};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},Se={key:0,class:"simple-progress-display"},Ce={class:"progress-content"},Pe={class:"progress-icon"},ke={class:"progress-info"},xe={class:"progress-title"},ze={class:"progress-description"},Me={key:0,class:"progress-section"},De={key:0,class:"progress-data"};function Te(i,o,t,e,d,r){const n=C("van-loading"),l=C("van-icon"),p=C("van-progress");return t.visible?(a(),m("div",Se,[s("div",Ce,[s("div",Pe,[t.status==="loading"?(a(),M(n,{key:0,size:"16",color:"rgba(255, 255, 255, 0.9)"})):(a(),M(l,{key:1,name:e.statusIcon,size:"16",color:e.iconColor},null,8,["name","color"]))]),s("div",ke,[s("div",xe,w(e.displayTitle),1),s("div",ze,w(e.displayDescription),1)])]),t.showProgress?(a(),m("div",Me,[f(p,{percentage:e.isWorkflowProgress?t.progress:100,"show-pivot":!1,color:"linear-gradient(90deg, #6366f1, #818cf8)","track-color":"rgba(255, 255, 255, 0.15)","stroke-width":"4",class:Z({"progress-animation":!e.isWorkflowProgress})},null,8,["percentage","class"]),e.isWorkflowProgress?(a(),m("div",De,w(e.progressDataText),1)):y("",!0)])):y("",!0)])):y("",!0)}const Be=W(be,[["render",Te],["__scopeId","data-v-7113082b"],["__file","D:/workspace/AIMagic/client/src/components/mobile/SimpleProgressDisplay.vue"]]),D={MIN_HEIGHT:300,MAX_HEIGHT:500,BREAKPOINTS:{mobile:768,tablet:1024},MOBILE:{MIN_HEIGHT:300,MAX_HEIGHT:400},getResponsiveHeight(i=!1){return i?{minHeight:this.MOBILE.MIN_HEIGHT,maxHeight:this.MOBILE.MAX_HEIGHT}:{minHeight:this.MIN_HEIGHT,maxHeight:this.MAX_HEIGHT}}},se={UPLOAD:{containerStyle:{minHeight:`${D.MIN_HEIGHT}px`,maxHeight:`${D.MAX_HEIGHT}px`,width:"auto",display:"flex",alignItems:"center",justifyContent:"center"},placeholderStyle:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"16px"}},PREVIEW:{containerStyle:{minHeight:`${D.MIN_HEIGHT}px`,maxHeight:`${D.MAX_HEIGHT}px`,width:"auto",display:"flex",alignItems:"center",justifyContent:"center"},imageStyle:{minHeight:`${D.MIN_HEIGHT}px`,maxHeight:`${D.MAX_HEIGHT}px`,width:"auto",objectFit:"contain"}},COMPARISON:{containerStyle:{minHeight:`${D.MIN_HEIGHT}px`,maxHeight:`${D.MAX_HEIGHT}px`,width:"100%",margin:"0 auto"}}},N={getContainerStyle(i,o=!1){const t=se[i.toUpperCase()];if(!t)return console.warn(`Unknown component type: ${i}`),{};let e={...t.containerStyle};if(o){const d=D.getResponsiveHeight(!0);e.minHeight=`${d.minHeight}px`,e.maxHeight=`${d.maxHeight}px`}return e},getImageStyle(i,o=!1){const t=se[i.toUpperCase()];if(!(t!=null&&t.imageStyle)){const d=o?D.getResponsiveHeight(!0):D.getResponsiveHeight(!1);return{minHeight:`${d.minHeight}px`,maxHeight:`${d.maxHeight}px`,width:"auto",objectFit:"contain"}}let e={...t.imageStyle};if(o){const d=D.getResponsiveHeight(!0);e.minHeight=`${d.minHeight}px`,e.maxHeight=`${d.maxHeight}px`}return e},isMobile(){return window.innerWidth<=D.BREAKPOINTS.mobile},calculateDisplaySize(i,o,t="preview"){const e=this.isMobile()?D.MOBILE.MAX_HEIGHT:D.MAX_HEIGHT,d=i/o;return t==="upload"||t==="comparison"?{width:e*D.ASPECT_RATIO,height:e}:o>e?{width:e*d,height:e}:{width:i,height:o}}},He={__name:"VantImageComparison",props:{originalImage:{type:String,required:!0},resultImage:{type:String,required:!0}},emits:[],setup(i,{expose:o,emit:t}){o();const e=i,d=t,r=h(!1),n=v(()=>N.getContainerStyle("preview",r.value)),l=v(()=>({...N.getContainerStyle("comparison",r.value),width:"48%",flex:"0 0 48%"})),p=(b,B)=>{ne({images:[b],showIndex:!1,closeable:!0})},g=()=>{r.value=N.isMobile()};F(()=>{g(),window.addEventListener("resize",g)}),j(()=>{window.removeEventListener("resize",g)});const c={props:e,emit:d,isMobile:r,containerStyle:n,imageWrapperStyle:l,previewImage:p,updateMobileStatus:g,ref:h,computed:v,onMounted:F,onUnmounted:j,get ImagePreview(){return ne},get ImageSizeUtils(){return N}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},Ee={class:"image-section"},Ue={class:"image-header"},Le={class:"divider"},Ae={class:"image-section"},Ve={class:"image-header"};function Ne(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-loading"),p=C("van-image");return a(),m("div",{class:"comparison-container",style:G(e.containerStyle)},[s("div",Ee,[s("div",Ue,[f(n,{name:"photo-o",size:"16",color:"rgba(255, 255, 255, 0.8)"}),o[2]||(o[2]=s("span",{class:"image-title"},"原图",-1))]),s("div",{class:"image-wrapper",style:G(e.imageWrapperStyle)},[f(p,{src:t.originalImage,fit:"contain","show-loading":!0,"show-error":!0,class:"comparison-image",onClick:o[0]||(o[0]=g=>e.previewImage(t.originalImage,"原图"))},{loading:T(()=>[f(l,{type:"spinner",size:"20"})]),error:T(()=>[f(n,{name:"photo-fail",size:"32"})]),_:1},8,["src"])],4)]),s("div",Le,[f(n,{name:"arrow",size:"16",color:"rgba(255, 255, 255, 0.9)"})]),s("div",Ae,[s("div",Ve,[f(n,{name:"star",size:"16",color:"#FFD700"}),o[3]||(o[3]=s("span",{class:"image-title"},"结果",-1))]),s("div",{class:"image-wrapper",style:G(e.imageWrapperStyle)},[f(p,{src:t.resultImage,fit:"contain","show-loading":!0,"show-error":!0,class:"comparison-image",onClick:o[1]||(o[1]=g=>e.previewImage(t.resultImage,"处理结果"))},{loading:T(()=>[f(l,{type:"spinner",size:"20"})]),error:T(()=>[f(n,{name:"photo-fail",size:"32"})]),_:1},8,["src"])],4)])],4)}const Fe=W(He,[["render",Ne],["__scopeId","data-v-0c19cbc3"],["__file","D:/workspace/AIMagic/client/src/components/common/VantImageComparison.vue"]]),Oe={__name:"SingleImageUpload",props:{modelValue:{type:String,default:null},uploadText:{type:String,default:"上传图片"},description:{type:String,default:""},accept:{type:String,default:"image/*"},maxSize:{type:Number,default:10*1024*1024},disabled:{type:Boolean,default:!1},iconSize:{type:[String,Number],default:32},iconColor:{type:String,default:"var(--van-text-color-3)"},showFileInfo:{type:Boolean,default:!1},containerHeight:{type:[String,Number],default:120}},emits:["update:modelValue","change","error"],setup(i,{expose:o,emit:t}){o();const e=i,d=t,r=h(null),n=h(!1),l=h(""),p=h(null),g=h(!1),c=h(!1),b=v(()=>N.getContainerStyle("upload",c.value)),B=v(()=>N.getImageStyle("upload",c.value)),S=()=>{r.value&&!e.disabled&&r.value.click()},H=async I=>{const z=I.target.files[0];if(z){if(l.value="",!E(z)){I.target.value="";return}n.value=!0;try{const O=await A(z);p.value={name:z.name,size:R(z.size),type:z.type},d("update:modelValue",O),d("change",O,z),x.success("图片上传成功")}catch(O){l.value="图片读取失败",d("error",O),x.fail("图片上传失败")}finally{n.value=!1,I.target.value=""}}},E=I=>{if(!I.type.startsWith("image/"))return l.value="请选择图片文件",x.fail("请选择图片文件"),!1;if(I.size>e.maxSize){const z=Math.round(e.maxSize/1024/1024);return l.value=`文件大小不能超过 ${z}MB`,x.fail(`文件大小不能超过 ${z}MB`),!1}return!0},A=I=>new Promise((z,O)=>{const L=new FileReader;L.onload=$=>z($.target.result),L.onerror=O,L.readAsDataURL(I)}),R=I=>{if(I===0)return"0 B";const z=1024,O=["B","KB","MB","GB"],L=Math.floor(Math.log(I)/Math.log(z));return parseFloat((I/Math.pow(z,L)).toFixed(2))+" "+O[L]},q=()=>{d("update:modelValue",null),d("change",null,null),p.value=null,l.value="",x.success("图片已移除")},P=()=>{e.modelValue&&(g.value=!0)},u=I=>{n.value=!1},_=()=>{n.value=!1,l.value="图片加载失败"},k=()=>{c.value=N.isMobile()};U(()=>e.modelValue,I=>{I||(p.value=null,l.value="")}),F(()=>{k(),window.addEventListener("resize",k)}),j(()=>{window.removeEventListener("resize",k)});const V={props:e,emit:d,fileInput:r,loading:n,error:l,fileInfo:p,showPreview:g,isMobile:c,containerStyle:b,imageStyle:B,triggerUpload:S,handleFileSelect:H,validateFile:E,readFileAsDataURL:A,formatFileSize:R,removeImage:q,previewImage:P,onImageLoad:u,onImageError:_,updateMobileStatus:k,ref:h,computed:v,watch:U,onMounted:F,onUnmounted:j,get Toast(){return x},get ImageSizeUtils(){return N}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},je={class:"single-image-upload"},Re={key:0,class:"upload-placeholder"},Ge={class:"upload-text"},We={key:0,class:"upload-description"},Xe={key:1,class:"image-container"},qe=["src","alt"],Ke={class:"image-overlay"},Ze={class:"overlay-actions"},Je={key:0,class:"loading-overlay"},Qe={key:0,class:"file-info"},Ye={class:"info-item"},$e={class:"info-item"},et={key:1,class:"error-message"},tt=["accept"];function ot(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-loading"),p=C("van-image-preview");return a(),m("div",je,[s("div",{class:Z(["upload-container",{"has-image":t.modelValue,disabled:t.disabled}]),style:G(e.containerStyle),onClick:o[1]||(o[1]=g=>!t.disabled&&e.triggerUpload())},[t.modelValue?(a(),m("div",Xe,[s("img",{src:t.modelValue,alt:t.uploadText,class:"uploaded-image",style:G(e.imageStyle),onLoad:e.onImageLoad,onError:e.onImageError},null,44,qe),s("div",Ke,[s("div",Ze,[f(n,{name:"eye-o",size:"20",color:"white",onClick:J(e.previewImage,["stop"])}),f(n,{name:"edit",size:"20",color:"white",onClick:o[0]||(o[0]=J(g=>e.triggerUpload(),["stop"]))}),f(n,{name:"delete",size:"20",color:"white",onClick:J(e.removeImage,["stop"])})])]),e.loading?(a(),m("div",Je,[f(l,{size:"24",color:"white"})])):y("",!0)])):(a(),m("div",Re,[f(n,{name:"plus",size:t.iconSize,color:t.iconColor},null,8,["size","color"]),s("div",Ge,w(t.uploadText),1),t.description?(a(),m("div",We,w(t.description),1)):y("",!0)]))],6),t.showFileInfo&&e.fileInfo?(a(),m("div",Qe,[s("div",Ye,[f(n,{name:"info-o",size:"14"}),s("span",null,w(e.fileInfo.name),1)]),s("div",$e,[f(n,{name:"photo-o",size:"14"}),s("span",null,w(e.fileInfo.size),1)])])):y("",!0),e.error?(a(),m("div",et,[f(n,{name:"warning-o",size:"14",color:"var(--van-danger-color)"}),s("span",null,w(e.error),1)])):y("",!0),s("input",{ref:"fileInput",type:"file",accept:t.accept,style:{display:"none"},onChange:e.handleFileSelect},null,40,tt),f(p,{show:e.showPreview,"onUpdate:show":o[2]||(o[2]=g=>e.showPreview=g),images:[t.modelValue],"start-position":0,onClose:o[3]||(o[3]=g=>e.showPreview=!1)},null,8,["show","images"])])}const nt=W(Oe,[["render",ot],["__scopeId","data-v-3833a10d"],["__file","D:/workspace/AIMagic/client/src/components/common/SingleImageUpload.vue"]]),it={__name:"MultiImageUpload",props:{modelValue:{type:Array,default:()=>[]},maxCount:{type:Number,default:4},minCount:{type:Number,default:1},uploadText:{type:String,default:"添加图片"},accept:{type:String,default:"image/*"},maxSize:{type:Number,default:10*1024*1024},disabled:{type:Boolean,default:!1},iconSize:{type:[String,Number],default:24},iconColor:{type:String,default:"var(--van-text-color-3)"},sortable:{type:Boolean,default:!1},gridColumns:{type:Number,default:4}},emits:["update:modelValue","change","error"],setup(i,{expose:o,emit:t}){o();const e=i,d=t,r=h(null),n=h([]),l=h(!1),p=h(0),g=v(()=>n.value.map(u=>u.url)),c=v(()=>`repeat(${e.gridColumns}, 1fr)`);U(()=>e.modelValue,u=>{Array.isArray(u)?n.value=u.map((_,k)=>({id:`img-${Date.now()}-${k}`,url:typeof _=="string"?_:_.url,file:typeof _=="object"?_.file:null})):n.value=[]},{immediate:!0});const b=()=>{r.value&&!e.disabled&&r.value.click()},B=async u=>{const _=Array.from(u.target.files);if(_.length===0)return;const k=e.maxCount-n.value.length;if(k<=0){x.fail(`最多只能上传 ${e.maxCount} 张图片`),u.target.value="";return}const V=_.slice(0,k).filter(I=>S(I));if(V.length===0){u.target.value="";return}try{const I=await Promise.all(V.map(async(L,$)=>{const le=await H(L);return{id:`img-${Date.now()}-${n.value.length+$}`,url:le,file:L}}));n.value=[...n.value,...I];const z=n.value.map(L=>({url:L.url,file:L.file}));d("update:modelValue",z),d("change",z);const O=I.length;x.success(`成功添加 ${O} 张图片`),_.length>k&&x.fail(`已达到最大数量限制，仅添加了前 ${k} 张图片`)}catch(I){console.error("图片处理失败:",I),x.fail("图片处理失败"),d("error",I)}finally{u.target.value=""}},S=u=>{if(!u.type.startsWith("image/"))return x.fail(`文件 ${u.name} 不是图片格式`),!1;if(u.size>e.maxSize){const _=Math.round(e.maxSize/1024/1024);return x.fail(`文件 ${u.name} 大小超过 ${_}MB`),!1}return!0},H=u=>new Promise((_,k)=>{const V=new FileReader;V.onload=I=>_(I.target.result),V.onerror=k,V.readAsDataURL(u)}),P={props:e,emit:d,fileInput:r,imageList:n,showPreview:l,previewIndex:p,previewImages:g,gridColumnsValue:c,triggerUpload:b,handleFileSelect:B,validateFile:S,readFileAsDataURL:H,removeImage:u=>{n.value.splice(u,1);const _=n.value.map(k=>({url:k.url,file:k.file}));d("update:modelValue",_),d("change",_),x.success("图片已移除")},clearAll:()=>{n.value=[],d("update:modelValue",[]),d("change",[]),x.success("已清空所有图片")},previewImage:u=>{p.value=u,l.value=!0},startDrag:(u,_)=>{e.sortable&&console.log("开始拖拽:",u)},ref:h,computed:v,watch:U,get Toast(){return x}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}},st={class:"multi-image-upload"},at={class:"image-container"},lt=["src","alt","onClick"],rt={class:"image-overlay"},ct={class:"image-index"},dt={class:"upload-text"},ut={key:0,class:"batch-actions"},gt={key:1,class:"sort-tip"},mt=["accept"];function pt(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-button"),p=C("van-image-preview");return a(),m("div",st,[s("div",{class:"images-grid",style:G({gridTemplateColumns:e.gridColumnsValue})},[(a(!0),m(Q,null,Y(e.imageList,(g,c)=>(a(),m("div",{key:`image-${c}`,class:"image-item"},[s("div",at,[s("img",{src:g.url,alt:`图片 ${c+1}`,class:"uploaded-image",onClick:b=>e.previewImage(c)},null,8,lt),s("div",rt,[f(n,{name:"eye-o",size:"16",color:"white",onClick:J(b=>e.previewImage(c),["stop"])},null,8,["onClick"]),f(n,{name:"delete",size:"16",color:"white",onClick:J(b=>e.removeImage(c),["stop"])},null,8,["onClick"])]),s("div",ct,w(c+1),1)])]))),128)),e.imageList.length<t.maxCount?(a(),m("div",{key:0,class:Z(["upload-item",{disabled:t.disabled}]),onClick:o[0]||(o[0]=g=>!t.disabled&&e.triggerUpload())},[f(n,{name:"plus",size:t.iconSize,color:t.iconColor},null,8,["size","color"]),s("div",dt,w(t.uploadText),1)],2)):y("",!0)],4),e.imageList.length>0?(a(),m("div",ut,[f(l,{size:"small",type:"default",onClick:e.clearAll},{default:T(()=>[f(n,{name:"delete-o",size:"14"}),o[4]||(o[4]=K(" 清空全部 "))]),_:1,__:[4]}),f(l,{size:"small",type:"primary",onClick:o[1]||(o[1]=g=>e.triggerUpload()),disabled:t.disabled||e.imageList.length>=t.maxCount},{default:T(()=>[f(n,{name:"plus",size:"14"}),o[5]||(o[5]=K(" 继续添加 "))]),_:1,__:[5]},8,["disabled"])])):y("",!0),t.sortable&&e.imageList.length>1?(a(),m("div",gt,[f(n,{name:"info-o",size:"12"}),o[6]||(o[6]=s("span",null,"长按图片可拖拽排序",-1))])):y("",!0),s("input",{ref:"fileInput",type:"file",accept:t.accept,multiple:!0,style:{display:"none"},onChange:e.handleFileSelect},null,40,mt),f(p,{show:e.showPreview,"onUpdate:show":o[2]||(o[2]=g=>e.showPreview=g),images:e.previewImages,"start-position":e.previewIndex,onClose:o[3]||(o[3]=g=>e.showPreview=!1)},null,8,["show","images","start-position"])])}const ft=W(it,[["render",pt],["__scopeId","data-v-a39d92c9"],["__file","D:/workspace/AIMagic/client/src/components/common/MultiImageUpload.vue"]]),vt={__name:"UnifiedImageUploadPanel",props:{modelValue:{type:[Array,String,null],default:null},config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},shouldHideUpload:{type:Boolean,default:!1}},emits:["update:modelValue","change","error"],setup(i,{expose:o,emit:t}){o();const e=i,d=t,r=h(null),n=h([]),l=v(()=>!0),p=v(()=>e.config.uploadType==="single"?r.value?1:0:n.value.length);U(()=>e.modelValue,S=>{e.config.uploadType==="single"?r.value=S:n.value=Array.isArray(S)?S:[]},{immediate:!0});const B={props:e,emit:d,singleImage:r,multiImages:n,isDevelopment:l,uploadedCount:p,handleSingleImageChange:(S,H)=>{r.value=S,d("update:modelValue",S),d("change",S)},handleMultiImageChange:S=>{n.value=S,d("update:modelValue",S),d("change",S)},handleUploadError:S=>{d("error",S)},ref:h,computed:v,watch:U,get Toast(){return x},SingleImageUpload:nt,MultiImageUpload:ft};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}},_t={class:"unified-image-upload-panel"},yt={class:"panel-header"},ht={class:"panel-title"},It={key:0,class:"count-badge"},wt={key:0,class:"comparison-slot"},bt={key:1,class:"upload-area"},St={class:"status-section"},Ct={class:"status-item"},Pt={key:0,class:"status-item"},kt={key:2,class:"tips-section"},xt=["accept","multiple"];function zt(i,o,t,e,d,r){const n=C("van-icon");return a(),m("div",_t,[s("div",yt,[f(n,{name:t.config.icon,color:t.config.iconColor,size:"18"},null,8,["name","color"]),s("span",ht,w(t.config.title),1),t.config.showCount?(a(),m("span",It," ("+w(t.config.minCount)+"-"+w(t.config.maxCount)+"张) ",1)):y("",!0)]),i.$slots.comparison?(a(),m("div",wt,[X(i.$slots,"comparison",{},void 0)])):y("",!0),i.$slots.comparison&&t.shouldHideUpload?y("",!0):(a(),m("div",bt,[t.config.uploadType==="single"?(a(),M(e.SingleImageUpload,{key:0,modelValue:e.singleImage,"onUpdate:modelValue":o[0]||(o[0]=l=>e.singleImage=l),"upload-text":t.config.uploadText,accept:t.config.accept,"max-size":t.config.maxSize,disabled:t.disabled,"container-height":120,onChange:e.handleSingleImageChange,onError:e.handleUploadError},null,8,["modelValue","upload-text","accept","max-size","disabled"])):(a(),M(e.MultiImageUpload,{key:1,modelValue:e.multiImages,"onUpdate:modelValue":o[1]||(o[1]=l=>e.multiImages=l),"max-count":t.config.maxCount,"min-count":t.config.minCount,"upload-text":t.config.uploadText,accept:t.config.accept,"max-size":t.config.maxSize,disabled:t.disabled,"grid-columns":4,onChange:e.handleMultiImageChange,onError:e.handleUploadError},null,8,["modelValue","max-count","min-count","upload-text","accept","max-size","disabled"]))])),s("div",St,[s("div",Ct,[f(n,{name:"photograph",size:"16",color:e.uploadedCount>0?"var(--van-success-color)":"var(--van-text-color-3)"},null,8,["color"]),s("span",{class:Z({"text-success":e.uploadedCount>0})}," 已上传 "+w(e.uploadedCount)+"/"+w(t.config.maxCount)+" 张图片 ",3)]),t.config.minCount>0?(a(),m("div",Pt,[f(n,{name:e.uploadedCount>=t.config.minCount?"success":"warning-o",size:"16",color:e.uploadedCount>=t.config.minCount?"var(--van-success-color)":"var(--van-warning-color)"},null,8,["name","color"]),s("span",{class:Z({"text-success":e.uploadedCount>=t.config.minCount,"text-warning":e.uploadedCount<t.config.minCount})},w(e.uploadedCount>=t.config.minCount?"已满足上传要求":`至少需要上传 ${t.config.minCount} 张图片`),3)])):y("",!0)]),t.config.tips&&t.config.tips.length>0?(a(),m("div",kt,[(a(!0),m(Q,null,Y(t.config.tips,(l,p)=>(a(),m("div",{key:p,class:"tip-item"},[f(n,{name:"info-o",size:"12",color:"var(--van-text-color-3)"}),s("span",null,w(l),1)]))),128))])):y("",!0),s("input",{ref:"fileInput",type:"file",accept:t.config.accept,multiple:t.config.uploadType==="multi",style:{display:"none"},onChange:o[2]||(o[2]=(...l)=>i.handleFileSelect&&i.handleFileSelect(...l))},null,40,xt)])}const Mt=W(vt,[["render",zt],["__scopeId","data-v-47fd962c"],["__file","D:/workspace/AIMagic/client/src/components/common/UnifiedImageUploadPanel.vue"]]),Dt={__name:"AIProcessingTemplate",props:{title:{type:String,required:!0},description:{type:String,required:!0},titleIcon:{type:[String,Object],default:null},titleIconName:{type:String,default:""},titleIconColor:{type:String,default:"var(--van-primary-color)"},isProcessing:{type:Boolean,default:!1},canProcess:{type:Boolean,default:!1},showUploadTips:{type:Boolean,default:!0},processButtonText:{type:String,default:"开始处理"},processButtonIcon:{type:[String,Object],default:null},progress:{type:Number,default:0},showProgress:{type:Boolean,default:!0},processingTitle:{type:String,default:"正在处理..."},processingDescription:{type:String,default:""},processingInfo:{type:Object,default:()=>({})},resultData:{type:[Object,String],default:null},downloadLoading:{type:Boolean,default:!1},pointsCost:{type:Number,default:0}},emits:["login","logout","process","download","reprocess"],setup(i,{expose:o}){o();const t=i,e=v(()=>{if(!t.isProcessing)return"";const l=t.processingDescription||"",p="⚠️请不要离开当前页面，等待处理完成后可自行下载";return l?`${l} ${p}`:p}),d=v(()=>t.pointsCost>0&&!t.isProcessing&&!t.resultData&&!t.canProcess),r=l=>{if(t.isProcessing)return l.preventDefault(),l.returnValue="正在处理中，确定要离开页面吗？处理进度将会丢失。","正在处理中，确定要离开页面吗？处理进度将会丢失。"};U(()=>t.isProcessing,l=>{l?(document.body.classList.add("has-fixed-status-bar"),window.addEventListener("beforeunload",r)):(document.body.classList.remove("has-fixed-status-bar"),window.removeEventListener("beforeunload",r))}),F(()=>{t.isProcessing&&(document.body.classList.add("has-fixed-status-bar"),window.addEventListener("beforeunload",r))}),j(()=>{document.body.classList.remove("has-fixed-status-bar"),window.removeEventListener("beforeunload",r)});const n={props:t,processingStatusDescription:e,shouldShowBottomPointsNotice:d,handleBeforeUnload:r,computed:v,watch:U,onMounted:F,onUnmounted:j,get MobilePageContainer(){return ce},get MobileActionButton(){return ue},get MobileStatusCard(){return we},get SimpleProgressDisplay(){return Be}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}},Tt={class:"ai-page-header"},Bt={class:"page-title"},Ht={class:"input-section"},Et={key:0,class:"action-section"},Ut={key:1,class:"upload-tips"},Lt={key:1,class:"result-section"},At={key:2,class:"result-actions"},Vt={key:3,class:"bottom-points-notice"},Nt={class:"points-notice-content"};function Ft(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-button");return a(),M(e.MobilePageContainer,{title:t.title,onLogin:o[3]||(o[3]=p=>i.$emit("login",p)),onLogout:o[4]||(o[4]=p=>i.$emit("logout",p))},{header:T(()=>[s("div",Tt,[s("div",Bt,[t.titleIcon?(a(),M(oe(t.titleIcon),{key:0,size:24,color:t.titleIconColor},null,8,["color"])):t.titleIconName?(a(),M(n,{key:1,name:t.titleIconName,size:24,color:t.titleIconColor},null,8,["name","color"])):y("",!0),s("span",null,w(t.description),1)])])]),default:T(()=>[s("div",Ht,[X(i.$slots,"inputs",{},void 0,!0),!t.resultData&&t.canProcess&&!t.isProcessing?(a(),m("div",Et,[f(e.MobileActionButton,{onClick:o[0]||(o[0]=p=>i.$emit("process")),type:"primary",block:"",variant:"floating",icon:typeof t.processButtonIcon=="string"?t.processButtonIcon:""},ae({default:T(()=>[K(" "+w(t.processButtonText),1)]),_:2},[i.$slots["process-button-icon"]||t.processButtonIcon&&typeof t.processButtonIcon=="object"?{name:"icon",fn:T(()=>[i.$slots["process-button-icon"]?X(i.$slots,"process-button-icon",{key:0},void 0,!0):t.processButtonIcon&&typeof t.processButtonIcon=="object"?(a(),M(oe(t.processButtonIcon),{key:1,size:18,color:"white"})):y("",!0)]),key:"0"}:void 0]),1032,["icon"])])):!t.resultData&&t.showUploadTips?(a(),m("div",Ut,[X(i.$slots,"upload-tips",{},void 0,!0)])):y("",!0)]),t.isProcessing?(a(),M(e.SimpleProgressDisplay,{key:0,visible:t.isProcessing,status:"loading",description:e.processingStatusDescription,progress:t.progress,"show-progress":t.showProgress},null,8,["visible","description","progress","show-progress"])):y("",!0),t.resultData?(a(),m("div",Lt,[X(i.$slots,"result",{result:t.resultData},void 0,!0)])):y("",!0),t.resultData?(a(),m("div",At,[f(l,{type:"primary",size:"large",onClick:o[1]||(o[1]=p=>i.$emit("download",t.resultData)),loading:t.downloadLoading,class:"result-action-btn"},{default:T(()=>o[5]||(o[5]=[K(" 下载图片 ")])),_:1,__:[5]},8,["loading"]),f(l,{type:"default",size:"large",onClick:o[2]||(o[2]=p=>i.$emit("reset")),class:"result-action-btn"},{default:T(()=>o[6]||(o[6]=[K(" 重新选择 ")])),_:1,__:[6]})])):y("",!0),e.shouldShowBottomPointsNotice?(a(),m("div",Vt,[s("div",Nt,[s("span",null,[K(w(t.title)+"将消耗 ",1),s("strong",null,w(t.pointsCost),1),o[7]||(o[7]=K(" 积分"))])])])):y("",!0)]),_:3},8,["title"])}const Ot=W(Dt,[["render",Ft],["__scopeId","data-v-1a4aad0f"],["__file","D:/workspace/AIMagic/client/src/components/templates/AIProcessingTemplate.vue"]]),jt={__name:"ImageComparison",props:{originalImage:{type:String,required:!0},resultImage:{type:String,required:!0}},emits:[],setup(i,{expose:o,emit:t}){o();const e=i,d=t,r=h(50),n=h(!1),l=h(null),p=h(null),g=h(1),c=h(!1),b=v(()=>N.getContainerStyle("preview",c.value)),B=()=>{if(p.value){const P=p.value;g.value=P.naturalWidth/P.naturalHeight}};U(()=>e.originalImage,()=>{g.value=1},{immediate:!0});const S=P=>{n.value=!0,document.addEventListener("mousemove",H),document.addEventListener("mouseup",E),document.addEventListener("touchmove",H),document.addEventListener("touchend",E),P.preventDefault()},H=P=>{if(!n.value||!l.value)return;const u=l.value.getBoundingClientRect(),k=(P.clientX||P.touches&&P.touches[0].clientX)-u.left,V=Math.max(0,Math.min(100,k/u.width*100));r.value=V},E=()=>{n.value=!1,document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",E),document.removeEventListener("touchmove",H),document.removeEventListener("touchend",E)},A=()=>{c.value=N.isMobile()},R=P=>{P.key==="ArrowLeft"?r.value=Math.max(0,r.value-5):P.key==="ArrowRight"&&(r.value=Math.min(100,r.value+5))};F(()=>{A(),window.addEventListener("resize",A),document.addEventListener("keydown",R)}),j(()=>{window.removeEventListener("resize",A),document.removeEventListener("keydown",R),E()});const q={props:e,emit:d,sliderPosition:r,isDragging:n,comparisonContainer:l,originalImageRef:p,imageAspectRatio:g,isMobile:c,containerStyle:b,handleImageLoad:B,startDragging:S,handleDrag:H,stopDragging:E,updateMobileStatus:A,handleKeyPress:R,ref:h,computed:v,watch:U,onMounted:F,onUnmounted:j,get ImageSizeUtils(){return N}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}},Rt={class:"comparison-wrapper"},Gt={class:"image-layer original-layer"},Wt=["src"],Xt=["src"],qt={class:"slider-handle"};function Kt(i,o,t,e,d,r){const n=C("van-icon");return a(),m("div",{class:"comparison-container",ref:"comparisonContainer",style:G(e.containerStyle)},[s("div",Rt,[s("div",Gt,[s("img",{src:t.originalImage,alt:"原图",class:"comparison-image",onLoad:e.handleImageLoad,ref:"originalImageRef"},null,40,Wt)]),s("div",{class:"image-layer result-layer",style:G({clipPath:`inset(0 ${100-e.sliderPosition}% 0 0)`})},[s("img",{src:t.resultImage,alt:"处理结果",class:"comparison-image"},null,8,Xt)],4),s("div",{class:"comparison-slider",style:G({left:e.sliderPosition+"%"}),onMousedown:e.startDragging,onTouchstart:e.startDragging},[o[1]||(o[1]=s("div",{class:"slider-line"},null,-1)),s("div",qt,[f(n,{name:"arrow-left",size:"12",color:"white",class:"slider-arrow left"}),o[0]||(o[0]=s("div",{class:"slider-circle"},null,-1)),f(n,{name:"arrow",size:"12",color:"white",class:"slider-arrow right"})])],36)])],4)}const Zt=W(jt,[["render",Kt],["__scopeId","data-v-37ebfcde"],["__file","D:/workspace/AIMagic/client/src/components/ImageComparison.vue"]]),Jt={__name:"UnifiedImageProcessingTemplate",props:{functionId:{type:String,required:!0},titleIcon:{type:[Object,String],default:null},titleIconName:{type:String,default:""},titleIconColor:{type:String,default:"var(--van-primary-color)"},processButtonIcon:{type:[Object,String],default:null},processButtonIconName:{type:String,default:""},isProcessing:{type:Boolean,default:!1},progress:{type:Number,default:0},processingDescription:{type:String,default:""},processingInfo:{type:Object,default:()=>({})},resultData:{type:String,default:null},originalImageForComparison:{type:String,default:null}},emits:["login","logout","process","reset","download","upload-change","input-change"],setup(i,{expose:o,emit:t}){const e=i,d=t,r=h({title:"",description:"",processButtonText:"开始处理",processingTitle:"正在处理...",processingDescription:"",uploadPanels:[],inputPanels:[],resultConfig:{}}),n=h({}),l=h({}),p=h(!1),g=v(()=>!0),c=v(()=>e.processingDescription||r.value.processingDescription||""),b=v(()=>e.titleIcon?e.titleIcon:e.titleIconName?{render:()=>ee(te,{name:e.titleIconName,size:24,color:e.titleIconColor})}:null),B=v(()=>e.processButtonIcon&&typeof e.processButtonIcon=="string"?e.processButtonIcon:null),S=v(()=>e.processButtonIcon&&typeof e.processButtonIcon=="object"?e.processButtonIcon:e.processButtonIconName?{render:()=>ee(te,{name:e.processButtonIconName,size:18,color:"white"})}:null),H=v(()=>{if(r.value.uploadPanels)for(const u of r.value.uploadPanels){const _=n.value[u.id];if(u.uploadType==="single"){if(!_&&u.minCount>0)return!1}else if((Array.isArray(_)?_.length:0)<u.minCount)return!1}if(r.value.inputPanels)for(const u of r.value.inputPanels){const _=l.value[u.id];if(u.required&&(!_||_.trim()===""))return!1}return!0}),E=async()=>{try{const u=await ie(e.functionId);u?(r.value=u,p.value=!0,A(),console.log("✅ 配置加载完成:",r.value)):x.fail("加载配置失败")}catch(u){console.error("加载配置失败:",u),x.fail("加载配置失败")}},A=()=>{r.value.uploadPanels&&r.value.uploadPanels.forEach(u=>{n.value[u.id]=u.uploadType==="single"?null:[]}),r.value.inputPanels&&r.value.inputPanels.forEach(u=>{l.value[u.id]=""})},R=(u,_)=>{n.value[u]=_,d("upload-change",u,_)},q=(u,_)=>{l.value[u]=_,d("input-change",u,_)};F(()=>{E()}),o({uploadData:n,inputData:l,config:r});const P={props:e,emit:d,config:r,uploadData:n,inputData:l,configLoaded:p,isDevelopment:g,dynamicProcessingDescription:c,titleIcon:b,processButtonIcon:B,processButtonIconComponent:S,canProcess:H,loadConfig:E,initializeData:A,handleUploadChange:R,handleInputChange:q,ref:h,computed:v,watch:U,onMounted:F,h:ee,get Toast(){return x},get AIProcessingTemplate(){return Ot},get VantImageComparison(){return Fe},ImageComparison:Zt,UnifiedImageUploadPanel:Mt,get SvgIcon(){return te},get getImageProcessingConfig(){return de},get fetchImageProcessingConfigFromAPI(){return ie}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}},Qt={key:0,class:"comparison-result"},Yt={class:"panel-header"},$t={class:"comparison-content"},eo={class:"tips-section"},to={class:"tip-item"},oo={key:0},no={key:1},io={class:"panel-header"},so={class:"panel-title"},ao={key:1,class:"tips-section"},lo={key:1,class:"config-loading"};function ro(i,o,t,e,d,r){const n=C("van-icon"),l=C("van-field"),p=C("van-loading");return e.config.title?(a(),M(e.AIProcessingTemplate,{key:0,title:e.config.title,description:e.config.description,"title-icon":e.titleIcon,"title-icon-color":t.titleIconColor,"is-processing":t.isProcessing,"can-process":e.canProcess,"show-upload-tips":!1,"process-button-text":e.config.processButtonText,"process-button-icon":e.processButtonIcon,progress:t.progress,"processing-title":e.config.processingTitle,"processing-description":e.dynamicProcessingDescription,"processing-info":t.processingInfo,"result-data":t.resultData,"points-cost":e.config.pointsCost,onLogin:o[0]||(o[0]=g=>i.$emit("login",g)),onLogout:o[1]||(o[1]=g=>i.$emit("logout",g)),onProcess:o[2]||(o[2]=g=>i.$emit("process")),onDownload:o[3]||(o[3]=g=>i.$emit("download",g)),onReset:o[4]||(o[4]=g=>i.$emit("reset"))},ae({inputs:T(()=>{var g;return[e.configLoaded&&t.resultData&&((g=e.config.resultConfig)!=null&&g.showComparison)&&e.config.resultConfig.comparisonType!=="none"?(a(),m("div",Qt,[s("div",Yt,[f(n,{name:"photo-o",color:"var(--van-success-color)",size:"18"}),o[5]||(o[5]=s("span",{class:"panel-title"},"处理结果对比",-1))]),s("div",$t,[e.config.resultConfig.comparisonType==="slider"?(a(),M(e.ImageComparison,{key:0,"original-image":t.originalImageForComparison,"result-image":t.resultData},null,8,["original-image","result-image"])):e.config.resultConfig.comparisonType==="side-by-side"?(a(),M(e.VantImageComparison,{key:1,"original-image":t.originalImageForComparison,"result-image":t.resultData},null,8,["original-image","result-image"])):y("",!0)]),s("div",eo,[s("div",to,[f(n,{name:"info-o",size:"12",color:"var(--van-text-color-3)"}),e.config.resultConfig.comparisonType==="slider"?(a(),m("span",oo,"拖拽中间的分割线查看对比效果")):(a(),m("span",no,"左侧为原图，右侧为处理结果"))])])])):e.config.uploadPanels?(a(!0),m(Q,{key:1},Y(e.config.uploadPanels,c=>(a(),M(e.UnifiedImageUploadPanel,{key:c.id,modelValue:e.uploadData[c.id],"onUpdate:modelValue":b=>e.uploadData[c.id]=b,config:c,disabled:t.isProcessing,onChange:b=>e.handleUploadChange(c.id,b)},null,8,["modelValue","onUpdate:modelValue","config","disabled","onChange"]))),128)):y("",!0),e.config.inputPanels?(a(!0),m(Q,{key:2},Y(e.config.inputPanels,c=>(a(),m("div",{key:c.id,class:"input-panel"},[s("div",io,[f(n,{name:c.icon,color:c.iconColor,size:"18"},null,8,["name","color"]),s("span",so,w(c.title),1)]),c.type==="text"?(a(),M(l,{key:0,modelValue:e.inputData[c.id],"onUpdate:modelValue":b=>e.inputData[c.id]=b,placeholder:c.placeholder,rows:c.rows,maxlength:c.maxLength,disabled:t.isProcessing,type:"textarea","show-word-limit":"",autosize:"",class:"text-input",onInput:b=>e.handleInputChange(c.id,b)},null,8,["modelValue","onUpdate:modelValue","placeholder","rows","maxlength","disabled","onInput"])):y("",!0),c.tips&&c.tips.length>0?(a(),m("div",ao,[(a(!0),m(Q,null,Y(c.tips,(b,B)=>(a(),m("div",{key:B,class:"tip-item"},[f(n,{name:"info-o",size:"12",color:"var(--van-text-color-3)"}),s("span",null,w(b),1)]))),128))])):y("",!0)]))),128)):y("",!0)]}),result:T(({result:g})=>[]),_:2},[e.processButtonIconComponent?{name:"process-button-icon",fn:T(()=>[(a(),M(oe(e.processButtonIconComponent)))]),key:"0"}:void 0]),1032,["title","description","title-icon","title-icon-color","is-processing","can-process","process-button-text","process-button-icon","progress","processing-title","processing-description","processing-info","result-data","points-cost"])):(a(),m("div",lo,[f(p,{type:"spinner",size:"24"}),o[6]||(o[6]=s("span",null,"加载中...",-1))]))}const po=W(Jt,[["render",ro],["__scopeId","data-v-1007aace"],["__file","D:/workspace/AIMagic/client/src/components/templates/UnifiedImageProcessingTemplate.vue"]]);export{po as U};
