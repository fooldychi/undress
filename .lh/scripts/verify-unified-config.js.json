{
    "sourceFile": "scripts/verify-unified-config.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1752548238913,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752548252338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n   {\n     pattern: /['\"\\/]system_stats['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /system_stats ç«¯ç‚¹',\n     severity: 'high',\n-    allowedFiles: ['docs/', 'test-', '.md']\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js']\n   },\n   {\n     pattern: /['\"\\/]object_info['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /object_info ç«¯ç‚¹',\n"
                },
                {
                    "date": 1752548263494,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n   {\n     pattern: /['\"\\/]object_info['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /object_info ç«¯ç‚¹',\n     severity: 'medium',\n-    allowedFiles: ['docs/', 'test-', '.md']\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js']\n   },\n   {\n     pattern: /['\"\\/]prompt['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /prompt ç«¯ç‚¹',\n"
                },
                {
                    "date": 1752548276687,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n   {\n     pattern: /['\"\\/]prompt['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /prompt ç«¯ç‚¹',\n     severity: 'medium',\n-    allowedFiles: ['docs/', 'test-', '.md']\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js']\n   },\n   {\n     pattern: /['\"\\/]history['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /history ç«¯ç‚¹',\n"
                },
                {
                    "date": 1752548292463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,9 +37,9 @@\n   {\n     pattern: /['\"\\/]history['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /history ç«¯ç‚¹',\n     severity: 'medium',\n-    allowedFiles: ['docs/', 'test-', '.md']\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js']\n   },\n   {\n     pattern: /testEndpoints\\s*=\\s*\\[/g,\n     description: 'å¯èƒ½çš„ç¡¬ç¼–ç ç«¯ç‚¹æ•°ç»„å®šä¹‰',\n"
                },
                {
                    "date": 1752548316511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,9 +13,9 @@\n   {\n     pattern: /['\"\\/]queue['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /queue ç«¯ç‚¹',\n     severity: 'high',\n-    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js'] // å…è®¸åœ¨é…ç½®æ–‡ä»¶ã€æ–‡æ¡£å’Œæµ‹è¯•æ–‡ä»¶ä¸­å‡ºç°\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js', 'routes/config.js', 'routes/admin.js'] // å…è®¸åœ¨é…ç½®æ–‡ä»¶ã€æ–‡æ¡£å’Œæµ‹è¯•æ–‡ä»¶ä¸­å‡ºç°\n   },\n   {\n     pattern: /['\"\\/]system_stats['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /system_stats ç«¯ç‚¹',\n"
                },
                {
                    "date": 1752548329463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n   {\n     pattern: /['\"\\/]system_stats['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /system_stats ç«¯ç‚¹',\n     severity: 'high',\n-    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js']\n+    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js', 'routes/config.js', 'routes/admin.js']\n   },\n   {\n     pattern: /['\"\\/]object_info['\",\\]]/g,\n     description: 'ç¡¬ç¼–ç çš„ /object_info ç«¯ç‚¹',\n"
                },
                {
                    "date": 1752548343203,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,9 +43,9 @@\n   {\n     pattern: /testEndpoints\\s*=\\s*\\[/g,\n     description: 'å¯èƒ½çš„ç¡¬ç¼–ç ç«¯ç‚¹æ•°ç»„å®šä¹‰',\n     severity: 'medium',\n-    allowedFiles: ['test-', '.md', 'config.js']\n+    allowedFiles: ['test-', '.md', 'config.js', 'routes/config.js', 'routes/admin.js']\n   }\n ];\n \n // éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶æ‰©å±•å\n"
                },
                {
                    "date": 1752548378636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,9 +76,10 @@\n   /**\n    * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­\n    */\n   isFileAllowed(filePath, allowedFiles) {\n-    return allowedFiles.some(allowed => filePath.includes(allowed));\n+    const normalizedPath = filePath.replace(/\\\\/g, '/');\n+    return allowedFiles.some(allowed => normalizedPath.includes(allowed));\n   }\n \n   /**\n    * æ£€æŸ¥å•ä¸ªæ–‡ä»¶\n"
                }
            ],
            "date": 1752548238913,
            "name": "Commit-0",
            "content": "#!/usr/bin/env node\n\n/**\n * éªŒè¯ComfyUIç«¯ç‚¹é…ç½®ç»Ÿä¸€æ€§\n * æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ç¡¬ç¼–ç çš„ç«¯ç‚¹é…ç½®\n */\n\nconst fs = require('fs');\nconst path = require('path');\n\n// éœ€è¦æ£€æŸ¥çš„ç¡¬ç¼–ç ç«¯ç‚¹æ¨¡å¼\nconst HARDCODED_ENDPOINT_PATTERNS = [\n  {\n    pattern: /['\"\\/]queue['\",\\]]/g,\n    description: 'ç¡¬ç¼–ç çš„ /queue ç«¯ç‚¹',\n    severity: 'high',\n    allowedFiles: ['docs/', 'test-', '.md', 'comfyui.config.js'] // å…è®¸åœ¨é…ç½®æ–‡ä»¶ã€æ–‡æ¡£å’Œæµ‹è¯•æ–‡ä»¶ä¸­å‡ºç°\n  },\n  {\n    pattern: /['\"\\/]system_stats['\",\\]]/g,\n    description: 'ç¡¬ç¼–ç çš„ /system_stats ç«¯ç‚¹',\n    severity: 'high',\n    allowedFiles: ['docs/', 'test-', '.md']\n  },\n  {\n    pattern: /['\"\\/]object_info['\",\\]]/g,\n    description: 'ç¡¬ç¼–ç çš„ /object_info ç«¯ç‚¹',\n    severity: 'medium',\n    allowedFiles: ['docs/', 'test-', '.md']\n  },\n  {\n    pattern: /['\"\\/]prompt['\",\\]]/g,\n    description: 'ç¡¬ç¼–ç çš„ /prompt ç«¯ç‚¹',\n    severity: 'medium',\n    allowedFiles: ['docs/', 'test-', '.md']\n  },\n  {\n    pattern: /['\"\\/]history['\",\\]]/g,\n    description: 'ç¡¬ç¼–ç çš„ /history ç«¯ç‚¹',\n    severity: 'medium',\n    allowedFiles: ['docs/', 'test-', '.md']\n  },\n  {\n    pattern: /testEndpoints\\s*=\\s*\\[/g,\n    description: 'å¯èƒ½çš„ç¡¬ç¼–ç ç«¯ç‚¹æ•°ç»„å®šä¹‰',\n    severity: 'medium',\n    allowedFiles: ['test-', '.md', 'config.js']\n  }\n];\n\n// éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶æ‰©å±•å\nconst FILE_EXTENSIONS = ['.js', '.ts', '.jsx', '.tsx', '.vue'];\n\n// æ’é™¤çš„ç›®å½•\nconst EXCLUDED_DIRS = ['node_modules', '.git', 'dist', 'build', '.lh'];\n\nclass ConfigVerifier {\n  constructor() {\n    this.issues = [];\n    this.checkedFiles = 0;\n  }\n\n  /**\n   * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åº”è¯¥è¢«æ’é™¤\n   */\n  shouldExcludeFile(filePath) {\n    // æ£€æŸ¥æ˜¯å¦åœ¨æ’é™¤ç›®å½•ä¸­\n    for (const excludedDir of EXCLUDED_DIRS) {\n      if (filePath.includes(excludedDir)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­\n   */\n  isFileAllowed(filePath, allowedFiles) {\n    return allowedFiles.some(allowed => filePath.includes(allowed));\n  }\n\n  /**\n   * æ£€æŸ¥å•ä¸ªæ–‡ä»¶\n   */\n  checkFile(filePath) {\n    if (this.shouldExcludeFile(filePath)) {\n      return;\n    }\n\n    try {\n      const content = fs.readFileSync(filePath, 'utf8');\n      this.checkedFiles++;\n\n      for (const { pattern, description, severity, allowedFiles } of HARDCODED_ENDPOINT_PATTERNS) {\n        const matches = content.match(pattern);\n        if (matches) {\n          // æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­\n          if (this.isFileAllowed(filePath, allowedFiles)) {\n            continue;\n          }\n\n          this.issues.push({\n            file: filePath,\n            pattern: pattern.source,\n            description,\n            severity,\n            matches: matches.length,\n            lines: this.getMatchingLines(content, pattern)\n          });\n        }\n      }\n    } catch (error) {\n      console.warn(`âš ï¸ æ— æ³•è¯»å–æ–‡ä»¶: ${filePath} - ${error.message}`);\n    }\n  }\n\n  /**\n   * è·å–åŒ¹é…çš„è¡Œå·\n   */\n  getMatchingLines(content, pattern) {\n    const lines = content.split('\\n');\n    const matchingLines = [];\n\n    lines.forEach((line, index) => {\n      if (pattern.test(line)) {\n        matchingLines.push({\n          number: index + 1,\n          content: line.trim()\n        });\n      }\n    });\n\n    return matchingLines;\n  }\n\n  /**\n   * é€’å½’æ£€æŸ¥ç›®å½•\n   */\n  checkDirectory(dirPath) {\n    try {\n      const items = fs.readdirSync(dirPath);\n\n      for (const item of items) {\n        const itemPath = path.join(dirPath, item);\n        const stat = fs.statSync(itemPath);\n\n        if (stat.isDirectory()) {\n          this.checkDirectory(itemPath);\n        } else if (stat.isFile()) {\n          const ext = path.extname(itemPath);\n          if (FILE_EXTENSIONS.includes(ext)) {\n            this.checkFile(itemPath);\n          }\n        }\n      }\n    } catch (error) {\n      console.warn(`âš ï¸ æ— æ³•è¯»å–ç›®å½•: ${dirPath} - ${error.message}`);\n    }\n  }\n\n  /**\n   * è¿è¡ŒéªŒè¯\n   */\n  verify() {\n    console.log('ğŸ” å¼€å§‹éªŒè¯ComfyUIç«¯ç‚¹é…ç½®ç»Ÿä¸€æ€§...');\n    console.log('=' .repeat(60));\n\n    const startTime = Date.now();\n\n    // æ£€æŸ¥ä¸»è¦ç›®å½•\n    const dirsToCheck = ['client/src', 'server/src', 'admin/src'];\n\n    for (const dir of dirsToCheck) {\n      if (fs.existsSync(dir)) {\n        console.log(`ğŸ“ æ£€æŸ¥ç›®å½•: ${dir}`);\n        this.checkDirectory(dir);\n      }\n    }\n\n    const endTime = Date.now();\n\n    console.log('\\nğŸ“Š æ£€æŸ¥ç»“æœ:');\n    console.log('=' .repeat(40));\n    console.log(`   æ£€æŸ¥æ–‡ä»¶æ•°: ${this.checkedFiles}`);\n    console.log(`   å‘ç°é—®é¢˜æ•°: ${this.issues.length}`);\n    console.log(`   è€—æ—¶: ${endTime - startTime}ms`);\n\n    if (this.issues.length === 0) {\n      console.log('\\nâœ… æ­å–œï¼æ‰€æœ‰ComfyUIç«¯ç‚¹é…ç½®å·²ç»Ÿä¸€ï¼Œæœªå‘ç°ç¡¬ç¼–ç é—®é¢˜ã€‚');\n      return true;\n    } else {\n      console.log('\\nâŒ å‘ç°ç¡¬ç¼–ç ç«¯ç‚¹é…ç½®é—®é¢˜:');\n      this.reportIssues();\n      return false;\n    }\n  }\n\n  /**\n   * æŠ¥å‘Šé—®é¢˜\n   */\n  reportIssues() {\n    const groupedIssues = this.groupIssuesBySeverity();\n\n    for (const [severity, issues] of Object.entries(groupedIssues)) {\n      console.log(`\\nğŸš¨ ${severity.toUpperCase()} çº§åˆ«é—®é¢˜ (${issues.length}ä¸ª):`);\n      console.log('-' .repeat(50));\n\n      for (const issue of issues) {\n        console.log(`ğŸ“„ æ–‡ä»¶: ${issue.file}`);\n        console.log(`ğŸ” é—®é¢˜: ${issue.description}`);\n        console.log(`ğŸ“Š åŒ¹é…æ•°: ${issue.matches}`);\n\n        if (issue.lines.length > 0) {\n          console.log('ğŸ“ ä½ç½®:');\n          issue.lines.forEach(line => {\n            console.log(`   ç¬¬${line.number}è¡Œ: ${line.content}`);\n          });\n        }\n        console.log('');\n      }\n    }\n\n    console.log('\\nğŸ’¡ å»ºè®®ä¿®å¤æ–¹æ¡ˆ:');\n    console.log('1. å°†ç¡¬ç¼–ç ç«¯ç‚¹ç§»åŠ¨åˆ° client/src/config/comfyui.config.js');\n    console.log('2. ä½¿ç”¨ comfyUIConfig.getHealthCheckEndpoints() è·å–ç«¯ç‚¹åˆ—è¡¨');\n    console.log('3. ä½¿ç”¨ comfyUIConfig.HEALTH_CHECK.HEADERS è·å–è¯·æ±‚å¤´');\n    console.log('4. ä½¿ç”¨ comfyUIConfig.validateResponse() éªŒè¯å“åº”');\n  }\n\n  /**\n   * æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç»„é—®é¢˜\n   */\n  groupIssuesBySeverity() {\n    const grouped = {};\n\n    for (const issue of this.issues) {\n      if (!grouped[issue.severity]) {\n        grouped[issue.severity] = [];\n      }\n      grouped[issue.severity].push(issue);\n    }\n\n    return grouped;\n  }\n}\n\n// è¿è¡ŒéªŒè¯\nif (require.main === module) {\n  const verifier = new ConfigVerifier();\n  const success = verifier.verify();\n  process.exit(success ? 0 : 1);\n}\n\nmodule.exports = ConfigVerifier;\n"
        }
    ]
}