{
    "sourceFile": "scripts/start-with-port-management.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752407741032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752407753017,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -116,9 +116,9 @@\n    * æ˜¾ç¤ºå¯åŠ¨å®Œæˆä¿¡æ¯\n    */\n   showStartupComplete() {\n     console.log('ğŸ‰ æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼');\n-    console.log('=' * 40);\n+    console.log('='.repeat(40));\n     console.log('');\n     console.log('ğŸ“ è®¿é—®åœ°å€:');\n \n     Object.entries(this.portManager.config.services).forEach(([_, config]) => {\n"
                },
                {
                    "date": 1752407764823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,9 +167,9 @@\n    * å¯åŠ¨å•ä¸ªæœåŠ¡\n    */\n   async startSingle(serviceName) {\n     console.log(`ğŸš€ å¯åŠ¨ ${serviceName} æœåŠ¡`);\n-    console.log('=' * 30);\n+    console.log('='.repeat(30));\n     console.log('');\n \n     // éªŒè¯ç«¯å£\n     const available = await this.portManager.handlePortConflict(\n"
                }
            ],
            "date": 1752407741032,
            "name": "Commit-0",
            "content": "#!/usr/bin/env node\n\n/**\n * AIMagic é¡¹ç›®ç»Ÿä¸€å¯åŠ¨è„šæœ¬\n * ä½¿ç”¨ç«¯å£ç®¡ç†å·¥å…·ç¡®ä¿ç«¯å£é…ç½®æ­£ç¡®\n */\n\nconst PortManager = require('./port-manager');\nconst { spawn } = require('child_process');\nconst path = require('path');\n\nclass ProjectStarter {\n  constructor() {\n    this.portManager = new PortManager();\n    this.processes = new Map();\n  }\n\n  /**\n   * å¯åŠ¨æ‰€æœ‰æœåŠ¡\n   */\n  async startAll() {\n    console.log('ğŸš€ AIMagic é¡¹ç›®å¯åŠ¨å™¨');\n    console.log('='.repeat(40));\n    console.log('');\n\n    // é¦–å…ˆéªŒè¯æ‰€æœ‰ç«¯å£\n    console.log('ç¬¬ä¸€æ­¥: éªŒè¯ç«¯å£é…ç½®...');\n    const portResults = await this.portManager.validateAllPorts();\n\n    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç«¯å£éƒ½å¯ç”¨\n    const unavailablePorts = Object.entries(portResults)\n      .filter(([_, result]) => !result.available);\n\n    if (unavailablePorts.length > 0) {\n      console.error('âŒ ä»¥ä¸‹ç«¯å£ä¸å¯ç”¨:');\n      unavailablePorts.forEach(([service, result]) => {\n        console.error(`  - ${result.config.name}: ç«¯å£ ${result.port}`);\n      });\n      console.error('\\nè¯·è§£å†³ç«¯å£å†²çªåé‡è¯•ã€‚');\n      process.exit(1);\n    }\n\n    console.log('âœ… æ‰€æœ‰ç«¯å£éªŒè¯é€šè¿‡ï¼\\n');\n\n    // æŒ‰é¡ºåºå¯åŠ¨æœåŠ¡\n    const startOrder = ['server', 'client', 'admin'];\n\n    for (const serviceName of startOrder) {\n      await this.startServiceWithDelay(serviceName);\n    }\n\n    // æ˜¾ç¤ºå¯åŠ¨å®Œæˆä¿¡æ¯\n    this.showStartupComplete();\n\n    // è®¾ç½®è¿›ç¨‹é€€å‡ºå¤„ç†\n    this.setupExitHandlers();\n  }\n\n  /**\n   * å¯åŠ¨å•ä¸ªæœåŠ¡å¹¶ç­‰å¾…\n   */\n  async startServiceWithDelay(serviceName) {\n    const serviceConfig = this.portManager.config.services[serviceName];\n\n    console.log(`ğŸ”„ å¯åŠ¨ ${serviceConfig.name}...`);\n\n    const cwd = path.join(__dirname, '..', serviceConfig.directory);\n    const [command, ...args] = serviceConfig.startCommand.split(' ');\n\n    const child = spawn(command, args, {\n      cwd,\n      stdio: ['inherit', 'pipe', 'pipe'],\n      shell: true\n    });\n\n    // å­˜å‚¨è¿›ç¨‹å¼•ç”¨\n    this.processes.set(serviceName, {\n      process: child,\n      config: serviceConfig\n    });\n\n    // ç›‘å¬è¿›ç¨‹è¾“å‡º\n    child.stdout.on('data', (data) => {\n      const output = data.toString().trim();\n      if (output) {\n        console.log(`[${serviceConfig.name}] ${output}`);\n      }\n    });\n\n    child.stderr.on('data', (data) => {\n      const output = data.toString().trim();\n      if (output) {\n        console.error(`[${serviceConfig.name}] ${output}`);\n      }\n    });\n\n    child.on('error', (error) => {\n      console.error(`âŒ ${serviceConfig.name} å¯åŠ¨å¤±è´¥:`, error.message);\n    });\n\n    child.on('exit', (code) => {\n      if (code !== 0) {\n        console.error(`âŒ ${serviceConfig.name} å¼‚å¸¸é€€å‡ºï¼Œä»£ç : ${code}`);\n      }\n      this.processes.delete(serviceName);\n    });\n\n    // ç­‰å¾…æœåŠ¡å¯åŠ¨\n    await new Promise(resolve => setTimeout(resolve, 3000));\n\n    console.log(`âœ… ${serviceConfig.name} å¯åŠ¨å®Œæˆ`);\n    console.log(`ğŸŒ è®¿é—®åœ°å€: ${serviceConfig.url}\\n`);\n  }\n\n  /**\n   * æ˜¾ç¤ºå¯åŠ¨å®Œæˆä¿¡æ¯\n   */\n  showStartupComplete() {\n    console.log('ğŸ‰ æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼');\n    console.log('=' * 40);\n    console.log('');\n    console.log('ğŸ“ è®¿é—®åœ°å€:');\n\n    Object.entries(this.portManager.config.services).forEach(([_, config]) => {\n      console.log(`  ${config.name}: ${config.url}`);\n    });\n\n    console.log('');\n    console.log('ğŸ’¡ æç¤º:');\n    console.log('  - æŒ‰ Ctrl+C åœæ­¢æ‰€æœ‰æœåŠ¡');\n    console.log('  - å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºè®¿é—®: åç«¯API â†’ å®¢æˆ·ç«¯ â†’ åå°ç®¡ç†');\n    console.log('');\n    console.log('ğŸ”§ ç«¯å£ç®¡ç†:');\n    console.log('  - æ‰€æœ‰ç«¯å£éƒ½å·²é€šè¿‡ç«¯å£ç®¡ç†å·¥å…·éªŒè¯');\n    console.log('  - å¦‚é‡ç«¯å£å†²çªï¼Œå·¥å…·ä¼šè‡ªåŠ¨å¤„ç†');\n    console.log('');\n  }\n\n  /**\n   * è®¾ç½®é€€å‡ºå¤„ç†ç¨‹åº\n   */\n  setupExitHandlers() {\n    const cleanup = () => {\n      console.log('\\nğŸ›‘ æ­£åœ¨åœæ­¢æ‰€æœ‰æœåŠ¡...');\n\n      this.processes.forEach((serviceInfo, serviceName) => {\n        console.log(`â¹ï¸ åœæ­¢ ${serviceInfo.config.name}...`);\n        try {\n          serviceInfo.process.kill('SIGTERM');\n        } catch (error) {\n          console.error(`âŒ åœæ­¢ ${serviceInfo.config.name} å¤±è´¥:`, error.message);\n        }\n      });\n\n      setTimeout(() => {\n        console.log('âœ… æ‰€æœ‰æœåŠ¡å·²åœæ­¢');\n        process.exit(0);\n      }, 2000);\n    };\n\n    process.on('SIGINT', cleanup);\n    process.on('SIGTERM', cleanup);\n    process.on('exit', cleanup);\n  }\n\n  /**\n   * å¯åŠ¨å•ä¸ªæœåŠ¡\n   */\n  async startSingle(serviceName) {\n    console.log(`ğŸš€ å¯åŠ¨ ${serviceName} æœåŠ¡`);\n    console.log('=' * 30);\n    console.log('');\n\n    // éªŒè¯ç«¯å£\n    const available = await this.portManager.handlePortConflict(\n      serviceName,\n      this.portManager.config.services[serviceName].port\n    );\n\n    if (!available) {\n      console.error(`âŒ ç«¯å£å†²çªï¼Œæ— æ³•å¯åŠ¨ ${serviceName}`);\n      process.exit(1);\n    }\n\n    // å¯åŠ¨æœåŠ¡\n    await this.startServiceWithDelay(serviceName);\n\n    console.log('âœ… æœåŠ¡å¯åŠ¨å®Œæˆï¼');\n    console.log('æŒ‰ Ctrl+C åœæ­¢æœåŠ¡');\n\n    // è®¾ç½®é€€å‡ºå¤„ç†\n    this.setupExitHandlers();\n\n    // ä¿æŒè¿›ç¨‹è¿è¡Œ\n    process.stdin.resume();\n  }\n\n  /**\n   * æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯\n   */\n  showHelp() {\n    console.log('ğŸ› ï¸ AIMagic é¡¹ç›®å¯åŠ¨å™¨');\n    console.log('');\n    console.log('ç”¨æ³•:');\n    console.log('  node scripts/start-with-port-management.js [å‘½ä»¤] [æœåŠ¡]');\n    console.log('');\n    console.log('å‘½ä»¤:');\n    console.log('  all            å¯åŠ¨æ‰€æœ‰æœåŠ¡ (é»˜è®¤)');\n    console.log('  single <æœåŠ¡>  å¯åŠ¨å•ä¸ªæœåŠ¡');\n    console.log('  help           æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯');\n    console.log('');\n    console.log('æœåŠ¡:');\n    console.log('  server         åç«¯APIæœåŠ¡ (ç«¯å£ 3007)');\n    console.log('  client         å®¢æˆ·ç«¯å‰ç«¯ (ç«¯å£ 3001)');\n    console.log('  admin          åå°ç®¡ç†ç³»ç»Ÿ (ç«¯å£ 3003)');\n    console.log('');\n    console.log('ç¤ºä¾‹:');\n    console.log('  node scripts/start-with-port-management.js');\n    console.log('  node scripts/start-with-port-management.js all');\n    console.log('  node scripts/start-with-port-management.js single server');\n    console.log('');\n    console.log('ç‰¹æ€§:');\n    console.log('  âœ… è‡ªåŠ¨æ£€æµ‹ç«¯å£å†²çª');\n    console.log('  âœ… è‡ªåŠ¨ç»ˆæ­¢å†²çªè¿›ç¨‹');\n    console.log('  âœ… å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç«¯å£');\n    console.log('  âœ… ç»Ÿä¸€å¯åŠ¨ç®¡ç†');\n  }\n}\n\n// ä¸»å‡½æ•°\nasync function main() {\n  const starter = new ProjectStarter();\n  const command = process.argv[2] || 'all';\n  const service = process.argv[3];\n\n  try {\n    switch (command) {\n      case 'all':\n        await starter.startAll();\n        break;\n\n      case 'single':\n        if (!service) {\n          console.error('âŒ è¯·æŒ‡å®šè¦å¯åŠ¨çš„æœåŠ¡: server, client, æˆ– admin');\n          process.exit(1);\n        }\n        if (!starter.portManager.config.services[service]) {\n          console.error(`âŒ æœªçŸ¥æœåŠ¡: ${service}`);\n          process.exit(1);\n        }\n        await starter.startSingle(service);\n        break;\n\n      case 'help':\n      default:\n        starter.showHelp();\n        break;\n    }\n  } catch (error) {\n    console.error('âŒ å¯åŠ¨å¤±è´¥:', error.message);\n    process.exit(1);\n  }\n}\n\n// å¦‚æœç›´æ¥è¿è¡Œæ­¤è„šæœ¬\nif (require.main === module) {\n  main();\n}\n\nmodule.exports = ProjectStarter;\n"
        }
    ]
}