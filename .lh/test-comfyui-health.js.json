{
    "sourceFile": "test-comfyui-health.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752548060935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752548060935,
            "name": "Commit-0",
            "content": "// ComfyUIå¥åº·æ£€æŸ¥æµ‹è¯•è„šæœ¬\n// åŸºäºå®˜æ–¹æ–‡æ¡£å’Œå®é™…è¯·æ±‚ä¿¡æ¯è¿›è¡Œæµ‹è¯•\n\nconst testServerHealth = async (serverUrl) => {\n  console.log(`\\nğŸ¥ æµ‹è¯•ComfyUIæœåŠ¡å™¨å¥åº·çŠ¶æ€: ${serverUrl}`)\n  console.log('=' .repeat(60))\n\n  // åŸºäºComfyUIå®˜æ–¹æ–‡æ¡£çš„ç«¯ç‚¹åˆ—è¡¨\n  const testEndpoints = [\n    '/api/queue',        // ComfyUIå®˜æ–¹é˜Ÿåˆ—ç«¯ç‚¹\n    '/api/system_stats'  // ComfyUIå®˜æ–¹ç³»ç»ŸçŠ¶æ€ç«¯ç‚¹\n  ]\n\n  const results = []\n\n  for (const endpoint of testEndpoints) {\n    const fullUrl = `${serverUrl.replace(/\\/$/, '')}${endpoint}`\n    console.log(`\\nğŸ” æµ‹è¯•ç«¯ç‚¹: ${endpoint}`)\n    console.log(`   URL: ${fullUrl}`)\n\n    try {\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), 10000) // 10ç§’è¶…æ—¶\n\n      const startTime = Date.now()\n      const response = await fetch(fullUrl, {\n        method: 'GET',\n        signal: controller.signal,\n        headers: {\n          'Accept': 'application/json, */*',\n          'Accept-Language': 'zh-CN,zh;q=0.9',\n          'Cache-Control': 'no-cache',\n          'comfy-user': 'health-test',\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0 Safari/537.36'\n        },\n        mode: 'cors',\n        credentials: 'omit'\n      })\n\n      clearTimeout(timeoutId)\n      const responseTime = Date.now() - startTime\n\n      const result = {\n        endpoint,\n        status: response.status,\n        ok: response.ok,\n        responseTime,\n        contentType: response.headers.get('content-type'),\n        success: response.ok\n      }\n\n      if (response.ok) {\n        console.log(`   âœ… çŠ¶æ€: ${response.status} (${responseTime}ms)`)\n        console.log(`   ğŸ“„ Content-Type: ${result.contentType}`)\n\n        // å°è¯•è§£æå“åº”å†…å®¹\n        try {\n          const contentType = response.headers.get('content-type')\n          if (contentType && contentType.includes('application/json')) {\n            const data = await response.json()\n            result.hasValidJson = true\n            result.dataSize = JSON.stringify(data).length\n            console.log(`   ğŸ“Š JSONæ•°æ®å¤§å°: ${result.dataSize} å­—ç¬¦`)\n\n            // æ£€æŸ¥ç‰¹å®šçš„ComfyUIå“åº”ç‰¹å¾\n            if (endpoint.includes('queue') && (data.queue_running !== undefined || data.queue_pending !== undefined)) {\n              result.isComfyUIQueue = true\n              console.log(`   ğŸ¯ ç¡®è®¤ä¸ºComfyUIé˜Ÿåˆ—ç«¯ç‚¹`)\n            }\n            if (endpoint.includes('system_stats') && data.system) {\n              result.isComfyUIStats = true\n              console.log(`   ğŸ¯ ç¡®è®¤ä¸ºComfyUIç³»ç»ŸçŠ¶æ€ç«¯ç‚¹`)\n            }\n          } else {\n            const text = await response.text()\n            result.hasValidJson = false\n            result.textLength = text.length\n            console.log(`   ğŸ“„ æ–‡æœ¬å“åº”é•¿åº¦: ${result.textLength} å­—ç¬¦`)\n          }\n        } catch (parseError) {\n          result.parseError = parseError.message\n          console.log(`   âš ï¸ å“åº”è§£æå¤±è´¥: ${parseError.message}`)\n        }\n      } else {\n        console.log(`   âŒ çŠ¶æ€: ${response.status} ${response.statusText} (${responseTime}ms)`)\n        result.statusText = response.statusText\n      }\n\n      results.push(result)\n\n    } catch (error) {\n      console.log(`   ğŸ’¥ è¯·æ±‚å¤±è´¥: ${error.message}`)\n      results.push({\n        endpoint,\n        success: false,\n        error: error.message,\n        errorType: error.name\n      })\n    }\n  }\n\n  // æ±‡æ€»ç»“æœ\n  console.log(`\\nğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»`)\n  console.log('=' .repeat(60))\n\n  const successfulEndpoints = results.filter(r => r.success)\n  const comfyUIEndpoints = results.filter(r => r.isComfyUIQueue || r.isComfyUIStats)\n\n  console.log(`âœ… æˆåŠŸç«¯ç‚¹: ${successfulEndpoints.length}/${results.length}`)\n  console.log(`ğŸ¯ ComfyUIç‰¹å¾ç«¯ç‚¹: ${comfyUIEndpoints.length}`)\n\n  if (successfulEndpoints.length > 0) {\n    console.log(`\\nğŸ† æ¨èä½¿ç”¨çš„ç«¯ç‚¹:`)\n    successfulEndpoints\n      .sort((a, b) => {\n        // ä¼˜å…ˆComfyUIç‰¹å¾ç«¯ç‚¹ï¼Œç„¶åæŒ‰å“åº”æ—¶é—´æ’åº\n        if (a.isComfyUIQueue || a.isComfyUIStats) return -1\n        if (b.isComfyUIQueue || b.isComfyUIStats) return 1\n        return a.responseTime - b.responseTime\n      })\n      .slice(0, 3)\n      .forEach((result, index) => {\n        console.log(`   ${index + 1}. ${result.endpoint} (${result.responseTime}ms)`)\n      })\n  }\n\n  // åˆ¤æ–­æœåŠ¡å™¨æ•´ä½“å¥åº·çŠ¶æ€\n  const isHealthy = successfulEndpoints.length > 0 && comfyUIEndpoints.length > 0\n  console.log(`\\nğŸ¥ æœåŠ¡å™¨å¥åº·çŠ¶æ€: ${isHealthy ? 'âœ… å¥åº·' : 'âŒ ä¸å¥åº·'}`)\n\n  return {\n    serverUrl,\n    isHealthy,\n    successfulEndpoints: successfulEndpoints.length,\n    totalEndpoints: results.length,\n    comfyUIEndpoints: comfyUIEndpoints.length,\n    results\n  }\n}\n\n// æµ‹è¯•æŒ‡å®šçš„æœåŠ¡å™¨\nconst testServers = async () => {\n  const servers = [\n    'https://l9s75ay3rp-8188.cnb.run'\n    // å¯ä»¥æ·»åŠ æ›´å¤šæœåŠ¡å™¨è¿›è¡Œæµ‹è¯•\n  ]\n\n  for (const server of servers) {\n    await testServerHealth(server)\n  }\n}\n\n// å¦‚æœåœ¨Node.jsç¯å¢ƒä¸­è¿è¡Œ\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { testServerHealth }\n\n  // å¦‚æœç›´æ¥è¿è¡Œæ­¤è„šæœ¬\n  if (require.main === module) {\n    testServers().catch(console.error)\n  }\n}\n\n// å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œ\nif (typeof window !== 'undefined') {\n  window.testServerHealth = testServerHealth\n  console.log('ğŸš€ ComfyUIå¥åº·æ£€æŸ¥å·¥å…·å·²åŠ è½½')\n  console.log('ä½¿ç”¨æ–¹æ³•: testServerHealth(\"https://your-server-url\")')\n}\n"
        }
    ]
}