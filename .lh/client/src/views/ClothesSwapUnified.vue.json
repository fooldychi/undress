{
    "sourceFile": "client/src/views/ClothesSwapUnified.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752395497153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752410747391,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,9 +42,9 @@\n \n // å¤„ç†ä¸Šä¼ å˜åŒ–\n const handleUploadChange = (panelId, data) => {\n   console.log('ä¸Šä¼ å˜åŒ–:', panelId, data)\n-  \n+\n   if (panelId === 'main-image') {\n     selectedImage.value = data\n     resultImage.value = null // æ¸…é™¤ä¹‹å‰çš„ç»“æœ\n   }\n@@ -68,15 +68,9 @@\n     processingStatus.value = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...'\n     progressPercent.value = 30\n \n     // è°ƒç”¨è¤ªè¡£å¤„ç†æœåŠ¡\n-    const result = await processUndressImage({\n-      image: selectedImage.value,\n-      onProgress: (status, percent) => {\n-        processingStatus.value = status\n-        progressPercent.value = Math.max(progressPercent.value, percent)\n-      }\n-    })\n+    const result = await processUndressImage(selectedImage.value)\n \n     if (result.success && result.imageUrl) {\n       resultImage.value = result.imageUrl\n       // ä¿å­˜åŸå›¾ç”¨äºå¯¹æ¯”\n@@ -112,17 +106,17 @@\n   resultImage.value = null\n   processingStatus.value = ''\n   promptId.value = ''\n   processingTime.value = ''\n-  \n+\n   // é‡ç½®æ¨¡æ¿å†…éƒ¨çŠ¶æ€\n   if (templateRef.value) {\n     const { uploadData } = templateRef.value\n     if (uploadData['main-image']) {\n       uploadData['main-image'] = null\n     }\n   }\n-  \n+\n   Toast.success('å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°é€‰æ‹©å›¾ç‰‡')\n }\n \n // ä¸‹è½½ç»“æœ\n"
                },
                {
                    "date": 1752410788844,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,12 +70,12 @@\n \n     // è°ƒç”¨è¤ªè¡£å¤„ç†æœåŠ¡\n     const result = await processUndressImage(selectedImage.value)\n \n-    if (result.success && result.imageUrl) {\n-      resultImage.value = result.imageUrl\n+    if (result.success && result.resultImage) {\n+      resultImage.value = result.resultImage\n       // ä¿å­˜åŸå›¾ç”¨äºå¯¹æ¯”\n-      originalImageForComparison.value = result.originalImageUrl || selectedImage.value\n+      originalImageForComparison.value = result.originalImage || selectedImage.value\n       promptId.value = result.promptId || ''\n \n       // è®¡ç®—å¤„ç†æ—¶é—´\n       const endTime = Date.now()\n"
                }
            ],
            "date": 1752395497153,
            "name": "Commit-0",
            "content": "<template>\n  <UnifiedImageProcessingTemplate\n    function-id=\"clothes-swap\"\n    :title-icon=\"UndressWomanIcon\"\n    title-icon-color=\"var(--van-primary-color)\"\n    :process-button-icon=\"UndressWomanIcon\"\n    :is-processing=\"isLoading\"\n    :progress=\"progressPercent\"\n    :processing-info=\"{ promptId, processingTime }\"\n    :result-data=\"resultImage\"\n    :original-image-for-comparison=\"originalImageForComparison\"\n    @login=\"handleUserLogin\"\n    @logout=\"handleUserLogout\"\n    @process=\"processImage\"\n    @reset=\"resetProcess\"\n    @download=\"handleDownload\"\n    @upload-change=\"handleUploadChange\"\n    ref=\"templateRef\"\n  />\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport { Toast } from 'vant'\nimport { UnifiedImageProcessingTemplate } from '../components/mobile'\nimport { UndressWomanIcon } from '../components/icons'\nimport { processUndressImage } from '../services/comfyui.js'\n\nconsole.log('ClothesSwapUnifiedç»„ä»¶å·²åŠ è½½ï¼ŒComfyUIæœåŠ¡å·²å¯¼å…¥')\n\n// å“åº”å¼æ•°æ®\nconst templateRef = ref(null)\nconst selectedImage = ref(null)\nconst originalImageForComparison = ref(null)\nconst resultImage = ref(null)\nconst isLoading = ref(false)\nconst processingStatus = ref('')\nconst promptId = ref('')\nconst processingTime = ref('')\nconst progressPercent = ref(0)\nconst startTime = ref(null)\n\n// å¤„ç†ä¸Šä¼ å˜åŒ–\nconst handleUploadChange = (panelId, data) => {\n  console.log('ä¸Šä¼ å˜åŒ–:', panelId, data)\n  \n  if (panelId === 'main-image') {\n    selectedImage.value = data\n    resultImage.value = null // æ¸…é™¤ä¹‹å‰çš„ç»“æœ\n  }\n}\n\n// å¤„ç†å›¾ç‰‡\nconst processImage = async () => {\n  if (!selectedImage.value) {\n    Toast.fail('è¯·å…ˆä¸Šä¼ äººç‰©ç…§ç‰‡')\n    return\n  }\n\n  isLoading.value = true\n  processingStatus.value = 'æ­£åœ¨åŠ è½½æœåŠ¡...'\n  progressPercent.value = 10\n  startTime.value = Date.now()\n\n  try {\n    console.log('ğŸš€ å¼€å§‹ä¸€é”®è¤ªè¡£å¤„ç†')\n\n    processingStatus.value = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...'\n    progressPercent.value = 30\n\n    // è°ƒç”¨è¤ªè¡£å¤„ç†æœåŠ¡\n    const result = await processUndressImage({\n      image: selectedImage.value,\n      onProgress: (status, percent) => {\n        processingStatus.value = status\n        progressPercent.value = Math.max(progressPercent.value, percent)\n      }\n    })\n\n    if (result.success && result.imageUrl) {\n      resultImage.value = result.imageUrl\n      // ä¿å­˜åŸå›¾ç”¨äºå¯¹æ¯”\n      originalImageForComparison.value = result.originalImageUrl || selectedImage.value\n      promptId.value = result.promptId || ''\n\n      // è®¡ç®—å¤„ç†æ—¶é—´\n      const endTime = Date.now()\n      const duration = Math.round((endTime - startTime.value) / 1000)\n      processingTime.value = `${duration}ç§’`\n\n      // æ˜¾ç¤ºæˆåŠŸtoast\n      const pointsInfo = result.pointsConsumed ? `ï¼ˆæ¶ˆè€—${result.pointsConsumed}ç‚¹ï¼‰` : ''\n      Toast.success(`ğŸ‰ å¤„ç†å®Œæˆï¼${pointsInfo}å¯ä»¥æ‹–æ‹½ä¸­é—´çº¿å¯¹æ¯”åŸå›¾å’Œå¤„ç†ç»“æœ`)\n      console.log('âœ… è¤ªè¡£å¤„ç†å®Œæˆ')\n    } else {\n      throw new Error(result.error || 'è¤ªè¡£å¤„ç†å¤±è´¥')\n    }\n  } catch (error) {\n    console.error('âŒ è¤ªè¡£å¤„ç†å¤±è´¥:', error)\n    Toast.fail(`å¤„ç†å¤±è´¥: ${error.message}`)\n  } finally {\n    isLoading.value = false\n    processingStatus.value = ''\n    progressPercent.value = 0\n  }\n}\n\n// é‡ç½®å¤„ç†\nconst resetProcess = () => {\n  selectedImage.value = null\n  originalImageForComparison.value = null\n  resultImage.value = null\n  processingStatus.value = ''\n  promptId.value = ''\n  processingTime.value = ''\n  \n  // é‡ç½®æ¨¡æ¿å†…éƒ¨çŠ¶æ€\n  if (templateRef.value) {\n    const { uploadData } = templateRef.value\n    if (uploadData['main-image']) {\n      uploadData['main-image'] = null\n    }\n  }\n  \n  Toast.success('å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°é€‰æ‹©å›¾ç‰‡')\n}\n\n// ä¸‹è½½ç»“æœ\nconst handleDownload = (imageUrl) => {\n  if (!imageUrl) return\n\n  const link = document.createElement('a')\n  link.href = imageUrl\n  link.download = `clothes_swap_result_${Date.now()}.png`\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n\n  Toast.success('å›¾ç‰‡ä¸‹è½½å·²å¼€å§‹')\n}\n\n// ç”¨æˆ·ç™»å½•æˆåŠŸå›è°ƒ\nconst handleUserLogin = (data) => {\n  console.log('ç”¨æˆ·ç™»å½•æˆåŠŸ:', data)\n  // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘ä¸€äº›éœ€è¦ç™»å½•çŠ¶æ€çš„æ“ä½œ\n  // æ¯”å¦‚åˆ·æ–°ç§¯åˆ†ä¿¡æ¯ç­‰\n}\n\n// ç”¨æˆ·ç™»å‡ºå›è°ƒ\nconst handleUserLogout = () => {\n  console.log('ç”¨æˆ·å·²ç™»å‡º')\n  // å¯ä»¥åœ¨è¿™é‡Œæ¸…ç†ä¸€äº›ç”¨æˆ·ç›¸å…³çš„çŠ¶æ€\n}\n\n// ç”Ÿå‘½å‘¨æœŸ\nonMounted(() => {\n  console.log('ClothesSwapUnifiedç»„ä»¶å·²æŒ‚è½½ï¼ŒComfyUIæœåŠ¡å·²å‡†å¤‡å°±ç»ª')\n})\n\nonUnmounted(() => {\n  // æ¸…ç†å·¥ä½œ\n  if (isLoading.value) {\n    isLoading.value = false\n  }\n})\n</script>\n\n<style scoped>\n/* è¿™é‡Œå¯ä»¥æ·»åŠ ç‰¹å®šäºä¸€é”®è¤ªè¡£åŠŸèƒ½çš„æ ·å¼ */\n/* å¤§éƒ¨åˆ†æ ·å¼å·²ç»åœ¨ç»Ÿä¸€æ¨¡æ¿ä¸­å¤„ç† */\n\n/* å¦‚æœéœ€è¦è‡ªå®šä¹‰æ ·å¼ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  */\n:deep(.unified-image-upload-panel) {\n  /* è‡ªå®šä¹‰ä¸Šä¼ é¢æ¿æ ·å¼ */\n}\n\n:deep(.single-image-upload) {\n  /* è‡ªå®šä¹‰å•å›¾ä¸Šä¼ æ ·å¼ */\n}\n\n/* ç§»åŠ¨ç«¯ä¼˜åŒ– */\n@media (max-width: 768px) {\n  /* ç§»åŠ¨ç«¯ç‰¹å®šæ ·å¼ */\n}\n\n/* æ·±è‰²ä¸»é¢˜é€‚é… */\n@media (prefers-color-scheme: dark) {\n  /* æ·±è‰²ä¸»é¢˜æ ·å¼ */\n}\n</style>\n\n"
        }
    ]
}