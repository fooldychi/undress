{
    "sourceFile": "client/src/services/globalErrorHandler.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1752899660459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752900067878,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,23 +74,23 @@\n export function showGlobalError(error, options = {}) {\n   console.error('ğŸš¨ å…¨å±€é”™è¯¯å¤„ç†å™¨æ•è·é”™è¯¯:', error)\n \n   let errorType = ERROR_TYPES.UNKNOWN_ERROR\n-  let title = 'ç³»ç»Ÿé”™è¯¯'\n-  let message = 'ç³»ç»Ÿå‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'\n-  let showRetry = true\n+  let title = 'æœåŠ¡å™¨ä¸å¯ç”¨'\n+  let message = 'ç›®å‰æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–ç¨åå†è¯•ï¼'\n+  let showRetry = false // é»˜è®¤ä¸æ˜¾ç¤ºé‡è¯•æŒ‰é’®\n \n-  // æ ¹æ®é”™è¯¯ç±»å‹è®¾ç½®ä¸åŒçš„æç¤º\n+  // æ ¹æ®é”™è¯¯ç±»å‹è®¾ç½®æç¤º\n   if (isComfyUIServerError(error)) {\n     errorType = ERROR_TYPES.COMFYUI_SERVER_UNAVAILABLE\n-    title = 'ComfyUI æœåŠ¡å™¨è¿æ¥å¼‚å¸¸'\n-    message = 'ComfyUI æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºæœåŠ¡å™¨ç»´æŠ¤æˆ–ç½‘ç»œé—®é¢˜å¯¼è‡´çš„ã€‚è¯·ç¨åé‡è¯•æˆ–åˆ·æ–°é¡µé¢ã€‚'\n-    showRetry = true\n+    title = 'æœåŠ¡å™¨ä¸å¯ç”¨'\n+    message = 'ç›®å‰æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–ç¨åå†è¯•ï¼'\n+    showRetry = false // ComfyUI æœåŠ¡å™¨é”™è¯¯åªæä¾›åˆ·æ–°é¡µé¢\n   } else if (isNetworkError(error)) {\n     errorType = ERROR_TYPES.NETWORK_ERROR\n-    title = 'ç½‘ç»œè¿æ¥å¼‚å¸¸'\n-    message = 'ç½‘ç»œè¿æ¥å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥åé‡è¯•ã€‚'\n-    showRetry = true\n+    title = 'æœåŠ¡å™¨ä¸å¯ç”¨'\n+    message = 'ç›®å‰æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–ç¨åå†è¯•ï¼'\n+    showRetry = false\n   } else if (isAuthError(error)) {\n     errorType = ERROR_TYPES.AUTH_ERROR\n     title = 'ç™»å½•çŠ¶æ€å¼‚å¸¸'\n     message = 'æ‚¨çš„ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•ã€‚'\n"
                },
                {
                    "date": 1752900496905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,25 +101,13 @@\n   if (options.title) title = options.title\n   if (options.message) message = options.message\n   if (options.showRetry !== undefined) showRetry = options.showRetry\n \n-  // è·å–é”™è¯¯è¯¦æƒ…\n-  let details = ''\n-  if (error?.stack) {\n-    details = error.stack\n-  } else if (error?.message) {\n-    details = error.message\n-  } else if (typeof error === 'string') {\n-    details = error\n-  }\n-\n   // æ›´æ–°é”™è¯¯çŠ¶æ€\n   errorState.value = {\n     visible: true,\n     title,\n     message,\n-    details,\n-    showRetry,\n     errorType\n   }\n \n   // é˜»æ­¢é¡µé¢äº¤äº’\n"
                },
                {
                    "date": 1752947431569,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,13 +23,16 @@\n   'ComfyUIæœåŠ¡å™¨ä¸å¯ç”¨',\n   'æ‰€æœ‰ç«¯ç‚¹æµ‹è¯•å¤±è´¥',\n   'ComfyUIæœåŠ¡å™¨ä¸å¯è¾¾',\n   'WebSocketè¿æ¥å¤±è´¥',\n+  'WebSocketè¿æ¥åæœªèƒ½é”å®šæœåŠ¡å™¨',\n   'ComfyUIæœåŠ¡å™¨å“åº”å¼‚å¸¸',\n   'ComfyUIæœåŠ¡å™¨é›†ç¾¤ä¸å¯ç”¨',\n   'ä¸ªæœåŠ¡å™¨éƒ½æ— æ³•è¿æ¥',\n   'æ²¡æœ‰æ‰¾åˆ°å¥åº·çš„æœåŠ¡å™¨',\n-  'æ²¡æœ‰å¯ç”¨çš„å¥åº·æœåŠ¡å™¨'\n+  'æ²¡æœ‰å¯ç”¨çš„å¥åº·æœåŠ¡å™¨',\n+  'æ— æ³•è·å–å¯ç”¨çš„ComfyUIæœåŠ¡å™¨',\n+  'è´Ÿè½½å‡è¡¡å™¨æœªè¿”å›æœ‰æ•ˆçš„æœåŠ¡å™¨URL'\n ]\n \n // æ£€æŸ¥æ˜¯å¦ä¸º ComfyUI æœåŠ¡å™¨é”™è¯¯\n function isComfyUIServerError(error) {\n"
                },
                {
                    "date": 1753553565119,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,8 +135,21 @@\n   // æ‹¦æˆªæœªæ•è·çš„ Promise é”™è¯¯\n   window.addEventListener('unhandledrejection', (event) => {\n     console.error('ğŸš¨ æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason)\n \n+    // Vueé€’å½’æ›´æ–°é”™è¯¯åº”è¯¥æš´éœ²ç»™å¼€å‘è€…ï¼Œä¸è¦æ©ç›–\n+    if (event.reason?.message?.includes('Maximum recursive updates exceeded')) {\n+      console.error('âŒ Vueé€’å½’æ›´æ–°é”™è¯¯ - éœ€è¦ä¿®å¤ä»£ç é€»è¾‘!')\n+      console.error('æ£€æŸ¥ä»¥ä¸‹å¯èƒ½åŸå› :')\n+      console.error('1. watchä¸­ä¿®æ”¹è¢«ç›‘å¬çš„æ•°æ®')\n+      console.error('2. computedä¸­ä¿®æ”¹å“åº”å¼æ•°æ®')\n+      console.error('3. æ¨¡æ¿ä¸­è°ƒç”¨ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°')\n+      // å¼€å‘ç¯å¢ƒä¸‹ä¸é˜»æ­¢é”™è¯¯ï¼Œè®©å¼€å‘è€…çœ‹åˆ°å®Œæ•´é”™è¯¯ä¿¡æ¯\n+      if (process.env.NODE_ENV === 'development') {\n+        return\n+      }\n+    }\n+\n     // æ£€æŸ¥æ˜¯å¦ä¸ºå…³é”®é”™è¯¯\n     if (isComfyUIServerError(event.reason) ||\n         isNetworkError(event.reason) ||\n         isAuthError(event.reason)) {\n"
                }
            ],
            "date": 1752899660459,
            "name": "Commit-0",
            "content": "import { ref } from 'vue'\n\n// å…¨å±€é”™è¯¯çŠ¶æ€\nconst errorState = ref({\n  visible: false,\n  title: '',\n  message: '',\n  details: '',\n  showRetry: true,\n  errorType: null\n})\n\n// é”™è¯¯ç±»å‹å¸¸é‡\nexport const ERROR_TYPES = {\n  COMFYUI_SERVER_UNAVAILABLE: 'comfyui_server_unavailable',\n  NETWORK_ERROR: 'network_error',\n  AUTH_ERROR: 'auth_error',\n  UNKNOWN_ERROR: 'unknown_error'\n}\n\n// ComfyUI æœåŠ¡å™¨ä¸å¯ç”¨çš„é”™è¯¯å…³é”®è¯\nconst COMFYUI_ERROR_KEYWORDS = [\n  'ComfyUIæœåŠ¡å™¨ä¸å¯ç”¨',\n  'æ‰€æœ‰ç«¯ç‚¹æµ‹è¯•å¤±è´¥',\n  'ComfyUIæœåŠ¡å™¨ä¸å¯è¾¾',\n  'WebSocketè¿æ¥å¤±è´¥',\n  'ComfyUIæœåŠ¡å™¨å“åº”å¼‚å¸¸',\n  'ComfyUIæœåŠ¡å™¨é›†ç¾¤ä¸å¯ç”¨',\n  'ä¸ªæœåŠ¡å™¨éƒ½æ— æ³•è¿æ¥',\n  'æ²¡æœ‰æ‰¾åˆ°å¥åº·çš„æœåŠ¡å™¨',\n  'æ²¡æœ‰å¯ç”¨çš„å¥åº·æœåŠ¡å™¨'\n]\n\n// æ£€æŸ¥æ˜¯å¦ä¸º ComfyUI æœåŠ¡å™¨é”™è¯¯\nfunction isComfyUIServerError(error) {\n  const errorMessage = error?.message || error?.toString() || ''\n  return COMFYUI_ERROR_KEYWORDS.some(keyword =>\n    errorMessage.includes(keyword)\n  )\n}\n\n// æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\nfunction isNetworkError(error) {\n  const errorMessage = error?.message || error?.toString() || ''\n  const networkKeywords = [\n    'Failed to fetch',\n    'NetworkError',\n    'fetch',\n    'ECONNREFUSED',\n    'ENOTFOUND',\n    'timeout'\n  ]\n  return networkKeywords.some(keyword =>\n    errorMessage.toLowerCase().includes(keyword.toLowerCase())\n  )\n}\n\n// æ£€æŸ¥æ˜¯å¦ä¸ºè®¤è¯é”™è¯¯\nfunction isAuthError(error) {\n  const errorMessage = error?.message || error?.toString() || ''\n  const authKeywords = [\n    'ç™»å½•å·²è¿‡æœŸ',\n    'ä»¤ç‰Œå·²è¿‡æœŸ',\n    'æ— æ•ˆçš„è®¿é—®ä»¤ç‰Œ',\n    'è®¤è¯éªŒè¯å¤±è´¥',\n    '401'\n  ]\n  return authKeywords.some(keyword =>\n    errorMessage.includes(keyword)\n  )\n}\n\n// æ˜¾ç¤ºå…¨å±€é”™è¯¯å¼¹çª—\nexport function showGlobalError(error, options = {}) {\n  console.error('ğŸš¨ å…¨å±€é”™è¯¯å¤„ç†å™¨æ•è·é”™è¯¯:', error)\n\n  let errorType = ERROR_TYPES.UNKNOWN_ERROR\n  let title = 'ç³»ç»Ÿé”™è¯¯'\n  let message = 'ç³»ç»Ÿå‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'\n  let showRetry = true\n\n  // æ ¹æ®é”™è¯¯ç±»å‹è®¾ç½®ä¸åŒçš„æç¤º\n  if (isComfyUIServerError(error)) {\n    errorType = ERROR_TYPES.COMFYUI_SERVER_UNAVAILABLE\n    title = 'ComfyUI æœåŠ¡å™¨è¿æ¥å¼‚å¸¸'\n    message = 'ComfyUI æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºæœåŠ¡å™¨ç»´æŠ¤æˆ–ç½‘ç»œé—®é¢˜å¯¼è‡´çš„ã€‚è¯·ç¨åé‡è¯•æˆ–åˆ·æ–°é¡µé¢ã€‚'\n    showRetry = true\n  } else if (isNetworkError(error)) {\n    errorType = ERROR_TYPES.NETWORK_ERROR\n    title = 'ç½‘ç»œè¿æ¥å¼‚å¸¸'\n    message = 'ç½‘ç»œè¿æ¥å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥åé‡è¯•ã€‚'\n    showRetry = true\n  } else if (isAuthError(error)) {\n    errorType = ERROR_TYPES.AUTH_ERROR\n    title = 'ç™»å½•çŠ¶æ€å¼‚å¸¸'\n    message = 'æ‚¨çš„ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•ã€‚'\n    showRetry = false\n  }\n\n  // åº”ç”¨è‡ªå®šä¹‰é€‰é¡¹\n  if (options.title) title = options.title\n  if (options.message) message = options.message\n  if (options.showRetry !== undefined) showRetry = options.showRetry\n\n  // è·å–é”™è¯¯è¯¦æƒ…\n  let details = ''\n  if (error?.stack) {\n    details = error.stack\n  } else if (error?.message) {\n    details = error.message\n  } else if (typeof error === 'string') {\n    details = error\n  }\n\n  // æ›´æ–°é”™è¯¯çŠ¶æ€\n  errorState.value = {\n    visible: true,\n    title,\n    message,\n    details,\n    showRetry,\n    errorType\n  }\n\n  // é˜»æ­¢é¡µé¢äº¤äº’\n  document.body.style.overflow = 'hidden'\n\n  return errorState\n}\n\n// éšè—å…¨å±€é”™è¯¯å¼¹çª—\nexport function hideGlobalError() {\n  errorState.value.visible = false\n  document.body.style.overflow = ''\n}\n\n// è·å–é”™è¯¯çŠ¶æ€\nexport function getErrorState() {\n  return errorState\n}\n\n// å…¨å±€é”™è¯¯æ‹¦æˆªå™¨\nexport function setupGlobalErrorHandler() {\n  // æ‹¦æˆªæœªæ•è·çš„ Promise é”™è¯¯\n  window.addEventListener('unhandledrejection', (event) => {\n    console.error('ğŸš¨ æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason)\n\n    // æ£€æŸ¥æ˜¯å¦ä¸ºå…³é”®é”™è¯¯\n    if (isComfyUIServerError(event.reason) ||\n        isNetworkError(event.reason) ||\n        isAuthError(event.reason)) {\n      showGlobalError(event.reason)\n      event.preventDefault() // é˜»æ­¢é»˜è®¤çš„é”™è¯¯å¤„ç†\n    }\n  })\n\n  // æ‹¦æˆªæœªæ•è·çš„ JavaScript é”™è¯¯\n  window.addEventListener('error', (event) => {\n    console.error('ğŸš¨ æœªæ•è·çš„ JavaScript é”™è¯¯:', event.error)\n\n    // æ£€æŸ¥æ˜¯å¦ä¸ºå…³é”®é”™è¯¯\n    if (isComfyUIServerError(event.error) ||\n        isNetworkError(event.error) ||\n        isAuthError(event.error)) {\n      showGlobalError(event.error)\n    }\n  })\n\n  console.log('âœ… å…¨å±€é”™è¯¯å¤„ç†å™¨å·²å¯åŠ¨')\n}\n\n// æ‰‹åŠ¨è§¦å‘é”™è¯¯å¤„ç†ï¼ˆä¾›ç»„ä»¶ä½¿ç”¨ï¼‰\nexport function handleError(error, context = '') {\n  console.error(`ğŸš¨ ${context} é”™è¯¯:`, error)\n\n  // æ£€æŸ¥æ˜¯å¦ä¸ºéœ€è¦å…¨å±€å¤„ç†çš„é”™è¯¯\n  if (isComfyUIServerError(error) ||\n      isNetworkError(error) ||\n      isAuthError(error)) {\n    showGlobalError(error)\n    return true // è¡¨ç¤ºå·²è¢«å…¨å±€å¤„ç†\n  }\n\n  return false // è¡¨ç¤ºéœ€è¦ç»„ä»¶è‡ªè¡Œå¤„ç†\n}\n\nexport default {\n  showGlobalError,\n  hideGlobalError,\n  getErrorState,\n  setupGlobalErrorHandler,\n  handleError,\n  ERROR_TYPES\n}\n"
        }
    ]
}