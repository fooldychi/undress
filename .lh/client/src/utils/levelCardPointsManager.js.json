{
    "sourceFile": "client/src/utils/levelCardPointsManager.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 13,
            "patches": [
                {
                    "date": 1752288021271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752288511571,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,18 +19,11 @@\n   }\n \n   // è·å–ç§¯åˆ†çŠ¶æ€\n   async getPointsStatus() {\n+    // é¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€\n     if (!this.isLoggedIn()) {\n-      return {\n-        current: 0,\n-        total_points: 0,\n-        cards_count: 0,\n-        cards_breakdown: [],\n-        canGenerate: false,\n-        generationCost: 20,\n-        isLoggedIn: false\n-      }\n+      return this.getDefaultStatus()\n     }\n \n     try {\n       // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®\n"
                },
                {
                    "date": 1752288528460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,17 +80,18 @@\n   }\n \n   // è·å–é»˜è®¤çŠ¶æ€\n   getDefaultStatus() {\n+    const loggedIn = this.isLoggedIn()\n     return {\n       current: 0,\n       total_points: 0,\n       purchased_points: 0,\n       cards_count: 0,\n       cards_breakdown: [],\n       canGenerate: false,\n       generationCost: 20,\n-      isLoggedIn: this.isLoggedIn(),\n+      isLoggedIn: loggedIn,\n       dailyRemaining: 0,\n       dailyFreePoints: 0,\n       totalUsedToday: 0,\n       experienceCardPoints: 0\n"
                },
                {
                    "date": 1752334538178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -98,18 +98,25 @@\n     }\n   }\n \n   // æ¶ˆè€—ç§¯åˆ†\n-  async consumePoints(amount, description = 'ç”Ÿæˆå›¾ç‰‡') {\n+  async consumePoints(amount, description = 'ç”Ÿæˆå›¾ç‰‡', mediaUrl = null) {\n     if (!this.isLoggedIn()) {\n       throw new Error('è¯·å…ˆç™»å½•')\n     }\n \n     try {\n+      console.log(`ğŸ’° å¼€å§‹æ¶ˆè€—ç§¯åˆ†: ${amount}ç‚¹, æè¿°: ${description}`)\n+      if (mediaUrl) {\n+        console.log(`ğŸ¬ å…³è”åª’ä½“URL: ${mediaUrl}`)\n+      }\n+\n       // è°ƒç”¨åç«¯APIæ¶ˆè€—ç§¯åˆ†\n-      const response = await pointsApi.consumePoints(amount, description)\n+      const response = await pointsApi.consumePoints(amount, description, mediaUrl)\n \n       if (response.success) {\n+        console.log(`âœ… ç§¯åˆ†æ¶ˆè€—æˆåŠŸ: æ¶ˆè€—${amount}ç‚¹, å‰©ä½™${response.data.remaining_points}ç‚¹`)\n+\n         // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶ä¸‹æ¬¡è·å–æœ€æ–°æ•°æ®\n         this.pointsInfo = null\n         this.lastUpdateTime = 0\n \n"
                },
                {
                    "date": 1752342614789,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -141,8 +141,15 @@\n     this.lastUpdateTime = 0\n     return await this.getPointsStatus()\n   }\n \n+  // å¼ºåˆ¶æ¸…é™¤ç¼“å­˜\n+  clearCache() {\n+    this.pointsInfo = null\n+    this.lastUpdateTime = 0\n+    console.log('ğŸ—‘ï¸ ç§¯åˆ†ç¼“å­˜å·²æ¸…é™¤')\n+  }\n+\n   // ç»‘å®šç­‰çº§å¡\n   async bindLevelCard(cardNumber, cardPassword) {\n     if (!this.isLoggedIn()) {\n       throw new Error('è¯·å…ˆç™»å½•')\n"
                },
                {
                    "date": 1752376526264,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,11 @@\n   constructor() {\n     this.pointsInfo = null\n     this.lastUpdateTime = 0\n     this.updateInterval = 30000 // 30ç§’æ›´æ–°ä¸€æ¬¡\n+    this.retryCount = 0\n+    this.maxRetries = 3\n+    this.retryDelay = 1000 // åˆå§‹é‡è¯•å»¶è¿Ÿ1ç§’\n   }\n \n   // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n   isLoggedIn() {\n"
                },
                {
                    "date": 1752376570327,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,28 +35,37 @@\n         return this.formatPointsStatus(this.pointsInfo)\n       }\n \n       // ä»APIè·å–æœ€æ–°ç§¯åˆ†ä¿¡æ¯\n-      const response = await pointsApi.getUserPoints()\n+      const response = await this.fetchPointsWithRetry()\n \n       if (response.success) {\n         this.pointsInfo = response.data\n         this.lastUpdateTime = now\n+        this.retryCount = 0 // é‡ç½®é‡è¯•è®¡æ•°\n         return this.formatPointsStatus(this.pointsInfo)\n       } else {\n         console.error('è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥:', response.message)\n         // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n         if (response.message && response.message.includes('ä»¤ç‰Œ')) {\n           return this.getDefaultStatus()\n         }\n+        // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\n+        if (this.pointsInfo) {\n+          return this.formatPointsStatus(this.pointsInfo)\n+        }\n         return this.getDefaultStatus()\n       }\n     } catch (error) {\n       console.error('è·å–ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n       // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n       if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n         return this.getDefaultStatus()\n       }\n+      // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\n+      if (this.pointsInfo) {\n+        return this.formatPointsStatus(this.pointsInfo)\n+      }\n       return this.getDefaultStatus()\n     }\n   }\n \n"
                },
                {
                    "date": 1752376585399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,8 +68,27 @@\n       return this.getDefaultStatus()\n     }\n   }\n \n+  // å¸¦é‡è¯•æœºåˆ¶çš„ç§¯åˆ†è·å–\n+  async fetchPointsWithRetry(attempt = 0) {\n+    try {\n+      return await pointsApi.getUserPoints()\n+    } catch (error) {\n+      if (attempt < this.maxRetries &&\n+          (error.message.includes('ç½‘ç»œ') ||\n+           error.message.includes('è¶…æ—¶') ||\n+           error.message.includes('è®¤è¯éªŒè¯å¤±è´¥'))) {\n+        // æŒ‡æ•°é€€é¿é‡è¯•\n+        const delay = this.retryDelay * Math.pow(2, attempt)\n+        console.log(`ç§¯åˆ†è·å–å¤±è´¥ï¼Œ${delay}msåé‡è¯• (${attempt + 1}/${this.maxRetries})`)\n+        await new Promise(resolve => setTimeout(resolve, delay))\n+        return this.fetchPointsWithRetry(attempt + 1)\n+      }\n+      throw error\n+    }\n+  }\n+\n   // æ ¼å¼åŒ–ç§¯åˆ†çŠ¶æ€\n   formatPointsStatus(pointsInfo) {\n     const totalPoints = pointsInfo.total_points || 0\n     const generationCost = 20 // æ¯æ¬¡ç”Ÿæˆæ¶ˆè€—20ç§¯åˆ†\n"
                },
                {
                    "date": 1752424440614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -161,9 +161,22 @@\n         throw new Error(response.message || 'ç§¯åˆ†ä¸è¶³')\n       }\n     } catch (error) {\n       console.error('æ¶ˆè€—ç§¯åˆ†å¤±è´¥:', error)\n-      throw error\n+\n+      // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n+      let errorMessage = error.message\n+      if (errorMessage.includes('æœåŠ¡å™¨è¿”å›éJSONå“åº”')) {\n+        errorMessage = 'åç«¯æœåŠ¡è¿æ¥å¼‚å¸¸ï¼Œç§¯åˆ†æ‰£é™¤å¤±è´¥'\n+      } else if (errorMessage.includes('APIæ¥å£ä¸å­˜åœ¨')) {\n+        errorMessage = 'ç§¯åˆ†ç³»ç»Ÿæ¥å£å¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'\n+      } else if (errorMessage.includes('ç½‘ç»œè¿æ¥å¼‚å¸¸')) {\n+        errorMessage = 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œç§¯åˆ†æ‰£é™¤å¤±è´¥'\n+      } else if (errorMessage.includes('ç™»å½•å·²è¿‡æœŸ')) {\n+        errorMessage = 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•'\n+      }\n+\n+      throw new Error(errorMessage)\n     }\n   }\n \n   // åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n"
                },
                {
                    "date": 1752424930335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -161,22 +161,9 @@\n         throw new Error(response.message || 'ç§¯åˆ†ä¸è¶³')\n       }\n     } catch (error) {\n       console.error('æ¶ˆè€—ç§¯åˆ†å¤±è´¥:', error)\n-\n-      // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n-      let errorMessage = error.message\n-      if (errorMessage.includes('æœåŠ¡å™¨è¿”å›éJSONå“åº”')) {\n-        errorMessage = 'åç«¯æœåŠ¡è¿æ¥å¼‚å¸¸ï¼Œç§¯åˆ†æ‰£é™¤å¤±è´¥'\n-      } else if (errorMessage.includes('APIæ¥å£ä¸å­˜åœ¨')) {\n-        errorMessage = 'ç§¯åˆ†ç³»ç»Ÿæ¥å£å¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'\n-      } else if (errorMessage.includes('ç½‘ç»œè¿æ¥å¼‚å¸¸')) {\n-        errorMessage = 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œç§¯åˆ†æ‰£é™¤å¤±è´¥'\n-      } else if (errorMessage.includes('ç™»å½•å·²è¿‡æœŸ')) {\n-        errorMessage = 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•åé‡è¯•'\n-      }\n-\n-      throw new Error(errorMessage)\n+      throw error\n     }\n   }\n \n   // åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n"
                },
                {
                    "date": 1752834919573,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n class LevelCardPointsManager {\n   constructor() {\n     this.pointsInfo = null\n     this.lastUpdateTime = 0\n-    this.updateInterval = 30000 // 30ç§’æ›´æ–°ä¸€æ¬¡\n+    this.cacheTimeout = 60000 // ç¼“å­˜æœ‰æ•ˆæœŸ1åˆ†é’Ÿï¼ˆä»…ç”¨äºå‡å°‘é‡å¤è¯·æ±‚ï¼‰\n     this.retryCount = 0\n     this.maxRetries = 3\n     this.retryDelay = 1000 // åˆå§‹é‡è¯•å»¶è¿Ÿ1ç§’\n   }\n"
                },
                {
                    "date": 1752834936734,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,11 +28,11 @@\n       return this.getDefaultStatus()\n     }\n \n     try {\n-      // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®\n+      // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰\n       const now = Date.now()\n-      if (this.pointsInfo && (now - this.lastUpdateTime) < this.updateInterval) {\n+      if (this.pointsInfo && (now - this.lastUpdateTime) < this.cacheTimeout) {\n         return this.formatPointsStatus(this.pointsInfo)\n       }\n \n       // ä»APIè·å–æœ€æ–°ç§¯åˆ†ä¿¡æ¯\n"
                },
                {
                    "date": 1753639306032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,290 +1,291 @@\n-/**\n- * ç­‰çº§å¡ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ\n- * åŸºäºåç«¯APIçš„ç§¯åˆ†ç®¡ç†ï¼Œæ›¿ä»£åŸæœ‰çš„æœ¬åœ°ç§¯åˆ†ç³»ç»Ÿ\n- */\n-\n-import { pointsApi, levelCardApi } from '../services/api.js'\n-import { authApi } from '../services/api.js'\n-\n-class LevelCardPointsManager {\n-  constructor() {\n-    this.pointsInfo = null\n-    this.lastUpdateTime = 0\n-    this.cacheTimeout = 60000 // ç¼“å­˜æœ‰æ•ˆæœŸ1åˆ†é’Ÿï¼ˆä»…ç”¨äºå‡å°‘é‡å¤è¯·æ±‚ï¼‰\n-    this.retryCount = 0\n-    this.maxRetries = 3\n-    this.retryDelay = 1000 // åˆå§‹é‡è¯•å»¶è¿Ÿ1ç§’\n-  }\n-\n-  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n-  isLoggedIn() {\n-    return authApi.isLoggedIn()\n-  }\n-\n-  // è·å–ç§¯åˆ†çŠ¶æ€\n-  async getPointsStatus() {\n-    // é¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€\n-    if (!this.isLoggedIn()) {\n-      return this.getDefaultStatus()\n-    }\n-\n-    try {\n-      // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰\n-      const now = Date.now()\n-      if (this.pointsInfo && (now - this.lastUpdateTime) < this.cacheTimeout) {\n-        return this.formatPointsStatus(this.pointsInfo)\n-      }\n-\n-      // ä»APIè·å–æœ€æ–°ç§¯åˆ†ä¿¡æ¯\n-      const response = await this.fetchPointsWithRetry()\n-\n-      if (response.success) {\n-        this.pointsInfo = response.data\n-        this.lastUpdateTime = now\n-        this.retryCount = 0 // é‡ç½®é‡è¯•è®¡æ•°\n-        return this.formatPointsStatus(this.pointsInfo)\n-      } else {\n-        console.error('è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥:', response.message)\n-        // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n-        if (response.message && response.message.includes('ä»¤ç‰Œ')) {\n-          return this.getDefaultStatus()\n-        }\n-        // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\n-        if (this.pointsInfo) {\n-          return this.formatPointsStatus(this.pointsInfo)\n-        }\n-        return this.getDefaultStatus()\n-      }\n-    } catch (error) {\n-      console.error('è·å–ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n-      // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n-      if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n-        return this.getDefaultStatus()\n-      }\n-      // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\n-      if (this.pointsInfo) {\n-        return this.formatPointsStatus(this.pointsInfo)\n-      }\n-      return this.getDefaultStatus()\n-    }\n-  }\n-\n-  // å¸¦é‡è¯•æœºåˆ¶çš„ç§¯åˆ†è·å–\n-  async fetchPointsWithRetry(attempt = 0) {\n-    try {\n-      return await pointsApi.getUserPoints()\n-    } catch (error) {\n-      if (attempt < this.maxRetries &&\n-          (error.message.includes('ç½‘ç»œ') ||\n-           error.message.includes('è¶…æ—¶') ||\n-           error.message.includes('è®¤è¯éªŒè¯å¤±è´¥'))) {\n-        // æŒ‡æ•°é€€é¿é‡è¯•\n-        const delay = this.retryDelay * Math.pow(2, attempt)\n-        console.log(`ç§¯åˆ†è·å–å¤±è´¥ï¼Œ${delay}msåé‡è¯• (${attempt + 1}/${this.maxRetries})`)\n-        await new Promise(resolve => setTimeout(resolve, delay))\n-        return this.fetchPointsWithRetry(attempt + 1)\n-      }\n-      throw error\n-    }\n-  }\n-\n-  // æ ¼å¼åŒ–ç§¯åˆ†çŠ¶æ€\n-  formatPointsStatus(pointsInfo) {\n-    const totalPoints = pointsInfo.total_points || 0\n-    const generationCost = 20 // æ¯æ¬¡ç”Ÿæˆæ¶ˆè€—20ç§¯åˆ†\n-\n-    return {\n-      current: totalPoints,\n-      total_points: totalPoints,\n-      purchased_points: pointsInfo.purchased_points || 0,\n-      cards_count: pointsInfo.cards_count || 0,\n-      cards_breakdown: pointsInfo.cards_breakdown || [],\n-      canGenerate: totalPoints >= generationCost,\n-      generationCost: generationCost,\n-      isLoggedIn: true,\n-      // å…¼å®¹åŸæœ‰å­—æ®µ\n-      dailyRemaining: 0, // ç­‰çº§å¡ç³»ç»Ÿæ²¡æœ‰æ¯æ—¥å…è´¹æ¦‚å¿µ\n-      dailyFreePoints: 0,\n-      totalUsedToday: 0,\n-      experienceCardPoints: 0\n-    }\n-  }\n-\n-  // è·å–é»˜è®¤çŠ¶æ€\n-  getDefaultStatus() {\n-    const loggedIn = this.isLoggedIn()\n-    return {\n-      current: 0,\n-      total_points: 0,\n-      purchased_points: 0,\n-      cards_count: 0,\n-      cards_breakdown: [],\n-      canGenerate: false,\n-      generationCost: 20,\n-      isLoggedIn: loggedIn,\n-      dailyRemaining: 0,\n-      dailyFreePoints: 0,\n-      totalUsedToday: 0,\n-      experienceCardPoints: 0\n-    }\n-  }\n-\n-  // æ¶ˆè€—ç§¯åˆ†\n-  async consumePoints(amount, description = 'ç”Ÿæˆå›¾ç‰‡', mediaUrl = null) {\n-    if (!this.isLoggedIn()) {\n-      throw new Error('è¯·å…ˆç™»å½•')\n-    }\n-\n-    try {\n-      console.log(`ğŸ’° å¼€å§‹æ¶ˆè€—ç§¯åˆ†: ${amount}ç‚¹, æè¿°: ${description}`)\n-      if (mediaUrl) {\n-        console.log(`ğŸ¬ å…³è”åª’ä½“URL: ${mediaUrl}`)\n-      }\n-\n-      // è°ƒç”¨åç«¯APIæ¶ˆè€—ç§¯åˆ†\n-      const response = await pointsApi.consumePoints(amount, description, mediaUrl)\n-\n-      if (response.success) {\n-        console.log(`âœ… ç§¯åˆ†æ¶ˆè€—æˆåŠŸ: æ¶ˆè€—${amount}ç‚¹, å‰©ä½™${response.data.remaining_points}ç‚¹`)\n-\n-        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶ä¸‹æ¬¡è·å–æœ€æ–°æ•°æ®\n-        this.pointsInfo = null\n-        this.lastUpdateTime = 0\n-\n-        return {\n-          success: true,\n-          message: 'ç§¯åˆ†æ¶ˆè€—æˆåŠŸ',\n-          consumed: amount,\n-          remaining: response.data.remaining_points || 0\n-        }\n-      } else {\n-        throw new Error(response.message || 'ç§¯åˆ†ä¸è¶³')\n-      }\n-    } catch (error) {\n-      console.error('æ¶ˆè€—ç§¯åˆ†å¤±è´¥:', error)\n-      throw error\n-    }\n-  }\n-\n-  // åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n-  async refreshPoints() {\n-    this.pointsInfo = null\n-    this.lastUpdateTime = 0\n-    return await this.getPointsStatus()\n-  }\n-\n-  // å¼ºåˆ¶æ¸…é™¤ç¼“å­˜\n-  clearCache() {\n-    this.pointsInfo = null\n-    this.lastUpdateTime = 0\n-    console.log('ğŸ—‘ï¸ ç§¯åˆ†ç¼“å­˜å·²æ¸…é™¤')\n-  }\n-\n-  // ç»‘å®šç­‰çº§å¡\n-  async bindLevelCard(cardNumber, cardPassword) {\n-    if (!this.isLoggedIn()) {\n-      throw new Error('è¯·å…ˆç™»å½•')\n-    }\n-\n-    try {\n-      const response = await levelCardApi.bindCard(cardNumber, cardPassword)\n-\n-      if (response.success) {\n-        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n-        this.pointsInfo = null\n-        this.lastUpdateTime = 0\n-\n-        return {\n-          success: true,\n-          message: response.message,\n-          data: response.data\n-        }\n-      } else {\n-        throw new Error(response.message || 'ç»‘å®šå¤±è´¥')\n-      }\n-    } catch (error) {\n-      console.error('ç»‘å®šç­‰çº§å¡å¤±è´¥:', error)\n-      throw error\n-    }\n-  }\n-\n-  // è·å–ç­‰çº§å¡ç±»å‹\n-  async getCardTypes() {\n-    try {\n-      const response = await levelCardApi.getCardTypes()\n-\n-      if (response.success) {\n-        return response.data.cardTypes || []\n-      } else {\n-        console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', response.message)\n-        return []\n-      }\n-    } catch (error) {\n-      console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', error)\n-      return []\n-    }\n-  }\n-\n-  // è·å–ç”¨æˆ·çš„ç­‰çº§å¡åˆ—è¡¨\n-  async getMyCards() {\n-    if (!this.isLoggedIn()) {\n-      return []\n-    }\n-\n-    try {\n-      const response = await levelCardApi.getMyCards()\n-\n-      if (response.success) {\n-        return response.data.cards || []\n-      } else {\n-        console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', response.message)\n-        return []\n-      }\n-    } catch (error) {\n-      console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', error)\n-      return []\n-    }\n-  }\n-\n-  // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç”Ÿæˆ\n-  async canGenerate() {\n-    const status = await this.getPointsStatus()\n-    return status.canGenerate\n-  }\n-\n-  // è·å–ç”Ÿæˆæˆæœ¬\n-  getGenerationCost() {\n-    return 20 // å›ºå®š20ç§¯åˆ†\n-  }\n-\n-  // å…¼å®¹åŸæœ‰æ¥å£ - æ·»åŠ ä½“éªŒå¡ç‚¹æ•°ï¼ˆç°åœ¨é€šè¿‡ç­‰çº§å¡ç³»ç»Ÿï¼‰\n-  addExperienceCardPoints() {\n-    // è¿™ä¸ªæ–¹æ³•åœ¨ç­‰çº§å¡ç³»ç»Ÿä¸­ä¸å†ä½¿ç”¨\n-    // ç§¯åˆ†é€šè¿‡ç»‘å®šç­‰çº§å¡è·å¾—\n-    return {\n-      success: false,\n-      message: 'è¯·ä½¿ç”¨ç­‰çº§å¡ç»‘å®šåŠŸèƒ½',\n-      added: 0\n-    }\n-  }\n-\n-  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–è´­ä¹°å†å²\n-  getPurchaseHistory() {\n-    // ç­‰çº§å¡ç³»ç»Ÿä¸­ï¼Œè´­ä¹°å†å²é€šè¿‡APIè·å–\n-    return []\n-  }\n-\n-  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–ç»Ÿè®¡ä¿¡æ¯\n-  getStatistics() {\n-    return {\n-      totalPurchased: 0,\n-      totalUsed: 0,\n-      totalCards: 0\n-    }\n-  }\n-}\n-\n-// åˆ›å»ºå•ä¾‹å®ä¾‹\n-const levelCardPointsManager = new LevelCardPointsManager()\n-\n-export default levelCardPointsManager\n+/**\r\n+ * ç­‰çº§å¡ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ\r\n+ * åŸºäºåç«¯APIçš„ç§¯åˆ†ç®¡ç†ï¼Œæ›¿ä»£åŸæœ‰çš„æœ¬åœ°ç§¯åˆ†ç³»ç»Ÿ\r\n+ */\r\n+\r\n+import { pointsApi, levelCardApi } from '../services/api.js'\r\n+import { authApi } from '../services/api.js'\r\n+import eventBus, { EVENTS } from './eventBus.js'\r\n+\r\n+class LevelCardPointsManager {\r\n+  constructor() {\r\n+    this.pointsInfo = null\r\n+    this.lastUpdateTime = 0\r\n+    this.cacheTimeout = 60000 // ç¼“å­˜æœ‰æ•ˆæœŸ1åˆ†é’Ÿï¼ˆä»…ç”¨äºå‡å°‘é‡å¤è¯·æ±‚ï¼‰\r\n+    this.retryCount = 0\r\n+    this.maxRetries = 3\r\n+    this.retryDelay = 1000 // åˆå§‹é‡è¯•å»¶è¿Ÿ1ç§’\r\n+  }\r\n+\r\n+  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\r\n+  isLoggedIn() {\r\n+    return authApi.isLoggedIn()\r\n+  }\r\n+\r\n+  // è·å–ç§¯åˆ†çŠ¶æ€\r\n+  async getPointsStatus() {\r\n+    // é¦–å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€\r\n+    if (!this.isLoggedIn()) {\r\n+      return this.getDefaultStatus()\r\n+    }\r\n+\r\n+    try {\r\n+      // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰\r\n+      const now = Date.now()\r\n+      if (this.pointsInfo && (now - this.lastUpdateTime) < this.cacheTimeout) {\r\n+        return this.formatPointsStatus(this.pointsInfo)\r\n+      }\r\n+\r\n+      // ä»APIè·å–æœ€æ–°ç§¯åˆ†ä¿¡æ¯\r\n+      const response = await this.fetchPointsWithRetry()\r\n+\r\n+      if (response.success) {\r\n+        this.pointsInfo = response.data\r\n+        this.lastUpdateTime = now\r\n+        this.retryCount = 0 // é‡ç½®é‡è¯•è®¡æ•°\r\n+        return this.formatPointsStatus(this.pointsInfo)\r\n+      } else {\r\n+        console.error('è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥:', response.message)\r\n+        // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\r\n+        if (response.message && response.message.includes('ä»¤ç‰Œ')) {\r\n+          return this.getDefaultStatus()\r\n+        }\r\n+        // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\r\n+        if (this.pointsInfo) {\r\n+          return this.formatPointsStatus(this.pointsInfo)\r\n+        }\r\n+        return this.getDefaultStatus()\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('è·å–ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\r\n+      // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\r\n+      if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\r\n+        return this.getDefaultStatus()\r\n+      }\r\n+      // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰\r\n+      if (this.pointsInfo) {\r\n+        return this.formatPointsStatus(this.pointsInfo)\r\n+      }\r\n+      return this.getDefaultStatus()\r\n+    }\r\n+  }\r\n+\r\n+  // å¸¦é‡è¯•æœºåˆ¶çš„ç§¯åˆ†è·å–\r\n+  async fetchPointsWithRetry(attempt = 0) {\r\n+    try {\r\n+      return await pointsApi.getUserPoints()\r\n+    } catch (error) {\r\n+      if (attempt < this.maxRetries &&\r\n+          (error.message.includes('ç½‘ç»œ') ||\r\n+           error.message.includes('è¶…æ—¶') ||\r\n+           error.message.includes('è®¤è¯éªŒè¯å¤±è´¥'))) {\r\n+        // æŒ‡æ•°é€€é¿é‡è¯•\r\n+        const delay = this.retryDelay * Math.pow(2, attempt)\r\n+        console.log(`ç§¯åˆ†è·å–å¤±è´¥ï¼Œ${delay}msåé‡è¯• (${attempt + 1}/${this.maxRetries})`)\r\n+        await new Promise(resolve => setTimeout(resolve, delay))\r\n+        return this.fetchPointsWithRetry(attempt + 1)\r\n+      }\r\n+      throw error\r\n+    }\r\n+  }\r\n+\r\n+  // æ ¼å¼åŒ–ç§¯åˆ†çŠ¶æ€\r\n+  formatPointsStatus(pointsInfo) {\r\n+    const totalPoints = pointsInfo.total_points || 0\r\n+    const generationCost = 20 // æ¯æ¬¡ç”Ÿæˆæ¶ˆè€—20ç§¯åˆ†\r\n+\r\n+    return {\r\n+      current: totalPoints,\r\n+      total_points: totalPoints,\r\n+      purchased_points: pointsInfo.purchased_points || 0,\r\n+      cards_count: pointsInfo.cards_count || 0,\r\n+      cards_breakdown: pointsInfo.cards_breakdown || [],\r\n+      canGenerate: totalPoints >= generationCost,\r\n+      generationCost: generationCost,\r\n+      isLoggedIn: true,\r\n+      // å…¼å®¹åŸæœ‰å­—æ®µ\r\n+      dailyRemaining: 0, // ç­‰çº§å¡ç³»ç»Ÿæ²¡æœ‰æ¯æ—¥å…è´¹æ¦‚å¿µ\r\n+      dailyFreePoints: 0,\r\n+      totalUsedToday: 0,\r\n+      experienceCardPoints: 0\r\n+    }\r\n+  }\r\n+\r\n+  // è·å–é»˜è®¤çŠ¶æ€\r\n+  getDefaultStatus() {\r\n+    const loggedIn = this.isLoggedIn()\r\n+    return {\r\n+      current: 0,\r\n+      total_points: 0,\r\n+      purchased_points: 0,\r\n+      cards_count: 0,\r\n+      cards_breakdown: [],\r\n+      canGenerate: false,\r\n+      generationCost: 20,\r\n+      isLoggedIn: loggedIn,\r\n+      dailyRemaining: 0,\r\n+      dailyFreePoints: 0,\r\n+      totalUsedToday: 0,\r\n+      experienceCardPoints: 0\r\n+    }\r\n+  }\r\n+\r\n+  // æ¶ˆè€—ç§¯åˆ†\r\n+  async consumePoints(amount, description = 'ç”Ÿæˆå›¾ç‰‡', mediaUrl = null) {\r\n+    if (!this.isLoggedIn()) {\r\n+      throw new Error('è¯·å…ˆç™»å½•')\r\n+    }\r\n+\r\n+    try {\r\n+      console.log(`ğŸ’° å¼€å§‹æ¶ˆè€—ç§¯åˆ†: ${amount}ç‚¹, æè¿°: ${description}`)\r\n+      if (mediaUrl) {\r\n+        console.log(`ğŸ¬ å…³è”åª’ä½“URL: ${mediaUrl}`)\r\n+      }\r\n+\r\n+      // è°ƒç”¨åç«¯APIæ¶ˆè€—ç§¯åˆ†\r\n+      const response = await pointsApi.consumePoints(amount, description, mediaUrl)\r\n+\r\n+      if (response.success) {\r\n+        console.log(`âœ… ç§¯åˆ†æ¶ˆè€—æˆåŠŸ: æ¶ˆè€—${amount}ç‚¹, å‰©ä½™${response.data.remaining_points}ç‚¹`)\r\n+\r\n+        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶ä¸‹æ¬¡è·å–æœ€æ–°æ•°æ®\r\n+        this.pointsInfo = null\r\n+        this.lastUpdateTime = 0\r\n+\r\n+        return {\r\n+          success: true,\r\n+          message: 'ç§¯åˆ†æ¶ˆè€—æˆåŠŸ',\r\n+          consumed: amount,\r\n+          remaining: response.data.remaining_points || 0\r\n+        }\r\n+      } else {\r\n+        throw new Error(response.message || 'ç§¯åˆ†ä¸è¶³')\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('æ¶ˆè€—ç§¯åˆ†å¤±è´¥:', error)\r\n+      throw error\r\n+    }\r\n+  }\r\n+\r\n+  // åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\r\n+  async refreshPoints() {\r\n+    this.pointsInfo = null\r\n+    this.lastUpdateTime = 0\r\n+    return await this.getPointsStatus()\r\n+  }\r\n+\r\n+  // å¼ºåˆ¶æ¸…é™¤ç¼“å­˜\r\n+  clearCache() {\r\n+    this.pointsInfo = null\r\n+    this.lastUpdateTime = 0\r\n+    console.log('ğŸ—‘ï¸ ç§¯åˆ†ç¼“å­˜å·²æ¸…é™¤')\r\n+  }\r\n+\r\n+  // ç»‘å®šç­‰çº§å¡\r\n+  async bindLevelCard(cardNumber, cardPassword) {\r\n+    if (!this.isLoggedIn()) {\r\n+      throw new Error('è¯·å…ˆç™»å½•')\r\n+    }\r\n+\r\n+    try {\r\n+      const response = await levelCardApi.bindCard(cardNumber, cardPassword)\r\n+\r\n+      if (response.success) {\r\n+        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\r\n+        this.pointsInfo = null\r\n+        this.lastUpdateTime = 0\r\n+\r\n+        return {\r\n+          success: true,\r\n+          message: response.message,\r\n+          data: response.data\r\n+        }\r\n+      } else {\r\n+        throw new Error(response.message || 'ç»‘å®šå¤±è´¥')\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('ç»‘å®šç­‰çº§å¡å¤±è´¥:', error)\r\n+      throw error\r\n+    }\r\n+  }\r\n+\r\n+  // è·å–ç­‰çº§å¡ç±»å‹\r\n+  async getCardTypes() {\r\n+    try {\r\n+      const response = await levelCardApi.getCardTypes()\r\n+\r\n+      if (response.success) {\r\n+        return response.data.cardTypes || []\r\n+      } else {\r\n+        console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', response.message)\r\n+        return []\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', error)\r\n+      return []\r\n+    }\r\n+  }\r\n+\r\n+  // è·å–ç”¨æˆ·çš„ç­‰çº§å¡åˆ—è¡¨\r\n+  async getMyCards() {\r\n+    if (!this.isLoggedIn()) {\r\n+      return []\r\n+    }\r\n+\r\n+    try {\r\n+      const response = await levelCardApi.getMyCards()\r\n+\r\n+      if (response.success) {\r\n+        return response.data.cards || []\r\n+      } else {\r\n+        console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', response.message)\r\n+        return []\r\n+      }\r\n+    } catch (error) {\r\n+      console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', error)\r\n+      return []\r\n+    }\r\n+  }\r\n+\r\n+  // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç”Ÿæˆ\r\n+  async canGenerate() {\r\n+    const status = await this.getPointsStatus()\r\n+    return status.canGenerate\r\n+  }\r\n+\r\n+  // è·å–ç”Ÿæˆæˆæœ¬\r\n+  getGenerationCost() {\r\n+    return 20 // å›ºå®š20ç§¯åˆ†\r\n+  }\r\n+\r\n+  // å…¼å®¹åŸæœ‰æ¥å£ - æ·»åŠ ä½“éªŒå¡ç‚¹æ•°ï¼ˆç°åœ¨é€šè¿‡ç­‰çº§å¡ç³»ç»Ÿï¼‰\r\n+  addExperienceCardPoints() {\r\n+    // è¿™ä¸ªæ–¹æ³•åœ¨ç­‰çº§å¡ç³»ç»Ÿä¸­ä¸å†ä½¿ç”¨\r\n+    // ç§¯åˆ†é€šè¿‡ç»‘å®šç­‰çº§å¡è·å¾—\r\n+    return {\r\n+      success: false,\r\n+      message: 'è¯·ä½¿ç”¨ç­‰çº§å¡ç»‘å®šåŠŸèƒ½',\r\n+      added: 0\r\n+    }\r\n+  }\r\n+\r\n+  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–è´­ä¹°å†å²\r\n+  getPurchaseHistory() {\r\n+    // ç­‰çº§å¡ç³»ç»Ÿä¸­ï¼Œè´­ä¹°å†å²é€šè¿‡APIè·å–\r\n+    return []\r\n+  }\r\n+\r\n+  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–ç»Ÿè®¡ä¿¡æ¯\r\n+  getStatistics() {\r\n+    return {\r\n+      totalPurchased: 0,\r\n+      totalUsed: 0,\r\n+      totalCards: 0\r\n+    }\r\n+  }\r\n+}\r\n+\r\n+// åˆ›å»ºå•ä¾‹å®ä¾‹\r\n+const levelCardPointsManager = new LevelCardPointsManager()\r\n+\r\n+export default levelCardPointsManager\r\n"
                },
                {
                    "date": 1753639327524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -151,8 +151,22 @@\n         // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶ä¸‹æ¬¡è·å–æœ€æ–°æ•°æ®\r\n         this.pointsInfo = null\r\n         this.lastUpdateTime = 0\r\n \r\n+        // è§¦å‘ç§¯åˆ†æ¶ˆè€—äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–ç»„ä»¶æ›´æ–°\r\n+        eventBus.emit(EVENTS.POINTS_CONSUMED, {\r\n+          consumed: amount,\r\n+          remaining: response.data.remaining_points || 0,\r\n+          description,\r\n+          mediaUrl\r\n+        })\r\n+\r\n+        // è§¦å‘ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œè®©ç§¯åˆ†æ˜¾ç¤ºç»„ä»¶åˆ·æ–°\r\n+        eventBus.emit(EVENTS.POINTS_UPDATED, {\r\n+          current: response.data.remaining_points || 0,\r\n+          consumed: amount\r\n+        })\r\n+\r\n         return {\r\n           success: true,\r\n           message: 'ç§¯åˆ†æ¶ˆè€—æˆåŠŸ',\r\n           consumed: amount,\r\n"
                }
            ],
            "date": 1752288021271,
            "name": "Commit-0",
            "content": "/**\n * ç­‰çº§å¡ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ\n * åŸºäºåç«¯APIçš„ç§¯åˆ†ç®¡ç†ï¼Œæ›¿ä»£åŸæœ‰çš„æœ¬åœ°ç§¯åˆ†ç³»ç»Ÿ\n */\n\nimport { pointsApi, levelCardApi } from '../services/api.js'\nimport { authApi } from '../services/api.js'\n\nclass LevelCardPointsManager {\n  constructor() {\n    this.pointsInfo = null\n    this.lastUpdateTime = 0\n    this.updateInterval = 30000 // 30ç§’æ›´æ–°ä¸€æ¬¡\n  }\n\n  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n  isLoggedIn() {\n    return authApi.isLoggedIn()\n  }\n\n  // è·å–ç§¯åˆ†çŠ¶æ€\n  async getPointsStatus() {\n    if (!this.isLoggedIn()) {\n      return {\n        current: 0,\n        total_points: 0,\n        cards_count: 0,\n        cards_breakdown: [],\n        canGenerate: false,\n        generationCost: 20,\n        isLoggedIn: false\n      }\n    }\n\n    try {\n      // å¦‚æœç¼“å­˜è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®\n      const now = Date.now()\n      if (this.pointsInfo && (now - this.lastUpdateTime) < this.updateInterval) {\n        return this.formatPointsStatus(this.pointsInfo)\n      }\n\n      // ä»APIè·å–æœ€æ–°ç§¯åˆ†ä¿¡æ¯\n      const response = await pointsApi.getUserPoints()\n\n      if (response.success) {\n        this.pointsInfo = response.data\n        this.lastUpdateTime = now\n        return this.formatPointsStatus(this.pointsInfo)\n      } else {\n        console.error('è·å–ç§¯åˆ†ä¿¡æ¯å¤±è´¥:', response.message)\n        // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n        if (response.message && response.message.includes('ä»¤ç‰Œ')) {\n          return this.getDefaultStatus()\n        }\n        return this.getDefaultStatus()\n      }\n    } catch (error) {\n      console.error('è·å–ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n      // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œè¿”å›æœªç™»å½•çŠ¶æ€\n      if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n        return this.getDefaultStatus()\n      }\n      return this.getDefaultStatus()\n    }\n  }\n\n  // æ ¼å¼åŒ–ç§¯åˆ†çŠ¶æ€\n  formatPointsStatus(pointsInfo) {\n    const totalPoints = pointsInfo.total_points || 0\n    const generationCost = 20 // æ¯æ¬¡ç”Ÿæˆæ¶ˆè€—20ç§¯åˆ†\n\n    return {\n      current: totalPoints,\n      total_points: totalPoints,\n      purchased_points: pointsInfo.purchased_points || 0,\n      cards_count: pointsInfo.cards_count || 0,\n      cards_breakdown: pointsInfo.cards_breakdown || [],\n      canGenerate: totalPoints >= generationCost,\n      generationCost: generationCost,\n      isLoggedIn: true,\n      // å…¼å®¹åŸæœ‰å­—æ®µ\n      dailyRemaining: 0, // ç­‰çº§å¡ç³»ç»Ÿæ²¡æœ‰æ¯æ—¥å…è´¹æ¦‚å¿µ\n      dailyFreePoints: 0,\n      totalUsedToday: 0,\n      experienceCardPoints: 0\n    }\n  }\n\n  // è·å–é»˜è®¤çŠ¶æ€\n  getDefaultStatus() {\n    return {\n      current: 0,\n      total_points: 0,\n      purchased_points: 0,\n      cards_count: 0,\n      cards_breakdown: [],\n      canGenerate: false,\n      generationCost: 20,\n      isLoggedIn: this.isLoggedIn(),\n      dailyRemaining: 0,\n      dailyFreePoints: 0,\n      totalUsedToday: 0,\n      experienceCardPoints: 0\n    }\n  }\n\n  // æ¶ˆè€—ç§¯åˆ†\n  async consumePoints(amount, description = 'ç”Ÿæˆå›¾ç‰‡') {\n    if (!this.isLoggedIn()) {\n      throw new Error('è¯·å…ˆç™»å½•')\n    }\n\n    try {\n      // è°ƒç”¨åç«¯APIæ¶ˆè€—ç§¯åˆ†\n      const response = await pointsApi.consumePoints(amount, description)\n\n      if (response.success) {\n        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶ä¸‹æ¬¡è·å–æœ€æ–°æ•°æ®\n        this.pointsInfo = null\n        this.lastUpdateTime = 0\n\n        return {\n          success: true,\n          message: 'ç§¯åˆ†æ¶ˆè€—æˆåŠŸ',\n          consumed: amount,\n          remaining: response.data.remaining_points || 0\n        }\n      } else {\n        throw new Error(response.message || 'ç§¯åˆ†ä¸è¶³')\n      }\n    } catch (error) {\n      console.error('æ¶ˆè€—ç§¯åˆ†å¤±è´¥:', error)\n      throw error\n    }\n  }\n\n  // åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n  async refreshPoints() {\n    this.pointsInfo = null\n    this.lastUpdateTime = 0\n    return await this.getPointsStatus()\n  }\n\n  // ç»‘å®šç­‰çº§å¡\n  async bindLevelCard(cardNumber, cardPassword) {\n    if (!this.isLoggedIn()) {\n      throw new Error('è¯·å…ˆç™»å½•')\n    }\n\n    try {\n      const response = await levelCardApi.bindCard(cardNumber, cardPassword)\n\n      if (response.success) {\n        // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†ä¿¡æ¯\n        this.pointsInfo = null\n        this.lastUpdateTime = 0\n\n        return {\n          success: true,\n          message: response.message,\n          data: response.data\n        }\n      } else {\n        throw new Error(response.message || 'ç»‘å®šå¤±è´¥')\n      }\n    } catch (error) {\n      console.error('ç»‘å®šç­‰çº§å¡å¤±è´¥:', error)\n      throw error\n    }\n  }\n\n  // è·å–ç­‰çº§å¡ç±»å‹\n  async getCardTypes() {\n    try {\n      const response = await levelCardApi.getCardTypes()\n\n      if (response.success) {\n        return response.data.cardTypes || []\n      } else {\n        console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', response.message)\n        return []\n      }\n    } catch (error) {\n      console.error('è·å–ç­‰çº§å¡ç±»å‹å¤±è´¥:', error)\n      return []\n    }\n  }\n\n  // è·å–ç”¨æˆ·çš„ç­‰çº§å¡åˆ—è¡¨\n  async getMyCards() {\n    if (!this.isLoggedIn()) {\n      return []\n    }\n\n    try {\n      const response = await levelCardApi.getMyCards()\n\n      if (response.success) {\n        return response.data.cards || []\n      } else {\n        console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', response.message)\n        return []\n      }\n    } catch (error) {\n      console.error('è·å–æˆ‘çš„ç­‰çº§å¡å¤±è´¥:', error)\n      return []\n    }\n  }\n\n  // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç”Ÿæˆ\n  async canGenerate() {\n    const status = await this.getPointsStatus()\n    return status.canGenerate\n  }\n\n  // è·å–ç”Ÿæˆæˆæœ¬\n  getGenerationCost() {\n    return 20 // å›ºå®š20ç§¯åˆ†\n  }\n\n  // å…¼å®¹åŸæœ‰æ¥å£ - æ·»åŠ ä½“éªŒå¡ç‚¹æ•°ï¼ˆç°åœ¨é€šè¿‡ç­‰çº§å¡ç³»ç»Ÿï¼‰\n  addExperienceCardPoints() {\n    // è¿™ä¸ªæ–¹æ³•åœ¨ç­‰çº§å¡ç³»ç»Ÿä¸­ä¸å†ä½¿ç”¨\n    // ç§¯åˆ†é€šè¿‡ç»‘å®šç­‰çº§å¡è·å¾—\n    return {\n      success: false,\n      message: 'è¯·ä½¿ç”¨ç­‰çº§å¡ç»‘å®šåŠŸèƒ½',\n      added: 0\n    }\n  }\n\n  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–è´­ä¹°å†å²\n  getPurchaseHistory() {\n    // ç­‰çº§å¡ç³»ç»Ÿä¸­ï¼Œè´­ä¹°å†å²é€šè¿‡APIè·å–\n    return []\n  }\n\n  // å…¼å®¹åŸæœ‰æ¥å£ - è·å–ç»Ÿè®¡ä¿¡æ¯\n  getStatistics() {\n    return {\n      totalPurchased: 0,\n      totalUsed: 0,\n      totalCards: 0\n    }\n  }\n}\n\n// åˆ›å»ºå•ä¾‹å®ä¾‹\nconst levelCardPointsManager = new LevelCardPointsManager()\n\nexport default levelCardPointsManager\n"
        }
    ]
}