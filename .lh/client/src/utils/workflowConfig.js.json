{
    "sourceFile": "client/src/utils/workflowConfig.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752812618314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752812647403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,22 +112,20 @@\n  * @returns {Promise<boolean>} æ˜¯å¦å¯ç”¨\n  */\n export async function isWorkflowEnabled(workflowType) {\n   try {\n-    const config = await getPublicConfig()\n-    const enabledKey = `workflow.${workflowType}.enabled`\n-    const enabled = config[enabledKey]\n+    const response = await fetch('/api/workflow-config/public')\n+    if (!response.ok) {\n+      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n+    }\n \n-    // å¤„ç†å¸ƒå°”å€¼\n-    if (typeof enabled === 'boolean') {\n-      return enabled\n+    const result = await response.json()\n+    if (!result.success) {\n+      throw new Error(result.message || 'è·å–é…ç½®å¤±è´¥')\n     }\n-    if (typeof enabled === 'string') {\n-      return enabled.toLowerCase() === 'true'\n-    }\n \n-    // é»˜è®¤å¯ç”¨\n-    return true\n+    const workflowConfig = result.data[workflowType]\n+    return workflowConfig ? workflowConfig.enabled : false\n \n   } catch (error) {\n     console.warn('æ£€æŸ¥å·¥ä½œæµå¯ç”¨çŠ¶æ€å¤±è´¥ï¼Œé»˜è®¤å¯ç”¨:', error)\n     return true\n@@ -140,15 +138,28 @@\n  * @returns {Promise<Object>} å·¥ä½œæµä¿¡æ¯\n  */\n export async function getWorkflowInfo(workflowType) {\n   try {\n-    const config = await getPublicConfig()\n+    const response = await fetch('/api/workflow-config/public')\n+    if (!response.ok) {\n+      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n+    }\n \n+    const result = await response.json()\n+    if (!result.success) {\n+      throw new Error(result.message || 'è·å–é…ç½®å¤±è´¥')\n+    }\n+\n+    const workflowConfig = result.data[workflowType]\n+    if (!workflowConfig) {\n+      throw new Error(`æœªæ‰¾åˆ°${workflowType}å·¥ä½œæµé…ç½®`)\n+    }\n+\n     const info = {\n-      name: config[`workflow.${workflowType}.name`] || `${workflowType} workflow`,\n-      description: config[`workflow.${workflowType}.description`] || '',\n-      enabled: await isWorkflowEnabled(workflowType),\n-      filePath: config[`workflow.${workflowType}.file_path`] || `workflows/${workflowType}.json`\n+      name: workflowConfig.name || `${workflowType} workflow`,\n+      description: workflowConfig.description || '',\n+      enabled: workflowConfig.enabled,\n+      filePath: workflowConfig.filePath || `workflows/${workflowType}.json`\n     }\n \n     console.log(`ğŸ“‹ è·å–${workflowType}å·¥ä½œæµä¿¡æ¯:`, info)\n     return info\n"
                }
            ],
            "date": 1752812618314,
            "name": "Commit-0",
            "content": "// å·¥ä½œæµèŠ‚ç‚¹é…ç½®å·¥å…·\n\n/**\n * è·å–å·¥ä½œæµèŠ‚ç‚¹é…ç½®\n * @param {string} workflowType - å·¥ä½œæµç±»å‹ ('faceswap' | 'undress')\n * @returns {Promise<Object>} èŠ‚ç‚¹é…ç½®å¯¹è±¡\n */\nexport async function getWorkflowNodeConfig(workflowType) {\n  try {\n    console.log(`ğŸ”„ è·å–${workflowType}å·¥ä½œæµèŠ‚ç‚¹é…ç½®...`)\n\n    const response = await fetch('/api/workflow-config/public')\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n    }\n\n    const result = await response.json()\n    if (!result.success) {\n      throw new Error(result.message || 'è·å–é…ç½®å¤±è´¥')\n    }\n\n    const workflowConfig = result.data[workflowType]\n    if (!workflowConfig) {\n      throw new Error(`æœªæ‰¾åˆ°${workflowType}å·¥ä½œæµé…ç½®`)\n    }\n\n    // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼\n    const nodeConfig = {\n      inputNodes: {},\n      outputNodes: { primary: null, secondary: [] }\n    }\n\n    if (workflowType === 'faceswap') {\n      // æ¢è„¸å·¥ä½œæµèŠ‚ç‚¹é…ç½®\n      nodeConfig.inputNodes.facePhoto1 = workflowConfig.inputNodes.face_photo_1 || '670'\n      nodeConfig.inputNodes.facePhoto2 = workflowConfig.inputNodes.face_photo_2 || '662'\n      nodeConfig.inputNodes.facePhoto3 = workflowConfig.inputNodes.face_photo_3 || '658'\n      nodeConfig.inputNodes.facePhoto4 = workflowConfig.inputNodes.face_photo_4 || '655'\n      nodeConfig.inputNodes.targetImage = workflowConfig.inputNodes.target_image || '737'\n\n    } else if (workflowType === 'undress') {\n      // ä¸€é”®è¤ªè¡£å·¥ä½œæµèŠ‚ç‚¹é…ç½®\n      nodeConfig.inputNodes.mainImage = workflowConfig.inputNodes.main_image || '49'\n      nodeConfig.inputNodes.seedNode = workflowConfig.inputNodes.seed_node || '174'\n    }\n\n    // å¤„ç†è¾“å‡ºèŠ‚ç‚¹\n    if (workflowConfig.outputNodes && workflowConfig.outputNodes.length > 0) {\n      // æŒ‰ä¼˜å…ˆçº§æ’åº\n      const sortedOutputs = workflowConfig.outputNodes.sort((a, b) => a.order - b.order)\n\n      // ç¬¬ä¸€ä¸ªæ˜¯ä¸»è¦è¾“å‡ºèŠ‚ç‚¹\n      nodeConfig.outputNodes.primary = sortedOutputs[0].nodeId\n\n      // å…¶ä½™æ˜¯å¤‡ç”¨è¾“å‡ºèŠ‚ç‚¹\n      nodeConfig.outputNodes.secondary = sortedOutputs.slice(1).map(node => node.nodeId)\n    }\n\n    console.log(`ğŸ“‹ è·å–${workflowType}å·¥ä½œæµèŠ‚ç‚¹é…ç½®æˆåŠŸ:`, nodeConfig)\n    return nodeConfig\n\n  } catch (error) {\n    console.warn('è·å–å·¥ä½œæµèŠ‚ç‚¹é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error)\n    return getDefaultNodeConfig(workflowType)\n  }\n}\n\n/**\n * è·å–é»˜è®¤èŠ‚ç‚¹é…ç½®ï¼ˆé™çº§æœºåˆ¶ï¼‰\n * @param {string} workflowType - å·¥ä½œæµç±»å‹\n * @returns {Object} é»˜è®¤èŠ‚ç‚¹é…ç½®\n */\nexport function getDefaultNodeConfig(workflowType) {\n  const defaultConfigs = {\n    faceswap: {\n      inputNodes: {\n        facePhoto1: '670',\n        facePhoto2: '662',\n        facePhoto3: '658',\n        facePhoto4: '655',\n        targetImage: '737'\n      },\n      outputNodes: {\n        primary: '812',\n        secondary: ['813', '746', '710']\n      }\n    },\n    undress: {\n      inputNodes: {\n        mainImage: '49',\n        seedNode: '174'\n      },\n      outputNodes: {\n        primary: '730',\n        secondary: ['812', '813', '746', '710']\n      }\n    }\n  }\n\n  const config = defaultConfigs[workflowType]\n  if (!config) {\n    throw new Error(`æœªçŸ¥çš„å·¥ä½œæµç±»å‹: ${workflowType}`)\n  }\n\n  console.log(`ğŸ“‹ ä½¿ç”¨${workflowType}å·¥ä½œæµé»˜è®¤é…ç½®:`, config)\n  return config\n}\n\n/**\n * æ£€æŸ¥å·¥ä½œæµæ˜¯å¦å¯ç”¨\n * @param {string} workflowType - å·¥ä½œæµç±»å‹\n * @returns {Promise<boolean>} æ˜¯å¦å¯ç”¨\n */\nexport async function isWorkflowEnabled(workflowType) {\n  try {\n    const config = await getPublicConfig()\n    const enabledKey = `workflow.${workflowType}.enabled`\n    const enabled = config[enabledKey]\n\n    // å¤„ç†å¸ƒå°”å€¼\n    if (typeof enabled === 'boolean') {\n      return enabled\n    }\n    if (typeof enabled === 'string') {\n      return enabled.toLowerCase() === 'true'\n    }\n\n    // é»˜è®¤å¯ç”¨\n    return true\n\n  } catch (error) {\n    console.warn('æ£€æŸ¥å·¥ä½œæµå¯ç”¨çŠ¶æ€å¤±è´¥ï¼Œé»˜è®¤å¯ç”¨:', error)\n    return true\n  }\n}\n\n/**\n * è·å–å·¥ä½œæµåŸºç¡€ä¿¡æ¯\n * @param {string} workflowType - å·¥ä½œæµç±»å‹\n * @returns {Promise<Object>} å·¥ä½œæµä¿¡æ¯\n */\nexport async function getWorkflowInfo(workflowType) {\n  try {\n    const config = await getPublicConfig()\n\n    const info = {\n      name: config[`workflow.${workflowType}.name`] || `${workflowType} workflow`,\n      description: config[`workflow.${workflowType}.description`] || '',\n      enabled: await isWorkflowEnabled(workflowType),\n      filePath: config[`workflow.${workflowType}.file_path`] || `workflows/${workflowType}.json`\n    }\n\n    console.log(`ğŸ“‹ è·å–${workflowType}å·¥ä½œæµä¿¡æ¯:`, info)\n    return info\n\n  } catch (error) {\n    console.warn('è·å–å·¥ä½œæµä¿¡æ¯å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä¿¡æ¯:', error)\n    return {\n      name: `${workflowType} workflow`,\n      description: '',\n      enabled: true,\n      filePath: `workflows/${workflowType}.json`\n    }\n  }\n}\n"
        }
    ]
}