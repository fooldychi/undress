{
    "sourceFile": "client/src/utils/testConfig.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752333103132,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752333134815,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,17 +118,113 @@\n     console.error('âŒ è·å–é…ç½®çŠ¶æ€å¤±è´¥:', error)\n   }\n }\n \n+/**\n+ * æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨åŠŸèƒ½\n+ */\n+export async function testLoadBalancer() {\n+  console.log('ğŸ§ª å¼€å§‹æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨...')\n+\n+  try {\n+    // 1. æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨åˆå§‹åŒ–\n+    console.log('\\n1ï¸âƒ£ æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨åˆå§‹åŒ–...')\n+    await loadBalancer.initialize()\n+    console.log('âœ… è´Ÿè½½å‡è¡¡å™¨åˆå§‹åŒ–æˆåŠŸ')\n+\n+    // 2. è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯\n+    console.log('\\n2ï¸âƒ£ è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯...')\n+    const stats = loadBalancer.getServerStats()\n+    console.log('âœ… æœåŠ¡å™¨ç»Ÿè®¡:', stats)\n+\n+    // 3. æµ‹è¯•æœåŠ¡å™¨é€‰æ‹©\n+    console.log('\\n3ï¸âƒ£ æµ‹è¯•æœåŠ¡å™¨é€‰æ‹©...')\n+    for (let i = 0; i < 3; i++) {\n+      const selectedServer = await loadBalancer.getOptimalServer()\n+      console.log(`   ç¬¬${i + 1}æ¬¡é€‰æ‹©: ${selectedServer}`)\n+    }\n+\n+    // 4. æµ‹è¯•æœåŠ¡å™¨å¥åº·æ£€æŸ¥\n+    console.log('\\n4ï¸âƒ£ æµ‹è¯•æœåŠ¡å™¨å¥åº·æ£€æŸ¥...')\n+    for (const server of stats.servers) {\n+      const health = await loadBalancer.checkServerHealth(server.url)\n+      console.log(`   ${server.url}: ${health.healthy ? 'âœ… å¥åº·' : 'âŒ ä¸å¥åº·'}`)\n+    }\n+\n+    // 5. æµ‹è¯•é˜Ÿåˆ—ä¿¡æ¯è·å–\n+    console.log('\\n5ï¸âƒ£ æµ‹è¯•é˜Ÿåˆ—ä¿¡æ¯è·å–...')\n+    for (const server of stats.servers) {\n+      const queue = await loadBalancer.getServerQueueInfo(server.url)\n+      console.log(`   ${server.url}: é˜Ÿåˆ—=${queue.total}, æ”¯æŒAPI=${queue.supportsQueueAPI}`)\n+    }\n+\n+    console.log('\\nğŸ‰ è´Ÿè½½å‡è¡¡å™¨æµ‹è¯•å®Œæˆï¼')\n+    return true\n+\n+  } catch (error) {\n+    console.error('âŒ è´Ÿè½½å‡è¡¡å™¨æµ‹è¯•å¤±è´¥:', error)\n+    return false\n+  }\n+}\n+\n+/**\n+ * æ¨¡æ‹ŸæœåŠ¡å™¨æ•…éšœæµ‹è¯•\n+ */\n+export async function testServerFailover() {\n+  console.log('ğŸ§ª å¼€å§‹æµ‹è¯•æœåŠ¡å™¨æ•…éšœè½¬ç§»...')\n+\n+  try {\n+    const stats = loadBalancer.getServerStats()\n+\n+    if (stats.servers.length < 2) {\n+      console.warn('âš ï¸ éœ€è¦è‡³å°‘2ä¸ªæœåŠ¡å™¨æ‰èƒ½æµ‹è¯•æ•…éšœè½¬ç§»')\n+      return false\n+    }\n+\n+    // 1. è·å–å½“å‰é€‰æ‹©çš„æœåŠ¡å™¨\n+    console.log('\\n1ï¸âƒ£ è·å–å½“å‰æœåŠ¡å™¨...')\n+    const currentServer = await loadBalancer.getOptimalServer()\n+    console.log(`å½“å‰æœåŠ¡å™¨: ${currentServer}`)\n+\n+    // 2. æ¨¡æ‹ŸæœåŠ¡å™¨æ•…éšœ\n+    console.log('\\n2ï¸âƒ£ æ¨¡æ‹ŸæœåŠ¡å™¨æ•…éšœ...')\n+    await loadBalancer.recordFailure(currentServer)\n+    console.log(`å·²è®°å½•æœåŠ¡å™¨æ•…éšœ: ${currentServer}`)\n+\n+    // 3. é‡æ–°é€‰æ‹©æœåŠ¡å™¨\n+    console.log('\\n3ï¸âƒ£ é‡æ–°é€‰æ‹©æœåŠ¡å™¨...')\n+    const newServer = await loadBalancer.getOptimalServer()\n+    console.log(`æ–°é€‰æ‹©çš„æœåŠ¡å™¨: ${newServer}`)\n+\n+    if (newServer !== currentServer) {\n+      console.log('âœ… æ•…éšœè½¬ç§»æµ‹è¯•æˆåŠŸ')\n+      return true\n+    } else {\n+      console.log('âŒ æ•…éšœè½¬ç§»æµ‹è¯•å¤±è´¥ - ä»ç„¶é€‰æ‹©äº†ç›¸åŒçš„æœåŠ¡å™¨')\n+      return false\n+    }\n+\n+  } catch (error) {\n+    console.error('âŒ æ•…éšœè½¬ç§»æµ‹è¯•å¤±è´¥:', error)\n+    return false\n+  }\n+}\n+\n // åœ¨å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨æš´éœ²åˆ°å…¨å±€\n if (import.meta.env.DEV) {\n   window.testConfigService = testConfigService\n+  window.testLoadBalancer = testLoadBalancer\n+  window.testServerFailover = testServerFailover\n   window.compareConfigs = compareConfigs\n   window.showAllConfigs = showAllConfigs\n   window.configService = configService\n+  window.loadBalancer = loadBalancer\n \n   console.log('ğŸ› ï¸ é…ç½®æµ‹è¯•å·¥å…·å·²åŠ è½½åˆ°å…¨å±€:')\n   console.log('  - window.testConfigService() - æµ‹è¯•é…ç½®æœåŠ¡')\n+  console.log('  - window.testLoadBalancer() - æµ‹è¯•è´Ÿè½½å‡è¡¡å™¨')\n+  console.log('  - window.testServerFailover() - æµ‹è¯•æ•…éšœè½¬ç§»')\n   console.log('  - window.showAllConfigs() - æ˜¾ç¤ºæ‰€æœ‰é…ç½®')\n   console.log('  - window.compareConfigs(c1, c2) - æ¯”è¾ƒé…ç½®')\n   console.log('  - window.configService - é…ç½®æœåŠ¡å®ä¾‹')\n+  console.log('  - window.loadBalancer - è´Ÿè½½å‡è¡¡å™¨å®ä¾‹')\n }\n"
                }
            ],
            "date": 1752333103132,
            "name": "Commit-0",
            "content": "// é…ç½®æµ‹è¯•å·¥å…·\nimport configService from '../services/configService.js'\nimport loadBalancer from '../services/loadBalancer.js'\nimport { getCurrentConfig } from '../services/comfyui.js'\nimport { API_CONFIG } from '../services/api.js'\n\n/**\n * æµ‹è¯•é…ç½®æœåŠ¡åŠŸèƒ½\n */\nexport async function testConfigService() {\n  console.log('ğŸ§ª å¼€å§‹æµ‹è¯•é…ç½®æœåŠ¡...')\n\n  try {\n    // 1. æµ‹è¯•è·å–æœåŠ¡ç«¯é…ç½®\n    console.log('\\n1ï¸âƒ£ æµ‹è¯•è·å–æœåŠ¡ç«¯é…ç½®...')\n    const serverConfig = await configService.getConfig(true) // å¼ºåˆ¶åˆ·æ–°\n    console.log('âœ… æœåŠ¡ç«¯é…ç½®:', serverConfig)\n\n    // 2. æµ‹è¯•åŒæ­¥ComfyUIé…ç½®\n    console.log('\\n2ï¸âƒ£ æµ‹è¯•åŒæ­¥ComfyUIé…ç½®...')\n    const syncResult = await configService.syncComfyUIConfig()\n    console.log('âœ… åŒæ­¥ç»“æœ:', syncResult)\n\n    // 3. æ£€æŸ¥æœ¬åœ°ComfyUIé…ç½®\n    console.log('\\n3ï¸âƒ£ æ£€æŸ¥æœ¬åœ°ComfyUIé…ç½®...')\n    const localConfig = getCurrentConfig()\n    console.log('âœ… æœ¬åœ°é…ç½®:', localConfig)\n\n    // 4. æ£€æŸ¥APIé…ç½®æ˜¯å¦å·²æ›´æ–°\n    console.log('\\n4ï¸âƒ£ æ£€æŸ¥APIé…ç½®...')\n    console.log('âœ… APIé…ç½®:', {\n      BASE_URL: API_CONFIG.BASE_URL,\n      CLIENT_ID: API_CONFIG.CLIENT_ID,\n      TIMEOUT: API_CONFIG.TIMEOUT\n    })\n\n    // 5. æµ‹è¯•AIç§¯åˆ†é…ç½®\n    console.log('\\n5ï¸âƒ£ æµ‹è¯•AIç§¯åˆ†é…ç½®...')\n    const pointsConfig = await configService.getAIPointsConfig()\n    console.log('âœ… AIç§¯åˆ†é…ç½®:', pointsConfig)\n\n    // 6. æµ‹è¯•å‰ç«¯é…ç½®\n    console.log('\\n6ï¸âƒ£ æµ‹è¯•å‰ç«¯é…ç½®...')\n    const frontendConfig = await configService.getFrontendConfig()\n    console.log('âœ… å‰ç«¯é…ç½®:', frontendConfig)\n\n    console.log('\\nğŸ‰ é…ç½®æœåŠ¡æµ‹è¯•å®Œæˆï¼')\n    return true\n\n  } catch (error) {\n    console.error('âŒ é…ç½®æœåŠ¡æµ‹è¯•å¤±è´¥:', error)\n    return false\n  }\n}\n\n/**\n * æ¯”è¾ƒé…ç½®å·®å¼‚\n */\nexport function compareConfigs(config1, config2, label1 = 'é…ç½®1', label2 = 'é…ç½®2') {\n  console.log(`\\nğŸ” æ¯”è¾ƒ ${label1} å’Œ ${label2}:`)\n\n  const keys = new Set([...Object.keys(config1), ...Object.keys(config2)])\n\n  for (const key of keys) {\n    const val1 = config1[key]\n    const val2 = config2[key]\n\n    if (val1 !== val2) {\n      console.log(`  ğŸ”„ ${key}:`)\n      console.log(`    ${label1}: ${val1}`)\n      console.log(`    ${label2}: ${val2}`)\n    } else {\n      console.log(`  âœ… ${key}: ${val1}`)\n    }\n  }\n}\n\n/**\n * æ˜¾ç¤ºå½“å‰æ‰€æœ‰é…ç½®çŠ¶æ€\n */\nexport async function showAllConfigs() {\n  console.log('\\nğŸ“‹ å½“å‰æ‰€æœ‰é…ç½®çŠ¶æ€:')\n\n  try {\n    // æœåŠ¡ç«¯é…ç½®\n    const serverConfig = await configService.getConfig()\n    console.log('\\nğŸŒ æœåŠ¡ç«¯é…ç½®:')\n    Object.entries(serverConfig).forEach(([key, value]) => {\n      console.log(`  ${key}: ${value}`)\n    })\n\n    // æœ¬åœ°ComfyUIé…ç½®\n    const localConfig = getCurrentConfig()\n    console.log('\\nğŸ’¾ æœ¬åœ°ComfyUIé…ç½®:')\n    Object.entries(localConfig).forEach(([key, value]) => {\n      console.log(`  ${key}: ${value}`)\n    })\n\n    // APIé…ç½®\n    console.log('\\nğŸ”— APIé…ç½®:')\n    console.log(`  BASE_URL: ${API_CONFIG.BASE_URL}`)\n    console.log(`  CLIENT_ID: ${API_CONFIG.CLIENT_ID}`)\n    console.log(`  TIMEOUT: ${API_CONFIG.TIMEOUT}`)\n\n    // localStorageä¸­çš„é…ç½®\n    const savedConfig = localStorage.getItem('comfyui_config')\n    if (savedConfig) {\n      console.log('\\nğŸ’¿ localStorageé…ç½®:')\n      const parsed = JSON.parse(savedConfig)\n      Object.entries(parsed).forEach(([key, value]) => {\n        console.log(`  ${key}: ${value}`)\n      })\n    } else {\n      console.log('\\nğŸ’¿ localStorage: æ— ä¿å­˜çš„é…ç½®')\n    }\n\n  } catch (error) {\n    console.error('âŒ è·å–é…ç½®çŠ¶æ€å¤±è´¥:', error)\n  }\n}\n\n// åœ¨å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨æš´éœ²åˆ°å…¨å±€\nif (import.meta.env.DEV) {\n  window.testConfigService = testConfigService\n  window.compareConfigs = compareConfigs\n  window.showAllConfigs = showAllConfigs\n  window.configService = configService\n\n  console.log('ğŸ› ï¸ é…ç½®æµ‹è¯•å·¥å…·å·²åŠ è½½åˆ°å…¨å±€:')\n  console.log('  - window.testConfigService() - æµ‹è¯•é…ç½®æœåŠ¡')\n  console.log('  - window.showAllConfigs() - æ˜¾ç¤ºæ‰€æœ‰é…ç½®')\n  console.log('  - window.compareConfigs(c1, c2) - æ¯”è¾ƒé…ç½®')\n  console.log('  - window.configService - é…ç½®æœåŠ¡å®ä¾‹')\n}\n"
        }
    ]
}