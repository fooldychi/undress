{
    "sourceFile": "client/src/config/features.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1752436588345,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752824275749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -122,21 +122,38 @@\n   return ICON_STYLES[iconClass] || {}\n }\n \n /**\n- * æ¨¡æ‹Ÿä»åå°APIè·å–åŠŸèƒ½é…ç½®\n- * åç»­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨\n+ * ä»åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½é…ç½®\n+ * æ ¹æ®å·¥ä½œæµå¯ç”¨çŠ¶æ€åŠ¨æ€è¿”å›åŠŸèƒ½åˆ—è¡¨\n  * @returns {Promise<Array>} åŠŸèƒ½é…ç½®åˆ—è¡¨\n  */\n export async function fetchFeaturesFromAPI() {\n-  // æ¨¡æ‹ŸAPIå»¶è¿Ÿ\n-  await new Promise(resolve => setTimeout(resolve, 100))\n+  try {\n+    console.log('ğŸ”„ ä»APIè·å–åŠŸèƒ½é…ç½®...');\n \n-  // è¿™é‡Œåç»­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨\n-  // const response = await fetch('/api/admin/features')\n-  // return response.json()\n+    // è°ƒç”¨åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½\n+    const response = await fetch('/api/workflow-config/features');\n \n-  return getEnabledFeatures()\n+    if (!response.ok) {\n+      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n+    }\n+\n+    const result = await response.json();\n+\n+    if (!result.success) {\n+      throw new Error(result.message || 'è·å–åŠŸèƒ½é…ç½®å¤±è´¥');\n+    }\n+\n+    console.log(`âœ… è·å–åˆ° ${result.data.length} ä¸ªå¯ç”¨çš„åŠŸèƒ½`);\n+    return result.data;\n+\n+  } catch (error) {\n+    console.warn('âš ï¸ ä»APIè·å–åŠŸèƒ½é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error.message);\n+\n+    // é™çº§åˆ°é™æ€é…ç½®\n+    return getEnabledFeatures();\n+  }\n }\n \n /**\n  * æ›´æ–°åŠŸèƒ½é…ç½®\n"
                },
                {
                    "date": 1753543721916,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { UndressWomanIcon, FaceSwapIcon } from '../components/icons'\n+import { SvgIcon } from '../components/icons'\n \n /**\n  * åŠŸèƒ½é…ç½®æ–‡ä»¶\n  * ç”¨äºç®¡ç†é¦–é¡µåŠŸèƒ½å¡ç‰‡çš„æ˜¾ç¤ºå’Œé…ç½®\n"
                },
                {
                    "date": 1753543732895,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,10 +13,10 @@\n     title: 'ä¸€é”®è¤ªè¡£',\n     description: 'æ™ºèƒ½è¯†åˆ«äººç‰©è½®å»“ï¼Œå¿«é€Ÿç§»é™¤ç…§ç‰‡ä¸­çš„æœè£…ï¼Œä½“éªŒå‰æ²¿AIæŠ€æœ¯',\n     route: '/clothes-swap',\n     icon: {\n-      type: 'custom', // 'custom' | 'vant'\n-      component: UndressWomanIcon,\n+      type: 'svg', // 'svg' | 'vant' | 'custom'\n+      name: 'undress-woman',\n       size: 28,\n       color: '#667eea'\n     },\n     iconClass: 'undress-icon',\n"
                },
                {
                    "date": 1753543744506,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,10 +37,10 @@\n     title: 'æé€Ÿæ¢è„¸',\n     description: 'ç²¾å‡†é¢éƒ¨è¯†åˆ«æŠ€æœ¯ï¼Œå®ç°è‡ªç„¶çš„äººè„¸æ›¿æ¢æ•ˆæœï¼Œåˆ›é€ æœ‰è¶£å†…å®¹',\n     route: '/face-swap',\n     icon: {\n-      type: 'custom',\n-      component: FaceSwapIcon,\n+      type: 'svg',\n+      name: 'face-swap',\n       size: 28,\n       color: '#f093fb'\n     },\n     iconClass: 'faceswap-icon',\n"
                },
                {
                    "date": 1753544372561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -143,11 +143,37 @@\n     if (!result.success) {\n       throw new Error(result.message || 'è·å–åŠŸèƒ½é…ç½®å¤±è´¥');\n     }\n \n-    console.log(`âœ… è·å–åˆ° ${result.data.length} ä¸ªå¯ç”¨çš„åŠŸèƒ½`);\n-    return result.data;\n+    // ä¿®å¤APIè¿”å›çš„å›¾æ ‡é…ç½®\n+    const fixedFeatures = result.data.map(feature => {\n+      const fixedFeature = { ...feature };\n \n+      // å¦‚æœå›¾æ ‡é…ç½®ä»ç„¶æ˜¯æ—§æ ¼å¼ï¼Œè½¬æ¢ä¸ºæ–°æ ¼å¼\n+      if (fixedFeature.icon && fixedFeature.icon.type === 'custom') {\n+        if (fixedFeature.icon.component === 'UndressWomanIcon') {\n+          fixedFeature.icon = {\n+            type: 'svg',\n+            name: 'undress-woman',\n+            size: fixedFeature.icon.size || 28,\n+            color: fixedFeature.icon.color || '#667eea'\n+          };\n+        } else if (fixedFeature.icon.component === 'FaceSwapIcon') {\n+          fixedFeature.icon = {\n+            type: 'svg',\n+            name: 'face-swap',\n+            size: fixedFeature.icon.size || 28,\n+            color: fixedFeature.icon.color || '#f093fb'\n+          };\n+        }\n+      }\n+\n+      return fixedFeature;\n+    });\n+\n+    console.log(`âœ… è·å–åˆ° ${fixedFeatures.length} ä¸ªå¯ç”¨çš„åŠŸèƒ½`);\n+    return fixedFeatures;\n+\n   } catch (error) {\n     console.warn('âš ï¸ ä»APIè·å–åŠŸèƒ½é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error.message);\n \n     // é™çº§åˆ°é™æ€é…ç½®\n"
                },
                {
                    "date": 1753711124583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,10 +130,14 @@\n export async function fetchFeaturesFromAPI() {\n   try {\n     console.log('ğŸ”„ ä»APIè·å–åŠŸèƒ½é…ç½®...');\n \n+    // æ„å»ºæ­£ç¡®çš„API URL\n+    const baseUrl = import.meta.env.DEV ? '' : (import.meta.env.VITE_API_BASE_URL || 'http://114.132.50.71:3007/api').replace('/api', '');\n+    const apiUrl = `${baseUrl}/api/workflow-config/features`;\n+\n     // è°ƒç”¨åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½\n-    const response = await fetch('/api/workflow-config/features');\n+    const response = await fetch(apiUrl);\n \n     if (!response.ok) {\n       throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n     }\n"
                },
                {
                    "date": 1753712175152,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,9 +131,9 @@\n   try {\n     console.log('ğŸ”„ ä»APIè·å–åŠŸèƒ½é…ç½®...');\n \n     // æ„å»ºæ­£ç¡®çš„API URL\n-    const baseUrl = import.meta.env.DEV ? '' : (import.meta.env.VITE_API_BASE_URL || 'http://114.132.50.71:3007/api').replace('/api', '');\n+    const baseUrl = import.meta.env.DEV ? '' : 'http://114.132.50.71:3007';\n     const apiUrl = `${baseUrl}/api/workflow-config/features`;\n \n     // è°ƒç”¨åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½\n     const response = await fetch(apiUrl);\n"
                },
                {
                    "date": 1753712533395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,9 +131,9 @@\n   try {\n     console.log('ğŸ”„ ä»APIè·å–åŠŸèƒ½é…ç½®...');\n \n     // æ„å»ºæ­£ç¡®çš„API URL\n-    const baseUrl = import.meta.env.DEV ? '' : 'http://114.132.50.71:3007';\n+    const baseUrl = import.meta.env.MODE === 'development' ? '' : 'http://114.132.50.71:3007';\n     const apiUrl = `${baseUrl}/api/workflow-config/features`;\n \n     // è°ƒç”¨åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½\n     const response = await fetch(apiUrl);\n"
                },
                {
                    "date": 1753719415003,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,9 +131,9 @@\n   try {\n     console.log('ğŸ”„ ä»APIè·å–åŠŸèƒ½é…ç½®...');\n \n     // æ„å»ºæ­£ç¡®çš„API URL\n-    const baseUrl = import.meta.env.MODE === 'development' ? '' : 'http://114.132.50.71:3007';\n+    const baseUrl = import.meta.env.MODE === 'development' ? '' : (import.meta.env.VITE_API_BASE_URL || 'http://114.132.50.71:3007').replace('/api', '');\n     const apiUrl = `${baseUrl}/api/workflow-config/features`;\n \n     // è°ƒç”¨åå°APIè·å–å¯ç”¨çš„åŠŸèƒ½\n     const response = await fetch(apiUrl);\n"
                }
            ],
            "date": 1752436588345,
            "name": "Commit-0",
            "content": "import { UndressWomanIcon, FaceSwapIcon } from '../components/icons'\n\n/**\n * åŠŸèƒ½é…ç½®æ–‡ä»¶\n * ç”¨äºç®¡ç†é¦–é¡µåŠŸèƒ½å¡ç‰‡çš„æ˜¾ç¤ºå’Œé…ç½®\n * åç»­å¯ä»¥æ”¹ä¸ºä»åå°APIè·å–\n */\n\n// åŠŸèƒ½é…ç½®æ•°æ®ç»“æ„\nexport const FEATURE_CONFIGS = [\n  {\n    id: 'clothes-swap',\n    title: 'ä¸€é”®è¤ªè¡£',\n    description: 'æ™ºèƒ½è¯†åˆ«äººç‰©è½®å»“ï¼Œå¿«é€Ÿç§»é™¤ç…§ç‰‡ä¸­çš„æœè£…ï¼Œä½“éªŒå‰æ²¿AIæŠ€æœ¯',\n    route: '/clothes-swap',\n    icon: {\n      type: 'custom', // 'custom' | 'vant'\n      component: UndressWomanIcon,\n      size: 28,\n      color: '#667eea'\n    },\n    iconClass: 'undress-icon',\n    tags: [\n      { text: 'AIè¯†åˆ«', type: 'primary' },\n      { text: 'å¿«é€Ÿå¤„ç†', type: 'success' }\n    ],\n    requireLogin: true,\n    enabled: true,\n    order: 1,\n    // åå°ç®¡ç†ç›¸å…³å­—æ®µ\n    category: 'image-processing',\n    pointsCost: 20,\n    description_admin: 'ä¸€é”®è¤ªè¡£åŠŸèƒ½ç®¡ç†'\n  },\n  {\n    id: 'face-swap',\n    title: 'æé€Ÿæ¢è„¸',\n    description: 'ç²¾å‡†é¢éƒ¨è¯†åˆ«æŠ€æœ¯ï¼Œå®ç°è‡ªç„¶çš„äººè„¸æ›¿æ¢æ•ˆæœï¼Œåˆ›é€ æœ‰è¶£å†…å®¹',\n    route: '/face-swap',\n    icon: {\n      type: 'custom',\n      component: FaceSwapIcon,\n      size: 28,\n      color: '#f093fb'\n    },\n    iconClass: 'faceswap-icon',\n    tags: [\n      { text: 'é¢éƒ¨è¯†åˆ«', type: 'warning' },\n      { text: 'è‡ªç„¶æ•ˆæœ', type: 'primary' }\n    ],\n    requireLogin: true,\n    enabled: true,\n    order: 2,\n    category: 'image-processing',\n    pointsCost: 20,\n    description_admin: 'æé€Ÿæ¢è„¸åŠŸèƒ½ç®¡ç†'\n  },\n\n]\n\n// å›¾æ ‡æ ·å¼é…ç½®\nexport const ICON_STYLES = {\n  'undress-icon': {\n    background: 'linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(102, 126, 234, 0.1))',\n    border: '1px solid rgba(102, 126, 234, 0.3)',\n    darkBackground: 'linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(102, 126, 234, 0.1))',\n    darkBorder: '1px solid rgba(102, 126, 234, 0.4)'\n  },\n  'faceswap-icon': {\n    background: 'linear-gradient(135deg, rgba(240, 147, 251, 0.2), rgba(240, 147, 251, 0.1))',\n    border: '1px solid rgba(240, 147, 251, 0.3)',\n    darkBackground: 'linear-gradient(135deg, rgba(240, 147, 251, 0.3), rgba(240, 147, 251, 0.1))',\n    darkBorder: '1px solid rgba(240, 147, 251, 0.4)'\n  },\n\n}\n\n// æ ‡ç­¾ç±»å‹é…ç½®\nexport const TAG_TYPES = {\n  primary: {\n    background: 'rgba(102, 126, 234, 0.15)',\n    borderColor: 'rgba(102, 126, 234, 0.3)',\n    color: 'rgba(102, 126, 234, 0.9)'\n  },\n  success: {\n    background: 'rgba(16, 185, 129, 0.15)',\n    borderColor: 'rgba(16, 185, 129, 0.3)',\n    color: 'rgba(16, 185, 129, 0.9)'\n  },\n  warning: {\n    background: 'rgba(245, 158, 11, 0.15)',\n    borderColor: 'rgba(245, 158, 11, 0.3)',\n    color: 'rgba(245, 158, 11, 0.9)'\n  }\n}\n\n/**\n * è·å–å¯ç”¨çš„åŠŸèƒ½é…ç½®\n * @returns {Array} å¯ç”¨çš„åŠŸèƒ½é…ç½®åˆ—è¡¨\n */\nexport function getEnabledFeatures() {\n  return FEATURE_CONFIGS\n    .filter(feature => feature.enabled)\n    .sort((a, b) => a.order - b.order)\n}\n\n/**\n * æ ¹æ®IDè·å–åŠŸèƒ½é…ç½®\n * @param {string} id åŠŸèƒ½ID\n * @returns {Object|null} åŠŸèƒ½é…ç½®å¯¹è±¡\n */\nexport function getFeatureById(id) {\n  return FEATURE_CONFIGS.find(feature => feature.id === id) || null\n}\n\n/**\n * è·å–åŠŸèƒ½çš„å›¾æ ‡æ ·å¼\n * @param {string} iconClass å›¾æ ‡ç±»å\n * @returns {Object} å›¾æ ‡æ ·å¼å¯¹è±¡\n */\nexport function getIconStyle(iconClass) {\n  return ICON_STYLES[iconClass] || {}\n}\n\n/**\n * æ¨¡æ‹Ÿä»åå°APIè·å–åŠŸèƒ½é…ç½®\n * åç»­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨\n * @returns {Promise<Array>} åŠŸèƒ½é…ç½®åˆ—è¡¨\n */\nexport async function fetchFeaturesFromAPI() {\n  // æ¨¡æ‹ŸAPIå»¶è¿Ÿ\n  await new Promise(resolve => setTimeout(resolve, 100))\n\n  // è¿™é‡Œåç»­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨\n  // const response = await fetch('/api/admin/features')\n  // return response.json()\n\n  return getEnabledFeatures()\n}\n\n/**\n * æ›´æ–°åŠŸèƒ½é…ç½®\n * åç»­ç”¨äºåå°ç®¡ç†åŠŸèƒ½\n * @param {string} id åŠŸèƒ½ID\n * @param {Object} updates æ›´æ–°çš„é…ç½®\n * @returns {Promise<boolean>} æ›´æ–°æ˜¯å¦æˆåŠŸ\n */\nexport async function updateFeatureConfig(id, updates) {\n  // æ¨¡æ‹ŸAPIè°ƒç”¨\n  console.log(`æ›´æ–°åŠŸèƒ½é…ç½®: ${id}`, updates)\n\n  // è¿™é‡Œåç»­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨\n  // const response = await fetch(`/api/admin/features/${id}`, {\n  //   method: 'PUT',\n  //   headers: { 'Content-Type': 'application/json' },\n  //   body: JSON.stringify(updates)\n  // })\n  // return response.ok\n\n  return true\n}\n"
        }
    ]
}