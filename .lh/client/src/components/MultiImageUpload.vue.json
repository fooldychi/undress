{
    "sourceFile": "client/src/components/MultiImageUpload.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752387294980,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752387428167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -204,8 +204,11 @@\n \r\n <style scoped>\r\n .multi-image-upload {\r\n   width: 100%;\r\n+  display: flex;\r\n+  flex-direction: column;\r\n+  align-items: center;\r\n }\r\n \r\n .upload-area-container {\r\n   margin-bottom: 24px;\r\n@@ -230,18 +233,10 @@\n   align-items: center;\r\n   justify-content: center;\r\n   cursor: pointer;\r\n   width: 100%;\r\n-  max-width: 500px; /* Limit maximum width for larger screens */\r\n }\r\n \r\n-/* For mobile screens, take full width */\r\n-@media (max-width: 768px) {\r\n-  .main-upload-area {\r\n-    max-width: 100%;\r\n-  }\r\n-}\r\n-\r\n .main-upload-area:hover {\r\n   border-color: var(--primary-color);\r\n   background: rgba(102, 126, 234, 0.05);\r\n }\r\n@@ -288,8 +283,9 @@\n   border-radius: 16px;\r\n   padding: 24px;\r\n   box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);\r\n   animation: slideIn 0.3s ease-out;\r\n+  width: 100%;\r\n }\r\n \r\n @keyframes slideIn {\r\n   from {\r\n"
                },
                {
                    "date": 1752387513963,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -233,8 +233,9 @@\n   align-items: center;\r\n   justify-content: center;\r\n   cursor: pointer;\r\n   width: 100%;\r\n+  /* Removed max-width */\r\n }\r\n \r\n .main-upload-area:hover {\r\n   border-color: var(--primary-color);\r\n@@ -284,8 +285,9 @@\n   padding: 24px;\r\n   box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);\r\n   animation: slideIn 0.3s ease-out;\r\n   width: 100%;\r\n+  /* Removed max-width */\r\n }\r\n \r\n @keyframes slideIn {\r\n   from {\r\n"
                }
            ],
            "date": 1752387294980,
            "name": "Commit-0",
            "content": "<template>\r\n  <div class=\"multi-image-upload\">\r\n    <!-- 主上传区域 - 只在没有选择图片时显示 -->\r\n    <div v-if=\"selectedImages.length === 0\" class=\"upload-area-container\">\r\n      <input\r\n        :id=\"inputId\"\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        multiple\r\n        @change=\"handleFileChange\"\r\n        class=\"hidden\"\r\n        :disabled=\"disabled\"\r\n        :webkitdirectory=\"false\"\r\n        ref=\"fileInput\"\r\n      >\r\n      <div class=\"main-upload-area\" :class=\"{ disabled }\" @click=\"triggerFileSelect\">\r\n        <div class=\"upload-placeholder\">\r\n          <Users :size=\"48\" color=\"var(--primary-color)\" class=\"upload-icon\" />\r\n          <h4 class=\"upload-title\">选择人脸照片</h4>\r\n          <p class=\"upload-description\">\r\n            一次选择1-4张照片，支持 JPG、PNG 格式<br>\r\n            如果少于4张，将自动重复最后一张\r\n          </p>\r\n          <van-button\r\n            type=\"primary\"\r\n            size=\"small\"\r\n            round\r\n            class=\"upload-btn\"\r\n            @click.stop=\"triggerFileSelect\"\r\n            :disabled=\"disabled\"\r\n          >\r\n            <Upload :size=\"16\" color=\"white\" class=\"btn-icon\" />\r\n            选择照片 (最多4张)\r\n          </van-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 已选择的图片预览 -->\r\n    <div v-if=\"selectedImages.length > 0\" class=\"selected-images\">\r\n      <div class=\"success-header\">\r\n        <div class=\"success-icon\">\r\n          <CheckCircle :size=\"24\" color=\"var(--success-color)\" />\r\n        </div>\r\n        <h5 class=\"preview-title\">\r\n          已选择 {{ originalCount }} 张照片\r\n          <span v-if=\"originalCount < 4\" class=\"auto-fill-hint\">\r\n            (自动补齐至4张)\r\n          </span>\r\n        </h5>\r\n      </div>\r\n\r\n      <div class=\"images-grid\">\r\n        <div\r\n          v-for=\"(image, index) in displayImages\"\r\n          :key=\"index\"\r\n          class=\"image-item\"\r\n          :class=\"{ 'auto-filled': index >= originalCount }\"\r\n        >\r\n          <div class=\"image-preview\">\r\n            <img :src=\"image\" :alt=\"`人脸照片 ${index + 1}`\" class=\"preview-image\">\r\n            <div class=\"image-overlay\">\r\n              <span class=\"image-number\">{{ index + 1 }}</span>\r\n              <span v-if=\"index >= originalCount\" class=\"auto-fill-badge\">自动补齐</span>\r\n            </div>\r\n          </div>\r\n          <p class=\"image-label\">人脸照片 {{ index + 1 }}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"upload-actions\">\r\n        <van-button @click=\"clearImages\" size=\"small\" type=\"default\">\r\n          <Trash2 :size=\"16\" class=\"btn-icon\" />\r\n          重新选择\r\n        </van-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch } from 'vue'\r\nimport { Toast } from 'vant'\r\nimport { Users, Upload, Trash2, CheckCircle } from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  modelValue: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  maxSize: {\r\n    type: Number,\r\n    default: 10 * 1024 * 1024 // 10MB\r\n  },\r\n  disabled: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:modelValue', 'change'])\r\n\r\nconst inputId = computed(() => `multi-image-upload-${Math.random().toString(36).substring(2, 11)}`)\r\nconst selectedImages = ref([])\r\nconst originalCount = ref(0)\r\nconst fileInput = ref(null)\r\n\r\n// 显示的图片数组（包含自动补齐的）\r\nconst displayImages = computed(() => {\r\n  if (selectedImages.value.length === 0) return []\r\n\r\n  const images = [...selectedImages.value]\r\n  const lastImage = images[images.length - 1]\r\n\r\n  // 如果少于4张，用最后一张补齐\r\n  while (images.length < 4) {\r\n    images.push(lastImage)\r\n  }\r\n\r\n  return images\r\n})\r\n\r\nconst handleFileChange = (event) => {\r\n  const files = Array.from(event.target.files)\r\n  if (files.length === 0) return\r\n\r\n  // 限制最多4张 - 如果选择超过4张，只取前4张\r\n  let selectedFiles = files\r\n  if (files.length > 4) {\r\n    selectedFiles = files.slice(0, 4)\r\n    Toast.fail(`最多只能选择4张照片，已自动选择前4张`)\r\n  }\r\n\r\n  // 验证文件大小\r\n  for (const file of selectedFiles) {\r\n    if (file.size > props.maxSize) {\r\n      const maxSizeMB = Math.round(props.maxSize / (1024 * 1024))\r\n      Toast.fail(`文件大小不能超过${maxSizeMB}MB`)\r\n      return\r\n    }\r\n  }\r\n\r\n  // 读取所有文件\r\n  const promises = selectedFiles.map(file => {\r\n    return new Promise((resolve) => {\r\n      const reader = new FileReader()\r\n      reader.onload = (e) => resolve(e.target.result)\r\n      reader.readAsDataURL(file)\r\n    })\r\n  })\r\n\r\n  Promise.all(promises).then(results => {\r\n    selectedImages.value = results\r\n    originalCount.value = results.length\r\n    updateModelValue()\r\n\r\n    const message = results.length < 4\r\n      ? `已选择 ${results.length} 张照片，自动补齐至4张`\r\n      : `已选择 ${results.length} 张照片`\r\n    Toast.success(message)\r\n  })\r\n\r\n  // 清空input以允许重新选择相同文件\r\n  event.target.value = ''\r\n}\r\n\r\nconst triggerFileSelect = () => {\r\n  if (props.disabled) return\r\n\r\n  // 尝试通过ref获取input元素\r\n  if (fileInput.value) {\r\n    fileInput.value.click()\r\n    return\r\n  }\r\n\r\n  // 备用方案：通过ID获取input元素\r\n  const input = document.getElementById(inputId.value)\r\n  if (input) {\r\n    input.click()\r\n  }\r\n}\r\n\r\nconst clearImages = () => {\r\n  selectedImages.value = []\r\n  originalCount.value = 0\r\n  updateModelValue()\r\n  Toast.success('已清空所有照片')\r\n}\r\n\r\nconst updateModelValue = () => {\r\n  const finalImages = displayImages.value\r\n  emit('update:modelValue', finalImages)\r\n  emit('change', finalImages, originalCount.value)\r\n}\r\n\r\n// 监听外部值变化\r\nwatch(() => props.modelValue, (newValue) => {\r\n  if (newValue && newValue.length > 0) {\r\n    selectedImages.value = newValue.slice(0, Math.min(newValue.length, 4))\r\n    originalCount.value = selectedImages.value.length\r\n  }\r\n}, { immediate: true })\r\n</script>\r\n\r\n<style scoped>\r\n.multi-image-upload {\r\n  width: 100%;\r\n}\r\n\r\n.upload-area-container {\r\n  margin-bottom: 24px;\r\n  display: flex;\r\n  justify-content: center;\r\n  width: 100%;\r\n}\r\n\r\n.hidden {\r\n  display: none;\r\n}\r\n\r\n.main-upload-area {\r\n  background: var(--bg-card);\r\n  border: 2px dashed var(--border-color);\r\n  border-radius: 16px;\r\n  padding: 40px 24px;\r\n  text-align: center;\r\n  transition: var(--transition);\r\n  min-height: 200px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  width: 100%;\r\n  max-width: 500px; /* Limit maximum width for larger screens */\r\n}\r\n\r\n/* For mobile screens, take full width */\r\n@media (max-width: 768px) {\r\n  .main-upload-area {\r\n    max-width: 100%;\r\n  }\r\n}\r\n\r\n.main-upload-area:hover {\r\n  border-color: var(--primary-color);\r\n  background: rgba(102, 126, 234, 0.05);\r\n}\r\n\r\n.main-upload-area.disabled {\r\n  opacity: 0.6;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.upload-placeholder {\r\n  text-align: center;\r\n  color: var(--text-light);\r\n}\r\n\r\n.upload-icon {\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.upload-title {\r\n  margin: 12px 0 8px;\r\n  color: var(--text-color);\r\n  font-size: 1.2rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.upload-description {\r\n  font-size: 0.9rem;\r\n  margin: 0 0 20px 0;\r\n  line-height: 1.5;\r\n  color: var(--text-light);\r\n}\r\n\r\n.upload-btn {\r\n  margin-top: 8px;\r\n}\r\n\r\n.btn-icon {\r\n  margin-right: 4px;\r\n}\r\n\r\n.selected-images {\r\n  background: var(--bg-card);\r\n  border: 2px solid var(--primary-color);\r\n  border-radius: 16px;\r\n  padding: 24px;\r\n  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);\r\n  animation: slideIn 0.3s ease-out;\r\n}\r\n\r\n@keyframes slideIn {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(20px);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.success-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.success-icon {\r\n  flex-shrink: 0;\r\n  animation: checkmark 0.5s ease-out;\r\n}\r\n\r\n@keyframes checkmark {\r\n  0% {\r\n    transform: scale(0);\r\n    opacity: 0;\r\n  }\r\n  50% {\r\n    transform: scale(1.2);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n.preview-title {\r\n  margin: 0;\r\n  color: var(--text-color);\r\n  font-size: 1.1rem;\r\n  font-weight: 600;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.auto-fill-hint {\r\n  font-size: 0.85rem;\r\n  color: var(--text-light);\r\n  font-weight: normal;\r\n}\r\n\r\n.images-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(4, 1fr);\r\n  gap: 16px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .images-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 12px;\r\n  }\r\n}\r\n\r\n.image-item {\r\n  text-align: center;\r\n}\r\n\r\n.image-item.auto-filled {\r\n  opacity: 0.7;\r\n}\r\n\r\n.image-preview {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 120px;\r\n  border-radius: 12px;\r\n  overflow: hidden;\r\n  background: var(--bg-dark);\r\n  border: 2px solid var(--border-color);\r\n}\r\n\r\n.image-item.auto-filled .image-preview {\r\n  border-color: var(--warning-color);\r\n  border-style: dashed;\r\n}\r\n\r\n.preview-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n  object-position: center;\r\n}\r\n\r\n.image-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.7) 100%);\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 8px;\r\n  color: white;\r\n  font-size: 0.75rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.image-number {\r\n  background: var(--primary-color);\r\n  padding: 4px 8px;\r\n  border-radius: 12px;\r\n  font-size: 0.7rem;\r\n}\r\n\r\n.auto-fill-badge {\r\n  background: var(--warning-color);\r\n  padding: 2px 6px;\r\n  border-radius: 8px;\r\n  font-size: 0.65rem;\r\n}\r\n\r\n.image-label {\r\n  margin: 8px 0 0 0;\r\n  font-size: 0.85rem;\r\n  color: var(--text-light);\r\n}\r\n\r\n.upload-actions {\r\n  display: flex;\r\n  gap: 12px;\r\n  justify-content: center;\r\n}\r\n\r\n.upload-actions .van-button {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n}\r\n</style>\r\n"
        }
    ]
}