{
    "sourceFile": "client/src/components/PointsModal.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 91,
            "patches": [
                {
                    "date": 1752287463851,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752287481485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -97,34 +97,20 @@\n             </div>\n           </van-form>\n         </div>\n \n-        <!-- 等级卡类型说明 -->\n-        <div class=\"card-types-section\">\n-          <h3 class=\"section-title\">等级卡类型</h3>\n-          <div class=\"card-types-list\">\n-            <div class=\"card-type-item\">\n-              <div class=\"card-type-icon\">🥉</div>\n-              <div class=\"card-type-info\">\n-                <div class=\"card-type-name\">基础卡</div>\n-                <div class=\"card-type-desc\">¥9.9 / 300积分</div>\n-              </div>\n-            </div>\n-            <div class=\"card-type-item\">\n-              <div class=\"card-type-icon\">🥈</div>\n-              <div class=\"card-type-info\">\n-                <div class=\"card-type-name\">高级卡</div>\n-                <div class=\"card-type-desc\">¥30 / 1000积分</div>\n-              </div>\n-            </div>\n-            <div class=\"card-type-item\">\n-              <div class=\"card-type-icon\">🥇</div>\n-              <div class=\"card-type-info\">\n-                <div class=\"card-type-name\">至尊卡</div>\n-                <div class=\"card-type-desc\">¥50 / 2000积分</div>\n-              </div>\n-            </div>\n-          </div>\n+        <!-- 购买等级卡按钮 -->\n+        <div class=\"purchase-section\">\n+          <van-button\n+            type=\"primary\"\n+            block\n+            round\n+            @click=\"showPurchaseModal = true\"\n+            class=\"purchase-btn\"\n+          >\n+            <van-icon name=\"shopping-cart-o\" size=\"16\" />\n+            购买等级卡\n+          </van-button>\n         </div>\n       </div>\n     </div>\n   </van-popup>\n"
                },
                {
                    "date": 1752287505969,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,8 +113,97 @@\n         </div>\n       </div>\n     </div>\n   </van-popup>\n+\n+  <!-- 购买等级卡弹窗 -->\n+  <van-popup\n+    v-model:show=\"showPurchaseModal\"\n+    position=\"center\"\n+    :style=\"{ width: '90%', maxWidth: '500px', borderRadius: '16px' }\"\n+    :close-on-click-overlay=\"false\"\n+  >\n+    <div class=\"purchase-modal\">\n+      <!-- 头部 -->\n+      <div class=\"modal-header\">\n+        <h2 class=\"modal-title\">\n+          <van-icon name=\"shopping-cart-o\" size=\"24\" />\n+          购买等级卡\n+        </h2>\n+        <van-icon\n+          name=\"cross\"\n+          size=\"20\"\n+          class=\"close-btn\"\n+          @click=\"showPurchaseModal = false\"\n+        />\n+      </div>\n+\n+      <!-- 内容 -->\n+      <div class=\"modal-content\">\n+        <!-- 等级卡类型（三列横排） -->\n+        <div class=\"card-types-grid\">\n+          <div class=\"card-type-card\">\n+            <div class=\"card-icon\">🥉</div>\n+            <div class=\"card-name\">基础卡</div>\n+            <div class=\"card-price\">¥9.9</div>\n+            <div class=\"card-points\">300积分</div>\n+          </div>\n+          <div class=\"card-type-card\">\n+            <div class=\"card-icon\">🥈</div>\n+            <div class=\"card-name\">高级卡</div>\n+            <div class=\"card-price\">¥30</div>\n+            <div class=\"card-points\">1000积分</div>\n+          </div>\n+          <div class=\"card-type-card\">\n+            <div class=\"card-icon\">🥇</div>\n+            <div class=\"card-name\">至尊卡</div>\n+            <div class=\"card-price\">¥50</div>\n+            <div class=\"card-points\">2000积分</div>\n+          </div>\n+        </div>\n+\n+        <!-- 兑换流程 -->\n+        <div class=\"exchange-process\">\n+          <h3 class=\"process-title\">兑换流程</h3>\n+          <div class=\"process-steps\">\n+            <div class=\"process-step\">\n+              <div class=\"step-number\">1</div>\n+              <div class=\"step-text\">加客服</div>\n+            </div>\n+            <div class=\"process-arrow\">→</div>\n+            <div class=\"process-step\">\n+              <div class=\"step-number\">2</div>\n+              <div class=\"step-text\">发口令红包</div>\n+            </div>\n+            <div class=\"process-arrow\">→</div>\n+            <div class=\"process-step\">\n+              <div class=\"step-number\">3</div>\n+              <div class=\"step-text\">收到卡号</div>\n+            </div>\n+            <div class=\"process-arrow\">→</div>\n+            <div class=\"process-step\">\n+              <div class=\"step-number\">4</div>\n+              <div class=\"step-text\">绑定获得等级卡</div>\n+            </div>\n+          </div>\n+        </div>\n+\n+        <!-- 联系客服按钮 -->\n+        <div class=\"contact-section\">\n+          <van-button\n+            type=\"primary\"\n+            block\n+            round\n+            @click=\"contactCustomerService\"\n+            class=\"contact-btn\"\n+          >\n+            <van-icon name=\"chat-o\" size=\"16\" />\n+            联系客服 (Telegram: tgcomfy)\n+          </van-button>\n+        </div>\n+      </div>\n+    </div>\n+  </van-popup>\n </template>\n \n <script>\n import { ref, reactive, computed, watch, onMounted } from 'vue'\n"
                },
                {
                    "date": 1752287520552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,8 +227,9 @@\n \n     const loading = ref(false)\n     const bindLoading = ref(false)\n     const pointsInfo = ref(null)\n+    const showPurchaseModal = ref(false)\n \n     // 绑定表单数据\n     const bindForm = reactive({\n       cardNumber: '',\n"
                },
                {
                    "date": 1752287533881,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,11 +255,22 @@\n \n     // 关闭弹窗\n     const closeModal = () => {\n       visible.value = false\n+      showPurchaseModal.value = false\n       resetBindForm()\n     }\n \n+    // 联系客服\n+    const contactCustomerService = () => {\n+      // 打开Telegram链接\n+      const telegramUrl = 'https://t.me/tgcomfy'\n+      window.open(telegramUrl, '_blank')\n+\n+      // 显示提示\n+      Toast.success('正在跳转到Telegram客服')\n+    }\n+\n     // 加载积分信息\n     const loadPointsInfo = async () => {\n       try {\n         loading.value = true\n"
                },
                {
                    "date": 1752287546139,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -339,8 +339,9 @@\n       if (newValue) {\n         loadPointsInfo()\n       } else {\n         resetBindForm()\n+        showPurchaseModal.value = false\n       }\n     })\n \n     return {\n"
                },
                {
                    "date": 1752287561646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -351,11 +351,13 @@\n       pointsInfo,\n       bindForm,\n       cardNumberRules,\n       cardPasswordRules,\n+      showPurchaseModal,\n       closeModal,\n       loadPointsInfo,\n-      handleBindCard\n+      handleBindCard,\n+      contactCustomerService\n     }\n   }\n }\n </script>\n"
                },
                {
                    "date": 1752287576423,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -524,8 +524,26 @@\n .bind-actions {\n   margin-top: 16px;\n }\n \n+/* 购买区块 */\n+.purchase-section {\n+  margin-top: 24px;\n+  padding-top: 24px;\n+  border-top: 1px solid #ebedf0;\n+}\n+\n+.purchase-btn {\n+  background: linear-gradient(135deg, #ff6b6b, #ee5a24);\n+  border: none;\n+  font-weight: 600;\n+  height: 48px;\n+}\n+\n+.purchase-btn:hover {\n+  background: linear-gradient(135deg, #ee5a24, #ff6b6b);\n+}\n+\n /* 等级卡类型说明 */\n .card-types-section {\n   border-top: 1px solid #ebedf0;\n   padding-top: 24px;\n"
                },
                {
                    "date": 1752287601866,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -542,51 +542,138 @@\n .purchase-btn:hover {\n   background: linear-gradient(135deg, #ee5a24, #ff6b6b);\n }\n \n-/* 等级卡类型说明 */\n-.card-types-section {\n-  border-top: 1px solid #ebedf0;\n-  padding-top: 24px;\n+/* 购买弹窗样式 */\n+.purchase-modal {\n+  padding: 0;\n+  background: white;\n+  border-radius: 16px;\n+  max-height: 80vh;\n+  overflow-y: auto;\n }\n \n-.card-types-list {\n-  display: flex;\n-  flex-direction: column;\n+/* 等级卡类型网格（三列横排） */\n+.card-types-grid {\n+  display: grid;\n+  grid-template-columns: repeat(3, 1fr);\n   gap: 12px;\n+  margin-bottom: 24px;\n }\n \n-.card-type-item {\n-  display: flex;\n-  align-items: center;\n-  gap: 12px;\n-  padding: 12px;\n+.card-type-card {\n+  padding: 16px 8px;\n   background: #f7f8fa;\n-  border-radius: 8px;\n+  border-radius: 12px;\n+  text-align: center;\n+  border: 2px solid transparent;\n+  transition: all 0.3s;\n }\n \n-.card-type-icon {\n-  font-size: 24px;\n-  width: 40px;\n-  text-align: center;\n+.card-type-card:hover {\n+  border-color: #1989fa;\n+  background: #e3f2fd;\n }\n \n-.card-type-info {\n-  flex: 1;\n+.card-icon {\n+  font-size: 32px;\n+  margin-bottom: 8px;\n }\n \n-.card-type-name {\n+.card-name {\n   font-size: 14px;\n-  font-weight: 500;\n+  font-weight: 600;\n   color: #323233;\n+  margin-bottom: 4px;\n+}\n+\n+.card-price {\n+  font-size: 16px;\n+  font-weight: 700;\n+  color: #ff6b6b;\n   margin-bottom: 2px;\n }\n \n-.card-type-desc {\n+.card-points {\n   font-size: 12px;\n   color: #969799;\n }\n \n+/* 兑换流程 */\n+.exchange-process {\n+  margin-bottom: 24px;\n+  padding: 20px;\n+  background: #f7f8fa;\n+  border-radius: 12px;\n+}\n+\n+.process-title {\n+  font-size: 16px;\n+  font-weight: 600;\n+  color: #323233;\n+  margin: 0 0 16px 0;\n+  text-align: center;\n+}\n+\n+.process-steps {\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+  flex-wrap: wrap;\n+  gap: 8px;\n+}\n+\n+.process-step {\n+  display: flex;\n+  flex-direction: column;\n+  align-items: center;\n+  min-width: 60px;\n+}\n+\n+.step-number {\n+  width: 24px;\n+  height: 24px;\n+  background: #1989fa;\n+  color: white;\n+  border-radius: 50%;\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+  font-size: 12px;\n+  font-weight: 600;\n+  margin-bottom: 4px;\n+}\n+\n+.step-text {\n+  font-size: 11px;\n+  color: #323233;\n+  text-align: center;\n+  line-height: 1.2;\n+}\n+\n+.process-arrow {\n+  color: #1989fa;\n+  font-size: 16px;\n+  font-weight: 600;\n+  margin: 0 4px;\n+}\n+\n+/* 联系客服 */\n+.contact-section {\n+  margin-top: 24px;\n+}\n+\n+.contact-btn {\n+  background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n+  border: none;\n+  font-weight: 600;\n+  height: 48px;\n+}\n+\n+.contact-btn:hover {\n+  background: linear-gradient(135deg, #3a7bd5, #00d2ff);\n+}\n+\n /* 响应式设计 */\n @media (max-width: 768px) {\n   .points-overview {\n     flex-direction: column;\n"
                },
                {
                    "date": 1752287619802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -683,8 +683,37 @@\n \n   .points-stats {\n     justify-content: center;\n   }\n+\n+  /* 移动端等级卡网格调整 */\n+  .card-types-grid {\n+    grid-template-columns: 1fr;\n+    gap: 8px;\n+  }\n+\n+  .card-type-card {\n+    padding: 12px;\n+  }\n+\n+  .card-icon {\n+    font-size: 28px;\n+  }\n+\n+  /* 移动端流程步骤调整 */\n+  .process-steps {\n+    flex-direction: column;\n+    gap: 12px;\n+  }\n+\n+  .process-arrow {\n+    transform: rotate(90deg);\n+    margin: 4px 0;\n+  }\n+\n+  .step-text {\n+    font-size: 12px;\n+  }\n }\n \n /* 深色主题适配 */\n @media (prefers-color-scheme: dark) {\n"
                },
                {
                    "date": 1752287889705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,20 +271,52 @@\n     }\n \n     // 加载积分信息\n     const loadPointsInfo = async () => {\n+      // 检查登录状态\n+      if (!authApi.isLoggedIn()) {\n+        pointsInfo.value = {\n+          total_points: 0,\n+          cards_count: 0,\n+          cards_breakdown: []\n+        }\n+        loading.value = false\n+        return\n+      }\n+\n       try {\n         loading.value = true\n         const response = await pointsApi.getUserPoints()\n \n         if (response.success) {\n           pointsInfo.value = response.data\n         } else {\n-          Toast.fail('获取积分信息失败')\n+          console.error('获取积分信息失败:', response.message)\n+          // 如果是认证错误，显示登录提示\n+          if (response.message && response.message.includes('令牌')) {\n+            Toast.fail('请先登录')\n+            pointsInfo.value = {\n+              total_points: 0,\n+              cards_count: 0,\n+              cards_breakdown: []\n+            }\n+          } else {\n+            Toast.fail('获取积分信息失败')\n+          }\n         }\n       } catch (error) {\n         console.error('加载积分信息失败:', error)\n-        Toast.fail('获取积分信息失败')\n+        // 如果是认证错误，显示登录提示\n+        if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n+          Toast.fail('请先登录')\n+          pointsInfo.value = {\n+            total_points: 0,\n+            cards_count: 0,\n+            cards_breakdown: []\n+          }\n+        } else {\n+          Toast.fail('获取积分信息失败')\n+        }\n       } finally {\n         loading.value = false\n       }\n     }\n"
                },
                {
                    "date": 1752287912972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -324,8 +324,14 @@\n     // 处理绑定等级卡\n     const handleBindCard = async () => {\n       if (bindLoading.value) return\n \n+      // 检查登录状态\n+      if (!authApi.isLoggedIn()) {\n+        Toast.fail('请先登录')\n+        return\n+      }\n+\n       // 验证表单\n       if (!bindForm.cardNumber.trim()) {\n         Toast.fail('请输入卡号')\n         return\n@@ -355,13 +361,24 @@\n \n           // 重置表单\n           resetBindForm()\n         } else {\n-          Toast.fail(response.message || '绑定失败')\n+          console.error('绑定失败:', response.message)\n+          // 如果是认证错误，显示登录提示\n+          if (response.message && response.message.includes('令牌')) {\n+            Toast.fail('请先登录')\n+          } else {\n+            Toast.fail(response.message || '绑定失败')\n+          }\n         }\n       } catch (error) {\n         console.error('绑定等级卡失败:', error)\n-        Toast.fail(error.message || '绑定失败')\n+        // 如果是认证错误，显示登录提示\n+        if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n+          Toast.fail('请先登录')\n+        } else {\n+          Toast.fail(error.message || '绑定失败')\n+        }\n       } finally {\n         bindLoading.value = false\n       }\n     }\n"
                },
                {
                    "date": 1752287990441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -207,9 +207,9 @@\n \n <script>\n import { ref, reactive, computed, watch, onMounted } from 'vue'\n import { Toast } from 'vant'\n-import { levelCardApi, pointsApi } from '../services/api.js'\n+import { levelCardApi, pointsApi, authApi } from '../services/api.js'\n \n export default {\n   name: 'PointsModal',\n   props: {\n"
                },
                {
                    "date": 1752288039885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,21 +26,39 @@\n       </van-loading>\n \n       <!-- 内容 -->\n       <div v-else class=\"modal-content\">\n-        <!-- 积分概览 -->\n-        <div class=\"points-overview\">\n-          <div class=\"points-total\">\n-            <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n-            <div class=\"points-label\">总积分</div>\n-          </div>\n-          <div class=\"points-stats\">\n-            <div class=\"stat-item\">\n-              <span class=\"stat-value\">{{ pointsInfo?.cards_count || 0 }}</span>\n-              <span class=\"stat-label\">等级卡</span>\n+        <!-- 未登录提示 -->\n+        <div v-if=\"!isLoggedIn\" class=\"login-prompt\">\n+          <div class=\"prompt-icon\">🔐</div>\n+          <div class=\"prompt-title\">请先登录</div>\n+          <div class=\"prompt-desc\">登录后即可查看积分信息和绑定等级卡</div>\n+          <van-button\n+            type=\"primary\"\n+            round\n+            block\n+            @click=\"closeModal\"\n+            class=\"login-btn\"\n+          >\n+            去登录\n+          </van-button>\n+        </div>\n+\n+        <!-- 已登录内容 -->\n+        <template v-else>\n+          <!-- 积分概览 -->\n+          <div class=\"points-overview\">\n+            <div class=\"points-total\">\n+              <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n+              <div class=\"points-label\">总积分</div>\n             </div>\n+            <div class=\"points-stats\">\n+              <div class=\"stat-item\">\n+                <span class=\"stat-value\">{{ pointsInfo?.cards_count || 0 }}</span>\n+                <span class=\"stat-label\">等级卡</span>\n+              </div>\n+            </div>\n           </div>\n-        </div>\n \n         <!-- 等级卡明细 - 移除显示 -->\n         <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n           <h3 class=\"section-title\">我的等级卡</h3>\n"
                },
                {
                    "date": 1752288061779,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,61 +75,62 @@\n             </div>\n           </div>\n         </div> -->\n \n-        <!-- 绑定等级卡 -->\n-        <div class=\"bind-section\">\n-          <h3 class=\"section-title\">绑定等级卡</h3>\n-          <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n+          <!-- 绑定等级卡 -->\n+          <div class=\"bind-section\">\n+            <h3 class=\"section-title\">绑定等级卡</h3>\n+            <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n-          <van-form @submit=\"handleBindCard\">\n-            <van-field\n-              v-model=\"bindForm.cardNumber\"\n-              name=\"cardNumber\"\n-              label=\"卡号\"\n-              placeholder=\"请输入等级卡卡号\"\n-              :rules=\"cardNumberRules\"\n-              clearable\n-            />\n+            <van-form @submit=\"handleBindCard\">\n+              <van-field\n+                v-model=\"bindForm.cardNumber\"\n+                name=\"cardNumber\"\n+                label=\"卡号\"\n+                placeholder=\"请输入等级卡卡号\"\n+                :rules=\"cardNumberRules\"\n+                clearable\n+              />\n \n-            <van-field\n-              v-model=\"bindForm.cardPassword\"\n-              type=\"password\"\n-              name=\"cardPassword\"\n-              label=\"卡密\"\n-              placeholder=\"请输入等级卡卡密\"\n-              :rules=\"cardPasswordRules\"\n-              clearable\n-            />\n+              <van-field\n+                v-model=\"bindForm.cardPassword\"\n+                type=\"password\"\n+                name=\"cardPassword\"\n+                label=\"卡密\"\n+                placeholder=\"请输入等级卡卡密\"\n+                :rules=\"cardPasswordRules\"\n+                clearable\n+              />\n \n-            <div class=\"bind-actions\">\n-              <van-button\n-                type=\"primary\"\n-                native-type=\"submit\"\n-                block\n-                round\n-                :loading=\"bindLoading\"\n-                :disabled=\"bindLoading\"\n-              >\n-                {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n-              </van-button>\n-            </div>\n-          </van-form>\n-        </div>\n+              <div class=\"bind-actions\">\n+                <van-button\n+                  type=\"primary\"\n+                  native-type=\"submit\"\n+                  block\n+                  round\n+                  :loading=\"bindLoading\"\n+                  :disabled=\"bindLoading\"\n+                >\n+                  {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n+                </van-button>\n+              </div>\n+            </van-form>\n+          </div>\n \n-        <!-- 购买等级卡按钮 -->\n-        <div class=\"purchase-section\">\n-          <van-button\n-            type=\"primary\"\n-            block\n-            round\n-            @click=\"showPurchaseModal = true\"\n-            class=\"purchase-btn\"\n-          >\n-            <van-icon name=\"shopping-cart-o\" size=\"16\" />\n-            购买等级卡\n-          </van-button>\n-        </div>\n+          <!-- 购买等级卡按钮 -->\n+          <div class=\"purchase-section\">\n+            <van-button\n+              type=\"primary\"\n+              block\n+              round\n+              @click=\"showPurchaseModal = true\"\n+              class=\"purchase-btn\"\n+            >\n+              <van-icon name=\"shopping-cart-o\" size=\"16\" />\n+              购买等级卡\n+            </van-button>\n+          </div>\n+        </template>\n       </div>\n     </div>\n   </van-popup>\n \n"
                },
                {
                    "date": 1752288076643,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,8 +248,11 @@\n     const bindLoading = ref(false)\n     const pointsInfo = ref(null)\n     const showPurchaseModal = ref(false)\n \n+    // 计算登录状态\n+    const isLoggedIn = computed(() => authApi.isLoggedIn())\n+\n     // 绑定表单数据\n     const bindForm = reactive({\n       cardNumber: '',\n       cardPassword: ''\n"
                },
                {
                    "date": 1752288095632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -423,8 +423,9 @@\n       bindForm,\n       cardNumberRules,\n       cardPasswordRules,\n       showPurchaseModal,\n+      isLoggedIn,\n       closeModal,\n       loadPointsInfo,\n       handleBindCard,\n       contactCustomerService\n"
                },
                {
                    "date": 1752288110947,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -485,8 +485,40 @@\n .modal-content {\n   padding: 24px;\n }\n \n+/* 登录提示 */\n+.login-prompt {\n+  text-align: center;\n+  padding: 40px 20px;\n+}\n+\n+.prompt-icon {\n+  font-size: 48px;\n+  margin-bottom: 16px;\n+}\n+\n+.prompt-title {\n+  font-size: 18px;\n+  font-weight: 600;\n+  color: #323233;\n+  margin-bottom: 8px;\n+}\n+\n+.prompt-desc {\n+  font-size: 14px;\n+  color: #969799;\n+  margin-bottom: 24px;\n+  line-height: 1.5;\n+}\n+\n+.login-btn {\n+  background: linear-gradient(135deg, #1989fa, #1976d2);\n+  border: none;\n+  font-weight: 600;\n+  height: 48px;\n+}\n+\n /* 积分概览 */\n .points-overview {\n   display: flex;\n   align-items: center;\n"
                },
                {
                    "date": 1752288842654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,27 +80,37 @@\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">绑定等级卡</h3>\n             <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n-            <van-form @submit=\"handleBindCard\">\n-              <van-field\n-                v-model=\"bindForm.cardNumber\"\n-                name=\"cardNumber\"\n-                label=\"卡号\"\n-                placeholder=\"请输入等级卡卡号\"\n-                :rules=\"cardNumberRules\"\n-                clearable\n-              />\n+            <van-form @submit=\"handleBindCard\" class=\"bind-form\">\n+              <div class=\"form-field\">\n+                <van-field\n+                  v-model=\"bindForm.cardNumber\"\n+                  name=\"cardNumber\"\n+                  label=\"卡号\"\n+                  placeholder=\"请输入等级卡卡号\"\n+                  :rules=\"cardNumberRules\"\n+                  clearable\n+                  input-align=\"left\"\n+                  label-width=\"60\"\n+                  class=\"custom-field\"\n+                />\n+              </div>\n \n-              <van-field\n-                v-model=\"bindForm.cardPassword\"\n-                type=\"password\"\n-                name=\"cardPassword\"\n-                label=\"卡密\"\n-                placeholder=\"请输入等级卡卡密\"\n-                :rules=\"cardPasswordRules\"\n-                clearable\n-              />\n+              <div class=\"form-field\">\n+                <van-field\n+                  v-model=\"bindForm.cardPassword\"\n+                  type=\"password\"\n+                  name=\"cardPassword\"\n+                  label=\"卡密\"\n+                  placeholder=\"请输入等级卡卡密\"\n+                  :rules=\"cardPasswordRules\"\n+                  clearable\n+                  input-align=\"left\"\n+                  label-width=\"60\"\n+                  class=\"custom-field\"\n+                />\n+              </div>\n \n               <div class=\"bind-actions\">\n                 <van-button\n                   type=\"primary\"\n@@ -108,8 +118,9 @@\n                   block\n                   round\n                   :loading=\"bindLoading\"\n                   :disabled=\"bindLoading\"\n+                  class=\"bind-button\"\n                 >\n                   {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n                 </van-button>\n               </div>\n"
                },
                {
                    "date": 1752288874464,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -630,17 +630,109 @@\n \n /* 绑定区块 */\n .bind-section {\n   margin-bottom: 24px;\n-  padding: 20px;\n-  background: #f7f8fa;\n+  padding: 24px;\n+  background: linear-gradient(135deg, #f7f8fa 0%, #ffffff 100%);\n+  border-radius: 16px;\n+  border: 1px solid #ebedf0;\n+  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n+}\n+\n+/* 绑定表单 */\n+.bind-form {\n+  margin-top: 20px;\n+}\n+\n+.form-field {\n+  margin-bottom: 16px;\n+}\n+\n+/* 自定义输入框样式 */\n+.custom-field {\n+  background: #ffffff;\n   border-radius: 12px;\n+  border: 1px solid #e1e5e9;\n+  transition: all 0.3s ease;\n+  overflow: hidden;\n }\n \n+.custom-field:hover {\n+  border-color: #1989fa;\n+  box-shadow: 0 2px 8px rgba(25, 137, 250, 0.1);\n+}\n+\n+.custom-field:focus-within {\n+  border-color: #1989fa;\n+  box-shadow: 0 0 0 2px rgba(25, 137, 250, 0.1);\n+}\n+\n+/* 输入框内部样式 */\n+.custom-field :deep(.van-field__control) {\n+  background: transparent;\n+  border: none;\n+  padding: 16px;\n+  font-size: 15px;\n+  line-height: 1.4;\n+}\n+\n+.custom-field :deep(.van-field__label) {\n+  color: #646566;\n+  font-weight: 500;\n+  font-size: 14px;\n+  padding-left: 16px;\n+  min-width: 60px;\n+}\n+\n+.custom-field :deep(.van-field__body) {\n+  padding: 0;\n+}\n+\n+.custom-field :deep(.van-field__control input) {\n+  color: #323233;\n+  font-size: 15px;\n+}\n+\n+.custom-field :deep(.van-field__control input::placeholder) {\n+  color: #c8c9cc;\n+  font-size: 14px;\n+}\n+\n+.custom-field :deep(.van-field__clear) {\n+  margin-right: 12px;\n+  color: #c8c9cc;\n+}\n+\n+.custom-field :deep(.van-field__clear):hover {\n+  color: #969799;\n+}\n+\n+/* 绑定按钮 */\n .bind-actions {\n-  margin-top: 16px;\n+  margin-top: 24px;\n }\n \n+.bind-button {\n+  height: 48px;\n+  font-size: 16px;\n+  font-weight: 600;\n+  background: linear-gradient(135deg, #1989fa, #1976d2);\n+  border: none;\n+  box-shadow: 0 4px 12px rgba(25, 137, 250, 0.3);\n+  transition: all 0.3s ease;\n+}\n+\n+.bind-button:hover {\n+  background: linear-gradient(135deg, #1976d2, #1565c0);\n+  box-shadow: 0 6px 16px rgba(25, 137, 250, 0.4);\n+  transform: translateY(-1px);\n+}\n+\n+.bind-button:active {\n+  transform: translateY(0);\n+  box-shadow: 0 2px 8px rgba(25, 137, 250, 0.3);\n+}\n+\n /* 购买区块 */\n .purchase-section {\n   margin-top: 24px;\n   padding-top: 24px;\n"
                },
                {
                    "date": 1752290127552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,37 +80,25 @@\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">绑定等级卡</h3>\n             <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n-            <van-form @submit=\"handleBindCard\" class=\"bind-form\">\n-              <div class=\"form-field\">\n-                <van-field\n-                  v-model=\"bindForm.cardNumber\"\n-                  name=\"cardNumber\"\n-                  label=\"卡号\"\n-                  placeholder=\"请输入等级卡卡号\"\n-                  :rules=\"cardNumberRules\"\n-                  clearable\n-                  input-align=\"left\"\n-                  label-width=\"60\"\n-                  class=\"custom-field\"\n-                />\n-              </div>\n+            <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n+              <BaseInput\n+                v-model=\"bindForm.cardNumber\"\n+                label=\"卡号\"\n+                placeholder=\"请输入等级卡卡号\"\n+                :rules=\"cardNumberRules\"\n+                clearable\n+              />\n \n-              <div class=\"form-field\">\n-                <van-field\n-                  v-model=\"bindForm.cardPassword\"\n-                  type=\"password\"\n-                  name=\"cardPassword\"\n-                  label=\"卡密\"\n-                  placeholder=\"请输入等级卡卡密\"\n-                  :rules=\"cardPasswordRules\"\n-                  clearable\n-                  input-align=\"left\"\n-                  label-width=\"60\"\n-                  class=\"custom-field\"\n-                />\n-              </div>\n+              <BaseInput\n+                v-model=\"bindForm.cardPassword\"\n+                type=\"password\"\n+                label=\"卡密\"\n+                placeholder=\"请输入等级卡卡密\"\n+                :rules=\"cardPasswordRules\"\n+                clearable\n+              />\n \n               <div class=\"bind-actions\">\n                 <van-button\n                   type=\"primary\"\n@@ -123,9 +111,9 @@\n                 >\n                   {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n                 </van-button>\n               </div>\n-            </van-form>\n+            </form>\n           </div>\n \n           <!-- 购买等级卡按钮 -->\n           <div class=\"purchase-section\">\n"
                },
                {
                    "date": 1752290176226,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -226,11 +226,15 @@\n <script>\n import { ref, reactive, computed, watch, onMounted } from 'vue'\n import { Toast } from 'vant'\n import { levelCardApi, pointsApi, authApi } from '../services/api.js'\n+import BaseInput from './BaseInput.vue'\n \n export default {\n   name: 'PointsModal',\n+  components: {\n+    BaseInput\n+  },\n   props: {\n     show: {\n       type: Boolean,\n       default: false\n"
                },
                {
                    "date": 1752341982135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -375,16 +375,32 @@\n           bindForm.cardPassword.trim()\n         )\n \n         if (response.success) {\n-          Toast.success(response.message || '绑定成功')\n+          Toast.success(response.message || '绑定成功，正在更新积分...')\n \n-          // 重新加载积分信息\n-          await loadPointsInfo()\n+          // 显示积分更新中的提示\n+          Toast.loading({\n+            message: '正在更新积分信息...',\n+            forbidClick: true,\n+            duration: 0\n+          })\n \n-          // 通知父组件积分已更新\n-          emit('points-updated', response.data)\n+          try {\n+            // 重新加载积分信息\n+            await loadPointsInfo()\n \n+            // 通知父组件积分已更新\n+            emit('points-updated', response.data)\n+\n+            Toast.clear()\n+            Toast.success('积分更新成功')\n+          } catch (error) {\n+            Toast.clear()\n+            console.error('更新积分信息失败:', error)\n+            Toast.fail('积分更新失败，请刷新页面')\n+          }\n+\n           // 重置表单\n           resetBindForm()\n         } else {\n           console.error('绑定失败:', response.message)\n"
                },
                {
                    "date": 1752342595762,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -388,10 +388,12 @@\n           try {\n             // 重新加载积分信息\n             await loadPointsInfo()\n \n-            // 通知父组件积分已更新\n-            emit('points-updated', response.data)\n+            // 通知父组件积分已更新（延迟一点确保数据同步）\n+            setTimeout(() => {\n+              emit('points-updated', response.data)\n+            }, 100)\n \n             Toast.clear()\n             Toast.success('积分更新成功')\n           } catch (error) {\n"
                },
                {
                    "date": 1752342654373,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -388,15 +388,13 @@\n           try {\n             // 重新加载积分信息\n             await loadPointsInfo()\n \n-            // 通知父组件积分已更新（延迟一点确保数据同步）\n-            setTimeout(() => {\n-              emit('points-updated', response.data)\n-            }, 100)\n-\n             Toast.clear()\n             Toast.success('积分更新成功')\n+\n+            // 通知父组件积分已更新\n+            emit('points-updated', response.data)\n           } catch (error) {\n             Toast.clear()\n             console.error('更新积分信息失败:', error)\n             Toast.fail('积分更新失败，请刷新页面')\n"
                },
                {
                    "date": 1752342953280,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,8 +80,18 @@\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">绑定等级卡</h3>\n             <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n+            <!-- 体验卡提示 -->\n+            <div v-if=\"hasUnusedExperienceCard\" class=\"experience-card-notice\">\n+              <van-notice-bar\n+                left-icon=\"warning-o\"\n+                color=\"#ff6b35\"\n+                background=\"#fff7f0\"\n+                text=\"您已有可用的体验卡，请先使用完当前体验卡积分后再绑定新的体验卡\"\n+              />\n+            </div>\n+\n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n               <BaseInput\n                 v-model=\"bindForm.cardNumber\"\n                 label=\"卡号\"\n"
                },
                {
                    "date": 1752342984560,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -260,12 +260,20 @@\n     const loading = ref(false)\n     const bindLoading = ref(false)\n     const pointsInfo = ref(null)\n     const showPurchaseModal = ref(false)\n+    const userCards = ref([])\n \n     // 计算登录状态\n     const isLoggedIn = computed(() => authApi.isLoggedIn())\n \n+    // 检查是否有未使用的体验卡\n+    const hasUnusedExperienceCard = computed(() => {\n+      return userCards.value.some(card =>\n+        card.type_name === '体验卡' && card.remaining_points > 0\n+      )\n+    })\n+\n     // 绑定表单数据\n     const bindForm = reactive({\n       cardNumber: '',\n       cardPassword: ''\n"
                },
                {
                    "date": 1752343014903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -321,22 +321,28 @@\n           total_points: 0,\n           cards_count: 0,\n           cards_breakdown: []\n         }\n+        userCards.value = []\n         loading.value = false\n         return\n       }\n \n       try {\n         loading.value = true\n-        const response = await pointsApi.getUserPoints()\n \n-        if (response.success) {\n-          pointsInfo.value = response.data\n+        // 并行加载积分信息和用户卡片信息\n+        const [pointsResponse, cardsResponse] = await Promise.all([\n+          pointsApi.getUserPoints(),\n+          levelCardApi.getMyCards()\n+        ])\n+\n+        if (pointsResponse.success) {\n+          pointsInfo.value = pointsResponse.data\n         } else {\n-          console.error('获取积分信息失败:', response.message)\n+          console.error('获取积分信息失败:', pointsResponse.message)\n           // 如果是认证错误，显示登录提示\n-          if (response.message && response.message.includes('令牌')) {\n+          if (pointsResponse.message && pointsResponse.message.includes('令牌')) {\n             Toast.fail('请先登录')\n             pointsInfo.value = {\n               total_points: 0,\n               cards_count: 0,\n@@ -345,8 +351,16 @@\n           } else {\n             Toast.fail('获取积分信息失败')\n           }\n         }\n+\n+        if (cardsResponse.success) {\n+          userCards.value = cardsResponse.data.cards || []\n+        } else {\n+          console.error('获取用户卡片信息失败:', cardsResponse.message)\n+          userCards.value = []\n+        }\n+\n       } catch (error) {\n         console.error('加载积分信息失败:', error)\n         // 如果是认证错误，显示登录提示\n         if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n@@ -358,8 +372,9 @@\n           }\n         } else {\n           Toast.fail('获取积分信息失败')\n         }\n+        userCards.value = []\n       } finally {\n         loading.value = false\n       }\n     }\n"
                },
                {
                    "date": 1752343038430,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -422,10 +422,16 @@\n             // 重新加载积分信息\n             await loadPointsInfo()\n \n             Toast.clear()\n-            Toast.success('积分更新成功')\n \n+            // 根据卡片类型显示不同的成功提示\n+            if (response.data.isExperienceCard) {\n+              Toast.success('体验卡绑定成功！请注意：体验卡使用完毕后才能绑定新的体验卡')\n+            } else {\n+              Toast.success('积分更新成功')\n+            }\n+\n             // 通知父组件积分已更新\n             emit('points-updated', response.data)\n           } catch (error) {\n             Toast.clear()\n"
                },
                {
                    "date": 1752343076414,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -482,8 +482,10 @@\n       cardNumberRules,\n       cardPasswordRules,\n       showPurchaseModal,\n       isLoggedIn,\n+      userCards,\n+      hasUnusedExperienceCard,\n       closeModal,\n       loadPointsInfo,\n       handleBindCard,\n       contactCustomerService\n"
                },
                {
                    "date": 1752343100638,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -641,8 +641,13 @@\n   color: #969799;\n   margin: 0 0 16px 0;\n }\n \n+/* 体验卡提示 */\n+.experience-card-notice {\n+  margin-bottom: 16px;\n+}\n+\n /* 等级卡明细 */\n .cards-section {\n   margin-bottom: 24px;\n }\n"
                },
                {
                    "date": 1752343150079,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,12 +115,17 @@\n                   native-type=\"submit\"\n                   block\n                   round\n                   :loading=\"bindLoading\"\n-                  :disabled=\"bindLoading\"\n+                  :disabled=\"bindLoading || hasUnusedExperienceCard\"\n                   class=\"bind-button\"\n+                  :class=\"{ 'disabled-by-experience-card': hasUnusedExperienceCard }\"\n                 >\n-                  {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n+                  {{\n+                    bindLoading ? '绑定中...' :\n+                    hasUnusedExperienceCard ? '请先使用完体验卡' :\n+                    '绑定等级卡'\n+                  }}\n                 </van-button>\n               </div>\n             </form>\n           </div>\n"
                },
                {
                    "date": 1752343164554,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -651,8 +651,16 @@\n .experience-card-notice {\n   margin-bottom: 16px;\n }\n \n+/* 体验卡禁用状态的按钮 */\n+.bind-button.disabled-by-experience-card {\n+  background-color: #f7f8fa !important;\n+  border-color: #f7f8fa !important;\n+  color: #c8c9cc !important;\n+  cursor: not-allowed;\n+}\n+\n /* 等级卡明细 */\n .cards-section {\n   margin-bottom: 24px;\n }\n"
                },
                {
                    "date": 1752343182646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -393,8 +393,14 @@\n         Toast.fail('请先登录')\n         return\n       }\n \n+      // 检查是否有未使用的体验卡\n+      if (hasUnusedExperienceCard.value) {\n+        Toast.fail('您已有可用的体验卡，请先使用完当前体验卡积分')\n+        return\n+      }\n+\n       // 验证表单\n       if (!bindForm.cardNumber.trim()) {\n         Toast.fail('请输入卡号')\n         return\n"
                },
                {
                    "date": 1752343248681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,17 +115,12 @@\n                   native-type=\"submit\"\n                   block\n                   round\n                   :loading=\"bindLoading\"\n-                  :disabled=\"bindLoading || hasUnusedExperienceCard\"\n+                  :disabled=\"bindLoading\"\n                   class=\"bind-button\"\n-                  :class=\"{ 'disabled-by-experience-card': hasUnusedExperienceCard }\"\n                 >\n-                  {{\n-                    bindLoading ? '绑定中...' :\n-                    hasUnusedExperienceCard ? '请先使用完体验卡' :\n-                    '绑定等级卡'\n-                  }}\n+                  {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n                 </van-button>\n               </div>\n             </form>\n           </div>\n"
                },
                {
                    "date": 1752343262680,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -388,14 +388,8 @@\n         Toast.fail('请先登录')\n         return\n       }\n \n-      // 检查是否有未使用的体验卡\n-      if (hasUnusedExperienceCard.value) {\n-        Toast.fail('您已有可用的体验卡，请先使用完当前体验卡积分')\n-        return\n-      }\n-\n       // 验证表单\n       if (!bindForm.cardNumber.trim()) {\n         Toast.fail('请输入卡号')\n         return\n"
                },
                {
                    "date": 1752343278093,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,12 +83,12 @@\n \n             <!-- 体验卡提示 -->\n             <div v-if=\"hasUnusedExperienceCard\" class=\"experience-card-notice\">\n               <van-notice-bar\n-                left-icon=\"warning-o\"\n-                color=\"#ff6b35\"\n-                background=\"#fff7f0\"\n-                text=\"您已有可用的体验卡，请先使用完当前体验卡积分后再绑定新的体验卡\"\n+                left-icon=\"info-o\"\n+                color=\"#1989fa\"\n+                background=\"#f0f8ff\"\n+                text=\"提示：您已有可用的体验卡，体验卡不可叠加，请先使用完当前体验卡积分后再绑定新的体验卡。其他等级卡可正常叠加。\"\n               />\n             </div>\n \n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n"
                },
                {
                    "date": 1752343291719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -646,16 +646,8 @@\n .experience-card-notice {\n   margin-bottom: 16px;\n }\n \n-/* 体验卡禁用状态的按钮 */\n-.bind-button.disabled-by-experience-card {\n-  background-color: #f7f8fa !important;\n-  border-color: #f7f8fa !important;\n-  color: #c8c9cc !important;\n-  cursor: not-allowed;\n-}\n-\n /* 等级卡明细 */\n .cards-section {\n   margin-bottom: 24px;\n }\n"
                },
                {
                    "date": 1752343308482,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -445,8 +445,11 @@\n           console.error('绑定失败:', response.message)\n           // 如果是认证错误，显示登录提示\n           if (response.message && response.message.includes('令牌')) {\n             Toast.fail('请先登录')\n+          } else if (response.message && response.message.includes('体验卡')) {\n+            // 体验卡相关错误，显示详细提示\n+            Toast.fail(response.message)\n           } else {\n             Toast.fail(response.message || '绑定失败')\n           }\n         }\n"
                },
                {
                    "date": 1752343322691,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -422,16 +422,10 @@\n             // 重新加载积分信息\n             await loadPointsInfo()\n \n             Toast.clear()\n+            Toast.success('等级卡绑定成功，积分已更新')\n \n-            // 根据卡片类型显示不同的成功提示\n-            if (response.data.isExperienceCard) {\n-              Toast.success('体验卡绑定成功！请注意：体验卡使用完毕后才能绑定新的体验卡')\n-            } else {\n-              Toast.success('积分更新成功')\n-            }\n-\n             // 通知父组件积分已更新\n             emit('points-updated', response.data)\n           } catch (error) {\n             Toast.clear()\n"
                },
                {
                    "date": 1752344289239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,18 +80,10 @@\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">绑定等级卡</h3>\n             <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n-            <!-- 体验卡提示 -->\n-            <div v-if=\"hasUnusedExperienceCard\" class=\"experience-card-notice\">\n-              <van-notice-bar\n-                left-icon=\"info-o\"\n-                color=\"#1989fa\"\n-                background=\"#f0f8ff\"\n-                text=\"提示：您已有可用的体验卡，体验卡不可叠加，请先使用完当前体验卡积分后再绑定新的体验卡。其他等级卡可正常叠加。\"\n-              />\n-            </div>\n \n+\n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n               <BaseInput\n                 v-model=\"bindForm.cardNumber\"\n                 label=\"卡号\"\n"
                },
                {
                    "date": 1752344301225,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,15 +257,10 @@\n \n     // 计算登录状态\n     const isLoggedIn = computed(() => authApi.isLoggedIn())\n \n-    // 检查是否有未使用的体验卡\n-    const hasUnusedExperienceCard = computed(() => {\n-      return userCards.value.some(card =>\n-        card.type_name === '体验卡' && card.remaining_points > 0\n-      )\n-    })\n \n+\n     // 绑定表单数据\n     const bindForm = reactive({\n       cardNumber: '',\n       cardPassword: ''\n"
                },
                {
                    "date": 1752344312735,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -467,9 +467,8 @@\n       cardPasswordRules,\n       showPurchaseModal,\n       isLoggedIn,\n       userCards,\n-      hasUnusedExperienceCard,\n       closeModal,\n       loadPointsInfo,\n       handleBindCard,\n       contactCustomerService\n"
                },
                {
                    "date": 1752344323189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -624,13 +624,10 @@\n   color: #969799;\n   margin: 0 0 16px 0;\n }\n \n-/* 体验卡提示 */\n-.experience-card-notice {\n-  margin-bottom: 16px;\n-}\n \n+\n /* 等级卡明细 */\n .cards-section {\n   margin-bottom: 24px;\n }\n"
                },
                {
                    "date": 1752344964503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,8 +257,14 @@\n \n     // 计算登录状态\n     const isLoggedIn = computed(() => authApi.isLoggedIn())\n \n+    // 检查是否有未使用的体验卡\n+    const hasUnusedExperienceCard = computed(() => {\n+      return userCards.value.some(card =>\n+        card.type_name === '体验卡' && card.remaining_points > 0\n+      )\n+    })\n \n \n     // 绑定表单数据\n     const bindForm = reactive({\n"
                },
                {
                    "date": 1752344993535,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,8 +80,17 @@\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">绑定等级卡</h3>\n             <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n \n+            <!-- 体验卡限制提示 -->\n+            <div v-if=\"hasUnusedExperienceCard\" class=\"experience-card-notice\">\n+              <van-notice-bar\n+                left-icon=\"info-o\"\n+                color=\"#ff6b35\"\n+                background=\"#fff7f0\"\n+                text=\"提示：您已有可用的体验卡，体验卡在使用前不可叠加绑定。其他等级卡可正常叠加。\"\n+              />\n+            </div>\n \n \n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n               <BaseInput\n"
                },
                {
                    "date": 1752345005386,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -482,8 +482,9 @@\n       cardPasswordRules,\n       showPurchaseModal,\n       isLoggedIn,\n       userCards,\n+      hasUnusedExperienceCard,\n       closeModal,\n       loadPointsInfo,\n       handleBindCard,\n       contactCustomerService\n"
                },
                {
                    "date": 1752345028497,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -640,10 +640,13 @@\n   color: #969799;\n   margin: 0 0 16px 0;\n }\n \n+/* 体验卡提示 */\n+.experience-card-notice {\n+  margin-bottom: 16px;\n+}\n \n-\n /* 等级卡明细 */\n .cards-section {\n   margin-bottom: 24px;\n }\n"
                },
                {
                    "date": 1752345545551,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -453,8 +453,11 @@\n         console.error('绑定等级卡失败:', error)\n         // 如果是认证错误，显示登录提示\n         if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n           Toast.fail('请先登录')\n+        } else if (error.message && error.message.includes('体验卡')) {\n+          // 体验卡相关错误，显示详细提示\n+          Toast.fail(error.message)\n         } else {\n           Toast.fail(error.message || '绑定失败')\n         }\n       } finally {\n"
                },
                {
                    "date": 1752345585244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -455,9 +455,11 @@\n         if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n           Toast.fail('请先登录')\n         } else if (error.message && error.message.includes('体验卡')) {\n           // 体验卡相关错误，显示详细提示\n-          Toast.fail(error.message)\n+          // 提取原始错误消息（去掉\"请求失败: \"前缀）\n+          const originalMessage = error.message.replace(/^请求失败:\\s*/, '')\n+          Toast.fail(originalMessage)\n         } else {\n           Toast.fail(error.message || '绑定失败')\n         }\n       } finally {\n"
                },
                {
                    "date": 1752345897835,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -364,15 +364,17 @@\n \n       } catch (error) {\n         console.error('加载积分信息失败:', error)\n         // 如果是认证错误，显示登录提示\n-        if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n-          Toast.fail('请先登录')\n+        if (error.message && (error.message.includes('令牌') || error.message.includes('401') || error.message.includes('登录已过期'))) {\n+          Toast.fail('登录已过期，请重新登录')\n           pointsInfo.value = {\n             total_points: 0,\n             cards_count: 0,\n             cards_breakdown: []\n           }\n+        } else if (error.message && error.message.includes('网络连接失败')) {\n+          Toast.fail('网络连接失败，请检查服务器状态')\n         } else {\n           Toast.fail('获取积分信息失败')\n         }\n         userCards.value = []\n"
                },
                {
                    "date": 1752345915994,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -453,15 +453,17 @@\n         }\n       } catch (error) {\n         console.error('绑定等级卡失败:', error)\n         // 如果是认证错误，显示登录提示\n-        if (error.message && (error.message.includes('令牌') || error.message.includes('401'))) {\n-          Toast.fail('请先登录')\n+        if (error.message && (error.message.includes('令牌') || error.message.includes('401') || error.message.includes('登录已过期'))) {\n+          Toast.fail('登录已过期，请重新登录')\n         } else if (error.message && error.message.includes('体验卡')) {\n           // 体验卡相关错误，显示详细提示\n           // 提取原始错误消息（去掉\"请求失败: \"前缀）\n           const originalMessage = error.message.replace(/^请求失败:\\s*/, '')\n           Toast.fail(originalMessage)\n+        } else if (error.message && error.message.includes('网络连接失败')) {\n+          Toast.fail('网络连接失败，请检查服务器状态')\n         } else {\n           Toast.fail(error.message || '绑定失败')\n         }\n       } finally {\n"
                },
                {
                    "date": 1752346393824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -403,8 +403,27 @@\n         Toast.fail('请输入卡密')\n         return\n       }\n \n+      // 预检查：如果用户已有未使用的体验卡，需要先验证卡片类型\n+      if (hasUnusedExperienceCard.value) {\n+        // 先尝试获取卡片类型信息来判断是否为体验卡\n+        try {\n+          // 这里我们无法直接知道卡片类型，所以让服务端来处理\n+          // 但我们可以给用户一个明确的警告\n+          const confirmed = await new Promise((resolve) => {\n+            Toast({\n+              type: 'loading',\n+              message: '检查卡片类型中...',\n+              duration: 1000,\n+              onClose: () => resolve(true)\n+            })\n+          })\n+        } catch (error) {\n+          // 继续执行绑定逻辑\n+        }\n+      }\n+\n       bindLoading.value = true\n \n       try {\n         const response = await levelCardApi.bindCard(\n"
                },
                {
                    "date": 1752346410512,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -403,27 +403,8 @@\n         Toast.fail('请输入卡密')\n         return\n       }\n \n-      // 预检查：如果用户已有未使用的体验卡，需要先验证卡片类型\n-      if (hasUnusedExperienceCard.value) {\n-        // 先尝试获取卡片类型信息来判断是否为体验卡\n-        try {\n-          // 这里我们无法直接知道卡片类型，所以让服务端来处理\n-          // 但我们可以给用户一个明确的警告\n-          const confirmed = await new Promise((resolve) => {\n-            Toast({\n-              type: 'loading',\n-              message: '检查卡片类型中...',\n-              duration: 1000,\n-              onClose: () => resolve(true)\n-            })\n-          })\n-        } catch (error) {\n-          // 继续执行绑定逻辑\n-        }\n-      }\n-\n       bindLoading.value = true\n \n       try {\n         const response = await levelCardApi.bindCard(\n"
                },
                {
                    "date": 1752346435884,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -459,9 +459,13 @@\n         } else if (error.message && error.message.includes('体验卡')) {\n           // 体验卡相关错误，显示详细提示\n           // 提取原始错误消息（去掉\"请求失败: \"前缀）\n           const originalMessage = error.message.replace(/^请求失败:\\s*/, '')\n-          Toast.fail(originalMessage)\n+          Toast({\n+            type: 'fail',\n+            message: originalMessage,\n+            duration: 4000 // 显示更长时间\n+          })\n         } else if (error.message && error.message.includes('网络连接失败')) {\n           Toast.fail('网络连接失败，请检查服务器状态')\n         } else {\n           Toast.fail(error.message || '绑定失败')\n"
                },
                {
                    "date": 1752346452682,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -406,13 +406,21 @@\n \n       bindLoading.value = true\n \n       try {\n+        console.log('🎫 尝试绑定等级卡:', {\n+          cardNumber: bindForm.cardNumber.trim(),\n+          hasUnusedExperienceCard: hasUnusedExperienceCard.value,\n+          userCards: userCards.value\n+        })\n+\n         const response = await levelCardApi.bindCard(\n           bindForm.cardNumber.trim(),\n           bindForm.cardPassword.trim()\n         )\n \n+        console.log('🎫 绑定响应:', response)\n+\n         if (response.success) {\n           Toast.success(response.message || '绑定成功，正在更新积分...')\n \n           // 显示积分更新中的提示\n"
                },
                {
                    "date": 1752346465795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -459,9 +459,14 @@\n             Toast.fail(response.message || '绑定失败')\n           }\n         }\n       } catch (error) {\n-        console.error('绑定等级卡失败:', error)\n+        console.error('🎫 绑定等级卡失败:', error)\n+        console.error('🎫 错误详情:', {\n+          message: error.message,\n+          hasUnusedExperienceCard: hasUnusedExperienceCard.value,\n+          userCards: userCards.value\n+        })\n         // 如果是认证错误，显示登录提示\n         if (error.message && (error.message.includes('令牌') || error.message.includes('401') || error.message.includes('登录已过期'))) {\n           Toast.fail('登录已过期，请重新登录')\n         } else if (error.message && error.message.includes('体验卡')) {\n"
                },
                {
                    "date": 1752349179490,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     <div class=\"points-modal\">\n       <!-- 头部 -->\n       <div class=\"modal-header\">\n         <h2 class=\"modal-title\">\n-          <van-icon name=\"gold-coin-o\" size=\"24\" />\n+          <van-icon name=\"diamond-o\" size=\"24\" />\n           我的积分\n         </h2>\n         <van-icon\n           name=\"cross\"\n"
                },
                {
                    "date": 1752389682678,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,14 +50,8 @@\n             <div class=\"points-total\">\n               <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n               <div class=\"points-label\">总积分</div>\n             </div>\n-            <div class=\"points-stats\">\n-              <div class=\"stat-item\">\n-                <span class=\"stat-value\">{{ pointsInfo?.cards_count || 0 }}</span>\n-                <span class=\"stat-label\">等级卡</span>\n-              </div>\n-            </div>\n           </div>\n \n         <!-- 等级卡明细 - 移除显示 -->\n         <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n"
                },
                {
                    "date": 1752389723898,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -515,12 +515,15 @@\n \n <style scoped>\n .points-modal {\n   padding: 0;\n-  background: white;\n+  background: rgba(10, 10, 20, 0.95);\n+  backdrop-filter: blur(20px);\n+  -webkit-backdrop-filter: blur(20px);\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 16px;\n-  max-height: 80vh;\n-  overflow-y: auto;\n+  max-height: 70vh;\n+  overflow: hidden;\n }\n \n .modal-header {\n   display: flex;\n"
                },
                {
                    "date": 1752389743707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -528,34 +528,32 @@\n .modal-header {\n   display: flex;\n   justify-content: space-between;\n   align-items: center;\n-  padding: 20px 24px;\n-  border-bottom: 1px solid #ebedf0;\n-  position: sticky;\n-  top: 0;\n-  background: white;\n-  z-index: 10;\n+  padding: 16px 20px;\n+  border-bottom: 1px solid rgba(30, 30, 60, 0.5);\n+  background: rgba(15, 15, 30, 0.8);\n+  backdrop-filter: blur(10px);\n }\n \n .modal-title {\n   display: flex;\n   align-items: center;\n   gap: 8px;\n-  font-size: 18px;\n+  font-size: 16px;\n   font-weight: 600;\n-  color: #323233;\n+  color: var(--van-text-color, #f7f8fa);\n   margin: 0;\n }\n \n .close-btn {\n-  color: #969799;\n+  color: var(--van-text-color-2, #969799);\n   cursor: pointer;\n   transition: color 0.3s;\n }\n \n .close-btn:hover {\n-  color: #323233;\n+  color: var(--van-text-color, #f7f8fa);\n }\n \n .loading-center {\n   display: flex;\n"
                },
                {
                    "date": 1752389757372,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -562,9 +562,11 @@\n   height: 200px;\n }\n \n .modal-content {\n-  padding: 24px;\n+  padding: 16px 20px;\n+  max-height: calc(70vh - 60px);\n+  overflow-y: auto;\n }\n \n /* 登录提示 */\n .login-prompt {\n"
                },
                {
                    "date": 1752389772755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -828,12 +828,15 @@\n \n /* 购买弹窗样式 */\n .purchase-modal {\n   padding: 0;\n-  background: white;\n+  background: rgba(10, 10, 20, 0.95);\n+  backdrop-filter: blur(20px);\n+  -webkit-backdrop-filter: blur(20px);\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 16px;\n-  max-height: 80vh;\n-  overflow-y: auto;\n+  max-height: 70vh;\n+  overflow: hidden;\n }\n \n /* 等级卡类型网格（三列横排） */\n .card-types-grid {\n"
                },
                {
                    "date": 1752389796279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -837,28 +837,30 @@\n   max-height: 70vh;\n   overflow: hidden;\n }\n \n-/* 等级卡类型网格（三列横排） */\n+/* 等级卡类型网格（三列横排，固定布局） */\n .card-types-grid {\n-  display: grid;\n-  grid-template-columns: repeat(3, 1fr);\n+  display: flex;\n   gap: 12px;\n-  margin-bottom: 24px;\n+  margin-bottom: 16px;\n+  min-width: 360px;\n }\n \n .card-type-card {\n-  padding: 16px 8px;\n-  background: #f7f8fa;\n+  flex: 1;\n+  padding: 12px 8px;\n+  background: rgba(15, 15, 30, 0.6);\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 12px;\n   text-align: center;\n-  border: 2px solid transparent;\n   transition: all 0.3s;\n+  min-width: 100px;\n }\n \n .card-type-card:hover {\n-  border-color: #1989fa;\n-  background: #e3f2fd;\n+  border-color: var(--van-primary-color, #1989fa);\n+  background: rgba(25, 137, 250, 0.1);\n }\n \n .card-icon {\n   font-size: 32px;\n"
                },
                {
                    "date": 1752389811450,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -869,9 +869,9 @@\n \n .card-name {\n   font-size: 14px;\n   font-weight: 600;\n-  color: #323233;\n+  color: var(--van-text-color, #f7f8fa);\n   margin-bottom: 4px;\n }\n \n .card-price {\n@@ -882,9 +882,9 @@\n }\n \n .card-points {\n   font-size: 12px;\n-  color: #969799;\n+  color: var(--van-text-color-2, #969799);\n }\n \n /* 兑换流程 */\n .exchange-process {\n"
                },
                {
                    "date": 1752389849388,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -603,14 +603,15 @@\n /* 积分概览 */\n .points-overview {\n   display: flex;\n   align-items: center;\n-  justify-content: space-between;\n-  padding: 24px;\n-  background: linear-gradient(135deg, #1989fa, #1976d2);\n-  border-radius: 16px;\n-  color: white;\n-  margin-bottom: 24px;\n+  justify-content: center;\n+  padding: 20px;\n+  background: rgba(15, 15, 30, 0.8);\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n+  border-radius: 12px;\n+  color: var(--van-text-color, #f7f8fa);\n+  margin-bottom: 16px;\n }\n \n .points-total {\n   text-align: center;\n"
                },
                {
                    "date": 1752389865207,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -141,9 +141,9 @@\n   <!-- 购买等级卡弹窗 -->\n   <van-popup\n     v-model:show=\"showPurchaseModal\"\n     position=\"center\"\n-    :style=\"{ width: '90%', maxWidth: '500px', borderRadius: '16px' }\"\n+    :style=\"{ width: '95%', maxWidth: '450px', borderRadius: '16px' }\"\n     :close-on-click-overlay=\"false\"\n   >\n     <div class=\"purchase-modal\">\n       <!-- 头部 -->\n"
                },
                {
                    "date": 1752389881316,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <template>\n   <van-popup\n     v-model:show=\"visible\"\n     position=\"center\"\n-    :style=\"{ width: '90%', maxWidth: '500px', borderRadius: '16px' }\"\n+    :style=\"{ width: '90%', maxWidth: '400px', borderRadius: '16px' }\"\n     :close-on-click-overlay=\"false\"\n   >\n     <div class=\"points-modal\">\n       <!-- 头部 -->\n"
                },
                {
                    "date": 1752390346351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,53 +71,53 @@\n         </div> -->\n \n           <!-- 绑定等级卡 -->\n           <div class=\"bind-section\">\n-            <h3 class=\"section-title\">绑定等级卡</h3>\n-            <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n+            <h3 class=\"section-title\">\n+              <van-icon name=\"credit-pay\" size=\"16\" />\n+              绑定等级卡\n+            </h3>\n \n             <!-- 体验卡限制提示 -->\n             <div v-if=\"hasUnusedExperienceCard\" class=\"experience-card-notice\">\n               <van-notice-bar\n                 left-icon=\"info-o\"\n                 color=\"#ff6b35\"\n-                background=\"#fff7f0\"\n-                text=\"提示：您已有可用的体验卡，体验卡在使用前不可叠加绑定。其他等级卡可正常叠加。\"\n+                background=\"rgba(255, 107, 53, 0.1)\"\n+                text=\"提示：您已有可用的体验卡，体验卡在使用前不可叠加绑定。\"\n               />\n             </div>\n \n-\n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n-              <BaseInput\n-                v-model=\"bindForm.cardNumber\"\n-                label=\"卡号\"\n-                placeholder=\"请输入等级卡卡号\"\n-                :rules=\"cardNumberRules\"\n-                clearable\n-              />\n+              <div class=\"bind-inputs\">\n+                <BaseInput\n+                  v-model=\"bindForm.cardNumber\"\n+                  placeholder=\"卡号\"\n+                  :rules=\"cardNumberRules\"\n+                  clearable\n+                  class=\"bind-input\"\n+                />\n \n-              <BaseInput\n-                v-model=\"bindForm.cardPassword\"\n-                type=\"password\"\n-                label=\"卡密\"\n-                placeholder=\"请输入等级卡卡密\"\n-                :rules=\"cardPasswordRules\"\n-                clearable\n-              />\n+                <BaseInput\n+                  v-model=\"bindForm.cardPassword\"\n+                  type=\"password\"\n+                  placeholder=\"卡密\"\n+                  :rules=\"cardPasswordRules\"\n+                  clearable\n+                  class=\"bind-input\"\n+                />\n+              </div>\n \n-              <div class=\"bind-actions\">\n-                <van-button\n-                  type=\"primary\"\n-                  native-type=\"submit\"\n-                  block\n-                  round\n-                  :loading=\"bindLoading\"\n-                  :disabled=\"bindLoading\"\n-                  class=\"bind-button\"\n-                >\n-                  {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n-                </van-button>\n-              </div>\n+              <van-button\n+                type=\"primary\"\n+                native-type=\"submit\"\n+                round\n+                :loading=\"bindLoading\"\n+                :disabled=\"bindLoading\"\n+                class=\"bind-button\"\n+              >\n+                {{ bindLoading ? '绑定中...' : '绑定' }}\n+              </van-button>\n             </form>\n           </div>\n \n           <!-- 购买等级卡按钮 -->\n"
                },
                {
                    "date": 1752390362810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -123,14 +123,13 @@\n           <!-- 购买等级卡按钮 -->\n           <div class=\"purchase-section\">\n             <van-button\n               type=\"primary\"\n-              block\n               round\n               @click=\"showPurchaseModal = true\"\n               class=\"purchase-btn\"\n             >\n-              <van-icon name=\"shopping-cart-o\" size=\"16\" />\n+              <van-icon name=\"shopping-cart-o\" size=\"14\" />\n               购买等级卡\n             </van-button>\n           </div>\n         </template>\n"
                },
                {
                    "date": 1752390402833,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -184,43 +184,42 @@\n         </div>\n \n         <!-- 兑换流程 -->\n         <div class=\"exchange-process\">\n-          <h3 class=\"process-title\">兑换流程</h3>\n+          <h4 class=\"process-title\">兑换流程</h4>\n           <div class=\"process-steps\">\n             <div class=\"process-step\">\n               <div class=\"step-number\">1</div>\n               <div class=\"step-text\">加客服</div>\n             </div>\n             <div class=\"process-arrow\">→</div>\n             <div class=\"process-step\">\n               <div class=\"step-number\">2</div>\n-              <div class=\"step-text\">发口令红包</div>\n+              <div class=\"step-text\">发红包</div>\n             </div>\n             <div class=\"process-arrow\">→</div>\n             <div class=\"process-step\">\n               <div class=\"step-number\">3</div>\n-              <div class=\"step-text\">收到卡号</div>\n+              <div class=\"step-text\">收卡号</div>\n             </div>\n             <div class=\"process-arrow\">→</div>\n             <div class=\"process-step\">\n               <div class=\"step-number\">4</div>\n-              <div class=\"step-text\">绑定获得等级卡</div>\n+              <div class=\"step-text\">绑定</div>\n             </div>\n           </div>\n         </div>\n \n         <!-- 联系客服按钮 -->\n         <div class=\"contact-section\">\n           <van-button\n             type=\"primary\"\n-            block\n             round\n             @click=\"contactCustomerService\"\n             class=\"contact-btn\"\n           >\n-            <van-icon name=\"chat-o\" size=\"16\" />\n-            联系客服 (Telegram: tgcomfy)\n+            <van-icon name=\"chat-o\" size=\"14\" />\n+            联系客服\n           </van-button>\n         </div>\n       </div>\n     </div>\n"
                },
                {
                    "date": 1752390430697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -704,21 +704,30 @@\n }\n \n /* 绑定区块 */\n .bind-section {\n-  margin-bottom: 24px;\n-  padding: 24px;\n-  background: linear-gradient(135deg, #f7f8fa 0%, #ffffff 100%);\n-  border-radius: 16px;\n-  border: 1px solid #ebedf0;\n-  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n+  margin-bottom: 16px;\n+  padding: 16px;\n+  background: rgba(15, 15, 30, 0.6);\n+  border-radius: 12px;\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n }\n \n /* 绑定表单 */\n .bind-form {\n-  margin-top: 20px;\n+  margin-top: 12px;\n }\n \n+.bind-inputs {\n+  display: flex;\n+  gap: 8px;\n+  margin-bottom: 12px;\n+}\n+\n+.bind-input {\n+  flex: 1;\n+}\n+\n .form-field {\n   margin-bottom: 16px;\n }\n \n"
                },
                {
                    "date": 1752390454407,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -650,18 +650,21 @@\n }\n \n /* 区块标题 */\n .section-title {\n-  font-size: 16px;\n+  display: flex;\n+  align-items: center;\n+  gap: 6px;\n+  font-size: 14px;\n   font-weight: 600;\n-  color: #323233;\n-  margin: 0 0 16px 0;\n+  color: var(--van-text-color, #f7f8fa);\n+  margin: 0 0 12px 0;\n }\n \n .section-desc {\n-  font-size: 14px;\n-  color: #969799;\n-  margin: 0 0 16px 0;\n+  font-size: 12px;\n+  color: var(--van-text-color-2, #969799);\n+  margin: 0 0 12px 0;\n }\n \n /* 体验卡提示 */\n .experience-card-notice {\n"
                },
                {
                    "date": 1752390485728,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -798,46 +798,33 @@\n   margin-top: 24px;\n }\n \n .bind-button {\n-  height: 48px;\n-  font-size: 16px;\n+  height: 36px;\n+  font-size: 14px;\n   font-weight: 600;\n   background: linear-gradient(135deg, #1989fa, #1976d2);\n   border: none;\n-  box-shadow: 0 4px 12px rgba(25, 137, 250, 0.3);\n-  transition: all 0.3s ease;\n+  min-width: 80px;\n }\n \n-.bind-button:hover {\n-  background: linear-gradient(135deg, #1976d2, #1565c0);\n-  box-shadow: 0 6px 16px rgba(25, 137, 250, 0.4);\n-  transform: translateY(-1px);\n-}\n-\n-.bind-button:active {\n-  transform: translateY(0);\n-  box-shadow: 0 2px 8px rgba(25, 137, 250, 0.3);\n-}\n-\n /* 购买区块 */\n .purchase-section {\n-  margin-top: 24px;\n-  padding-top: 24px;\n-  border-top: 1px solid #ebedf0;\n+  margin-top: 16px;\n+  padding-top: 16px;\n+  border-top: 1px solid rgba(30, 30, 60, 0.5);\n+  text-align: center;\n }\n \n .purchase-btn {\n   background: linear-gradient(135deg, #ff6b6b, #ee5a24);\n   border: none;\n   font-weight: 600;\n-  height: 48px;\n+  height: 36px;\n+  font-size: 14px;\n+  min-width: 120px;\n }\n \n-.purchase-btn:hover {\n-  background: linear-gradient(135deg, #ee5a24, #ff6b6b);\n-}\n-\n /* 购买弹窗样式 */\n .purchase-modal {\n   padding: 0;\n   background: rgba(10, 10, 20, 0.95);\n"
                },
                {
                    "date": 1752390525148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -885,63 +885,63 @@\n }\n \n /* 兑换流程 */\n .exchange-process {\n-  margin-bottom: 24px;\n-  padding: 20px;\n-  background: #f7f8fa;\n+  margin-bottom: 16px;\n+  padding: 12px;\n+  background: rgba(15, 15, 30, 0.6);\n+  border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 12px;\n }\n \n .process-title {\n-  font-size: 16px;\n+  font-size: 14px;\n   font-weight: 600;\n-  color: #323233;\n-  margin: 0 0 16px 0;\n+  color: var(--van-text-color, #f7f8fa);\n+  margin: 0 0 12px 0;\n   text-align: center;\n }\n \n .process-steps {\n   display: flex;\n   align-items: center;\n   justify-content: center;\n-  flex-wrap: wrap;\n-  gap: 8px;\n+  gap: 6px;\n }\n \n .process-step {\n   display: flex;\n   flex-direction: column;\n   align-items: center;\n-  min-width: 60px;\n+  min-width: 50px;\n }\n \n .step-number {\n-  width: 24px;\n-  height: 24px;\n+  width: 20px;\n+  height: 20px;\n   background: #1989fa;\n   color: white;\n   border-radius: 50%;\n   display: flex;\n   align-items: center;\n   justify-content: center;\n-  font-size: 12px;\n+  font-size: 10px;\n   font-weight: 600;\n-  margin-bottom: 4px;\n+  margin-bottom: 3px;\n }\n \n .step-text {\n-  font-size: 11px;\n-  color: #323233;\n+  font-size: 10px;\n+  color: var(--van-text-color, #f7f8fa);\n   text-align: center;\n   line-height: 1.2;\n }\n \n .process-arrow {\n   color: #1989fa;\n-  font-size: 16px;\n+  font-size: 14px;\n   font-weight: 600;\n-  margin: 0 4px;\n+  margin: 0 2px;\n }\n \n /* 联系客服 */\n .contact-section {\n"
                },
                {
                    "date": 1752390538764,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -944,16 +944,19 @@\n }\n \n /* 联系客服 */\n .contact-section {\n-  margin-top: 24px;\n+  margin-top: 16px;\n+  text-align: center;\n }\n \n .contact-btn {\n   background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n   border: none;\n   font-weight: 600;\n-  height: 48px;\n+  height: 36px;\n+  font-size: 14px;\n+  min-width: 120px;\n }\n \n .contact-btn:hover {\n   background: linear-gradient(135deg, #3a7bd5, #00d2ff);\n"
                },
                {
                    "date": 1752390551000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -560,10 +560,10 @@\n   height: 200px;\n }\n \n .modal-content {\n-  padding: 16px 20px;\n-  max-height: calc(70vh - 60px);\n+  padding: 12px 16px;\n+  max-height: calc(70vh - 50px);\n   overflow-y: auto;\n }\n \n /* 登录提示 */\n"
                },
                {
                    "date": 1752391102293,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,8 +52,21 @@\n               <div class=\"points-label\">总积分</div>\n             </div>\n           </div>\n \n+          <!-- 购买等级卡按钮 -->\n+          <div class=\"purchase-section\">\n+            <van-button\n+              type=\"primary\"\n+              round\n+              @click=\"showPurchaseModal = true\"\n+              class=\"purchase-btn\"\n+            >\n+              <van-icon name=\"shopping-cart-o\" size=\"14\" />\n+              购买等级卡\n+            </van-button>\n+          </div>\n+\n         <!-- 等级卡明细 - 移除显示 -->\n         <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n           <h3 class=\"section-title\">我的等级卡</h3>\n           <div class=\"cards-list\">\n"
                },
                {
                    "date": 1752391124331,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,26 +100,24 @@\n               />\n             </div>\n \n             <form @submit.prevent=\"handleBindCard\" class=\"bind-form\">\n-              <div class=\"bind-inputs\">\n-                <BaseInput\n-                  v-model=\"bindForm.cardNumber\"\n-                  placeholder=\"卡号\"\n-                  :rules=\"cardNumberRules\"\n-                  clearable\n-                  class=\"bind-input\"\n-                />\n+              <BaseInput\n+                v-model=\"bindForm.cardNumber\"\n+                placeholder=\"请输入卡号\"\n+                :rules=\"cardNumberRules\"\n+                clearable\n+                class=\"bind-input-full\"\n+              />\n \n-                <BaseInput\n-                  v-model=\"bindForm.cardPassword\"\n-                  type=\"password\"\n-                  placeholder=\"卡密\"\n-                  :rules=\"cardPasswordRules\"\n-                  clearable\n-                  class=\"bind-input\"\n-                />\n-              </div>\n+              <BaseInput\n+                v-model=\"bindForm.cardPassword\"\n+                type=\"password\"\n+                placeholder=\"请输入卡密\"\n+                :rules=\"cardPasswordRules\"\n+                clearable\n+                class=\"bind-input-full\"\n+              />\n \n               <van-button\n                 type=\"primary\"\n                 native-type=\"submit\"\n"
                },
                {
                    "date": 1752391140975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,20 +130,9 @@\n               </van-button>\n             </form>\n           </div>\n \n-          <!-- 购买等级卡按钮 -->\n-          <div class=\"purchase-section\">\n-            <van-button\n-              type=\"primary\"\n-              round\n-              @click=\"showPurchaseModal = true\"\n-              class=\"purchase-btn\"\n-            >\n-              <van-icon name=\"shopping-cart-o\" size=\"14\" />\n-              购买等级卡\n-            </van-button>\n-          </div>\n+\n         </template>\n       </div>\n     </div>\n   </van-popup>\n"
                },
                {
                    "date": 1752391160297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -904,9 +904,12 @@\n .process-steps {\n   display: flex;\n   align-items: center;\n   justify-content: center;\n-  gap: 6px;\n+  gap: 4px;\n+  flex-wrap: nowrap;\n+  overflow-x: auto;\n+  min-width: 0;\n }\n \n .process-step {\n   display: flex;\n"
                },
                {
                    "date": 1752391185021,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -914,9 +914,10 @@\n .process-step {\n   display: flex;\n   flex-direction: column;\n   align-items: center;\n-  min-width: 50px;\n+  min-width: 45px;\n+  flex-shrink: 0;\n }\n \n .step-number {\n   width: 20px;\n"
                },
                {
                    "date": 1752391201042,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -719,18 +719,13 @@\n .bind-form {\n   margin-top: 12px;\n }\n \n-.bind-inputs {\n-  display: flex;\n-  gap: 8px;\n+.bind-input-full {\n+  width: 100%;\n   margin-bottom: 12px;\n }\n \n-.bind-input {\n-  flex: 1;\n-}\n-\n .form-field {\n   margin-bottom: 16px;\n }\n \n"
                },
                {
                    "date": 1752391218167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -803,11 +803,9 @@\n }\n \n /* 购买区块 */\n .purchase-section {\n-  margin-top: 16px;\n-  padding-top: 16px;\n-  border-top: 1px solid rgba(30, 30, 60, 0.5);\n+  margin: 12px 0;\n   text-align: center;\n }\n \n .purchase-btn {\n"
                },
                {
                    "date": 1752391243153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -878,10 +878,10 @@\n }\n \n /* 兑换流程 */\n .exchange-process {\n-  margin-bottom: 16px;\n-  padding: 12px;\n+  margin-bottom: 12px;\n+  padding: 10px;\n   background: rgba(15, 15, 30, 0.6);\n   border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 12px;\n }\n"
                },
                {
                    "date": 1752391270074,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -889,9 +889,9 @@\n .process-title {\n   font-size: 14px;\n   font-weight: 600;\n   color: var(--van-text-color, #f7f8fa);\n-  margin: 0 0 12px 0;\n+  margin: 0 0 8px 0;\n   text-align: center;\n }\n \n .process-steps {\n"
                },
                {
                    "date": 1752391410581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -984,18 +984,18 @@\n   .card-icon {\n     font-size: 28px;\n   }\n \n-  /* 移动端流程步骤调整 */\n-  .process-steps {\n+  /* 删除以下移动端流程步骤调整，保持横向布局 */\n+  /* .process-steps {\n     flex-direction: column;\n     gap: 12px;\n   }\n \n   .process-arrow {\n     transform: rotate(90deg);\n     margin: 4px 0;\n-  }\n+  } */\n \n   .step-text {\n     font-size: 12px;\n   }\n@@ -1042,4 +1042,5 @@\n     color: #8e8e93;\n   }\n }\n </style>\n+\n"
                },
                {
                    "date": 1752391454369,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -899,10 +899,11 @@\n   align-items: center;\n   justify-content: center;\n   gap: 4px;\n   flex-wrap: nowrap;\n-  overflow-x: auto;\n+  overflow-x: hidden; /* 改为 hidden 以隐藏滚动条 */\n   min-width: 0;\n+  padding: 5px 0; /* 添加一些内边距 */\n }\n \n .process-step {\n   display: flex;\n@@ -939,8 +940,35 @@\n   font-weight: 600;\n   margin: 0 2px;\n }\n \n+/* 确保在小屏幕上步骤能够适当缩小 */\n+@media (max-width: 768px) {\n+  .process-steps {\n+    justify-content: space-between; /* 在小屏幕上均匀分布 */\n+    gap: 2px; /* 减小间距 */\n+  }\n+  \n+  .process-step {\n+    min-width: 40px; /* 减小最小宽度 */\n+  }\n+  \n+  .process-arrow {\n+    margin: 0 1px; /* 减小箭头边距 */\n+    font-size: 12px; /* 减小箭头大小 */\n+  }\n+  \n+  .step-number {\n+    width: 18px; /* 减小步骤数字圆圈大小 */\n+    height: 18px;\n+    font-size: 9px;\n+  }\n+  \n+  .step-text {\n+    font-size: 9px; /* 减小文字大小 */\n+  }\n+}\n+\n /* 联系客服 */\n .contact-section {\n   margin-top: 16px;\n   text-align: center;\n@@ -1043,4 +1071,5 @@\n   }\n }\n </style>\n \n+\n"
                },
                {
                    "date": 1752391532380,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,23 +50,23 @@\n             <div class=\"points-total\">\n               <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n               <div class=\"points-label\">总积分</div>\n             </div>\n+            \n+            <!-- 购买等级卡按钮 - 移到积分概览内 -->\n+            <div class=\"purchase-btn-container\">\n+              <van-button\n+                type=\"primary\"\n+                round\n+                @click=\"showPurchaseModal = true\"\n+                class=\"purchase-btn\"\n+              >\n+                <van-icon name=\"shopping-cart-o\" size=\"14\" />\n+                购买等级卡\n+              </van-button>\n+            </div>\n           </div>\n \n-          <!-- 购买等级卡按钮 -->\n-          <div class=\"purchase-section\">\n-            <van-button\n-              type=\"primary\"\n-              round\n-              @click=\"showPurchaseModal = true\"\n-              class=\"purchase-btn\"\n-            >\n-              <van-icon name=\"shopping-cart-o\" size=\"14\" />\n-              购买等级卡\n-            </van-button>\n-          </div>\n-\n         <!-- 等级卡明细 - 移除显示 -->\n         <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n           <h3 class=\"section-title\">我的等级卡</h3>\n           <div class=\"cards-list\">\n@@ -1072,4 +1072,5 @@\n }\n </style>\n \n \n+\n"
                },
                {
                    "date": 1752391653552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,25 +65,8 @@\n               </van-button>\n             </div>\n           </div>\n \n-        <!-- 等级卡明细 - 移除显示 -->\n-        <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n-          <h3 class=\"section-title\">我的等级卡</h3>\n-          <div class=\"cards-list\">\n-            <div\n-              v-for=\"(card, index) in pointsInfo.cards_breakdown\"\n-              :key=\"index\"\n-              class=\"card-item\"\n-            >\n-              <div class=\"card-info\">\n-                <span class=\"card-type\">{{ card.type }}</span>\n-                <span class=\"card-points\">{{ card.points }} 积分</span>\n-              </div>\n-            </div>\n-          </div>\n-        </div> -->\n-\n           <!-- 绑定等级卡 -->\n           <div class=\"bind-section\">\n             <h3 class=\"section-title\">\n               <van-icon name=\"credit-pay\" size=\"16\" />\n@@ -117,22 +100,23 @@\n                 clearable\n                 class=\"bind-input-full\"\n               />\n \n-              <van-button\n-                type=\"primary\"\n-                native-type=\"submit\"\n-                round\n-                :loading=\"bindLoading\"\n-                :disabled=\"bindLoading\"\n-                class=\"bind-button\"\n-              >\n-                {{ bindLoading ? '绑定中...' : '绑定' }}\n-              </van-button>\n+              <div class=\"bind-actions\">\n+                <van-button\n+                  type=\"primary\"\n+                  native-type=\"submit\"\n+                  round\n+                  block\n+                  :loading=\"bindLoading\"\n+                  :disabled=\"bindLoading\"\n+                  class=\"bind-button\"\n+                >\n+                  {{ bindLoading ? '绑定中...' : '绑定' }}\n+                </van-button>\n+              </div>\n             </form>\n           </div>\n-\n-\n         </template>\n       </div>\n     </div>\n   </van-popup>\n@@ -518,9 +502,9 @@\n   backdrop-filter: blur(20px);\n   -webkit-backdrop-filter: blur(20px);\n   border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 16px;\n-  max-height: 70vh;\n+  max-height: 90vh; /* 增加最大高度 */\n   overflow: hidden;\n }\n \n .modal-header {\n@@ -560,10 +544,10 @@\n   height: 200px;\n }\n \n .modal-content {\n-  padding: 12px 16px;\n-  max-height: calc(70vh - 50px);\n+  padding: 0 16px 16px;\n+  max-height: calc(90vh - 60px); /* 减去头部高度 */\n   overflow-y: auto;\n }\n \n /* 登录提示 */\n@@ -601,23 +585,23 @@\n /* 积分概览 */\n .points-overview {\n   display: flex;\n   align-items: center;\n-  justify-content: center;\n-  padding: 20px;\n+  justify-content: space-between; /* 改为两端对齐 */\n+  padding: 16px; /* 减小内边距 */\n   background: rgba(15, 15, 30, 0.8);\n   border: 1px solid rgba(30, 30, 60, 0.5);\n   border-radius: 12px;\n   color: var(--van-text-color, #f7f8fa);\n-  margin-bottom: 16px;\n+  margin-bottom: 12px; /* 减小底部间距 */\n }\n \n .points-total {\n   text-align: center;\n }\n \n .points-number {\n-  font-size: 36px;\n+  font-size: 32px; /* 减小字体大小 */\n   font-weight: 700;\n   line-height: 1;\n   margin-bottom: 4px;\n }\n@@ -656,9 +640,9 @@\n   gap: 6px;\n   font-size: 14px;\n   font-weight: 600;\n   color: var(--van-text-color, #f7f8fa);\n-  margin: 0 0 12px 0;\n+  margin: 0 0 10px 0; /* 减小底部间距 */\n }\n \n .section-desc {\n   font-size: 12px;\n@@ -667,9 +651,9 @@\n }\n \n /* 体验卡提示 */\n .experience-card-notice {\n-  margin-bottom: 16px;\n+  margin-bottom: 12px; /* 减小底部间距 */\n }\n \n /* 等级卡明细 */\n .cards-section {\n@@ -707,23 +691,23 @@\n }\n \n /* 绑定区块 */\n .bind-section {\n-  margin-bottom: 16px;\n-  padding: 16px;\n+  margin-bottom: 12px; /* 减小底部间距 */\n+  padding: 12px; /* 减小内边距 */\n   background: rgba(15, 15, 30, 0.6);\n   border-radius: 12px;\n   border: 1px solid rgba(30, 30, 60, 0.5);\n }\n \n /* 绑定表单 */\n .bind-form {\n-  margin-top: 12px;\n+  margin-top: 10px; /* 减小顶部间距 */\n }\n \n .bind-input-full {\n   width: 100%;\n-  margin-bottom: 12px;\n+  margin-bottom: 10px; /* 减小底部间距 */\n }\n \n .form-field {\n   margin-bottom: 16px;\n@@ -789,18 +773,19 @@\n }\n \n /* 绑定按钮 */\n .bind-actions {\n-  margin-top: 24px;\n+  margin-top: 16px;\n+  width: 100%; /* 确保容器占据整行 */\n }\n \n .bind-button {\n   height: 36px;\n   font-size: 14px;\n   font-weight: 600;\n   background: linear-gradient(135deg, #1989fa, #1976d2);\n   border: none;\n-  min-width: 80px;\n+  width: 100%; /* 确保按钮占据整行 */\n }\n \n /* 购买区块 */\n .purchase-section {\n@@ -1073,4 +1058,6 @@\n </style>\n \n \n \n+\n+\n"
                },
                {
                    "date": 1753639498050,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,9 +50,9 @@\n             <div class=\"points-total\">\n               <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n               <div class=\"points-label\">总积分</div>\n             </div>\n-            \n+\n             <!-- 购买等级卡按钮 - 移到积分概览内 -->\n             <div class=\"purchase-btn-container\">\n               <van-button\n                 type=\"primary\"\n@@ -210,12 +210,13 @@\n   </van-popup>\n </template>\n \n <script>\n-import { ref, reactive, computed, watch, onMounted } from 'vue'\n+import { ref, reactive, computed, watch, onMounted, onUnmounted } from 'vue'\n import { Toast } from 'vant'\n import { levelCardApi, pointsApi, authApi } from '../services/api.js'\n import BaseInput from './BaseInput.vue'\n+import eventBus, { EVENTS } from '../utils/eventBus.js'\n \n export default {\n   name: 'PointsModal',\n   components: {\n@@ -931,24 +932,24 @@\n   .process-steps {\n     justify-content: space-between; /* 在小屏幕上均匀分布 */\n     gap: 2px; /* 减小间距 */\n   }\n-  \n+\n   .process-step {\n     min-width: 40px; /* 减小最小宽度 */\n   }\n-  \n+\n   .process-arrow {\n     margin: 0 1px; /* 减小箭头边距 */\n     font-size: 12px; /* 减小箭头大小 */\n   }\n-  \n+\n   .step-number {\n     width: 18px; /* 减小步骤数字圆圈大小 */\n     height: 18px;\n     font-size: 9px;\n   }\n-  \n+\n   .step-text {\n     font-size: 9px; /* 减小文字大小 */\n   }\n }\n"
                },
                {
                    "date": 1753639535358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -474,8 +474,28 @@\n         showPurchaseModal.value = false\n       }\n     })\n \n+    // 监听积分更新事件\n+    const handlePointsUpdateEvent = async () => {\n+      console.log('🔄 PointsModal 收到积分更新事件，刷新积分信息')\n+      if (props.show && isLoggedIn.value) {\n+        await loadPointsInfo()\n+      }\n+    }\n+\n+    // 组件挂载时添加事件监听\n+    onMounted(() => {\n+      eventBus.on(EVENTS.POINTS_UPDATED, handlePointsUpdateEvent)\n+      eventBus.on(EVENTS.POINTS_CONSUMED, handlePointsUpdateEvent)\n+    })\n+\n+    // 组件卸载时移除事件监听\n+    onUnmounted(() => {\n+      eventBus.off(EVENTS.POINTS_UPDATED, handlePointsUpdateEvent)\n+      eventBus.off(EVENTS.POINTS_CONSUMED, handlePointsUpdateEvent)\n+    })\n+\n     return {\n       visible,\n       loading,\n       bindLoading,\n"
                }
            ],
            "date": 1752287463851,
            "name": "Commit-0",
            "content": "<template>\n  <van-popup\n    v-model:show=\"visible\"\n    position=\"center\"\n    :style=\"{ width: '90%', maxWidth: '500px', borderRadius: '16px' }\"\n    :close-on-click-overlay=\"false\"\n  >\n    <div class=\"points-modal\">\n      <!-- 头部 -->\n      <div class=\"modal-header\">\n        <h2 class=\"modal-title\">\n          <van-icon name=\"gold-coin-o\" size=\"24\" />\n          我的积分\n        </h2>\n        <van-icon\n          name=\"cross\"\n          size=\"20\"\n          class=\"close-btn\"\n          @click=\"closeModal\"\n        />\n      </div>\n\n      <!-- 加载状态 -->\n      <van-loading v-if=\"loading\" class=\"loading-center\" size=\"24px\" vertical>\n        加载中...\n      </van-loading>\n\n      <!-- 内容 -->\n      <div v-else class=\"modal-content\">\n        <!-- 积分概览 -->\n        <div class=\"points-overview\">\n          <div class=\"points-total\">\n            <div class=\"points-number\">{{ pointsInfo?.total_points || 0 }}</div>\n            <div class=\"points-label\">总积分</div>\n          </div>\n          <div class=\"points-stats\">\n            <div class=\"stat-item\">\n              <span class=\"stat-value\">{{ pointsInfo?.cards_count || 0 }}</span>\n              <span class=\"stat-label\">等级卡</span>\n            </div>\n          </div>\n        </div>\n\n        <!-- 等级卡明细 - 移除显示 -->\n        <!-- <div v-if=\"pointsInfo?.cards_breakdown?.length\" class=\"cards-section\">\n          <h3 class=\"section-title\">我的等级卡</h3>\n          <div class=\"cards-list\">\n            <div\n              v-for=\"(card, index) in pointsInfo.cards_breakdown\"\n              :key=\"index\"\n              class=\"card-item\"\n            >\n              <div class=\"card-info\">\n                <span class=\"card-type\">{{ card.type }}</span>\n                <span class=\"card-points\">{{ card.points }} 积分</span>\n              </div>\n            </div>\n          </div>\n        </div> -->\n\n        <!-- 绑定等级卡 -->\n        <div class=\"bind-section\">\n          <h3 class=\"section-title\">绑定等级卡</h3>\n          <p class=\"section-desc\">输入卡号和卡密来绑定新的等级卡</p>\n\n          <van-form @submit=\"handleBindCard\">\n            <van-field\n              v-model=\"bindForm.cardNumber\"\n              name=\"cardNumber\"\n              label=\"卡号\"\n              placeholder=\"请输入等级卡卡号\"\n              :rules=\"cardNumberRules\"\n              clearable\n            />\n\n            <van-field\n              v-model=\"bindForm.cardPassword\"\n              type=\"password\"\n              name=\"cardPassword\"\n              label=\"卡密\"\n              placeholder=\"请输入等级卡卡密\"\n              :rules=\"cardPasswordRules\"\n              clearable\n            />\n\n            <div class=\"bind-actions\">\n              <van-button\n                type=\"primary\"\n                native-type=\"submit\"\n                block\n                round\n                :loading=\"bindLoading\"\n                :disabled=\"bindLoading\"\n              >\n                {{ bindLoading ? '绑定中...' : '绑定等级卡' }}\n              </van-button>\n            </div>\n          </van-form>\n        </div>\n\n        <!-- 等级卡类型说明 -->\n        <div class=\"card-types-section\">\n          <h3 class=\"section-title\">等级卡类型</h3>\n          <div class=\"card-types-list\">\n            <div class=\"card-type-item\">\n              <div class=\"card-type-icon\">🥉</div>\n              <div class=\"card-type-info\">\n                <div class=\"card-type-name\">基础卡</div>\n                <div class=\"card-type-desc\">¥9.9 / 300积分</div>\n              </div>\n            </div>\n            <div class=\"card-type-item\">\n              <div class=\"card-type-icon\">🥈</div>\n              <div class=\"card-type-info\">\n                <div class=\"card-type-name\">高级卡</div>\n                <div class=\"card-type-desc\">¥30 / 1000积分</div>\n              </div>\n            </div>\n            <div class=\"card-type-item\">\n              <div class=\"card-type-icon\">🥇</div>\n              <div class=\"card-type-info\">\n                <div class=\"card-type-name\">至尊卡</div>\n                <div class=\"card-type-desc\">¥50 / 2000积分</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </van-popup>\n</template>\n\n<script>\nimport { ref, reactive, computed, watch, onMounted } from 'vue'\nimport { Toast } from 'vant'\nimport { levelCardApi, pointsApi } from '../services/api.js'\n\nexport default {\n  name: 'PointsModal',\n  props: {\n    show: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update:show', 'points-updated'],\n  setup(props, { emit }) {\n    const visible = computed({\n      get: () => props.show,\n      set: (value) => emit('update:show', value)\n    })\n\n    const loading = ref(false)\n    const bindLoading = ref(false)\n    const pointsInfo = ref(null)\n\n    // 绑定表单数据\n    const bindForm = reactive({\n      cardNumber: '',\n      cardPassword: ''\n    })\n\n    // 表单验证规则\n    const cardNumberRules = [\n      { required: true, message: '请输入卡号' },\n      { pattern: /^[A-Za-z0-9]{6,20}$/, message: '卡号格式不正确' }\n    ]\n\n    const cardPasswordRules = [\n      { required: true, message: '请输入卡密' },\n      { pattern: /^[A-Za-z0-9]{6,20}$/, message: '卡密格式不正确' }\n    ]\n\n    // 重置绑定表单\n    const resetBindForm = () => {\n      bindForm.cardNumber = ''\n      bindForm.cardPassword = ''\n    }\n\n    // 关闭弹窗\n    const closeModal = () => {\n      visible.value = false\n      resetBindForm()\n    }\n\n    // 加载积分信息\n    const loadPointsInfo = async () => {\n      try {\n        loading.value = true\n        const response = await pointsApi.getUserPoints()\n\n        if (response.success) {\n          pointsInfo.value = response.data\n        } else {\n          Toast.fail('获取积分信息失败')\n        }\n      } catch (error) {\n        console.error('加载积分信息失败:', error)\n        Toast.fail('获取积分信息失败')\n      } finally {\n        loading.value = false\n      }\n    }\n\n    // 处理绑定等级卡\n    const handleBindCard = async () => {\n      if (bindLoading.value) return\n\n      // 验证表单\n      if (!bindForm.cardNumber.trim()) {\n        Toast.fail('请输入卡号')\n        return\n      }\n\n      if (!bindForm.cardPassword.trim()) {\n        Toast.fail('请输入卡密')\n        return\n      }\n\n      bindLoading.value = true\n\n      try {\n        const response = await levelCardApi.bindCard(\n          bindForm.cardNumber.trim(),\n          bindForm.cardPassword.trim()\n        )\n\n        if (response.success) {\n          Toast.success(response.message || '绑定成功')\n\n          // 重新加载积分信息\n          await loadPointsInfo()\n\n          // 通知父组件积分已更新\n          emit('points-updated', response.data)\n\n          // 重置表单\n          resetBindForm()\n        } else {\n          Toast.fail(response.message || '绑定失败')\n        }\n      } catch (error) {\n        console.error('绑定等级卡失败:', error)\n        Toast.fail(error.message || '绑定失败')\n      } finally {\n        bindLoading.value = false\n      }\n    }\n\n    // 监听弹窗显示状态\n    watch(visible, (newValue) => {\n      if (newValue) {\n        loadPointsInfo()\n      } else {\n        resetBindForm()\n      }\n    })\n\n    return {\n      visible,\n      loading,\n      bindLoading,\n      pointsInfo,\n      bindForm,\n      cardNumberRules,\n      cardPasswordRules,\n      closeModal,\n      loadPointsInfo,\n      handleBindCard\n    }\n  }\n}\n</script>\n\n<style scoped>\n.points-modal {\n  padding: 0;\n  background: white;\n  border-radius: 16px;\n  max-height: 80vh;\n  overflow-y: auto;\n}\n\n.modal-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  border-bottom: 1px solid #ebedf0;\n  position: sticky;\n  top: 0;\n  background: white;\n  z-index: 10;\n}\n\n.modal-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 18px;\n  font-weight: 600;\n  color: #323233;\n  margin: 0;\n}\n\n.close-btn {\n  color: #969799;\n  cursor: pointer;\n  transition: color 0.3s;\n}\n\n.close-btn:hover {\n  color: #323233;\n}\n\n.loading-center {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n}\n\n.modal-content {\n  padding: 24px;\n}\n\n/* 积分概览 */\n.points-overview {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 24px;\n  background: linear-gradient(135deg, #1989fa, #1976d2);\n  border-radius: 16px;\n  color: white;\n  margin-bottom: 24px;\n}\n\n.points-total {\n  text-align: center;\n}\n\n.points-number {\n  font-size: 36px;\n  font-weight: 700;\n  line-height: 1;\n  margin-bottom: 4px;\n}\n\n.points-label {\n  font-size: 14px;\n  opacity: 0.9;\n}\n\n.points-stats {\n  display: flex;\n  gap: 24px;\n}\n\n.stat-item {\n  text-align: center;\n}\n\n.stat-value {\n  display: block;\n  font-size: 20px;\n  font-weight: 600;\n  line-height: 1;\n  margin-bottom: 4px;\n}\n\n.stat-label {\n  font-size: 12px;\n  opacity: 0.9;\n}\n\n/* 区块标题 */\n.section-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #323233;\n  margin: 0 0 16px 0;\n}\n\n.section-desc {\n  font-size: 14px;\n  color: #969799;\n  margin: 0 0 16px 0;\n}\n\n/* 等级卡明细 */\n.cards-section {\n  margin-bottom: 24px;\n}\n\n.cards-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.card-item {\n  padding: 12px 16px;\n  background: #f7f8fa;\n  border-radius: 8px;\n}\n\n.card-info {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.card-type {\n  font-size: 14px;\n  color: #323233;\n  font-weight: 500;\n}\n\n.card-points {\n  font-size: 14px;\n  color: #1989fa;\n  font-weight: 600;\n}\n\n/* 绑定区块 */\n.bind-section {\n  margin-bottom: 24px;\n  padding: 20px;\n  background: #f7f8fa;\n  border-radius: 12px;\n}\n\n.bind-actions {\n  margin-top: 16px;\n}\n\n/* 等级卡类型说明 */\n.card-types-section {\n  border-top: 1px solid #ebedf0;\n  padding-top: 24px;\n}\n\n.card-types-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.card-type-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px;\n  background: #f7f8fa;\n  border-radius: 8px;\n}\n\n.card-type-icon {\n  font-size: 24px;\n  width: 40px;\n  text-align: center;\n}\n\n.card-type-info {\n  flex: 1;\n}\n\n.card-type-name {\n  font-size: 14px;\n  font-weight: 500;\n  color: #323233;\n  margin-bottom: 2px;\n}\n\n.card-type-desc {\n  font-size: 12px;\n  color: #969799;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .points-overview {\n    flex-direction: column;\n    gap: 16px;\n    text-align: center;\n  }\n\n  .points-stats {\n    justify-content: center;\n  }\n}\n\n/* 深色主题适配 */\n@media (prefers-color-scheme: dark) {\n  .points-modal {\n    background: #1e1e1e;\n  }\n\n  .modal-header {\n    background: #1e1e1e;\n    border-bottom-color: #3a3a3c;\n  }\n\n  .modal-title {\n    color: #ffffff;\n  }\n\n  .section-title {\n    color: #ffffff;\n  }\n\n  .section-desc {\n    color: #8e8e93;\n  }\n\n  .card-item,\n  .bind-section,\n  .card-type-item {\n    background: #2c2c2e;\n  }\n\n  .card-type {\n    color: #ffffff;\n  }\n\n  .card-type-name {\n    color: #ffffff;\n  }\n\n  .card-type-desc {\n    color: #8e8e93;\n  }\n}\n</style>\n"
        }
    ]
}