{
    "sourceFile": "client/src/components/common/UnifiedImageUploadPanel.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 10,
            "patches": [
                {
                    "date": 1752393164890,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752393182729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,8 +94,10 @@\n \n <script setup>\n import { ref, computed, watch } from 'vue'\n import { Toast } from 'vant'\n+import SingleImageUpload from './SingleImageUpload.vue'\n+import MultiImageUpload from './MultiImageUpload.vue'\n \n // Props\n const props = defineProps({\n   modelValue: {\n@@ -112,20 +114,19 @@\n   }\n })\n \n // Emits\n-const emit = defineEmits(['update:modelValue', 'change'])\n+const emit = defineEmits(['update:modelValue', 'change', 'error'])\n \n // Refs\n-const fileInput = ref(null)\n-const fileList = ref([])\n const singleImage = ref(null)\n+const multiImages = ref([])\n \n // è®¡ç®—å±æ€§\n const uploadedCount = computed(() => {\n   return props.config.uploadType === 'single'\n     ? (singleImage.value ? 1 : 0)\n-    : fileList.value.length\n+    : multiImages.value.length\n })\n \n // ç›‘å¬modelValueå˜åŒ–\n watch(() => props.modelValue, (newValue) => {\n"
                },
                {
                    "date": 1752393207456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,102 +132,34 @@\n watch(() => props.modelValue, (newValue) => {\n   if (props.config.uploadType === 'single') {\n     singleImage.value = newValue\n   } else {\n-    fileList.value = Array.isArray(newValue) ? newValue : []\n+    multiImages.value = Array.isArray(newValue) ? newValue : []\n   }\n }, { immediate: true })\n \n // ç›‘å¬å†…éƒ¨æ•°æ®å˜åŒ–\n-watch([fileList, singleImage], () => {\n+watch([singleImage, multiImages], () => {\n   const value = props.config.uploadType === 'single'\n     ? singleImage.value\n-    : fileList.value\n+    : multiImages.value\n \n   emit('update:modelValue', value)\n   emit('change', value)\n }, { deep: true })\n \n // æ–¹æ³•\n-const triggerUpload = () => {\n-  if (fileInput.value) {\n-    fileInput.value.click()\n-  }\n+const handleSingleImageChange = (imageData, file) => {\n+  singleImage.value = imageData\n }\n \n-const handleFileSelect = (event) => {\n-  const files = Array.from(event.target.files)\n-  if (files.length === 0) return\n-\n-  if (props.config.uploadType === 'single') {\n-    handleSingleFileUpload(files[0])\n-  } else {\n-    handleMultiFileUpload(files)\n-  }\n-\n-  // æ¸…ç©ºinput\n-  event.target.value = ''\n+const handleMultiImageChange = (images) => {\n+  multiImages.value = images\n }\n \n-const handleSingleFileUpload = (file) => {\n-  if (!beforeRead(file)) return\n-\n-  const reader = new FileReader()\n-  reader.onload = (e) => {\n-    singleImage.value = e.target.result\n-  }\n-  reader.readAsDataURL(file)\n+const handleUploadError = (error) => {\n+  emit('error', error)\n }\n-\n-const handleMultiFileUpload = (files) => {\n-  const validFiles = files.filter(file => beforeRead(file))\n-  const remainingSlots = props.config.maxCount - fileList.value.length\n-  const filesToProcess = validFiles.slice(0, remainingSlots)\n-\n-  filesToProcess.forEach(file => {\n-    const reader = new FileReader()\n-    reader.onload = (e) => {\n-      fileList.value.push({\n-        url: e.target.result,\n-        file: file,\n-        status: 'done'\n-      })\n-    }\n-    reader.readAsDataURL(file)\n-  })\n-\n-  if (validFiles.length > remainingSlots) {\n-    Toast.fail(`æœ€å¤šåªèƒ½ä¸Šä¼  ${props.config.maxCount} å¼ å›¾ç‰‡`)\n-  }\n-}\n-\n-const beforeRead = (file) => {\n-  // æ£€æŸ¥æ–‡ä»¶å¤§å°\n-  if (file.size > props.config.maxSize) {\n-    Toast.fail(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${Math.round(props.config.maxSize / 1024 / 1024)}MB`)\n-    return false\n-  }\n-\n-  // æ£€æŸ¥æ–‡ä»¶ç±»å‹\n-  if (!file.type.startsWith('image/')) {\n-    Toast.fail('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶')\n-    return false\n-  }\n-\n-  return true\n-}\n-\n-const removeSingleImage = () => {\n-  singleImage.value = null\n-}\n-\n-const onDelete = (file, detail) => {\n-  fileList.value.splice(detail.index, 1)\n-}\n-\n-const onOversize = () => {\n-  Toast.fail(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${Math.round(props.config.maxSize / 1024 / 1024)}MB`)\n-}\n </script>\n \n <style scoped>\n .unified-image-upload-panel {\n"
                },
                {
                    "date": 1752393237971,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -191,66 +191,8 @@\n .upload-area {\n   margin-bottom: 16px;\n }\n \n-.upload-slot {\n-  display: flex;\n-  flex-direction: column;\n-  align-items: center;\n-  justify-content: center;\n-  border: 2px dashed rgba(255, 255, 255, 0.2);\n-  border-radius: 8px;\n-  cursor: pointer;\n-  transition: all 0.3s ease;\n-}\n-\n-.single-upload {\n-  height: 120px;\n-  position: relative;\n-  overflow: hidden;\n-}\n-\n-.single-upload:hover:not(.disabled) {\n-  border-color: rgba(255, 255, 255, 0.4);\n-  background: rgba(255, 255, 255, 0.05);\n-}\n-\n-.multi-upload {\n-  height: 80px;\n-  width: 80px;\n-}\n-\n-.upload-text {\n-  font-size: 14px;\n-  color: var(--van-text-color-2);\n-  margin-top: 8px;\n-}\n-\n-.uploaded-image {\n-  width: 100%;\n-  height: 100%;\n-  object-fit: cover;\n-}\n-\n-.image-overlay {\n-  position: absolute;\n-  top: 0;\n-  left: 0;\n-  right: 0;\n-  bottom: 0;\n-  background: rgba(0, 0, 0, 0.5);\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n-  gap: 16px;\n-  opacity: 0;\n-  transition: opacity 0.3s ease;\n-}\n-\n-.single-upload:hover .image-overlay {\n-  opacity: 1;\n-}\n-\n .status-section {\n   display: flex;\n   flex-direction: column;\n   gap: 8px;\n@@ -285,15 +227,5 @@\n \n .text-warning {\n   color: var(--van-warning-color);\n }\n-\n-.disabled {\n-  opacity: 0.5;\n-  cursor: not-allowed;\n-}\n-\n-.multi-uploader {\n-  --van-uploader-upload-background: transparent;\n-  --van-uploader-upload-border-color: rgba(255, 255, 255, 0.2);\n-}\n </style>\n"
                },
                {
                    "date": 1752425764562,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,10 +12,15 @@\n         ({{ config.minCount }}-{{ config.maxCount }}å¼ )\n       </span>\n     </div>\n \n+    <!-- å¯¹æ¯”ç»„ä»¶æ’æ§½ - åœ¨panel-headerå’Œstatus-sectionä¹‹é—´ -->\n+    <div v-if=\"$slots.comparison\" class=\"comparison-slot\">\n+      <slot name=\"comparison\" />\n+    </div>\n+\n     <!-- ä¸Šä¼ åŒºåŸŸ -->\n-    <div class=\"upload-area\">\n+    <div v-else class=\"upload-area\">\n       <!-- å•å›¾ä¸Šä¼  -->\n       <SingleImageUpload\n         v-if=\"config.uploadType === 'single'\"\n         v-model=\"singleImage\"\n"
                },
                {
                    "date": 1752425788885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -192,8 +192,13 @@\n   font-size: 14px;\n   color: var(--van-text-color-2);\n }\n \n+/* å¯¹æ¯”ç»„ä»¶æ’æ§½æ ·å¼ */\n+.comparison-slot {\n+  margin-bottom: 16px;\n+}\n+\n .upload-area {\n   margin-bottom: 16px;\n }\n \n"
                },
                {
                    "date": 1752426204143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,10 +17,10 @@\n     <div v-if=\"$slots.comparison\" class=\"comparison-slot\">\n       <slot name=\"comparison\" />\n     </div>\n \n-    <!-- ä¸Šä¼ åŒºåŸŸ -->\n-    <div v-else class=\"upload-area\">\n+    <!-- ä¸Šä¼ åŒºåŸŸ - å§‹ç»ˆæ˜¾ç¤ºï¼Œé™¤éæœ‰å¯¹æ¯”ç»„ä»¶ä¸”æ˜ç¡®éšè— -->\n+    <div v-if=\"!($slots.comparison && shouldHideUpload)\" class=\"upload-area\">\n       <!-- å•å›¾ä¸Šä¼  -->\n       <SingleImageUpload\n         v-if=\"config.uploadType === 'single'\"\n         v-model=\"singleImage\"\n"
                },
                {
                    "date": 1752426226733,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,8 +115,12 @@\n   },\n   disabled: {\n     type: Boolean,\n     default: false\n+  },\n+  shouldHideUpload: {\n+    type: Boolean,\n+    default: false\n   }\n })\n \n // Emits\n"
                },
                {
                    "date": 1752426921274,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,11 @@\n     </div>\n \n     <!-- å¯¹æ¯”ç»„ä»¶æ’æ§½ - åœ¨panel-headerå’Œstatus-sectionä¹‹é—´ -->\n     <div v-if=\"$slots.comparison\" class=\"comparison-slot\">\n+      <div style=\"background: rgba(0,255,0,0.1); padding: 5px; margin: 5px 0; border-radius: 4px; color: white; font-size: 11px;\">\n+        ğŸ“ æ’æ§½å·²æ¿€æ´» - shouldHideUpload: {{ shouldHideUpload }}\n+      </div>\n       <slot name=\"comparison\" />\n     </div>\n \n     <!-- ä¸Šä¼ åŒºåŸŸ - å§‹ç»ˆæ˜¾ç¤ºï¼Œé™¤éæœ‰å¯¹æ¯”ç»„ä»¶ä¸”æ˜ç¡®éšè— -->\n"
                },
                {
                    "date": 1752427096127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,11 +14,14 @@\n     </div>\n \n     <!-- å¯¹æ¯”ç»„ä»¶æ’æ§½ - åœ¨panel-headerå’Œstatus-sectionä¹‹é—´ -->\n     <div v-if=\"$slots.comparison\" class=\"comparison-slot\">\n+      <!-- è°ƒè¯•ä¿¡æ¯ - å¼€å‘æ—¶å¯å¯ç”¨ -->\n+      <!--\n       <div style=\"background: rgba(0,255,0,0.1); padding: 5px; margin: 5px 0; border-radius: 4px; color: white; font-size: 11px;\">\n         ğŸ“ æ’æ§½å·²æ¿€æ´» - shouldHideUpload: {{ shouldHideUpload }}\n       </div>\n+      -->\n       <slot name=\"comparison\" />\n     </div>\n \n     <!-- ä¸Šä¼ åŒºåŸŸ - å§‹ç»ˆæ˜¾ç¤ºï¼Œé™¤éæœ‰å¯¹æ¯”ç»„ä»¶ä¸”æ˜ç¡®éšè— -->\n"
                },
                {
                    "date": 1752431367874,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -205,8 +205,14 @@\n \n /* å¯¹æ¯”ç»„ä»¶æ’æ§½æ ·å¼ */\n .comparison-slot {\n   margin-bottom: 16px;\n+  /* ç¡®ä¿æ’æ§½å†…å®¹èƒ½æ­£ç¡®æ˜¾ç¤º */\n+  display: flex;\n+  justify-content: center;\n+  align-items: center;\n+  /* é¿å…å¼¹æ€§å¸ƒå±€å¯¼è‡´çš„å®½åº¦é—®é¢˜ */\n+  width: 100%;\n }\n \n .upload-area {\n   margin-bottom: 16px;\n"
                }
            ],
            "date": 1752393164890,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"unified-image-upload-panel\">\n    <!-- æ ‡é¢˜åŒºåŸŸ -->\n    <div class=\"panel-header\">\n      <van-icon\n        :name=\"config.icon\"\n        :color=\"config.iconColor\"\n        size=\"18\"\n      />\n      <span class=\"panel-title\">{{ config.title }}</span>\n      <span v-if=\"config.showCount\" class=\"count-badge\">\n        ({{ config.minCount }}-{{ config.maxCount }}å¼ )\n      </span>\n    </div>\n\n    <!-- ä¸Šä¼ åŒºåŸŸ -->\n    <div class=\"upload-area\">\n      <!-- å•å›¾ä¸Šä¼  -->\n      <SingleImageUpload\n        v-if=\"config.uploadType === 'single'\"\n        v-model=\"singleImage\"\n        :upload-text=\"config.uploadText\"\n        :accept=\"config.accept\"\n        :max-size=\"config.maxSize\"\n        :disabled=\"disabled\"\n        :container-height=\"120\"\n        @change=\"handleSingleImageChange\"\n        @error=\"handleUploadError\"\n      />\n\n      <!-- å¤šå›¾ä¸Šä¼  -->\n      <MultiImageUpload\n        v-else\n        v-model=\"multiImages\"\n        :max-count=\"config.maxCount\"\n        :min-count=\"config.minCount\"\n        :upload-text=\"config.uploadText\"\n        :accept=\"config.accept\"\n        :max-size=\"config.maxSize\"\n        :disabled=\"disabled\"\n        :grid-columns=\"4\"\n        @change=\"handleMultiImageChange\"\n        @error=\"handleUploadError\"\n      />\n    </div>\n\n    <!-- çŠ¶æ€ä¿¡æ¯ -->\n    <div class=\"status-section\">\n      <div class=\"status-item\">\n        <van-icon\n          name=\"photograph\"\n          size=\"16\"\n          :color=\"uploadedCount > 0 ? 'var(--van-success-color)' : 'var(--van-text-color-3)'\"\n        />\n        <span :class=\"{ 'text-success': uploadedCount > 0 }\">\n          å·²ä¸Šä¼  {{ uploadedCount }}/{{ config.maxCount }} å¼ å›¾ç‰‡\n        </span>\n      </div>\n\n      <div v-if=\"config.minCount > 0\" class=\"status-item\">\n        <van-icon\n          :name=\"uploadedCount >= config.minCount ? 'success' : 'warning-o'\"\n          size=\"16\"\n          :color=\"uploadedCount >= config.minCount ? 'var(--van-success-color)' : 'var(--van-warning-color)'\"\n        />\n        <span :class=\"{\n          'text-success': uploadedCount >= config.minCount,\n          'text-warning': uploadedCount < config.minCount\n        }\">\n          {{ uploadedCount >= config.minCount ? 'å·²æ»¡è¶³ä¸Šä¼ è¦æ±‚' : `è‡³å°‘éœ€è¦ä¸Šä¼  ${config.minCount} å¼ å›¾ç‰‡` }}\n        </span>\n      </div>\n    </div>\n\n    <!-- æç¤ºä¿¡æ¯ -->\n    <div v-if=\"config.tips && config.tips.length > 0\" class=\"tips-section\">\n      <div v-for=\"(tip, index) in config.tips\" :key=\"index\" class=\"tip-item\">\n        <van-icon name=\"info-o\" size=\"12\" color=\"var(--van-text-color-3)\" />\n        <span>{{ tip }}</span>\n      </div>\n    </div>\n\n    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->\n    <input\n      ref=\"fileInput\"\n      type=\"file\"\n      :accept=\"config.accept\"\n      :multiple=\"config.uploadType === 'multi'\"\n      style=\"display: none\"\n      @change=\"handleFileSelect\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport { Toast } from 'vant'\n\n// Props\nconst props = defineProps({\n  modelValue: {\n    type: [Array, String, null],\n    default: null\n  },\n  config: {\n    type: Object,\n    required: true\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// Emits\nconst emit = defineEmits(['update:modelValue', 'change'])\n\n// Refs\nconst fileInput = ref(null)\nconst fileList = ref([])\nconst singleImage = ref(null)\n\n// è®¡ç®—å±æ€§\nconst uploadedCount = computed(() => {\n  return props.config.uploadType === 'single'\n    ? (singleImage.value ? 1 : 0)\n    : fileList.value.length\n})\n\n// ç›‘å¬modelValueå˜åŒ–\nwatch(() => props.modelValue, (newValue) => {\n  if (props.config.uploadType === 'single') {\n    singleImage.value = newValue\n  } else {\n    fileList.value = Array.isArray(newValue) ? newValue : []\n  }\n}, { immediate: true })\n\n// ç›‘å¬å†…éƒ¨æ•°æ®å˜åŒ–\nwatch([fileList, singleImage], () => {\n  const value = props.config.uploadType === 'single'\n    ? singleImage.value\n    : fileList.value\n\n  emit('update:modelValue', value)\n  emit('change', value)\n}, { deep: true })\n\n// æ–¹æ³•\nconst triggerUpload = () => {\n  if (fileInput.value) {\n    fileInput.value.click()\n  }\n}\n\nconst handleFileSelect = (event) => {\n  const files = Array.from(event.target.files)\n  if (files.length === 0) return\n\n  if (props.config.uploadType === 'single') {\n    handleSingleFileUpload(files[0])\n  } else {\n    handleMultiFileUpload(files)\n  }\n\n  // æ¸…ç©ºinput\n  event.target.value = ''\n}\n\nconst handleSingleFileUpload = (file) => {\n  if (!beforeRead(file)) return\n\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    singleImage.value = e.target.result\n  }\n  reader.readAsDataURL(file)\n}\n\nconst handleMultiFileUpload = (files) => {\n  const validFiles = files.filter(file => beforeRead(file))\n  const remainingSlots = props.config.maxCount - fileList.value.length\n  const filesToProcess = validFiles.slice(0, remainingSlots)\n\n  filesToProcess.forEach(file => {\n    const reader = new FileReader()\n    reader.onload = (e) => {\n      fileList.value.push({\n        url: e.target.result,\n        file: file,\n        status: 'done'\n      })\n    }\n    reader.readAsDataURL(file)\n  })\n\n  if (validFiles.length > remainingSlots) {\n    Toast.fail(`æœ€å¤šåªèƒ½ä¸Šä¼  ${props.config.maxCount} å¼ å›¾ç‰‡`)\n  }\n}\n\nconst beforeRead = (file) => {\n  // æ£€æŸ¥æ–‡ä»¶å¤§å°\n  if (file.size > props.config.maxSize) {\n    Toast.fail(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${Math.round(props.config.maxSize / 1024 / 1024)}MB`)\n    return false\n  }\n\n  // æ£€æŸ¥æ–‡ä»¶ç±»å‹\n  if (!file.type.startsWith('image/')) {\n    Toast.fail('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶')\n    return false\n  }\n\n  return true\n}\n\nconst removeSingleImage = () => {\n  singleImage.value = null\n}\n\nconst onDelete = (file, detail) => {\n  fileList.value.splice(detail.index, 1)\n}\n\nconst onOversize = () => {\n  Toast.fail(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${Math.round(props.config.maxSize / 1024 / 1024)}MB`)\n}\n</script>\n\n<style scoped>\n.unified-image-upload-panel {\n  background: rgba(15, 15, 30, 0.6);\n  border-radius: 12px;\n  border: 1px solid rgba(30, 30, 60, 0.5);\n  padding: 16px;\n  margin-bottom: 16px;\n}\n\n.panel-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 16px;\n  color: var(--van-text-color, #f7f8fa);\n}\n\n.panel-title {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.count-badge {\n  font-size: 14px;\n  color: var(--van-text-color-2);\n}\n\n.upload-area {\n  margin-bottom: 16px;\n}\n\n.upload-slot {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  border: 2px dashed rgba(255, 255, 255, 0.2);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.single-upload {\n  height: 120px;\n  position: relative;\n  overflow: hidden;\n}\n\n.single-upload:hover:not(.disabled) {\n  border-color: rgba(255, 255, 255, 0.4);\n  background: rgba(255, 255, 255, 0.05);\n}\n\n.multi-upload {\n  height: 80px;\n  width: 80px;\n}\n\n.upload-text {\n  font-size: 14px;\n  color: var(--van-text-color-2);\n  margin-top: 8px;\n}\n\n.uploaded-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.image-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.single-upload:hover .image-overlay {\n  opacity: 1;\n}\n\n.status-section {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  margin-bottom: 12px;\n}\n\n.status-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 14px;\n  color: var(--van-text-color-2);\n}\n\n.tips-section {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.tip-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 12px;\n  color: var(--van-text-color-3);\n}\n\n.text-success {\n  color: var(--van-success-color);\n}\n\n.text-warning {\n  color: var(--van-warning-color);\n}\n\n.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.multi-uploader {\n  --van-uploader-upload-background: transparent;\n  --van-uploader-upload-border-color: rgba(255, 255, 255, 0.2);\n}\n</style>\n"
        }
    ]
}