{
    "sourceFile": "client/src/components/common/VantMultiImageUpload.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1752385170499,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752385196301,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -341,34 +341,64 @@\n \n /* 移动端优化 */\n @media (max-width: 768px) {\n   .upload-slot {\n-    width: 70px;\n-    height: 70px;\n+    width: 80px;\n+    height: 80px;\n   }\n \n   .upload-text {\n     font-size: 11px;\n+    margin-top: 4px;\n   }\n \n+  .upload-status,\n+  .upload-tips {\n+    padding: 12px;\n+    margin-top: 12px;\n+  }\n+\n   .status-item {\n     font-size: 13px;\n+    margin-bottom: 6px;\n   }\n+\n+  .tip-item {\n+    font-size: 12px;\n+    margin-bottom: 4px;\n+  }\n }\n \n /* 深色主题适配 */\n @media (prefers-color-scheme: dark) {\n   .upload-slot {\n-    background: var(--van-background, #2a2a2a);\n-    border-color: var(--van-border-color, #333);\n+    background: rgba(0, 0, 0, 0.3);\n+    border-color: rgba(255, 255, 255, 0.2);\n   }\n \n   .upload-slot:hover {\n-    background: rgba(25, 137, 250, 0.1);\n+    background: rgba(0, 0, 0, 0.4);\n+    border-color: rgba(255, 255, 255, 0.4);\n   }\n \n   .upload-status,\n   .upload-tips {\n-    background: var(--van-background-2, #1e1e1e);\n+    background: rgba(0, 0, 0, 0.2);\n+    border-color: rgba(255, 255, 255, 0.1);\n   }\n }\n+\n+/* 减少动画在低性能设备上的影响 */\n+@media (prefers-reduced-motion: reduce) {\n+  .upload-slot {\n+    transition: none;\n+  }\n+\n+  .upload-slot::before {\n+    display: none;\n+  }\n+\n+  .upload-slot:hover {\n+    transform: none;\n+  }\n+}\n </style>\n"
                },
                {
                    "date": 1752387423697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,12 +222,17 @@\n \n <style scoped>\n .vant-multi-image-upload {\n   width: 100%;\n+  display: flex;\n+  flex-direction: column;\n+  align-items: center;\n }\n \n .multi-image-uploader {\n   width: 100%;\n+  display: flex;\n+  justify-content: center;\n }\n \n .upload-slot {\n   display: flex;\n@@ -280,8 +285,10 @@\n   text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n }\n \n .upload-status {\n+  width: 100%;\n+  max-width: 500px;\n   margin-top: 16px;\n   padding: 16px;\n   background: rgba(255, 255, 255, 0.1);\n   backdrop-filter: blur(10px);\n@@ -314,8 +321,10 @@\n   font-weight: 600;\n }\n \n .upload-tips {\n+  width: 100%;\n+  max-width: 500px;\n   margin-top: 16px;\n   padding: 16px;\n   background: rgba(255, 255, 255, 0.1);\n   backdrop-filter: blur(10px);\n@@ -401,4 +410,5 @@\n     transform: none;\n   }\n }\n </style>\n+\n"
                },
                {
                    "date": 1752387515326,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -286,9 +286,8 @@\n }\n \n .upload-status {\n   width: 100%;\n-  max-width: 500px;\n   margin-top: 16px;\n   padding: 16px;\n   background: rgba(255, 255, 255, 0.1);\n   backdrop-filter: blur(10px);\n@@ -322,9 +321,8 @@\n }\n \n .upload-tips {\n   width: 100%;\n-  max-width: 500px;\n   margin-top: 16px;\n   padding: 16px;\n   background: rgba(255, 255, 255, 0.1);\n   backdrop-filter: blur(10px);\n@@ -411,4 +409,5 @@\n   }\n }\n </style>\n \n+\n"
                }
            ],
            "date": 1752385170499,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"vant-multi-image-upload\">\n    <van-uploader\n      v-model=\"fileList\"\n      :max-count=\"maxCount\"\n      :max-size=\"maxSize\"\n      :accept=\"accept\"\n      :disabled=\"disabled\"\n      :preview-size=\"previewSize\"\n      :deletable=\"deletable\"\n      :show-upload=\"showUpload\"\n      :before-read=\"beforeRead\"\n      @oversize=\"onOversize\"\n      @delete=\"onDelete\"\n      multiple\n      class=\"multi-image-uploader\"\n    >\n      <template #default>\n        <div class=\"upload-slot\">\n          <van-icon\n            name=\"plus\"\n            :size=\"iconSize\"\n            :color=\"iconColor\"\n          />\n          <div class=\"upload-text\">{{ uploadText }}</div>\n        </div>\n      </template>\n    </van-uploader>\n\n    <!-- 上传状态提示 -->\n    <div class=\"upload-status\">\n      <div class=\"status-item\">\n        <van-icon\n          name=\"photograph\"\n          size=\"16\"\n          :color=\"fileList.length > 0 ? 'var(--van-success-color)' : 'var(--van-text-color-3)'\"\n        />\n        <span :class=\"{ 'text-success': fileList.length > 0 }\">\n          已上传 {{ fileList.length }}/{{ maxCount }} 张图片\n        </span>\n      </div>\n\n      <div v-if=\"minCount > 0\" class=\"status-item\">\n        <van-icon\n          :name=\"fileList.length >= minCount ? 'success' : 'info-o'\"\n          size=\"16\"\n          :color=\"fileList.length >= minCount ? 'var(--van-success-color)' : 'var(--van-warning-color)'\"\n        />\n        <span :class=\"{ 'text-success': fileList.length >= minCount, 'text-warning': fileList.length < minCount }\">\n          {{ fileList.length >= minCount ? '已满足最少上传要求' : `至少需要上传 ${minCount} 张图片` }}\n        </span>\n      </div>\n    </div>\n\n    <!-- 上传提示 -->\n    <div v-if=\"showTips && tips.length > 0\" class=\"upload-tips\">\n      <div v-for=\"(tip, index) in tips\" :key=\"index\" class=\"tip-item\">\n        <van-icon name=\"info-o\" size=\"14\" color=\"var(--van-text-color-3)\" />\n        <span>{{ tip }}</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport { Toast } from 'vant'\n\n// Props\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    default: () => []\n  },\n  maxCount: {\n    type: Number,\n    default: 4\n  },\n  minCount: {\n    type: Number,\n    default: 1\n  },\n  maxSize: {\n    type: Number,\n    default: 10 * 1024 * 1024 // 10MB\n  },\n  accept: {\n    type: String,\n    default: 'image/*'\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  previewSize: {\n    type: [String, Number],\n    default: 80\n  },\n  uploadText: {\n    type: String,\n    default: '添加图片'\n  },\n  iconSize: {\n    type: [String, Number],\n    default: 24\n  },\n  iconColor: {\n    type: String,\n    default: 'var(--van-text-color-3, #c8c9cc)'\n  },\n  deletable: {\n    type: Boolean,\n    default: true\n  },\n  showTips: {\n    type: Boolean,\n    default: true\n  },\n  tips: {\n    type: Array,\n    default: () => [\n      '支持 JPG、PNG 格式',\n      '建议尺寸 512x512 以上',\n      '文件大小不超过 10MB',\n      '可一次选择多张图片'\n    ]\n  }\n})\n\n// Events\nconst emit = defineEmits(['update:modelValue', 'change', 'delete', 'oversize'])\n\n// Data\nconst fileList = ref([])\n\n// Computed\nconst showUpload = computed(() => {\n  return !props.disabled && fileList.value.length < props.maxCount\n})\n\n// Watch\nwatch(() => props.modelValue, (newValue) => {\n  if (Array.isArray(newValue)) {\n    fileList.value = newValue.map((item, index) => ({\n      url: typeof item === 'string' ? item : item.url,\n      file: typeof item === 'object' ? item.file : null,\n      status: 'done',\n      message: '',\n      uid: `${Date.now()}-${index}`\n    }))\n  } else {\n    fileList.value = []\n  }\n}, { immediate: true })\n\nwatch(fileList, (newValue) => {\n  const result = newValue.map(item => ({\n    url: item.url,\n    file: item.file\n  }))\n\n  emit('update:modelValue', result)\n  emit('change', result)\n}, { deep: true })\n\n// Methods\nconst beforeRead = (file) => {\n  // 如果是多个文件\n  if (Array.isArray(file)) {\n    // 检查总数量\n    if (fileList.value.length + file.length > props.maxCount) {\n      Toast.fail(`最多只能上传 ${props.maxCount} 张图片`)\n      return false\n    }\n\n    // 检查每个文件\n    for (const f of file) {\n      if (!validateFile(f)) {\n        return false\n      }\n    }\n  } else {\n    // 单个文件\n    if (fileList.value.length >= props.maxCount) {\n      Toast.fail(`最多只能上传 ${props.maxCount} 张图片`)\n      return false\n    }\n\n    if (!validateFile(file)) {\n      return false\n    }\n  }\n\n  return true\n}\n\nconst validateFile = (file) => {\n  // 检查文件类型\n  if (!file.type.startsWith('image/')) {\n    Toast.fail('请选择图片文件')\n    return false\n  }\n\n  // 检查文件大小\n  if (file.size > props.maxSize) {\n    Toast.fail(`文件大小不能超过 ${(props.maxSize / 1024 / 1024).toFixed(1)}MB`)\n    return false\n  }\n\n  return true\n}\n\nconst onOversize = (file) => {\n  Toast.fail(`文件大小不能超过 ${(props.maxSize / 1024 / 1024).toFixed(1)}MB`)\n  emit('oversize', file)\n}\n\nconst onDelete = (file, detail) => {\n  emit('delete', file, detail)\n}\n</script>\n\n<style scoped>\n.vant-multi-image-upload {\n  width: 100%;\n}\n\n.multi-image-uploader {\n  width: 100%;\n}\n\n.upload-slot {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 88px;\n  height: 88px;\n  border: 2px dashed rgba(255, 255, 255, 0.3);\n  border-radius: 12px;\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  position: relative;\n  overflow: hidden;\n}\n\n.upload-slot::before {\n  content: '';\n  position: absolute;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);\n  transform: rotate(45deg) translate(-100%, -100%);\n  transition: transform 0.6s ease;\n  pointer-events: none;\n}\n\n.upload-slot:hover {\n  border-color: rgba(255, 255, 255, 0.6);\n  background: rgba(255, 255, 255, 0.2);\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);\n}\n\n.upload-slot:hover::before {\n  transform: rotate(45deg) translate(50%, 50%);\n}\n\n.upload-text {\n  font-size: 12px;\n  color: rgba(255, 255, 255, 0.8);\n  margin-top: 6px;\n  text-align: center;\n  font-weight: 500;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n.upload-status {\n  margin-top: 16px;\n  padding: 16px;\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);\n}\n\n.status-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 14px;\n  color: rgba(255, 255, 255, 0.8);\n  margin-bottom: 8px;\n}\n\n.status-item:last-child {\n  margin-bottom: 0;\n}\n\n.text-success {\n  color: #07c160;\n  font-weight: 600;\n}\n\n.text-warning {\n  color: #ff976a;\n  font-weight: 600;\n}\n\n.upload-tips {\n  margin-top: 16px;\n  padding: 16px;\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);\n}\n\n.tip-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 13px;\n  color: rgba(255, 255, 255, 0.7);\n  line-height: 1.5;\n  margin-bottom: 6px;\n}\n\n.tip-item:last-child {\n  margin-bottom: 0;\n}\n\n/* 移动端优化 */\n@media (max-width: 768px) {\n  .upload-slot {\n    width: 70px;\n    height: 70px;\n  }\n\n  .upload-text {\n    font-size: 11px;\n  }\n\n  .status-item {\n    font-size: 13px;\n  }\n}\n\n/* 深色主题适配 */\n@media (prefers-color-scheme: dark) {\n  .upload-slot {\n    background: var(--van-background, #2a2a2a);\n    border-color: var(--van-border-color, #333);\n  }\n\n  .upload-slot:hover {\n    background: rgba(25, 137, 250, 0.1);\n  }\n\n  .upload-status,\n  .upload-tips {\n    background: var(--van-background-2, #1e1e1e);\n  }\n}\n</style>\n"
        }
    ]
}