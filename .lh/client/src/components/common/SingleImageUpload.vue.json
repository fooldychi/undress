{
    "sourceFile": "client/src/components/common/SingleImageUpload.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1752393485845,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752393500374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -290,9 +290,9 @@\n   border-radius: 8px;\n   cursor: pointer;\n   transition: all 0.3s ease;\n   overflow: hidden;\n-  v-bind(containerStyle);\n+  height: v-bind(containerHeightValue);\n }\n \n .upload-container:hover:not(.disabled) {\n   border-color: rgba(255, 255, 255, 0.4);\n"
                },
                {
                    "date": 1752393683280,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n   <div class=\"single-image-upload\">\n     <div\n       class=\"upload-container\"\n       :class=\"{ 'has-image': modelValue, 'disabled': disabled }\"\n+      :style=\"{ height: containerHeightValue }\"\n       @click=\"!disabled && triggerUpload()\"\n     >\n       <!-- 无图片状态 -->\n       <template v-if=\"!modelValue\">\n"
                },
                {
                    "date": 1752393699034,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -291,9 +291,8 @@\n   border-radius: 8px;\n   cursor: pointer;\n   transition: all 0.3s ease;\n   overflow: hidden;\n-  height: v-bind(containerHeightValue);\n }\n \n .upload-container:hover:not(.disabled) {\n   border-color: rgba(255, 255, 255, 0.4);\n"
                },
                {
                    "date": 1752412219227,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -334,9 +334,10 @@\n \n .uploaded-image {\n   width: 100%;\n   height: 100%;\n-  object-fit: cover;\n+  object-fit: contain;\n+  background: rgba(0, 0, 0, 0.1);\n }\n \n .image-overlay {\n   position: absolute;\n"
                },
                {
                    "date": 1752412246184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -261,10 +261,21 @@\n     showPreview.value = true\n   }\n }\n \n-const onImageLoad = () => {\n+const onImageLoad = (event) => {\n   loading.value = false\n+\n+  // 计算图片比例并调整容器高度\n+  const img = event.target\n+  const aspectRatio = img.naturalWidth / img.naturalHeight\n+\n+  // 设置容器的最大高度，保持图片比例\n+  const container = img.closest('.upload-container')\n+  if (container && aspectRatio) {\n+    const maxHeight = Math.min(300, container.offsetWidth / aspectRatio)\n+    container.style.height = `${maxHeight}px`\n+  }\n }\n \n const onImageError = () => {\n   loading.value = false\n"
                },
                {
                    "date": 1752412288528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -302,8 +302,9 @@\n   border-radius: 8px;\n   cursor: pointer;\n   transition: all 0.3s ease;\n   overflow: hidden;\n+  min-height: 120px;\n }\n \n .upload-container:hover:not(.disabled) {\n   border-color: rgba(255, 255, 255, 0.4);\n"
                },
                {
                    "date": 1752413939399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,10 +99,11 @@\n   </div>\n </template>\n \n <script setup>\n-import { ref, computed, watch } from 'vue'\n+import { ref, computed, watch, onMounted, onUnmounted } from 'vue'\n import { Toast } from 'vant'\n+import { ImageSizeUtils } from '../../config/imageSizeConfig.js'\n \n // Props\n const props = defineProps({\n   modelValue: {\n"
                },
                {
                    "date": 1752413955303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,16 +156,21 @@\n const loading = ref(false)\n const error = ref('')\n const fileInfo = ref(null)\n const showPreview = ref(false)\n+const isMobile = ref(false)\n \n // 计算属性\n-const containerHeightValue = computed(() => {\n-  return typeof props.containerHeight === 'number'\n-    ? `${props.containerHeight}px`\n-    : props.containerHeight\n+const containerStyle = computed(() => {\n+  // 使用统一的上传组件尺寸配置\n+  return ImageSizeUtils.getContainerStyle('upload', isMobile.value)\n })\n \n+const imageStyle = computed(() => {\n+  // 使用统一的图片样式配置\n+  return ImageSizeUtils.getImageStyle('upload', isMobile.value)\n+})\n+\n // 方法\n const triggerUpload = () => {\n   if (fileInput.value && !props.disabled) {\n     fileInput.value.click()\n"
                },
                {
                    "date": 1752413969408,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n   <div class=\"single-image-upload\">\n     <div\n       class=\"upload-container\"\n       :class=\"{ 'has-image': modelValue, 'disabled': disabled }\"\n-      :style=\"{ height: containerHeightValue }\"\n+      :style=\"containerStyle\"\n       @click=\"!disabled && triggerUpload()\"\n     >\n       <!-- 无图片状态 -->\n       <template v-if=\"!modelValue\">\n"
                },
                {
                    "date": 1752413983962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,8 +25,9 @@\n           <img\n             :src=\"modelValue\"\n             :alt=\"uploadText\"\n             class=\"uploaded-image\"\n+            :style=\"imageStyle\"\n             @load=\"onImageLoad\"\n             @error=\"onImageError\"\n           />\n \n"
                },
                {
                    "date": 1752414001006,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,19 +270,9 @@\n }\n \n const onImageLoad = (event) => {\n   loading.value = false\n-\n-  // 计算图片比例并调整容器高度\n-  const img = event.target\n-  const aspectRatio = img.naturalWidth / img.naturalHeight\n-\n-  // 设置容器的最大高度，保持图片比例\n-  const container = img.closest('.upload-container')\n-  if (container && aspectRatio) {\n-    const maxHeight = Math.min(300, container.offsetWidth / aspectRatio)\n-    container.style.height = `${maxHeight}px`\n-  }\n+  // 不再需要动态调整容器高度，使用统一的固定尺寸\n }\n \n const onImageError = () => {\n   loading.value = false\n"
                },
                {
                    "date": 1752414018016,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -278,15 +278,30 @@\n   loading.value = false\n   error.value = '图片加载失败'\n }\n \n+// 响应式检测\n+const updateMobileStatus = () => {\n+  isMobile.value = ImageSizeUtils.isMobile()\n+}\n+\n // 监听modelValue变化\n watch(() => props.modelValue, (newValue) => {\n   if (!newValue) {\n     fileInfo.value = null\n     error.value = ''\n   }\n })\n+\n+// 生命周期\n+onMounted(() => {\n+  updateMobileStatus()\n+  window.addEventListener('resize', updateMobileStatus)\n+})\n+\n+onUnmounted(() => {\n+  window.removeEventListener('resize', updateMobileStatus)\n+})\n </script>\n \n <style scoped>\n .single-image-upload {\n"
                },
                {
                    "date": 1752414034334,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -310,13 +310,18 @@\n \n .upload-container {\n   position: relative;\n   border: 2px dashed rgba(255, 255, 255, 0.2);\n-  border-radius: 8px;\n+  border-radius: 12px;\n   cursor: pointer;\n   transition: all 0.3s ease;\n   overflow: hidden;\n-  min-height: 120px;\n+  background: rgba(255, 255, 255, 0.05);\n+  backdrop-filter: blur(10px);\n+  -webkit-backdrop-filter: blur(10px);\n+  border: 1px solid rgba(255, 255, 255, 0.2);\n+  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);\n+  margin: 0 auto;\n }\n \n .upload-container:hover:not(.disabled) {\n   border-color: rgba(255, 255, 255, 0.4);\n"
                },
                {
                    "date": 1752414048280,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -363,9 +363,9 @@\n \n .uploaded-image {\n   width: 100%;\n   height: 100%;\n-  object-fit: contain;\n+  object-fit: cover;\n   background: rgba(0, 0, 0, 0.1);\n }\n \n .image-overlay {\n"
                },
                {
                    "date": 1752421857623,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -358,14 +358,19 @@\n .image-container {\n   position: relative;\n   width: 100%;\n   height: 100%;\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n }\n \n .uploaded-image {\n-  width: 100%;\n-  height: 100%;\n-  object-fit: cover;\n+  max-width: 100%;\n+  max-height: 100%;\n+  width: auto;\n+  height: auto;\n+  object-fit: contain;\n   background: rgba(0, 0, 0, 0.1);\n }\n \n .image-overlay {\n"
                }
            ],
            "date": 1752393485845,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"single-image-upload\">\n    <div\n      class=\"upload-container\"\n      :class=\"{ 'has-image': modelValue, 'disabled': disabled }\"\n      @click=\"!disabled && triggerUpload()\"\n    >\n      <!-- 无图片状态 -->\n      <template v-if=\"!modelValue\">\n        <div class=\"upload-placeholder\">\n          <van-icon\n            name=\"plus\"\n            :size=\"iconSize\"\n            :color=\"iconColor\"\n          />\n          <div class=\"upload-text\">{{ uploadText }}</div>\n          <div v-if=\"description\" class=\"upload-description\">{{ description }}</div>\n        </div>\n      </template>\n\n      <!-- 有图片状态 -->\n      <template v-else>\n        <div class=\"image-container\">\n          <img\n            :src=\"modelValue\"\n            :alt=\"uploadText\"\n            class=\"uploaded-image\"\n            @load=\"onImageLoad\"\n            @error=\"onImageError\"\n          />\n\n          <!-- 图片操作覆盖层 -->\n          <div class=\"image-overlay\">\n            <div class=\"overlay-actions\">\n              <van-icon\n                name=\"eye-o\"\n                size=\"20\"\n                color=\"white\"\n                @click.stop=\"previewImage\"\n              />\n              <van-icon\n                name=\"edit\"\n                size=\"20\"\n                color=\"white\"\n                @click.stop=\"triggerUpload()\"\n              />\n              <van-icon\n                name=\"delete\"\n                size=\"20\"\n                color=\"white\"\n                @click.stop=\"removeImage\"\n              />\n            </div>\n          </div>\n\n          <!-- 加载状态 -->\n          <div v-if=\"loading\" class=\"loading-overlay\">\n            <van-loading size=\"24\" color=\"white\" />\n          </div>\n        </div>\n      </template>\n    </div>\n\n    <!-- 文件信息 -->\n    <div v-if=\"showFileInfo && fileInfo\" class=\"file-info\">\n      <div class=\"info-item\">\n        <van-icon name=\"info-o\" size=\"14\" />\n        <span>{{ fileInfo.name }}</span>\n      </div>\n      <div class=\"info-item\">\n        <van-icon name=\"photo-o\" size=\"14\" />\n        <span>{{ fileInfo.size }}</span>\n      </div>\n    </div>\n\n    <!-- 错误提示 -->\n    <div v-if=\"error\" class=\"error-message\">\n      <van-icon name=\"warning-o\" size=\"14\" color=\"var(--van-danger-color)\" />\n      <span>{{ error }}</span>\n    </div>\n\n    <!-- 隐藏的文件输入 -->\n    <input\n      ref=\"fileInput\"\n      type=\"file\"\n      :accept=\"accept\"\n      style=\"display: none\"\n      @change=\"handleFileSelect\"\n    />\n\n    <!-- 图片预览弹窗 -->\n    <van-image-preview\n      v-model:show=\"showPreview\"\n      :images=\"[modelValue]\"\n      :start-position=\"0\"\n      @close=\"showPreview = false\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport { Toast } from 'vant'\n\n// Props\nconst props = defineProps({\n  modelValue: {\n    type: String,\n    default: null\n  },\n  uploadText: {\n    type: String,\n    default: '上传图片'\n  },\n  description: {\n    type: String,\n    default: ''\n  },\n  accept: {\n    type: String,\n    default: 'image/*'\n  },\n  maxSize: {\n    type: Number,\n    default: 10 * 1024 * 1024 // 10MB\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  iconSize: {\n    type: [String, Number],\n    default: 32\n  },\n  iconColor: {\n    type: String,\n    default: 'var(--van-text-color-3)'\n  },\n  showFileInfo: {\n    type: Boolean,\n    default: false\n  },\n  containerHeight: {\n    type: [String, Number],\n    default: 120\n  }\n})\n\n// Emits\nconst emit = defineEmits(['update:modelValue', 'change', 'error'])\n\n// 响应式数据\nconst fileInput = ref(null)\nconst loading = ref(false)\nconst error = ref('')\nconst fileInfo = ref(null)\nconst showPreview = ref(false)\n\n// 计算属性\nconst containerHeightValue = computed(() => {\n  return typeof props.containerHeight === 'number'\n    ? `${props.containerHeight}px`\n    : props.containerHeight\n})\n\n// 方法\nconst triggerUpload = () => {\n  if (fileInput.value && !props.disabled) {\n    fileInput.value.click()\n  }\n}\n\nconst handleFileSelect = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 清除之前的错误\n  error.value = ''\n\n  // 验证文件\n  if (!validateFile(file)) {\n    event.target.value = '' // 清空input\n    return\n  }\n\n  loading.value = true\n\n  try {\n    // 读取文件\n    const dataUrl = await readFileAsDataURL(file)\n\n    // 更新文件信息\n    fileInfo.value = {\n      name: file.name,\n      size: formatFileSize(file.size),\n      type: file.type\n    }\n\n    // 发出事件\n    emit('update:modelValue', dataUrl)\n    emit('change', dataUrl, file)\n\n    Toast.success('图片上传成功')\n  } catch (err) {\n    error.value = '图片读取失败'\n    emit('error', err)\n    Toast.fail('图片上传失败')\n  } finally {\n    loading.value = false\n    event.target.value = '' // 清空input\n  }\n}\n\nconst validateFile = (file) => {\n  // 检查文件类型\n  if (!file.type.startsWith('image/')) {\n    error.value = '请选择图片文件'\n    Toast.fail('请选择图片文件')\n    return false\n  }\n\n  // 检查文件大小\n  if (file.size > props.maxSize) {\n    const maxSizeMB = Math.round(props.maxSize / 1024 / 1024)\n    error.value = `文件大小不能超过 ${maxSizeMB}MB`\n    Toast.fail(`文件大小不能超过 ${maxSizeMB}MB`)\n    return false\n  }\n\n  return true\n}\n\nconst readFileAsDataURL = (file) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = (e) => resolve(e.target.result)\n    reader.onerror = reject\n    reader.readAsDataURL(file)\n  })\n}\n\nconst formatFileSize = (bytes) => {\n  if (bytes === 0) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n}\n\nconst removeImage = () => {\n  emit('update:modelValue', null)\n  emit('change', null, null)\n  fileInfo.value = null\n  error.value = ''\n  Toast.success('图片已移除')\n}\n\nconst previewImage = () => {\n  if (props.modelValue) {\n    showPreview.value = true\n  }\n}\n\nconst onImageLoad = () => {\n  loading.value = false\n}\n\nconst onImageError = () => {\n  loading.value = false\n  error.value = '图片加载失败'\n}\n\n// 监听modelValue变化\nwatch(() => props.modelValue, (newValue) => {\n  if (!newValue) {\n    fileInfo.value = null\n    error.value = ''\n  }\n})\n</script>\n\n<style scoped>\n.single-image-upload {\n  width: 100%;\n}\n\n.upload-container {\n  position: relative;\n  border: 2px dashed rgba(255, 255, 255, 0.2);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  overflow: hidden;\n  v-bind(containerStyle);\n}\n\n.upload-container:hover:not(.disabled) {\n  border-color: rgba(255, 255, 255, 0.4);\n  background: rgba(255, 255, 255, 0.05);\n}\n\n.upload-container.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.upload-placeholder {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  padding: 16px;\n}\n\n.upload-text {\n  font-size: 14px;\n  color: var(--van-text-color-2);\n  margin-top: 8px;\n}\n\n.upload-description {\n  font-size: 12px;\n  color: var(--van-text-color-3);\n  margin-top: 4px;\n  text-align: center;\n}\n\n.image-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.uploaded-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.image-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.upload-container:hover .image-overlay {\n  opacity: 1;\n}\n\n.overlay-actions {\n  display: flex;\n  gap: 16px;\n}\n\n.overlay-actions .van-icon {\n  cursor: pointer;\n  transition: transform 0.2s ease;\n}\n\n.overlay-actions .van-icon:hover {\n  transform: scale(1.1);\n}\n\n.loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.file-info {\n  margin-top: 8px;\n  padding: 8px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 4px;\n  font-size: 12px;\n}\n\n.info-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: var(--van-text-color-3);\n  margin-bottom: 4px;\n}\n\n.info-item:last-child {\n  margin-bottom: 0;\n}\n\n.error-message {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  padding: 8px;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 4px;\n  font-size: 12px;\n  color: var(--van-danger-color);\n}\n\n/* 移动端优化 */\n@media (max-width: 768px) {\n  .overlay-actions {\n    gap: 12px;\n  }\n\n  .overlay-actions .van-icon {\n    font-size: 18px;\n  }\n}\n</style>\n"
        }
    ]
}