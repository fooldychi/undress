{
    "sourceFile": "client/src/components/TopNavigation.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 47,
            "patches": [
                {
                    "date": 1752290874113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752290897253,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -84,10 +84,13 @@\n let statusUpdateTimer = null\n \n // æ›´æ–°ç§¯åˆ†çŠ¶æ€\n const updatePointsStatus = async () => {\n+  console.log('ğŸ”„ æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œå½“å‰ç™»å½•çŠ¶æ€:', levelCardPointsManager.isLoggedIn(), isLoggedIn.value)\n+\n   // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™ä¸å‘é€APIè¯·æ±‚\n-  if (!levelCardPointsManager.isLoggedIn()) {\n+  if (!levelCardPointsManager.isLoggedIn() || !isLoggedIn.value) {\n+    console.log('âŒ æœªç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç§¯åˆ†çŠ¶æ€')\n     Object.assign(pointsStatus, {\n       current: 0,\n       total_points: 0,\n       cards_count: 0,\n@@ -98,14 +101,17 @@\n     return\n   }\n \n   try {\n+    console.log('ğŸš€ å‘é€ç§¯åˆ†APIè¯·æ±‚...')\n     const newStatus = await levelCardPointsManager.getPointsStatus()\n+    console.log('âœ… ç§¯åˆ†çŠ¶æ€æ›´æ–°æˆåŠŸ:', newStatus)\n     Object.assign(pointsStatus, newStatus)\n   } catch (error) {\n-    console.error('æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n+    console.error('âŒ æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n     // è®¤è¯é”™è¯¯å¤„ç†\n     if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n+      console.log('ğŸ”’ è®¤è¯é”™è¯¯ï¼Œé‡ç½®ç§¯åˆ†çŠ¶æ€')\n       Object.assign(pointsStatus, {\n         current: 0,\n         total_points: 0,\n         cards_count: 0,\n"
                },
                {
                    "date": 1752290912678,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,21 +167,24 @@\n }\n \n // åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯\n const initUserInfo = () => {\n-  console.log('åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...')\n+  console.log('ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...')\n   const token = authApi.getToken()\n   const localUserInfo = authApi.getLocalUserInfo()\n \n   console.log('Tokenå­˜åœ¨:', !!token)\n   console.log('æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', localUserInfo)\n \n   if (token && localUserInfo) {\n     userInfo.value = localUserInfo\n-    console.log('è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\n+    pointsStatus.isLoggedIn = true\n+    console.log('âœ… è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\n+    console.log('âœ… è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºtrue')\n   } else {\n-    console.log('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\n+    console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\n     userInfo.value = null\n+    pointsStatus.isLoggedIn = false\n   }\n }\n \n // ç›‘å¬localStorageå˜åŒ–\n"
                },
                {
                    "date": 1752290981271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,9 +220,13 @@\n // æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\n defineExpose({\n   updatePointsStatus,\n   getCurrentPoints: () => pointsStatus.current,\n-  hasEnoughPoints: () => pointsStatus.canGenerate\n+  hasEnoughPoints: () => pointsStatus.canGenerate,\n+  showLoginModal: () => {\n+    authMode.value = 'login'\n+    showAuthModal.value = true\n+  }\n })\n </script>\n \n <style scoped>\n"
                },
                {
                    "date": 1752341911904,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,18 @@\n <template>\n   <div class=\"top-navigation\">\n-    <!-- ç§¯åˆ†æ˜¾ç¤ºï¼ˆå·¦è¾¹ï¼‰ -->\n-    <div class=\"nav-item nav-points\" @click=\"showPointsModal = true\" title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\">\n+    <!-- ç§¯åˆ†æ˜¾ç¤ºï¼ˆå·¦è¾¹ï¼‰ - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n+    <div\n+      v-if=\"isLoggedIn\"\n+      class=\"nav-item nav-points\"\n+      @click=\"showPointsModal = true\"\n+      title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\"\n+    >\n       <div class=\"nav-icon\">\n         <van-icon name=\"diamond-o\" size=\"18\" />\n       </div>\n-      <span class=\"nav-text\">{{ pointsStatus.current }}</span>\n+      <span v-if=\"!pointsLoading\" class=\"nav-text\">{{ pointsStatus.current }}</span>\n+      <van-loading v-else size=\"14\" color=\"var(--primary-color)\" />\n     </div>\n \n     <!-- ç”¨æˆ·ä¿¡æ¯ï¼ˆå³è¾¹ï¼‰ -->\n     <div class=\"nav-item nav-user\">\n"
                },
                {
                    "date": 1752341923307,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,8 +66,9 @@\n const showPointsModal = ref(false)\n const showAuthModal = ref(false)\n const authMode = ref('login')\n const loading = ref(false)\n+const pointsLoading = ref(false)\n \n // ç”¨æˆ·ä¿¡æ¯\n const userInfo = ref(null)\n const isLoggedIn = computed(() => {\n"
                },
                {
                    "date": 1752341943757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,8 +96,9 @@\n \n   // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™ä¸å‘é€APIè¯·æ±‚\n   if (!levelCardPointsManager.isLoggedIn() || !isLoggedIn.value) {\n     console.log('âŒ æœªç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç§¯åˆ†çŠ¶æ€')\n+    pointsLoading.value = false\n     Object.assign(pointsStatus, {\n       current: 0,\n       total_points: 0,\n       cards_count: 0,\n@@ -108,8 +109,9 @@\n     return\n   }\n \n   try {\n+    pointsLoading.value = true\n     console.log('ğŸš€ å‘é€ç§¯åˆ†APIè¯·æ±‚...')\n     const newStatus = await levelCardPointsManager.getPointsStatus()\n     console.log('âœ… ç§¯åˆ†çŠ¶æ€æ›´æ–°æˆåŠŸ:', newStatus)\n     Object.assign(pointsStatus, newStatus)\n@@ -126,8 +128,10 @@\n         generationCost: 20,\n         isLoggedIn: false\n       })\n     }\n+  } finally {\n+    pointsLoading.value = false\n   }\n }\n \n // æ˜¾ç¤ºç™»å½•å¼¹çª—\n"
                },
                {
                    "date": 1752341960528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -140,9 +140,9 @@\n   showAuthModal.value = true\n }\n \n // å¤„ç†è®¤è¯æˆåŠŸ\n-const handleAuthSuccess = (data) => {\n+const handleAuthSuccess = async (data) => {\n   console.log('è®¤è¯æˆåŠŸï¼Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', data)\n \n   // ç«‹å³æ›´æ–°ç”¨æˆ·ä¿¡æ¯\n   userInfo.value = data.user\n@@ -157,12 +157,10 @@\n \n   // è§¦å‘çˆ¶ç»„ä»¶çš„ç™»å½•äº‹ä»¶\n   emit('login', data)\n \n-  // å»¶è¿Ÿæ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œç¡®ä¿ç™»å½•çŠ¶æ€å·²åŒæ­¥\n-  setTimeout(() => {\n-    updatePointsStatus()\n-  }, 100)\n+  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€\n+  await updatePointsStatus()\n \n   // å…³é—­å¼¹çª—\n   showAuthModal.value = false\n }\n"
                },
                {
                    "date": 1752342580448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,10 +170,16 @@\n   router.push('/profile')\n }\n \n // å¤„ç†ç§¯åˆ†æ›´æ–°\n-const handlePointsUpdated = () => {\n-  updatePointsStatus()\n+const handlePointsUpdated = async () => {\n+  console.log('ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†çŠ¶æ€')\n+  // æ¸…é™¤levelCardPointsManagerçš„ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®\n+  levelCardPointsManager.pointsInfo = null\n+  levelCardPointsManager.lastUpdateTime = 0\n+\n+  // æ›´æ–°ç§¯åˆ†çŠ¶æ€\n+  await updatePointsStatus()\n }\n \n // åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯\n const initUserInfo = () => {\n"
                },
                {
                    "date": 1752342628711,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -173,10 +173,9 @@\n // å¤„ç†ç§¯åˆ†æ›´æ–°\n const handlePointsUpdated = async () => {\n   console.log('ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†çŠ¶æ€')\n   // æ¸…é™¤levelCardPointsManagerçš„ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®\n-  levelCardPointsManager.pointsInfo = null\n-  levelCardPointsManager.lastUpdateTime = 0\n+  levelCardPointsManager.clearCache()\n \n   // æ›´æ–°ç§¯åˆ†çŠ¶æ€\n   await updatePointsStatus()\n }\n"
                },
                {
                    "date": 1752348718404,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,17 +17,17 @@\n     <!-- ç”¨æˆ·ä¿¡æ¯ï¼ˆå³è¾¹ï¼‰ -->\n     <div class=\"nav-item nav-user\">\n       <!-- æœªç™»å½•çŠ¶æ€ -->\n       <div v-if=\"!isLoggedIn\" class=\"nav-login\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\n-        <div class=\"nav-icon\">\n+        <div class=\"nav-icon nav-icon-user\">\n           <van-icon name=\"user-o\" size=\"18\" />\n         </div>\n         <span class=\"nav-text\">ç™»å½•</span>\n       </div>\n \n       <!-- å·²ç™»å½•çŠ¶æ€ -->\n       <div v-else class=\"nav-avatar\" @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\n-        <div class=\"nav-icon\">\n+        <div class=\"nav-icon nav-icon-user\">\n           <van-icon name=\"user-o\" size=\"18\" />\n         </div>\n       </div>\n     </div>\n"
                },
                {
                    "date": 1752348742257,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -283,8 +283,15 @@\n   height: 24px;\n   color: #1989fa;\n }\n \n+/* ç”¨æˆ·å›¾æ ‡æ ·å¼ - ä¸ç§¯åˆ†å›¾æ ‡ä¿æŒä¸€è‡´ */\n+.nav-icon-user {\n+  color: #1989fa !important;\n+  background: none !important;\n+  border: none !important;\n+}\n+\n .nav-text {\n   font-size: 14px;\n   font-weight: 500;\n   color: #323233;\n"
                },
                {
                    "date": 1752374736233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,51 +1,66 @@\n <template>\n-  <div class=\"top-navigation\">\n-    <!-- ç§¯åˆ†æ˜¾ç¤ºï¼ˆå·¦è¾¹ï¼‰ - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n-    <div\n-      v-if=\"isLoggedIn\"\n-      class=\"nav-item nav-points\"\n-      @click=\"showPointsModal = true\"\n-      title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\"\n-    >\n-      <div class=\"nav-icon\">\n-        <van-icon name=\"diamond-o\" size=\"18\" />\n+  <van-nav-bar\n+    :title=\"pageTitle\"\n+    :left-arrow=\"showBackButton\"\n+    @click-left=\"handleLeftClick\"\n+    class=\"top-navigation\"\n+    fixed\n+    placeholder\n+  >\n+    <!-- å·¦ä¾§æ’æ§½ -->\n+    <template #left>\n+      <div class=\"nav-left\">\n+        <div v-if=\"!showBackButton\" class=\"nav-logo\" @click=\"goToHome\">\n+          <van-icon name=\"home-o\" size=\"18\" />\n+          <span class=\"logo-text\">AI Magic</span>\n+        </div>\n       </div>\n-      <span v-if=\"!pointsLoading\" class=\"nav-text\">{{ pointsStatus.current }}</span>\n-      <van-loading v-else size=\"14\" color=\"var(--primary-color)\" />\n-    </div>\n+    </template>\n \n-    <!-- ç”¨æˆ·ä¿¡æ¯ï¼ˆå³è¾¹ï¼‰ -->\n-    <div class=\"nav-item nav-user\">\n-      <!-- æœªç™»å½•çŠ¶æ€ -->\n-      <div v-if=\"!isLoggedIn\" class=\"nav-login\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\n-        <div class=\"nav-icon nav-icon-user\">\n-          <van-icon name=\"user-o\" size=\"18\" />\n+    <!-- å³ä¾§æ’æ§½ -->\n+    <template #right>\n+      <div class=\"nav-right\">\n+        <!-- ç§¯åˆ†æ˜¾ç¤º - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n+        <div\n+          v-if=\"isLoggedIn\"\n+          class=\"nav-points\"\n+          @click=\"showPointsModal = true\"\n+          title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\"\n+        >\n+          <van-icon name=\"diamond-o\" size=\"16\" />\n+          <span v-if=\"!pointsLoading\" class=\"points-text\">{{ pointsStatus.current }}</span>\n+          <van-loading v-else size=\"12\" color=\"var(--primary-color)\" />\n         </div>\n-        <span class=\"nav-text\">ç™»å½•</span>\n-      </div>\n \n-      <!-- å·²ç™»å½•çŠ¶æ€ -->\n-      <div v-else class=\"nav-avatar\" @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\n-        <div class=\"nav-icon nav-icon-user\">\n-          <van-icon name=\"user-o\" size=\"18\" />\n+        <!-- ç”¨æˆ·ä¿¡æ¯ -->\n+        <div class=\"nav-user\">\n+          <!-- æœªç™»å½•çŠ¶æ€ -->\n+          <div v-if=\"!isLoggedIn\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\n+            <van-icon name=\"user-o\" size=\"16\" />\n+            <span class=\"user-text\">ç™»å½•</span>\n+          </div>\n+          <!-- å·²ç™»å½•çŠ¶æ€ -->\n+          <div v-else @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\n+            <van-icon name=\"user-o\" size=\"16\" />\n+          </div>\n         </div>\n       </div>\n-    </div>\n+    </template>\n+  </van-nav-bar>\n \n-    <!-- ç§¯åˆ†å¼¹çª— -->\n-    <PointsModal\n-      v-model:show=\"showPointsModal\"\n-      @points-updated=\"handlePointsUpdated\"\n-    />\n+  <!-- ç§¯åˆ†å¼¹çª— -->\n+  <PointsModal\n+    v-model:show=\"showPointsModal\"\n+    @points-updated=\"handlePointsUpdated\"\n+  />\n \n-    <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->\n-    <AuthModal\n-      v-model:show=\"showAuthModal\"\n-      :default-mode=\"authMode\"\n-      @success=\"handleAuthSuccess\"\n-    />\n-  </div>\n+  <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->\n+  <AuthModal\n+    v-model:show=\"showAuthModal\"\n+    :default-mode=\"authMode\"\n+    @success=\"handleAuthSuccess\"\n+  />\n </template>\n \n <script setup>\n import { ref, reactive, computed, onMounted, onUnmounted } from 'vue'\n"
                },
                {
                    "date": 1752374753785,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,15 +63,27 @@\n </template>\n \n <script setup>\n import { ref, reactive, computed, onMounted, onUnmounted } from 'vue'\n-import { useRouter } from 'vue-router'\n+import { useRouter, useRoute } from 'vue-router'\n import { Toast } from 'vant'\n import { authApi } from '../services/api.js'\n import levelCardPointsManager from '../utils/levelCardPointsManager.js'\n import PointsModal from './PointsModal.vue'\n import AuthModal from './AuthModal.vue'\n \n+// å®šä¹‰props\n+const props = defineProps({\n+  title: {\n+    type: String,\n+    default: ''\n+  },\n+  showBack: {\n+    type: Boolean,\n+    default: null // nullè¡¨ç¤ºè‡ªåŠ¨åˆ¤æ–­\n+  }\n+})\n+\n // å®šä¹‰äº‹ä»¶\n const emit = defineEmits(['login', 'logout'])\n \n // è·¯ç”±\n"
                },
                {
                    "date": 1752374768639,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,9 +87,33 @@\n const emit = defineEmits(['login', 'logout'])\n \n // è·¯ç”±\n const router = useRouter()\n+const route = useRoute()\n \n+// è®¡ç®—å±æ€§\n+const pageTitle = computed(() => {\n+  if (props.title) return props.title\n+\n+  // æ ¹æ®è·¯ç”±è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜\n+  const routeTitleMap = {\n+    '/': 'AI Magic',\n+    '/clothes-swap': 'ä¸€é”®æ¢è¡£',\n+    '/face-swap': 'æé€Ÿæ¢è„¸',\n+    '/text-to-image': 'æ–‡ç”Ÿå›¾',\n+    '/profile': 'ä¸ªäººä¸­å¿ƒ'\n+  }\n+\n+  return routeTitleMap[route.path] || 'AI Magic'\n+})\n+\n+const showBackButton = computed(() => {\n+  if (props.showBack !== null) return props.showBack\n+\n+  // è‡ªåŠ¨åˆ¤æ–­ï¼šé¦–é¡µä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œå…¶ä»–é¡µé¢æ˜¾ç¤º\n+  return route.path !== '/'\n+})\n+\n // å“åº”å¼æ•°æ®\n const showPointsModal = ref(false)\n const showAuthModal = ref(false)\n const authMode = ref('login')\n"
                },
                {
                    "date": 1752374788122,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -215,8 +215,25 @@\n   // å…³é—­å¼¹çª—\n   showAuthModal.value = false\n }\n \n+// å¤„ç†å·¦ä¾§ç‚¹å‡»äº‹ä»¶\n+const handleLeftClick = () => {\n+  if (showBackButton.value) {\n+    // è¿”å›ä¸Šä¸€é¡µ\n+    if (window.history.length > 1) {\n+      router.go(-1)\n+    } else {\n+      router.push('/')\n+    }\n+  }\n+}\n+\n+// è·³è½¬åˆ°é¦–é¡µ\n+const goToHome = () => {\n+  router.push('/')\n+}\n+\n // è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ\n const goToProfile = () => {\n   router.push('/profile')\n }\n"
                },
                {
                    "date": 1752374830618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -311,118 +311,144 @@\n })\n </script>\n \n <style scoped>\n+/* Vant NavBar è‡ªå®šä¹‰æ ·å¼ */\n .top-navigation {\n-  position: fixed;\n-  top: 20px;\n-  right: 20px;\n+  background: var(--van-nav-bar-background, #fff);\n+  border-bottom: 1px solid var(--van-border-color, #ebedf0);\n+  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n+}\n+\n+/* å·¦ä¾§åŒºåŸŸ */\n+.nav-left {\n   display: flex;\n   align-items: center;\n-  gap: 12px;\n-  z-index: 1000;\n+  gap: 8px;\n }\n \n-.nav-item {\n+.nav-logo {\n   display: flex;\n   align-items: center;\n   gap: 6px;\n-  padding: 8px 12px;\n-  background: rgba(255, 255, 255, 0.95);\n-  backdrop-filter: blur(10px);\n-  border: 1px solid rgba(255, 255, 255, 0.2);\n-  border-radius: 20px;\n   cursor: pointer;\n+  padding: 4px 8px;\n+  border-radius: 12px;\n   transition: all 0.3s ease;\n-  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n }\n \n-.nav-item:hover {\n-  background: rgba(255, 255, 255, 1);\n-  border-color: #1989fa;\n-  box-shadow: 0 4px 12px rgba(25, 137, 250, 0.2);\n-  transform: translateY(-1px);\n+.nav-logo:hover {\n+  background: rgba(25, 137, 250, 0.1);\n }\n \n-.nav-icon {\n+.logo-text {\n+  font-size: 14px;\n+  font-weight: 600;\n+  color: var(--van-primary-color, #1989fa);\n+}\n+\n+/* å³ä¾§åŒºåŸŸ */\n+.nav-right {\n   display: flex;\n   align-items: center;\n-  justify-content: center;\n-  width: 24px;\n-  height: 24px;\n-  color: #1989fa;\n+  gap: 12px;\n }\n \n-/* ç”¨æˆ·å›¾æ ‡æ ·å¼ - ä¸ç§¯åˆ†å›¾æ ‡ä¿æŒä¸€è‡´ */\n-.nav-icon-user {\n-  color: #1989fa !important;\n-  background: none !important;\n-  border: none !important;\n+/* ç§¯åˆ†æ˜¾ç¤º */\n+.nav-points {\n+  display: flex;\n+  align-items: center;\n+  gap: 4px;\n+  padding: 6px 10px;\n+  background: rgba(25, 137, 250, 0.1);\n+  border-radius: 16px;\n+  cursor: pointer;\n+  transition: all 0.3s ease;\n+  min-width: 60px;\n+  justify-content: center;\n }\n \n-.nav-text {\n-  font-size: 14px;\n-  font-weight: 500;\n-  color: #323233;\n-  white-space: nowrap;\n+.nav-points:hover {\n+  background: rgba(25, 137, 250, 0.2);\n+  transform: translateY(-1px);\n }\n \n-.nav-points {\n-  order: 1; /* ç§¯åˆ†åœ¨å·¦è¾¹ */\n+.points-text {\n+  font-size: 12px;\n+  font-weight: 600;\n+  color: var(--van-primary-color, #1989fa);\n+  margin-left: 2px;\n }\n \n+/* ç”¨æˆ·ä¿¡æ¯ */\n .nav-user {\n-  order: 2; /* ç”¨æˆ·åœ¨å³è¾¹ */\n-}\n-\n-.nav-login {\n   display: flex;\n   align-items: center;\n-  gap: 6px;\n+  cursor: pointer;\n }\n \n-.nav-avatar {\n+.nav-user > div {\n   display: flex;\n   align-items: center;\n-  justify-content: center;\n-  width: 32px;\n-  height: 32px;\n-  background: linear-gradient(135deg, #1989fa, #1976d2);\n-  border-radius: 50%;\n-  color: white;\n-  margin: -4px;\n+  gap: 4px;\n+  padding: 6px 10px;\n+  border-radius: 16px;\n+  transition: all 0.3s ease;\n+  color: var(--van-text-color, #323233);\n }\n \n-.nav-avatar:hover {\n-  background: linear-gradient(135deg, #1976d2, #1565c0);\n-  transform: scale(1.05);\n+.nav-user > div:hover {\n+  background: rgba(25, 137, 250, 0.1);\n+  color: var(--van-primary-color, #1989fa);\n }\n \n+.user-text {\n+  font-size: 12px;\n+  font-weight: 500;\n+}\n+\n /* æ·±è‰²ä¸»é¢˜é€‚é… */\n @media (prefers-color-scheme: dark) {\n-  .nav-item {\n-    background: rgba(30, 30, 30, 0.95);\n-    border-color: rgba(255, 255, 255, 0.1);\n+  .top-navigation {\n+    background: var(--van-nav-bar-background, #1e1e1e);\n+    border-bottom-color: var(--van-border-color, #333);\n   }\n \n-  .nav-item:hover {\n-    background: rgba(40, 40, 40, 1);\n-    border-color: #1989fa;\n+  .nav-points {\n+    background: rgba(25, 137, 250, 0.2);\n   }\n \n-  .nav-text {\n-    color: #ffffff;\n+  .nav-points:hover {\n+    background: rgba(25, 137, 250, 0.3);\n   }\n+\n+  .nav-user > div:hover {\n+    background: rgba(25, 137, 250, 0.2);\n+  }\n }\n \n /* å“åº”å¼è®¾è®¡ */\n @media (max-width: 768px) {\n-  .top-navigation {\n-    top: 15px;\n-    right: 15px;\n+  .nav-right {\n     gap: 8px;\n   }\n \n+  .nav-points {\n+    padding: 4px 8px;\n+    min-width: 50px;\n+  }\n+\n+  .points-text,\n+  .user-text {\n+    font-size: 11px;\n+  }\n+\n+  .logo-text {\n+    font-size: 13px;\n+  }\n+}\n+  }\n+\n   .nav-item {\n     padding: 6px 10px;\n   }\n \n"
                },
                {
                    "date": 1752374850872,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -445,20 +445,5 @@\n   .logo-text {\n     font-size: 13px;\n   }\n }\n-  }\n-\n-  .nav-item {\n-    padding: 6px 10px;\n-  }\n-\n-  .nav-text {\n-    font-size: 13px;\n-  }\n-\n-  .nav-icon {\n-    width: 20px;\n-    height: 20px;\n-  }\n-}\n </style>\n"
                },
                {
                    "date": 1752376649580,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -261,15 +261,32 @@\n     userInfo.value = localUserInfo\n     pointsStatus.isLoggedIn = true\n     console.log('âœ… è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\n     console.log('âœ… è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºtrue')\n+\n+    // éªŒè¯tokenæœ‰æ•ˆæ€§ï¼ˆé™é»˜éªŒè¯ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼‰\n+    validateTokenSilently()\n   } else {\n     console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\n     userInfo.value = null\n     pointsStatus.isLoggedIn = false\n   }\n }\n \n+// é™é»˜éªŒè¯token\n+const validateTokenSilently = async () => {\n+  try {\n+    const response = await authApi.getCurrentUser()\n+    if (!response.success) {\n+      console.warn('TokenéªŒè¯å¤±è´¥ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·')\n+      // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\n+    }\n+  } catch (error) {\n+    console.warn('TokenéªŒè¯å‡ºé”™ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·:', error)\n+    // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\n+  }\n+}\n+\n // ç›‘å¬localStorageå˜åŒ–\n const handleStorageChange = (event) => {\n   console.log('localStorageå˜åŒ–:', event)\n   if (event.key === 'auth_token' || event.key === 'user_info') {\n"
                },
                {
                    "date": 1752376665485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -305,8 +305,29 @@\n   window.addEventListener('storage', handleStorageChange)\n \n   // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€\n   statusUpdateTimer = setInterval(updatePointsStatus, 30000)\n+\n+  // å®šæœŸæ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ˆé˜²æ­¢tokenè¿‡æœŸç­‰é—®é¢˜ï¼‰\n+  const checkInterval = setInterval(() => {\n+    const token = authApi.getToken()\n+    const localUserInfo = authApi.getLocalUserInfo()\n+\n+    // çŠ¶æ€ä¸ä¸€è‡´æ—¶é‡æ–°åˆå§‹åŒ–\n+    if ((token && !userInfo.value) || (!token && userInfo.value)) {\n+      console.log('æ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ä¸ä¸€è‡´ï¼Œé‡æ–°åˆå§‹åŒ–')\n+      initUserInfo()\n+    }\n+  }, 5000) // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡\n+\n+  // æ¸…ç†å®šæ—¶å™¨\n+  onUnmounted(() => {\n+    window.removeEventListener('storage', handleStorageChange)\n+    if (statusUpdateTimer) {\n+      clearInterval(statusUpdateTimer)\n+    }\n+    clearInterval(checkInterval)\n+  })\n })\n \n // ç»„ä»¶å¸è½½æ—¶æ¸…ç†\n onUnmounted(() => {\n"
                },
                {
                    "date": 1752376682514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -328,16 +328,8 @@\n     clearInterval(checkInterval)\n   })\n })\n \n-// ç»„ä»¶å¸è½½æ—¶æ¸…ç†\n-onUnmounted(() => {\n-  window.removeEventListener('storage', handleStorageChange)\n-  if (statusUpdateTimer) {\n-    clearInterval(statusUpdateTimer)\n-  }\n-})\n-\n // æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\n defineExpose({\n   updatePointsStatus,\n   getCurrentPoints: () => pointsStatus.current,\n"
                },
                {
                    "date": 1752381123254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,13 +11,25 @@\n     <template #left>\n       <div class=\"nav-left\">\n         <div v-if=\"!showBackButton\" class=\"nav-logo\" @click=\"goToHome\">\n           <van-icon name=\"home-o\" size=\"18\" />\n-          <span class=\"logo-text\">AI Magic</span>\n         </div>\n       </div>\n     </template>\n \n+    <!-- æ ‡é¢˜æ’æ§½ - æ·»åŠ å›¾æ ‡ -->\n+    <template #title>\n+      <div class=\"nav-title\">\n+        <van-icon\n+          v-if=\"getTitleIcon()\"\n+          :name=\"getTitleIcon()\"\n+          size=\"16\"\n+          class=\"title-icon\"\n+        />\n+        <span>{{ pageTitle }}</span>\n+      </div>\n+    </template>\n+\n     <!-- å³ä¾§æ’æ§½ -->\n     <template #right>\n       <div class=\"nav-right\">\n         <!-- ç§¯åˆ†æ˜¾ç¤º - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n"
                },
                {
                    "date": 1752381143046,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,8 +124,21 @@\n   // è‡ªåŠ¨åˆ¤æ–­ï¼šé¦–é¡µä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œå…¶ä»–é¡µé¢æ˜¾ç¤º\n   return route.path !== '/'\n })\n \n+// è·å–æ ‡é¢˜å›¾æ ‡\n+const getTitleIcon = () => {\n+  const iconMap = {\n+    '/': 'home-o',\n+    '/clothes-swap': 'user-o',\n+    '/face-swap': 'friends-o',\n+    '/text-to-image': 'photo-o',\n+    '/profile': 'manager-o'\n+  }\n+\n+  return iconMap[route.path] || 'apps-o'\n+}\n+\n // å“åº”å¼æ•°æ®\n const showPointsModal = ref(false)\n const showAuthModal = ref(false)\n const authMode = ref('login')\n"
                },
                {
                    "date": 1752381191009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -383,23 +383,27 @@\n \n .nav-logo {\n   display: flex;\n   align-items: center;\n-  gap: 6px;\n   cursor: pointer;\n-  padding: 4px 8px;\n-  border-radius: 12px;\n-  transition: all 0.3s ease;\n+  padding: 8px 12px;\n+  border-radius: 8px;\n+  color: var(--van-text-color, #323233);\n+  min-height: 44px;\n+  min-width: 44px;\n+  justify-content: center;\n }\n \n-.nav-logo:hover {\n-  background: rgba(25, 137, 250, 0.1);\n+/* æ ‡é¢˜åŒºåŸŸ */\n+.nav-title {\n+  display: flex;\n+  align-items: center;\n+  gap: 6px;\n+  font-weight: 600;\n }\n \n-.logo-text {\n-  font-size: 14px;\n-  font-weight: 600;\n-  color: var(--van-primary-color, #1989fa);\n+.title-icon {\n+  flex-shrink: 0;\n }\n \n /* å³ä¾§åŒºåŸŸ */\n .nav-right {\n"
                },
                {
                    "date": 1752381210632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -416,22 +416,17 @@\n .nav-points {\n   display: flex;\n   align-items: center;\n   gap: 4px;\n-  padding: 6px 10px;\n+  padding: 8px 12px;\n   background: rgba(25, 137, 250, 0.1);\n   border-radius: 16px;\n   cursor: pointer;\n-  transition: all 0.3s ease;\n   min-width: 60px;\n+  min-height: 44px;\n   justify-content: center;\n }\n \n-.nav-points:hover {\n-  background: rgba(25, 137, 250, 0.2);\n-  transform: translateY(-1px);\n-}\n-\n .points-text {\n   font-size: 12px;\n   font-weight: 600;\n   color: var(--van-primary-color, #1989fa);\n"
                },
                {
                    "date": 1752381229618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -443,19 +443,16 @@\n .nav-user > div {\n   display: flex;\n   align-items: center;\n   gap: 4px;\n-  padding: 6px 10px;\n+  padding: 8px 12px;\n   border-radius: 16px;\n-  transition: all 0.3s ease;\n   color: var(--van-text-color, #323233);\n+  min-height: 44px;\n+  min-width: 44px;\n+  justify-content: center;\n }\n \n-.nav-user > div:hover {\n-  background: rgba(25, 137, 250, 0.1);\n-  color: var(--van-primary-color, #1989fa);\n-}\n-\n .user-text {\n   font-size: 12px;\n   font-weight: 500;\n }\n"
                },
                {
                    "date": 1752381255601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -466,16 +466,8 @@\n \n   .nav-points {\n     background: rgba(25, 137, 250, 0.2);\n   }\n-\n-  .nav-points:hover {\n-    background: rgba(25, 137, 250, 0.3);\n-  }\n-\n-  .nav-user > div:hover {\n-    background: rgba(25, 137, 250, 0.2);\n-  }\n }\n \n /* å“åº”å¼è®¾è®¡ */\n @media (max-width: 768px) {\n"
                },
                {
                    "date": 1752381274395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -475,18 +475,27 @@\n     gap: 8px;\n   }\n \n   .nav-points {\n-    padding: 4px 8px;\n+    padding: 6px 10px;\n     min-width: 50px;\n+    min-height: 40px;\n   }\n \n+  .nav-user > div {\n+    padding: 6px 10px;\n+    min-height: 40px;\n+    min-width: 40px;\n+  }\n+\n+  .nav-logo {\n+    padding: 6px 10px;\n+    min-height: 40px;\n+    min-width: 40px;\n+  }\n+\n   .points-text,\n   .user-text {\n     font-size: 11px;\n   }\n-\n-  .logo-text {\n-    font-size: 13px;\n-  }\n }\n </style>\n"
                },
                {
                    "date": 1752385812575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,23 +9,25 @@\n   >\n     <!-- å·¦ä¾§æ’æ§½ -->\n     <template #left>\n       <div class=\"nav-left\">\n-        <div v-if=\"!showBackButton\" class=\"nav-logo\" @click=\"goToHome\">\n+        <!-- Removing the home icon that appears when not showing back button -->\n+        <!-- <div v-if=\"!showBackButton\" class=\"nav-logo\" @click=\"goToHome\">\n           <van-icon name=\"home-o\" size=\"18\" />\n-        </div>\n+        </div> -->\n       </div>\n     </template>\n \n-    <!-- æ ‡é¢˜æ’æ§½ - æ·»åŠ å›¾æ ‡ -->\n+    <!-- æ ‡é¢˜æ’æ§½ - ç§»é™¤å›¾æ ‡ï¼Œåªä¿ç•™æ–‡æœ¬ -->\n     <template #title>\n       <div class=\"nav-title\">\n-        <van-icon\n+        <!-- Removing the title icon -->\n+        <!-- <van-icon\n           v-if=\"getTitleIcon()\"\n           :name=\"getTitleIcon()\"\n           size=\"16\"\n           class=\"title-icon\"\n-        />\n+        /> -->\n         <span>{{ pageTitle }}</span>\n       </div>\n     </template>\n \n@@ -124,21 +126,21 @@\n   // è‡ªåŠ¨åˆ¤æ–­ï¼šé¦–é¡µä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œå…¶ä»–é¡µé¢æ˜¾ç¤º\n   return route.path !== '/'\n })\n \n-// è·å–æ ‡é¢˜å›¾æ ‡\n-const getTitleIcon = () => {\n-  const iconMap = {\n-    '/': 'home-o',\n-    '/clothes-swap': 'user-o',\n-    '/face-swap': 'friends-o',\n-    '/text-to-image': 'photo-o',\n-    '/profile': 'manager-o'\n-  }\n+// è·å–æ ‡é¢˜å›¾æ ‡ - ä¸å†éœ€è¦æ­¤å‡½æ•°\n+// const getTitleIcon = () => {\n+//   const iconMap = {\n+//     '/': 'home-o',\n+//     '/clothes-swap': 'user-o',\n+//     '/face-swap': 'friends-o',\n+//     '/text-to-image': 'photo-o',\n+//     '/profile': 'manager-o'\n+//   }\n+//\n+//   return iconMap[route.path] || 'apps-o'\n+// }\n \n-  return iconMap[route.path] || 'apps-o'\n-}\n-\n // å“åº”å¼æ•°æ®\n const showPointsModal = ref(false)\n const showAuthModal = ref(false)\n const authMode = ref('login')\n@@ -498,4 +500,6 @@\n     font-size: 11px;\n   }\n }\n </style>\n+\n+\n"
                },
                {
                    "date": 1752386244970,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,6 @@\n <template>\n   <van-nav-bar\n-    :title=\"pageTitle\"\n     :left-arrow=\"showBackButton\"\n     @click-left=\"handleLeftClick\"\n     class=\"top-navigation\"\n     fixed\n@@ -9,30 +8,27 @@\n   >\n     <!-- å·¦ä¾§æ’æ§½ -->\n     <template #left>\n       <div class=\"nav-left\">\n-        <!-- Removing the home icon that appears when not showing back button -->\n-        <!-- <div v-if=\"!showBackButton\" class=\"nav-logo\" @click=\"goToHome\">\n-          <van-icon name=\"home-o\" size=\"18\" />\n-        </div> -->\n+        <template v-if=\"showBackButton\">\n+          <!-- Back button remains unchanged -->\n+        </template>\n+        <template v-else>\n+          <!-- New left side branding -->\n+          <div class=\"nav-branding\" @click=\"goToHome\">\n+            <van-icon name=\"palette\" size=\"18\" color=\"#FFD700\" />\n+            <span class=\"brand-text\">AI Magic</span>\n+          </div>\n+        </template>\n       </div>\n     </template>\n \n-    <!-- æ ‡é¢˜æ’æ§½ - ç§»é™¤å›¾æ ‡ï¼Œåªä¿ç•™æ–‡æœ¬ -->\n+    <!-- æ ‡é¢˜æ’æ§½ - ç§»é™¤ä¸­é—´æ ‡é¢˜ -->\n     <template #title>\n-      <div class=\"nav-title\">\n-        <!-- Removing the title icon -->\n-        <!-- <van-icon\n-          v-if=\"getTitleIcon()\"\n-          :name=\"getTitleIcon()\"\n-          size=\"16\"\n-          class=\"title-icon\"\n-        /> -->\n-        <span>{{ pageTitle }}</span>\n-      </div>\n+      <!-- Title removed -->\n     </template>\n \n-    <!-- å³ä¾§æ’æ§½ -->\n+    <!-- å³ä¾§æ’æ§½ä¿æŒä¸å˜ -->\n     <template #right>\n       <div class=\"nav-right\">\n         <!-- ç§¯åˆ†æ˜¾ç¤º - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n         <div\n@@ -499,7 +495,22 @@\n   .user-text {\n     font-size: 11px;\n   }\n }\n+\n+/* Add new styles for the branding */\n+.nav-branding {\n+  display: flex;\n+  align-items: center;\n+  gap: 8px;\n+  cursor: pointer;\n+}\n+\n+.brand-text {\n+  font-weight: 600;\n+  font-size: 16px;\n+  color: var(--text-color, #fff);\n+}\n </style>\n \n \n+\n"
                },
                {
                    "date": 1752386295368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -513,4 +513,5 @@\n </style>\n \n \n \n+\n"
                },
                {
                    "date": 1752386337377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,9 +14,10 @@\n         </template>\n         <template v-else>\n           <!-- New left side branding -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n-            <van-icon name=\"palette\" size=\"18\" color=\"#FFD700\" />\n+            <!-- Fix for palette icon not displaying -->\n+            <i class=\"van-icon van-icon-photo-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n             <span class=\"brand-text\">AI Magic</span>\n           </div>\n         </template>\n       </div>\n@@ -514,4 +515,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752386374198,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,10 +14,10 @@\n         </template>\n         <template v-else>\n           <!-- New left side branding -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n-            <!-- Fix for palette icon not displaying -->\n-            <i class=\"van-icon van-icon-photo-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n+            <!-- Using a different palette-related icon that's available in Vant -->\n+            <i class=\"van-icon van-icon-brush-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n             <span class=\"brand-text\">AI Magic</span>\n           </div>\n         </template>\n       </div>\n@@ -516,4 +516,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752386407570,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,10 +14,10 @@\n         </template>\n         <template v-else>\n           <!-- New left side branding -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n-            <!-- Using a different palette-related icon that's available in Vant -->\n-            <i class=\"van-icon van-icon-brush-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n+            <!-- Using color-related icon that's available in Vant -->\n+            <i class=\"van-icon van-icon-cluster-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n             <span class=\"brand-text\">AI Magic</span>\n           </div>\n         </template>\n       </div>\n@@ -517,4 +517,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752386490680,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,10 +14,16 @@\n         </template>\n         <template v-else>\n           <!-- New left side branding -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n-            <!-- Using color-related icon that's available in Vant -->\n-            <i class=\"van-icon van-icon-cluster-o\" style=\"color: #FFD700; font-size: 18px;\"></i>\n+            <!-- Using inline SVG for palette icon -->\n+            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#FFD700\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"custom-icon\">\n+              <circle cx=\"13.5\" cy=\"6.5\" r=\"2.5\"/>\n+              <circle cx=\"17.5\" cy=\"10.5\" r=\"2.5\"/>\n+              <circle cx=\"8.5\" cy=\"7.5\" r=\"2.5\"/>\n+              <circle cx=\"6.5\" cy=\"12.5\" r=\"2.5\"/>\n+              <path d=\"M12 22c5.5 0 10-4.5 10-10c0-2.8-1.5-5.5-4-7L6 3C4.5 4.5 3 7.2 3 10c0 5.5 4.5 10 9 12z\"/>\n+            </svg>\n             <span class=\"brand-text\">AI Magic</span>\n           </div>\n         </template>\n       </div>\n@@ -510,12 +516,17 @@\n   font-weight: 600;\n   font-size: 16px;\n   color: var(--text-color, #fff);\n }\n+\n+.custom-icon {\n+  flex-shrink: 0;\n+}\n </style>\n \n \n \n \n \n \n \n+\n"
                },
                {
                    "date": 1752386523759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,18 +12,11 @@\n         <template v-if=\"showBackButton\">\n           <!-- Back button remains unchanged -->\n         </template>\n         <template v-else>\n-          <!-- New left side branding -->\n+          <!-- New left side branding with emoji -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n-            <!-- Using inline SVG for palette icon -->\n-            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#FFD700\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"custom-icon\">\n-              <circle cx=\"13.5\" cy=\"6.5\" r=\"2.5\"/>\n-              <circle cx=\"17.5\" cy=\"10.5\" r=\"2.5\"/>\n-              <circle cx=\"8.5\" cy=\"7.5\" r=\"2.5\"/>\n-              <circle cx=\"6.5\" cy=\"12.5\" r=\"2.5\"/>\n-              <path d=\"M12 22c5.5 0 10-4.5 10-10c0-2.8-1.5-5.5-4-7L6 3C4.5 4.5 3 7.2 3 10c0 5.5 4.5 10 9 12z\"/>\n-            </svg>\n+            <span class=\"palette-emoji\">ğŸ¨</span>\n             <span class=\"brand-text\">AI Magic</span>\n           </div>\n         </template>\n       </div>\n@@ -517,10 +510,11 @@\n   font-size: 16px;\n   color: var(--text-color, #fff);\n }\n \n-.custom-icon {\n-  flex-shrink: 0;\n+.palette-emoji {\n+  font-size: 18px;\n+  line-height: 1;\n }\n </style>\n \n \n@@ -529,4 +523,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752387209498,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,12 @@\n     <!-- å·¦ä¾§æ’æ§½ -->\n     <template #left>\n       <div class=\"nav-left\">\n         <template v-if=\"showBackButton\">\n-          <!-- Back button remains unchanged -->\n+          <!-- Make back button visible -->\n+          <div class=\"back-button\">\n+            <van-icon name=\"arrow-left\" size=\"18\" color=\"#fff\" />\n+          </div>\n         </template>\n         <template v-else>\n           <!-- New left side branding with emoji -->\n           <div class=\"nav-branding\" @click=\"goToHome\">\n@@ -514,8 +517,18 @@\n .palette-emoji {\n   font-size: 18px;\n   line-height: 1;\n }\n+\n+/* Add styles for back button */\n+.back-button {\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+  min-width: 44px;\n+  min-height: 44px;\n+  cursor: pointer;\n+}\n </style>\n \n \n \n@@ -524,4 +537,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752388983078,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -372,10 +372,20 @@\n .top-navigation {\n   background: var(--van-nav-bar-background, #fff);\n   border-bottom: 1px solid var(--van-border-color, #ebedf0);\n   box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n+  height: 56px !important; /* å¢åŠ é«˜åº¦ */\n+  line-height: 56px !important; /* ä¿æŒå†…å®¹å‚ç›´å±…ä¸­ */\n+  z-index: 100; /* ç¡®ä¿åœ¨é¡µé¢æœ€å‰é¢ */\n }\n \n+/* è°ƒæ•´å†…éƒ¨å…ƒç´ å‚ç›´å±…ä¸­ */\n+.top-navigation :deep(.van-nav-bar__content) {\n+  height: 100%;\n+  display: flex;\n+  align-items: center;\n+}\n+\n /* å·¦ä¾§åŒºåŸŸ */\n .nav-left {\n   display: flex;\n   align-items: center;\n@@ -538,4 +548,5 @@\n \n \n \n \n+\n"
                },
                {
                    "date": 1752388995743,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -372,20 +372,10 @@\n .top-navigation {\n   background: var(--van-nav-bar-background, #fff);\n   border-bottom: 1px solid var(--van-border-color, #ebedf0);\n   box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n-  height: 56px !important; /* å¢åŠ é«˜åº¦ */\n-  line-height: 56px !important; /* ä¿æŒå†…å®¹å‚ç›´å±…ä¸­ */\n-  z-index: 100; /* ç¡®ä¿åœ¨é¡µé¢æœ€å‰é¢ */\n }\n \n-/* è°ƒæ•´å†…éƒ¨å…ƒç´ å‚ç›´å±…ä¸­ */\n-.top-navigation :deep(.van-nav-bar__content) {\n-  height: 100%;\n-  display: flex;\n-  align-items: center;\n-}\n-\n /* å·¦ä¾§åŒºåŸŸ */\n .nav-left {\n   display: flex;\n   align-items: center;\n@@ -548,5 +538,4 @@\n \n \n \n \n-\n"
                },
                {
                    "date": 1752389045930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -372,10 +372,31 @@\n .top-navigation {\n   background: var(--van-nav-bar-background, #fff);\n   border-bottom: 1px solid var(--van-border-color, #ebedf0);\n   box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n+  height: 64px !important; /* å¢åŠ é«˜åº¦åˆ°64px */\n+  z-index: 9999 !important; /* ç¡®ä¿åœ¨æœ€å‰é¢ */\n+  position: fixed !important; /* ç¡®ä¿å›ºå®šå®šä½ */\n+  top: 0 !important;\n+  left: 0 !important;\n+  right: 0 !important;\n }\n \n+/* ç¡®ä¿å¯¼èˆªæ å†…å®¹å‚ç›´å±…ä¸­ */\n+.top-navigation :deep(.van-nav-bar__content) {\n+  height: 64px !important;\n+  display: flex !important;\n+  align-items: center !important;\n+}\n+\n+.top-navigation :deep(.van-nav-bar__left),\n+.top-navigation :deep(.van-nav-bar__title),\n+.top-navigation :deep(.van-nav-bar__right) {\n+  height: 64px !important;\n+  display: flex !important;\n+  align-items: center !important;\n+}\n+\n /* å·¦ä¾§åŒºåŸŸ */\n .nav-left {\n   display: flex;\n   align-items: center;\n"
                },
                {
                    "date": 1752389062859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -492,8 +492,22 @@\n }\n \n /* å“åº”å¼è®¾è®¡ */\n @media (max-width: 768px) {\n+  .top-navigation {\n+    height: 60px !important; /* ç§»åŠ¨ç«¯ç¨å¾®é™ä½é«˜åº¦ä½†ä»æ¯”é»˜è®¤é«˜ */\n+  }\n+\n+  .top-navigation :deep(.van-nav-bar__content) {\n+    height: 60px !important;\n+  }\n+\n+  .top-navigation :deep(.van-nav-bar__left),\n+  .top-navigation :deep(.van-nav-bar__title),\n+  .top-navigation :deep(.van-nav-bar__right) {\n+    height: 60px !important;\n+  }\n+\n   .nav-right {\n     gap: 8px;\n   }\n \n"
                },
                {
                    "date": 1752389075007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -559,9 +559,9 @@\n   display: flex;\n   align-items: center;\n   justify-content: center;\n   min-width: 44px;\n-  min-height: 44px;\n+  min-height: 64px; /* åŒ¹é…å¯¼èˆªæ é«˜åº¦ */\n   cursor: pointer;\n }\n </style>\n \n"
                },
                {
                    "date": 1752834855418,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,10 +163,9 @@\n   generationCost: 20,\n   isLoggedIn: false\n })\n \n-// å®šæ—¶å™¨\n-let statusUpdateTimer = null\n+// ç§»é™¤å®šæ—¶å™¨ç›¸å…³å˜é‡\n \n // æ›´æ–°ç§¯åˆ†çŠ¶æ€\n const updatePointsStatus = async () => {\n   console.log('ğŸ”„ æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œå½“å‰ç™»å½•çŠ¶æ€:', levelCardPointsManager.isLoggedIn(), isLoggedIn.value)\n"
                },
                {
                    "date": 1752834870464,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -310,17 +310,9 @@\n     // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\n   }\n }\n \n-// ç›‘å¬localStorageå˜åŒ–\n-const handleStorageChange = (event) => {\n-  console.log('localStorageå˜åŒ–:', event)\n-  if (event.key === 'auth_token' || event.key === 'user_info') {\n-    console.log('è®¤è¯ç›¸å…³æ•°æ®å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–')\n-    initUserInfo()\n-    updatePointsStatus()\n-  }\n-}\n+// ç§»é™¤è·¨æ ‡ç­¾é¡µåŒæ­¥é€»è¾‘\n \n // ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\n onMounted(() => {\n   initUserInfo()\n"
                },
                {
                    "date": 1752834885801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -316,35 +316,8 @@\n // ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\n onMounted(() => {\n   initUserInfo()\n   updatePointsStatus()\n-\n-  // ç›‘å¬storageäº‹ä»¶ï¼ˆè·¨æ ‡ç­¾é¡µåŒæ­¥ï¼‰\n-  window.addEventListener('storage', handleStorageChange)\n-\n-  // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€\n-  statusUpdateTimer = setInterval(updatePointsStatus, 30000)\n-\n-  // å®šæœŸæ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ˆé˜²æ­¢tokenè¿‡æœŸç­‰é—®é¢˜ï¼‰\n-  const checkInterval = setInterval(() => {\n-    const token = authApi.getToken()\n-    const localUserInfo = authApi.getLocalUserInfo()\n-\n-    // çŠ¶æ€ä¸ä¸€è‡´æ—¶é‡æ–°åˆå§‹åŒ–\n-    if ((token && !userInfo.value) || (!token && userInfo.value)) {\n-      console.log('æ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ä¸ä¸€è‡´ï¼Œé‡æ–°åˆå§‹åŒ–')\n-      initUserInfo()\n-    }\n-  }, 5000) // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡\n-\n-  // æ¸…ç†å®šæ—¶å™¨\n-  onUnmounted(() => {\n-    window.removeEventListener('storage', handleStorageChange)\n-    if (statusUpdateTimer) {\n-      clearInterval(statusUpdateTimer)\n-    }\n-    clearInterval(checkInterval)\n-  })\n })\n \n // æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\n defineExpose({\n"
                },
                {
                    "date": 1753537806248,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,540 +1,536 @@\n-<template>\n-  <van-nav-bar\n-    :left-arrow=\"showBackButton\"\n-    @click-left=\"handleLeftClick\"\n-    class=\"top-navigation\"\n-    fixed\n-    placeholder\n-  >\n-    <!-- å·¦ä¾§æ’æ§½ -->\n-    <template #left>\n-      <div class=\"nav-left\">\n-        <template v-if=\"showBackButton\">\n-          <!-- Make back button visible -->\n-          <div class=\"back-button\">\n-            <van-icon name=\"arrow-left\" size=\"18\" color=\"#fff\" />\n-          </div>\n-        </template>\n-        <template v-else>\n-          <!-- New left side branding with emoji -->\n-          <div class=\"nav-branding\" @click=\"goToHome\">\n-            <span class=\"palette-emoji\">ğŸ¨</span>\n-            <span class=\"brand-text\">AI Magic</span>\n-          </div>\n-        </template>\n-      </div>\n-    </template>\n-\n-    <!-- æ ‡é¢˜æ’æ§½ - ç§»é™¤ä¸­é—´æ ‡é¢˜ -->\n-    <template #title>\n-      <!-- Title removed -->\n-    </template>\n-\n-    <!-- å³ä¾§æ’æ§½ä¿æŒä¸å˜ -->\n-    <template #right>\n-      <div class=\"nav-right\">\n-        <!-- ç§¯åˆ†æ˜¾ç¤º - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\n-        <div\n-          v-if=\"isLoggedIn\"\n-          class=\"nav-points\"\n-          @click=\"showPointsModal = true\"\n-          title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\"\n-        >\n-          <van-icon name=\"diamond-o\" size=\"16\" />\n-          <span v-if=\"!pointsLoading\" class=\"points-text\">{{ pointsStatus.current }}</span>\n-          <van-loading v-else size=\"12\" color=\"var(--primary-color)\" />\n-        </div>\n-\n-        <!-- ç”¨æˆ·ä¿¡æ¯ -->\n-        <div class=\"nav-user\">\n-          <!-- æœªç™»å½•çŠ¶æ€ -->\n-          <div v-if=\"!isLoggedIn\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\n-            <van-icon name=\"user-o\" size=\"16\" />\n-            <span class=\"user-text\">ç™»å½•</span>\n-          </div>\n-          <!-- å·²ç™»å½•çŠ¶æ€ -->\n-          <div v-else @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\n-            <van-icon name=\"user-o\" size=\"16\" />\n-          </div>\n-        </div>\n-      </div>\n-    </template>\n-  </van-nav-bar>\n-\n-  <!-- ç§¯åˆ†å¼¹çª— -->\n-  <PointsModal\n-    v-model:show=\"showPointsModal\"\n-    @points-updated=\"handlePointsUpdated\"\n-  />\n-\n-  <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->\n-  <AuthModal\n-    v-model:show=\"showAuthModal\"\n-    :default-mode=\"authMode\"\n-    @success=\"handleAuthSuccess\"\n-  />\n-</template>\n-\n-<script setup>\n-import { ref, reactive, computed, onMounted, onUnmounted } from 'vue'\n-import { useRouter, useRoute } from 'vue-router'\n-import { Toast } from 'vant'\n-import { authApi } from '../services/api.js'\n-import levelCardPointsManager from '../utils/levelCardPointsManager.js'\n-import PointsModal from './PointsModal.vue'\n-import AuthModal from './AuthModal.vue'\n-\n-// å®šä¹‰props\n-const props = defineProps({\n-  title: {\n-    type: String,\n-    default: ''\n-  },\n-  showBack: {\n-    type: Boolean,\n-    default: null // nullè¡¨ç¤ºè‡ªåŠ¨åˆ¤æ–­\n-  }\n-})\n-\n-// å®šä¹‰äº‹ä»¶\n-const emit = defineEmits(['login', 'logout'])\n-\n-// è·¯ç”±\n-const router = useRouter()\n-const route = useRoute()\n-\n-// è®¡ç®—å±æ€§\n-const pageTitle = computed(() => {\n-  if (props.title) return props.title\n-\n-  // æ ¹æ®è·¯ç”±è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜\n-  const routeTitleMap = {\n-    '/': 'AI Magic',\n-    '/clothes-swap': 'ä¸€é”®æ¢è¡£',\n-    '/face-swap': 'æé€Ÿæ¢è„¸',\n-    '/text-to-image': 'æ–‡ç”Ÿå›¾',\n-    '/profile': 'ä¸ªäººä¸­å¿ƒ'\n-  }\n-\n-  return routeTitleMap[route.path] || 'AI Magic'\n-})\n-\n-const showBackButton = computed(() => {\n-  if (props.showBack !== null) return props.showBack\n-\n-  // è‡ªåŠ¨åˆ¤æ–­ï¼šé¦–é¡µä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œå…¶ä»–é¡µé¢æ˜¾ç¤º\n-  return route.path !== '/'\n-})\n-\n-// è·å–æ ‡é¢˜å›¾æ ‡ - ä¸å†éœ€è¦æ­¤å‡½æ•°\n-// const getTitleIcon = () => {\n-//   const iconMap = {\n-//     '/': 'home-o',\n-//     '/clothes-swap': 'user-o',\n-//     '/face-swap': 'friends-o',\n-//     '/text-to-image': 'photo-o',\n-//     '/profile': 'manager-o'\n-//   }\n-//\n-//   return iconMap[route.path] || 'apps-o'\n-// }\n-\n-// å“åº”å¼æ•°æ®\n-const showPointsModal = ref(false)\n-const showAuthModal = ref(false)\n-const authMode = ref('login')\n-const loading = ref(false)\n-const pointsLoading = ref(false)\n-\n-// ç”¨æˆ·ä¿¡æ¯\n-const userInfo = ref(null)\n-const isLoggedIn = computed(() => {\n-  const hasToken = authApi.isLoggedIn()\n-  const hasUserInfo = !!userInfo.value\n-  return hasToken && hasUserInfo\n-})\n-\n-// ç§¯åˆ†çŠ¶æ€\n-const pointsStatus = reactive({\n-  current: 0,\n-  total_points: 0,\n-  cards_count: 0,\n-  canGenerate: false,\n-  generationCost: 20,\n-  isLoggedIn: false\n-})\n-\n-// ç§»é™¤å®šæ—¶å™¨ç›¸å…³å˜é‡\n-\n-// æ›´æ–°ç§¯åˆ†çŠ¶æ€\n-const updatePointsStatus = async () => {\n-  console.log('ğŸ”„ æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œå½“å‰ç™»å½•çŠ¶æ€:', levelCardPointsManager.isLoggedIn(), isLoggedIn.value)\n-\n-  // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™ä¸å‘é€APIè¯·æ±‚\n-  if (!levelCardPointsManager.isLoggedIn() || !isLoggedIn.value) {\n-    console.log('âŒ æœªç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç§¯åˆ†çŠ¶æ€')\n-    pointsLoading.value = false\n-    Object.assign(pointsStatus, {\n-      current: 0,\n-      total_points: 0,\n-      cards_count: 0,\n-      canGenerate: false,\n-      generationCost: 20,\n-      isLoggedIn: false\n-    })\n-    return\n-  }\n-\n-  try {\n-    pointsLoading.value = true\n-    console.log('ğŸš€ å‘é€ç§¯åˆ†APIè¯·æ±‚...')\n-    const newStatus = await levelCardPointsManager.getPointsStatus()\n-    console.log('âœ… ç§¯åˆ†çŠ¶æ€æ›´æ–°æˆåŠŸ:', newStatus)\n-    Object.assign(pointsStatus, newStatus)\n-  } catch (error) {\n-    console.error('âŒ æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n-    // è®¤è¯é”™è¯¯å¤„ç†\n-    if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n-      console.log('ğŸ”’ è®¤è¯é”™è¯¯ï¼Œé‡ç½®ç§¯åˆ†çŠ¶æ€')\n-      Object.assign(pointsStatus, {\n-        current: 0,\n-        total_points: 0,\n-        cards_count: 0,\n-        canGenerate: false,\n-        generationCost: 20,\n-        isLoggedIn: false\n-      })\n-    }\n-  } finally {\n-    pointsLoading.value = false\n-  }\n-}\n-\n-// æ˜¾ç¤ºç™»å½•å¼¹çª—\n-const showLoginModal = () => {\n-  authMode.value = 'login'\n-  showAuthModal.value = true\n-}\n-\n-// å¤„ç†è®¤è¯æˆåŠŸ\n-const handleAuthSuccess = async (data) => {\n-  console.log('è®¤è¯æˆåŠŸï¼Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', data)\n-\n-  // ç«‹å³æ›´æ–°ç”¨æˆ·ä¿¡æ¯\n-  userInfo.value = data.user\n-\n-  // ç¡®ä¿localStorageä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„\n-  if (data.user) {\n-    localStorage.setItem('user_info', JSON.stringify(data.user))\n-  }\n-\n-  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ä¸­çš„ç™»å½•çŠ¶æ€\n-  pointsStatus.isLoggedIn = true\n-\n-  // è§¦å‘çˆ¶ç»„ä»¶çš„ç™»å½•äº‹ä»¶\n-  emit('login', data)\n-\n-  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€\n-  await updatePointsStatus()\n-\n-  // å…³é—­å¼¹çª—\n-  showAuthModal.value = false\n-}\n-\n-// å¤„ç†å·¦ä¾§ç‚¹å‡»äº‹ä»¶\n-const handleLeftClick = () => {\n-  if (showBackButton.value) {\n-    // è¿”å›ä¸Šä¸€é¡µ\n-    if (window.history.length > 1) {\n-      router.go(-1)\n-    } else {\n-      router.push('/')\n-    }\n-  }\n-}\n-\n-// è·³è½¬åˆ°é¦–é¡µ\n-const goToHome = () => {\n-  router.push('/')\n-}\n-\n-// è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ\n-const goToProfile = () => {\n-  router.push('/profile')\n-}\n-\n-// å¤„ç†ç§¯åˆ†æ›´æ–°\n-const handlePointsUpdated = async () => {\n-  console.log('ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†çŠ¶æ€')\n-  // æ¸…é™¤levelCardPointsManagerçš„ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®\n-  levelCardPointsManager.clearCache()\n-\n-  // æ›´æ–°ç§¯åˆ†çŠ¶æ€\n-  await updatePointsStatus()\n-}\n-\n-// åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯\n-const initUserInfo = () => {\n-  console.log('ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...')\n-  const token = authApi.getToken()\n-  const localUserInfo = authApi.getLocalUserInfo()\n-\n-  console.log('Tokenå­˜åœ¨:', !!token)\n-  console.log('æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', localUserInfo)\n-\n-  if (token && localUserInfo) {\n-    userInfo.value = localUserInfo\n-    pointsStatus.isLoggedIn = true\n-    console.log('âœ… è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\n-    console.log('âœ… è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºtrue')\n-\n-    // éªŒè¯tokenæœ‰æ•ˆæ€§ï¼ˆé™é»˜éªŒè¯ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼‰\n-    validateTokenSilently()\n-  } else {\n-    console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\n-    userInfo.value = null\n-    pointsStatus.isLoggedIn = false\n-  }\n-}\n-\n-// é™é»˜éªŒè¯token\n-const validateTokenSilently = async () => {\n-  try {\n-    const response = await authApi.getCurrentUser()\n-    if (!response.success) {\n-      console.warn('TokenéªŒè¯å¤±è´¥ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·')\n-      // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\n-    }\n-  } catch (error) {\n-    console.warn('TokenéªŒè¯å‡ºé”™ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·:', error)\n-    // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\n-  }\n-}\n-\n-// ç§»é™¤è·¨æ ‡ç­¾é¡µåŒæ­¥é€»è¾‘\n-\n-// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\n-onMounted(() => {\n-  initUserInfo()\n-  updatePointsStatus()\n-})\n-\n-// æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\n-defineExpose({\n-  updatePointsStatus,\n-  getCurrentPoints: () => pointsStatus.current,\n-  hasEnoughPoints: () => pointsStatus.canGenerate,\n-  showLoginModal: () => {\n-    authMode.value = 'login'\n-    showAuthModal.value = true\n-  }\n-})\n-</script>\n-\n-<style scoped>\n-/* Vant NavBar è‡ªå®šä¹‰æ ·å¼ */\n-.top-navigation {\n-  background: var(--van-nav-bar-background, #fff);\n-  border-bottom: 1px solid var(--van-border-color, #ebedf0);\n-  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n-  height: 64px !important; /* å¢åŠ é«˜åº¦åˆ°64px */\n-  z-index: 9999 !important; /* ç¡®ä¿åœ¨æœ€å‰é¢ */\n-  position: fixed !important; /* ç¡®ä¿å›ºå®šå®šä½ */\n-  top: 0 !important;\n-  left: 0 !important;\n-  right: 0 !important;\n-}\n-\n-/* ç¡®ä¿å¯¼èˆªæ å†…å®¹å‚ç›´å±…ä¸­ */\n-.top-navigation :deep(.van-nav-bar__content) {\n-  height: 64px !important;\n-  display: flex !important;\n-  align-items: center !important;\n-}\n-\n-.top-navigation :deep(.van-nav-bar__left),\n-.top-navigation :deep(.van-nav-bar__title),\n-.top-navigation :deep(.van-nav-bar__right) {\n-  height: 64px !important;\n-  display: flex !important;\n-  align-items: center !important;\n-}\n-\n-/* å·¦ä¾§åŒºåŸŸ */\n-.nav-left {\n-  display: flex;\n-  align-items: center;\n-  gap: 8px;\n-}\n-\n-.nav-logo {\n-  display: flex;\n-  align-items: center;\n-  cursor: pointer;\n-  padding: 8px 12px;\n-  border-radius: 8px;\n-  color: var(--van-text-color, #323233);\n-  min-height: 44px;\n-  min-width: 44px;\n-  justify-content: center;\n-}\n-\n-/* æ ‡é¢˜åŒºåŸŸ */\n-.nav-title {\n-  display: flex;\n-  align-items: center;\n-  gap: 6px;\n-  font-weight: 600;\n-}\n-\n-.title-icon {\n-  flex-shrink: 0;\n-}\n-\n-/* å³ä¾§åŒºåŸŸ */\n-.nav-right {\n-  display: flex;\n-  align-items: center;\n-  gap: 12px;\n-}\n-\n-/* ç§¯åˆ†æ˜¾ç¤º */\n-.nav-points {\n-  display: flex;\n-  align-items: center;\n-  gap: 4px;\n-  padding: 8px 12px;\n-  background: rgba(25, 137, 250, 0.1);\n-  border-radius: 16px;\n-  cursor: pointer;\n-  min-width: 60px;\n-  min-height: 44px;\n-  justify-content: center;\n-}\n-\n-.points-text {\n-  font-size: 12px;\n-  font-weight: 600;\n-  color: var(--van-primary-color, #1989fa);\n-  margin-left: 2px;\n-}\n-\n-/* ç”¨æˆ·ä¿¡æ¯ */\n-.nav-user {\n-  display: flex;\n-  align-items: center;\n-  cursor: pointer;\n-}\n-\n-.nav-user > div {\n-  display: flex;\n-  align-items: center;\n-  gap: 4px;\n-  padding: 8px 12px;\n-  border-radius: 16px;\n-  color: var(--van-text-color, #323233);\n-  min-height: 44px;\n-  min-width: 44px;\n-  justify-content: center;\n-}\n-\n-.user-text {\n-  font-size: 12px;\n-  font-weight: 500;\n-}\n-\n-/* æ·±è‰²ä¸»é¢˜é€‚é… */\n-@media (prefers-color-scheme: dark) {\n-  .top-navigation {\n-    background: var(--van-nav-bar-background, #1e1e1e);\n-    border-bottom-color: var(--van-border-color, #333);\n-  }\n-\n-  .nav-points {\n-    background: rgba(25, 137, 250, 0.2);\n-  }\n-}\n-\n-/* å“åº”å¼è®¾è®¡ */\n-@media (max-width: 768px) {\n-  .top-navigation {\n-    height: 60px !important; /* ç§»åŠ¨ç«¯ç¨å¾®é™ä½é«˜åº¦ä½†ä»æ¯”é»˜è®¤é«˜ */\n-  }\n-\n-  .top-navigation :deep(.van-nav-bar__content) {\n-    height: 60px !important;\n-  }\n-\n-  .top-navigation :deep(.van-nav-bar__left),\n-  .top-navigation :deep(.van-nav-bar__title),\n-  .top-navigation :deep(.van-nav-bar__right) {\n-    height: 60px !important;\n-  }\n-\n-  .nav-right {\n-    gap: 8px;\n-  }\n-\n-  .nav-points {\n-    padding: 6px 10px;\n-    min-width: 50px;\n-    min-height: 40px;\n-  }\n-\n-  .nav-user > div {\n-    padding: 6px 10px;\n-    min-height: 40px;\n-    min-width: 40px;\n-  }\n-\n-  .nav-logo {\n-    padding: 6px 10px;\n-    min-height: 40px;\n-    min-width: 40px;\n-  }\n-\n-  .points-text,\n-  .user-text {\n-    font-size: 11px;\n-  }\n-}\n-\n-/* Add new styles for the branding */\n-.nav-branding {\n-  display: flex;\n-  align-items: center;\n-  gap: 8px;\n-  cursor: pointer;\n-}\n-\n-.brand-text {\n-  font-weight: 600;\n-  font-size: 16px;\n-  color: var(--text-color, #fff);\n-}\n-\n-.palette-emoji {\n-  font-size: 18px;\n-  line-height: 1;\n-}\n-\n-/* Add styles for back button */\n-.back-button {\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n-  min-width: 44px;\n-  min-height: 64px; /* åŒ¹é…å¯¼èˆªæ é«˜åº¦ */\n-  cursor: pointer;\n-}\n-</style>\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n+<template>\r\n+  <van-nav-bar\r\n+    :left-arrow=\"showBackButton\"\r\n+    @click-left=\"handleLeftClick\"\r\n+    class=\"top-navigation\"\r\n+    fixed\r\n+    placeholder\r\n+  >\r\n+    <!-- å·¦ä¾§æ’æ§½ -->\r\n+    <template #left>\r\n+      <div class=\"nav-left\">\r\n+        <template v-if=\"showBackButton\">\r\n+          <!-- Make back button visible -->\r\n+          <div class=\"back-button\">\r\n+            <van-icon name=\"arrow-left\" size=\"18\" color=\"#fff\" />\r\n+          </div>\r\n+        </template>\r\n+        <template v-else>\r\n+          <!-- New left side branding with emoji -->\r\n+          <div class=\"nav-branding\" @click=\"goToHome\">\r\n+            <span class=\"palette-emoji\">ğŸ¨</span>\r\n+            <span class=\"brand-text\">AI Magic</span>\r\n+          </div>\r\n+        </template>\r\n+      </div>\r\n+    </template>\r\n+\r\n+    <!-- æ ‡é¢˜æ’æ§½ - ç§»é™¤ä¸­é—´æ ‡é¢˜ -->\r\n+    <template #title>\r\n+      <!-- Title removed -->\r\n+    </template>\r\n+\r\n+    <!-- å³ä¾§æ’æ§½ä¿æŒä¸å˜ -->\r\n+    <template #right>\r\n+      <div class=\"nav-right\">\r\n+        <!-- ç§¯åˆ†æ˜¾ç¤º - ä»…åœ¨ç™»å½•æ—¶æ˜¾ç¤º -->\r\n+        <div\r\n+          v-if=\"isLoggedIn\"\r\n+          class=\"nav-points\"\r\n+          @click=\"showPointsModal = true\"\r\n+          title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\"\r\n+        >\r\n+          <van-icon name=\"diamond-o\" size=\"16\" />\r\n+          <span v-if=\"!pointsLoading\" class=\"points-text\">{{ pointsStatus.current }}</span>\r\n+          <van-loading v-else size=\"12\" color=\"var(--primary-color)\" />\r\n+        </div>\r\n+\r\n+        <!-- ç”¨æˆ·ä¿¡æ¯ -->\r\n+        <div class=\"nav-user\">\r\n+          <!-- æœªç™»å½•çŠ¶æ€ -->\r\n+          <div v-if=\"!isLoggedIn\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\r\n+            <van-icon name=\"user-o\" size=\"16\" />\r\n+            <span class=\"user-text\">ç™»å½•</span>\r\n+          </div>\r\n+          <!-- å·²ç™»å½•çŠ¶æ€ -->\r\n+          <div v-else @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\r\n+            <van-icon name=\"user-o\" size=\"16\" />\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    </template>\r\n+  </van-nav-bar>\r\n+\r\n+  <!-- ç§¯åˆ†å¼¹çª— -->\r\n+  <PointsModal\r\n+    v-model:show=\"showPointsModal\"\r\n+    @points-updated=\"handlePointsUpdated\"\r\n+  />\r\n+\r\n+  <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->\r\n+  <AuthModal\r\n+    v-model:show=\"showAuthModal\"\r\n+    :default-mode=\"authMode\"\r\n+    @success=\"handleAuthSuccess\"\r\n+  />\r\n+</template>\r\n+\r\n+<script setup>\r\n+import { ref, reactive, computed, onMounted, onUnmounted } from 'vue'\r\n+import { useRouter, useRoute } from 'vue-router'\r\n+import { Toast } from 'vant'\r\n+import { authApi } from '../services/api.js'\r\n+import levelCardPointsManager from '../utils/levelCardPointsManager.js'\r\n+import PointsModal from './PointsModal.vue'\r\n+import AuthModal from './AuthModal.vue'\r\n+\r\n+// å®šä¹‰props\r\n+const props = defineProps({\r\n+  title: {\r\n+    type: String,\r\n+    default: ''\r\n+  },\r\n+  showBack: {\r\n+    type: Boolean,\r\n+    default: null // nullè¡¨ç¤ºè‡ªåŠ¨åˆ¤æ–­\r\n+  }\r\n+})\r\n+\r\n+// å®šä¹‰äº‹ä»¶\r\n+const emit = defineEmits(['login', 'logout'])\r\n+\r\n+// è·¯ç”±\r\n+const router = useRouter()\r\n+const route = useRoute()\r\n+\r\n+// è®¡ç®—å±æ€§\r\n+const pageTitle = computed(() => {\r\n+  if (props.title) return props.title\r\n+\r\n+  // æ ¹æ®è·¯ç”±è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜\r\n+  const routeTitleMap = {\r\n+    '/': 'AI Magic',\r\n+    '/clothes-swap': 'ä¸€é”®æ¢è¡£',\r\n+    '/face-swap': 'æé€Ÿæ¢è„¸',\r\n+    '/text-to-image': 'æ–‡ç”Ÿå›¾',\r\n+    '/profile': 'ä¸ªäººä¸­å¿ƒ'\r\n+  }\r\n+\r\n+  return routeTitleMap[route.path] || 'AI Magic'\r\n+})\r\n+\r\n+const showBackButton = computed(() => {\r\n+  if (props.showBack !== null) return props.showBack\r\n+\r\n+  // è‡ªåŠ¨åˆ¤æ–­ï¼šé¦–é¡µä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œå…¶ä»–é¡µé¢æ˜¾ç¤º\r\n+  return route.path !== '/'\r\n+})\r\n+\r\n+// è·å–æ ‡é¢˜å›¾æ ‡ - ä¸å†éœ€è¦æ­¤å‡½æ•°\r\n+// const getTitleIcon = () => {\r\n+//   const iconMap = {\r\n+//     '/': 'home-o',\r\n+//     '/clothes-swap': 'user-o',\r\n+//     '/face-swap': 'friends-o',\r\n+//     '/text-to-image': 'photo-o',\r\n+//     '/profile': 'manager-o'\r\n+//   }\r\n+//\r\n+//   return iconMap[route.path] || 'apps-o'\r\n+// }\r\n+\r\n+// å“åº”å¼æ•°æ®\r\n+const showPointsModal = ref(false)\r\n+const showAuthModal = ref(false)\r\n+const authMode = ref('login')\r\n+const loading = ref(false)\r\n+const pointsLoading = ref(false)\r\n+\r\n+// ç”¨æˆ·ä¿¡æ¯\r\n+const userInfo = ref(null)\r\n+const isLoggedIn = computed(() => {\r\n+  const hasToken = authApi.isLoggedIn()\r\n+  const hasUserInfo = !!userInfo.value\r\n+  return hasToken && hasUserInfo\r\n+})\r\n+\r\n+// ç§¯åˆ†çŠ¶æ€\r\n+const pointsStatus = reactive({\r\n+  current: 0,\r\n+  total_points: 0,\r\n+  cards_count: 0,\r\n+  canGenerate: false,\r\n+  generationCost: 20,\r\n+  isLoggedIn: false\r\n+})\r\n+\r\n+// ç§»é™¤å®šæ—¶å™¨ç›¸å…³å˜é‡\r\n+\r\n+// æ›´æ–°ç§¯åˆ†çŠ¶æ€\r\n+const updatePointsStatus = async () => {\r\n+  console.log('ğŸ”„ æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œå½“å‰ç™»å½•çŠ¶æ€:', levelCardPointsManager.isLoggedIn(), isLoggedIn.value)\r\n+\r\n+  // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™ä¸å‘é€APIè¯·æ±‚\r\n+  if (!levelCardPointsManager.isLoggedIn() || !isLoggedIn.value) {\r\n+    console.log('âŒ æœªç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç§¯åˆ†çŠ¶æ€')\r\n+    pointsLoading.value = false\r\n+    Object.assign(pointsStatus, {\r\n+      current: 0,\r\n+      total_points: 0,\r\n+      cards_count: 0,\r\n+      canGenerate: false,\r\n+      generationCost: 20,\r\n+      isLoggedIn: false\r\n+    })\r\n+    return\r\n+  }\r\n+\r\n+  try {\r\n+    pointsLoading.value = true\r\n+    console.log('ğŸš€ å‘é€ç§¯åˆ†APIè¯·æ±‚...')\r\n+    const newStatus = await levelCardPointsManager.getPointsStatus()\r\n+    console.log('âœ… ç§¯åˆ†çŠ¶æ€æ›´æ–°æˆåŠŸ:', newStatus)\r\n+    Object.assign(pointsStatus, newStatus)\r\n+  } catch (error) {\r\n+    console.error('âŒ æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\r\n+    // è®¤è¯é”™è¯¯å¤„ç†\r\n+    if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\r\n+      console.log('ğŸ”’ è®¤è¯é”™è¯¯ï¼Œé‡ç½®ç§¯åˆ†çŠ¶æ€')\r\n+      Object.assign(pointsStatus, {\r\n+        current: 0,\r\n+        total_points: 0,\r\n+        cards_count: 0,\r\n+        canGenerate: false,\r\n+        generationCost: 20,\r\n+        isLoggedIn: false\r\n+      })\r\n+    }\r\n+  } finally {\r\n+    pointsLoading.value = false\r\n+  }\r\n+}\r\n+\r\n+// æ˜¾ç¤ºç™»å½•å¼¹çª—\r\n+const showLoginModal = () => {\r\n+  authMode.value = 'login'\r\n+  showAuthModal.value = true\r\n+}\r\n+\r\n+// å¤„ç†è®¤è¯æˆåŠŸ\r\n+const handleAuthSuccess = async (data) => {\r\n+  console.log('è®¤è¯æˆåŠŸï¼Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', data)\r\n+\r\n+  // ç«‹å³æ›´æ–°ç”¨æˆ·ä¿¡æ¯\r\n+  userInfo.value = data.user\r\n+\r\n+  // ç¡®ä¿localStorageä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„\r\n+  if (data.user) {\r\n+    localStorage.setItem('user_info', JSON.stringify(data.user))\r\n+  }\r\n+\r\n+  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ä¸­çš„ç™»å½•çŠ¶æ€\r\n+  pointsStatus.isLoggedIn = true\r\n+\r\n+  // è§¦å‘çˆ¶ç»„ä»¶çš„ç™»å½•äº‹ä»¶\r\n+  emit('login', data)\r\n+\r\n+  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€\r\n+  await updatePointsStatus()\r\n+\r\n+  // å…³é—­å¼¹çª—\r\n+  showAuthModal.value = false\r\n+}\r\n+\r\n+// å¤„ç†å·¦ä¾§ç‚¹å‡»äº‹ä»¶\r\n+const handleLeftClick = () => {\r\n+  if (showBackButton.value) {\r\n+    // ç›´æ¥è·³è½¬åˆ°é¦–é¡µ\r\n+    router.push('/')\r\n+  }\r\n+}\r\n+\r\n+// è·³è½¬åˆ°é¦–é¡µ\r\n+const goToHome = () => {\r\n+  router.push('/')\r\n+}\r\n+\r\n+// è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ\r\n+const goToProfile = () => {\r\n+  router.push('/profile')\r\n+}\r\n+\r\n+// å¤„ç†ç§¯åˆ†æ›´æ–°\r\n+const handlePointsUpdated = async () => {\r\n+  console.log('ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç§¯åˆ†çŠ¶æ€')\r\n+  // æ¸…é™¤levelCardPointsManagerçš„ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®\r\n+  levelCardPointsManager.clearCache()\r\n+\r\n+  // æ›´æ–°ç§¯åˆ†çŠ¶æ€\r\n+  await updatePointsStatus()\r\n+}\r\n+\r\n+// åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯\r\n+const initUserInfo = () => {\r\n+  console.log('ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...')\r\n+  const token = authApi.getToken()\r\n+  const localUserInfo = authApi.getLocalUserInfo()\r\n+\r\n+  console.log('Tokenå­˜åœ¨:', !!token)\r\n+  console.log('æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', localUserInfo)\r\n+\r\n+  if (token && localUserInfo) {\r\n+    userInfo.value = localUserInfo\r\n+    pointsStatus.isLoggedIn = true\r\n+    console.log('âœ… è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\r\n+    console.log('âœ… è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºtrue')\r\n+\r\n+    // éªŒè¯tokenæœ‰æ•ˆæ€§ï¼ˆé™é»˜éªŒè¯ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼‰\r\n+    validateTokenSilently()\r\n+  } else {\r\n+    console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\r\n+    userInfo.value = null\r\n+    pointsStatus.isLoggedIn = false\r\n+  }\r\n+}\r\n+\r\n+// é™é»˜éªŒè¯token\r\n+const validateTokenSilently = async () => {\r\n+  try {\r\n+    const response = await authApi.getCurrentUser()\r\n+    if (!response.success) {\r\n+      console.warn('TokenéªŒè¯å¤±è´¥ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·')\r\n+      // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\r\n+    }\r\n+  } catch (error) {\r\n+    console.warn('TokenéªŒè¯å‡ºé”™ï¼Œä½†ä¸ç«‹å³ç™»å‡ºç”¨æˆ·:', error)\r\n+    // ä¸ç«‹å³æ¸…é™¤tokenï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡APIè°ƒç”¨æ—¶å†å¤„ç†\r\n+  }\r\n+}\r\n+\r\n+// ç§»é™¤è·¨æ ‡ç­¾é¡µåŒæ­¥é€»è¾‘\r\n+\r\n+// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\r\n+onMounted(() => {\r\n+  initUserInfo()\r\n+  updatePointsStatus()\r\n+})\r\n+\r\n+// æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\r\n+defineExpose({\r\n+  updatePointsStatus,\r\n+  getCurrentPoints: () => pointsStatus.current,\r\n+  hasEnoughPoints: () => pointsStatus.canGenerate,\r\n+  showLoginModal: () => {\r\n+    authMode.value = 'login'\r\n+    showAuthModal.value = true\r\n+  }\r\n+})\r\n+</script>\r\n+\r\n+<style scoped>\r\n+/* Vant NavBar è‡ªå®šä¹‰æ ·å¼ */\r\n+.top-navigation {\r\n+  background: var(--van-nav-bar-background, #fff);\r\n+  border-bottom: 1px solid var(--van-border-color, #ebedf0);\r\n+  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n+  height: 64px !important; /* å¢åŠ é«˜åº¦åˆ°64px */\r\n+  z-index: 9999 !important; /* ç¡®ä¿åœ¨æœ€å‰é¢ */\r\n+  position: fixed !important; /* ç¡®ä¿å›ºå®šå®šä½ */\r\n+  top: 0 !important;\r\n+  left: 0 !important;\r\n+  right: 0 !important;\r\n+}\r\n+\r\n+/* ç¡®ä¿å¯¼èˆªæ å†…å®¹å‚ç›´å±…ä¸­ */\r\n+.top-navigation :deep(.van-nav-bar__content) {\r\n+  height: 64px !important;\r\n+  display: flex !important;\r\n+  align-items: center !important;\r\n+}\r\n+\r\n+.top-navigation :deep(.van-nav-bar__left),\r\n+.top-navigation :deep(.van-nav-bar__title),\r\n+.top-navigation :deep(.van-nav-bar__right) {\r\n+  height: 64px !important;\r\n+  display: flex !important;\r\n+  align-items: center !important;\r\n+}\r\n+\r\n+/* å·¦ä¾§åŒºåŸŸ */\r\n+.nav-left {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 8px;\r\n+}\r\n+\r\n+.nav-logo {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  cursor: pointer;\r\n+  padding: 8px 12px;\r\n+  border-radius: 8px;\r\n+  color: var(--van-text-color, #323233);\r\n+  min-height: 44px;\r\n+  min-width: 44px;\r\n+  justify-content: center;\r\n+}\r\n+\r\n+/* æ ‡é¢˜åŒºåŸŸ */\r\n+.nav-title {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 6px;\r\n+  font-weight: 600;\r\n+}\r\n+\r\n+.title-icon {\r\n+  flex-shrink: 0;\r\n+}\r\n+\r\n+/* å³ä¾§åŒºåŸŸ */\r\n+.nav-right {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 12px;\r\n+}\r\n+\r\n+/* ç§¯åˆ†æ˜¾ç¤º */\r\n+.nav-points {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 4px;\r\n+  padding: 8px 12px;\r\n+  background: rgba(25, 137, 250, 0.1);\r\n+  border-radius: 16px;\r\n+  cursor: pointer;\r\n+  min-width: 60px;\r\n+  min-height: 44px;\r\n+  justify-content: center;\r\n+}\r\n+\r\n+.points-text {\r\n+  font-size: 12px;\r\n+  font-weight: 600;\r\n+  color: var(--van-primary-color, #1989fa);\r\n+  margin-left: 2px;\r\n+}\r\n+\r\n+/* ç”¨æˆ·ä¿¡æ¯ */\r\n+.nav-user {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  cursor: pointer;\r\n+}\r\n+\r\n+.nav-user > div {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 4px;\r\n+  padding: 8px 12px;\r\n+  border-radius: 16px;\r\n+  color: var(--van-text-color, #323233);\r\n+  min-height: 44px;\r\n+  min-width: 44px;\r\n+  justify-content: center;\r\n+}\r\n+\r\n+.user-text {\r\n+  font-size: 12px;\r\n+  font-weight: 500;\r\n+}\r\n+\r\n+/* æ·±è‰²ä¸»é¢˜é€‚é… */\r\n+@media (prefers-color-scheme: dark) {\r\n+  .top-navigation {\r\n+    background: var(--van-nav-bar-background, #1e1e1e);\r\n+    border-bottom-color: var(--van-border-color, #333);\r\n+  }\r\n+\r\n+  .nav-points {\r\n+    background: rgba(25, 137, 250, 0.2);\r\n+  }\r\n+}\r\n+\r\n+/* å“åº”å¼è®¾è®¡ */\r\n+@media (max-width: 768px) {\r\n+  .top-navigation {\r\n+    height: 60px !important; /* ç§»åŠ¨ç«¯ç¨å¾®é™ä½é«˜åº¦ä½†ä»æ¯”é»˜è®¤é«˜ */\r\n+  }\r\n+\r\n+  .top-navigation :deep(.van-nav-bar__content) {\r\n+    height: 60px !important;\r\n+  }\r\n+\r\n+  .top-navigation :deep(.van-nav-bar__left),\r\n+  .top-navigation :deep(.van-nav-bar__title),\r\n+  .top-navigation :deep(.van-nav-bar__right) {\r\n+    height: 60px !important;\r\n+  }\r\n+\r\n+  .nav-right {\r\n+    gap: 8px;\r\n+  }\r\n+\r\n+  .nav-points {\r\n+    padding: 6px 10px;\r\n+    min-width: 50px;\r\n+    min-height: 40px;\r\n+  }\r\n+\r\n+  .nav-user > div {\r\n+    padding: 6px 10px;\r\n+    min-height: 40px;\r\n+    min-width: 40px;\r\n+  }\r\n+\r\n+  .nav-logo {\r\n+    padding: 6px 10px;\r\n+    min-height: 40px;\r\n+    min-width: 40px;\r\n+  }\r\n+\r\n+  .points-text,\r\n+  .user-text {\r\n+    font-size: 11px;\r\n+  }\r\n+}\r\n+\r\n+/* Add new styles for the branding */\r\n+.nav-branding {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  gap: 8px;\r\n+  cursor: pointer;\r\n+}\r\n+\r\n+.brand-text {\r\n+  font-weight: 600;\r\n+  font-size: 16px;\r\n+  color: var(--text-color, #fff);\r\n+}\r\n+\r\n+.palette-emoji {\r\n+  font-size: 18px;\r\n+  line-height: 1;\r\n+}\r\n+\r\n+/* Add styles for back button */\r\n+.back-button {\r\n+  display: flex;\r\n+  align-items: center;\r\n+  justify-content: center;\r\n+  min-width: 44px;\r\n+  min-height: 64px; /* åŒ¹é…å¯¼èˆªæ é«˜åº¦ */\r\n+  cursor: pointer;\r\n+}\r\n+</style>\r\n+\r\n+\r\n+\r\n+\r\n+\r\n+\r\n+\r\n+\r\n+\r\n+\r\n"
                },
                {
                    "date": 1753639374027,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,8 +82,9 @@\n import { authApi } from '../services/api.js'\r\n import levelCardPointsManager from '../utils/levelCardPointsManager.js'\r\n import PointsModal from './PointsModal.vue'\r\n import AuthModal from './AuthModal.vue'\r\n+import eventBus, { EVENTS } from '../utils/eventBus.js'\r\n \r\n // å®šä¹‰props\r\n const props = defineProps({\r\n   title: {\r\n"
                },
                {
                    "date": 1753639389634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -309,14 +309,30 @@\n }\r\n \r\n // ç§»é™¤è·¨æ ‡ç­¾é¡µåŒæ­¥é€»è¾‘\r\n \r\n+// ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶\r\n+const handlePointsUpdateEvent = async () => {\r\n+  console.log('ğŸ”„ æ”¶åˆ°ç§¯åˆ†æ›´æ–°äº‹ä»¶ï¼Œåˆ·æ–°ç§¯åˆ†æ˜¾ç¤º')\r\n+  await updatePointsStatus()\r\n+}\r\n+\r\n // ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\r\n onMounted(() => {\r\n   initUserInfo()\r\n   updatePointsStatus()\r\n+\r\n+  // ç›‘å¬ç§¯åˆ†ç›¸å…³äº‹ä»¶\r\n+  eventBus.on(EVENTS.POINTS_UPDATED, handlePointsUpdateEvent)\r\n+  eventBus.on(EVENTS.POINTS_CONSUMED, handlePointsUpdateEvent)\r\n })\r\n \r\n+// ç»„ä»¶å¸è½½æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬\r\n+onUnmounted(() => {\r\n+  eventBus.off(EVENTS.POINTS_UPDATED, handlePointsUpdateEvent)\r\n+  eventBus.off(EVENTS.POINTS_CONSUMED, handlePointsUpdateEvent)\r\n+})\r\n+\r\n // æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\r\n defineExpose({\r\n   updatePointsStatus,\r\n   getCurrentPoints: () => pointsStatus.current,\r\n"
                }
            ],
            "date": 1752290874113,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"top-navigation\">\n    <!-- ç§¯åˆ†æ˜¾ç¤ºï¼ˆå·¦è¾¹ï¼‰ -->\n    <div class=\"nav-item nav-points\" @click=\"showPointsModal = true\" title=\"ç‚¹å‡»æŸ¥çœ‹ç§¯åˆ†è¯¦æƒ…\">\n      <div class=\"nav-icon\">\n        <van-icon name=\"diamond-o\" size=\"18\" />\n      </div>\n      <span class=\"nav-text\">{{ pointsStatus.current }}</span>\n    </div>\n\n    <!-- ç”¨æˆ·ä¿¡æ¯ï¼ˆå³è¾¹ï¼‰ -->\n    <div class=\"nav-item nav-user\">\n      <!-- æœªç™»å½•çŠ¶æ€ -->\n      <div v-if=\"!isLoggedIn\" class=\"nav-login\" @click=\"showLoginModal\" title=\"ç‚¹å‡»ç™»å½•\">\n        <div class=\"nav-icon\">\n          <van-icon name=\"user-o\" size=\"18\" />\n        </div>\n        <span class=\"nav-text\">ç™»å½•</span>\n      </div>\n\n      <!-- å·²ç™»å½•çŠ¶æ€ -->\n      <div v-else class=\"nav-avatar\" @click=\"goToProfile\" title=\"ç‚¹å‡»è¿›å…¥ä¸ªäººä¸­å¿ƒ\">\n        <div class=\"nav-icon\">\n          <van-icon name=\"user-o\" size=\"18\" />\n        </div>\n      </div>\n    </div>\n\n    <!-- ç§¯åˆ†å¼¹çª— -->\n    <PointsModal\n      v-model:show=\"showPointsModal\"\n      @points-updated=\"handlePointsUpdated\"\n    />\n\n    <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->\n    <AuthModal\n      v-model:show=\"showAuthModal\"\n      :default-mode=\"authMode\"\n      @success=\"handleAuthSuccess\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, computed, onMounted, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { Toast } from 'vant'\nimport { authApi } from '../services/api.js'\nimport levelCardPointsManager from '../utils/levelCardPointsManager.js'\nimport PointsModal from './PointsModal.vue'\nimport AuthModal from './AuthModal.vue'\n\n// å®šä¹‰äº‹ä»¶\nconst emit = defineEmits(['login', 'logout'])\n\n// è·¯ç”±\nconst router = useRouter()\n\n// å“åº”å¼æ•°æ®\nconst showPointsModal = ref(false)\nconst showAuthModal = ref(false)\nconst authMode = ref('login')\nconst loading = ref(false)\n\n// ç”¨æˆ·ä¿¡æ¯\nconst userInfo = ref(null)\nconst isLoggedIn = computed(() => {\n  const hasToken = authApi.isLoggedIn()\n  const hasUserInfo = !!userInfo.value\n  return hasToken && hasUserInfo\n})\n\n// ç§¯åˆ†çŠ¶æ€\nconst pointsStatus = reactive({\n  current: 0,\n  total_points: 0,\n  cards_count: 0,\n  canGenerate: false,\n  generationCost: 20,\n  isLoggedIn: false\n})\n\n// å®šæ—¶å™¨\nlet statusUpdateTimer = null\n\n// æ›´æ–°ç§¯åˆ†çŠ¶æ€\nconst updatePointsStatus = async () => {\n  // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™ä¸å‘é€APIè¯·æ±‚\n  if (!levelCardPointsManager.isLoggedIn()) {\n    Object.assign(pointsStatus, {\n      current: 0,\n      total_points: 0,\n      cards_count: 0,\n      canGenerate: false,\n      generationCost: 20,\n      isLoggedIn: false\n    })\n    return\n  }\n\n  try {\n    const newStatus = await levelCardPointsManager.getPointsStatus()\n    Object.assign(pointsStatus, newStatus)\n  } catch (error) {\n    console.error('æ›´æ–°ç§¯åˆ†çŠ¶æ€å¤±è´¥:', error)\n    // è®¤è¯é”™è¯¯å¤„ç†\n    if (error.message && (error.message.includes('ä»¤ç‰Œ') || error.message.includes('401'))) {\n      Object.assign(pointsStatus, {\n        current: 0,\n        total_points: 0,\n        cards_count: 0,\n        canGenerate: false,\n        generationCost: 20,\n        isLoggedIn: false\n      })\n    }\n  }\n}\n\n// æ˜¾ç¤ºç™»å½•å¼¹çª—\nconst showLoginModal = () => {\n  authMode.value = 'login'\n  showAuthModal.value = true\n}\n\n// å¤„ç†è®¤è¯æˆåŠŸ\nconst handleAuthSuccess = (data) => {\n  console.log('è®¤è¯æˆåŠŸï¼Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', data)\n\n  // ç«‹å³æ›´æ–°ç”¨æˆ·ä¿¡æ¯\n  userInfo.value = data.user\n\n  // ç¡®ä¿localStorageä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„\n  if (data.user) {\n    localStorage.setItem('user_info', JSON.stringify(data.user))\n  }\n\n  // ç«‹å³æ›´æ–°ç§¯åˆ†çŠ¶æ€ä¸­çš„ç™»å½•çŠ¶æ€\n  pointsStatus.isLoggedIn = true\n\n  // è§¦å‘çˆ¶ç»„ä»¶çš„ç™»å½•äº‹ä»¶\n  emit('login', data)\n\n  // å»¶è¿Ÿæ›´æ–°ç§¯åˆ†çŠ¶æ€ï¼Œç¡®ä¿ç™»å½•çŠ¶æ€å·²åŒæ­¥\n  setTimeout(() => {\n    updatePointsStatus()\n  }, 100)\n\n  // å…³é—­å¼¹çª—\n  showAuthModal.value = false\n}\n\n// è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ\nconst goToProfile = () => {\n  router.push('/profile')\n}\n\n// å¤„ç†ç§¯åˆ†æ›´æ–°\nconst handlePointsUpdated = () => {\n  updatePointsStatus()\n}\n\n// åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯\nconst initUserInfo = () => {\n  console.log('åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯...')\n  const token = authApi.getToken()\n  const localUserInfo = authApi.getLocalUserInfo()\n\n  console.log('Tokenå­˜åœ¨:', !!token)\n  console.log('æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', localUserInfo)\n\n  if (token && localUserInfo) {\n    userInfo.value = localUserInfo\n    console.log('è®¾ç½®ç”¨æˆ·ä¿¡æ¯:', userInfo.value)\n  } else {\n    console.log('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯')\n    userInfo.value = null\n  }\n}\n\n// ç›‘å¬localStorageå˜åŒ–\nconst handleStorageChange = (event) => {\n  console.log('localStorageå˜åŒ–:', event)\n  if (event.key === 'auth_token' || event.key === 'user_info') {\n    console.log('è®¤è¯ç›¸å…³æ•°æ®å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–')\n    initUserInfo()\n    updatePointsStatus()\n  }\n}\n\n// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–\nonMounted(() => {\n  initUserInfo()\n  updatePointsStatus()\n\n  // ç›‘å¬storageäº‹ä»¶ï¼ˆè·¨æ ‡ç­¾é¡µåŒæ­¥ï¼‰\n  window.addEventListener('storage', handleStorageChange)\n\n  // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€\n  statusUpdateTimer = setInterval(updatePointsStatus, 30000)\n})\n\n// ç»„ä»¶å¸è½½æ—¶æ¸…ç†\nonUnmounted(() => {\n  window.removeEventListener('storage', handleStorageChange)\n  if (statusUpdateTimer) {\n    clearInterval(statusUpdateTimer)\n  }\n})\n\n// æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•\ndefineExpose({\n  updatePointsStatus,\n  getCurrentPoints: () => pointsStatus.current,\n  hasEnoughPoints: () => pointsStatus.canGenerate\n})\n</script>\n\n<style scoped>\n.top-navigation {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  z-index: 1000;\n}\n\n.nav-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: rgba(255, 255, 255, 0.95);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 20px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.nav-item:hover {\n  background: rgba(255, 255, 255, 1);\n  border-color: #1989fa;\n  box-shadow: 0 4px 12px rgba(25, 137, 250, 0.2);\n  transform: translateY(-1px);\n}\n\n.nav-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  color: #1989fa;\n}\n\n.nav-text {\n  font-size: 14px;\n  font-weight: 500;\n  color: #323233;\n  white-space: nowrap;\n}\n\n.nav-points {\n  order: 1; /* ç§¯åˆ†åœ¨å·¦è¾¹ */\n}\n\n.nav-user {\n  order: 2; /* ç”¨æˆ·åœ¨å³è¾¹ */\n}\n\n.nav-login {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.nav-avatar {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n  background: linear-gradient(135deg, #1989fa, #1976d2);\n  border-radius: 50%;\n  color: white;\n  margin: -4px;\n}\n\n.nav-avatar:hover {\n  background: linear-gradient(135deg, #1976d2, #1565c0);\n  transform: scale(1.05);\n}\n\n/* æ·±è‰²ä¸»é¢˜é€‚é… */\n@media (prefers-color-scheme: dark) {\n  .nav-item {\n    background: rgba(30, 30, 30, 0.95);\n    border-color: rgba(255, 255, 255, 0.1);\n  }\n\n  .nav-item:hover {\n    background: rgba(40, 40, 40, 1);\n    border-color: #1989fa;\n  }\n\n  .nav-text {\n    color: #ffffff;\n  }\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 768px) {\n  .top-navigation {\n    top: 15px;\n    right: 15px;\n    gap: 8px;\n  }\n\n  .nav-item {\n    padding: 6px 10px;\n  }\n\n  .nav-text {\n    font-size: 13px;\n  }\n\n  .nav-icon {\n    width: 20px;\n    height: 20px;\n  }\n}\n</style>\n"
        }
    ]
}