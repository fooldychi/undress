{
    "sourceFile": "client/src/components/ResultModal.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 25,
            "patches": [
                {
                    "date": 1752389916378,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752389932452,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -267,18 +267,20 @@\n   border-radius: 16px;\n }\n \n .modal-header {\n-  padding: 20px 20px 16px;\n-  border-bottom: 1px solid #f0f0f0;\n+  padding: 16px 20px;\n+  border-bottom: 1px solid rgba(30, 30, 60, 0.5);\n+  background: rgba(15, 15, 30, 0.8);\n+  backdrop-filter: blur(10px);\n   flex-shrink: 0;\n }\n \n .modal-header h3 {\n   margin: 0 0 8px 0;\n-  font-size: 18px;\n+  font-size: 16px;\n   font-weight: 600;\n-  color: #323233;\n+  color: var(--van-text-color, #f7f8fa);\n }\n \n .result-info {\n   margin-top: 8px;\n"
                },
                {
                    "date": 1752389945376,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -287,15 +287,15 @@\n }\n \n .result-desc {\n   font-size: 14px;\n-  color: #646566;\n+  color: var(--van-text-color-2, #969799);\n   margin-bottom: 4px;\n }\n \n .result-time {\n   font-size: 12px;\n-  color: #969799;\n+  color: var(--van-text-color-3, #646566);\n }\n \n .modal-content {\n   flex: 1;\n"
                },
                {
                    "date": 1752389959917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -299,9 +299,9 @@\n \n .modal-content {\n   flex: 1;\n   overflow-y: auto;\n-  padding: 16px 20px 20px;\n+  padding: 12px 16px 16px;\n }\n \n .loading-state,\n .error-state,\n"
                },
                {
                    "date": 1752503821712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n     close-icon-position=\"top-right\"\n   >\n     <div class=\"result-modal\">\n       <div class=\"modal-header\">\n-        <h3>生成结果</h3>\n+        <h3>图片预览</h3>\n         <div class=\"result-info\">\n           <div class=\"result-desc\">{{ resultData?.description }}</div>\n           <div class=\"result-time\">{{ formatDate(resultData?.createdAt) }}</div>\n         </div>\n"
                },
                {
                    "date": 1752503842983,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,32 +79,16 @@\n \n           <!-- 操作按钮 -->\n           <div class=\"result-actions\">\n             <van-button\n-              v-if=\"isImage\"\n               type=\"primary\"\n               size=\"small\"\n-              @click=\"previewImage\"\n-              icon=\"eye-o\"\n-            >\n-              预览\n-            </van-button>\n-            <van-button\n-              type=\"default\"\n-              size=\"small\"\n               @click=\"downloadFile\"\n               icon=\"down\"\n+              block\n             >\n               下载\n             </van-button>\n-            <van-button\n-              type=\"default\"\n-              size=\"small\"\n-              @click=\"shareResult\"\n-              icon=\"share-o\"\n-            >\n-              分享\n-            </van-button>\n           </div>\n         </div>\n \n         <div v-else class=\"no-result\">\n"
                },
                {
                    "date": 1752503883913,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -350,8 +350,9 @@\n   display: flex;\n   gap: 8px;\n   justify-content: center;\n   flex-wrap: wrap;\n+  margin-top: 16px;\n }\n \n /* 深色主题适配 */\n @media (prefers-color-scheme: dark) {\n"
                },
                {
                    "date": 1752504282652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,8 +40,9 @@\n               fit=\"contain\"\n               :show-loading=\"true\"\n               :show-error=\"true\"\n               @click=\"previewImage\"\n+              class=\"result-image\"\n             >\n               <template #loading>\n                 <van-loading type=\"spinner\" size=\"20\" />\n               </template>\n@@ -60,8 +61,9 @@\n               :src=\"resultData.mediaUrl\"\n               controls\n               preload=\"metadata\"\n               @error=\"handleMediaError\"\n+              class=\"result-video\"\n             >\n               您的浏览器不支持视频播放\n             </video>\n           </div>\n@@ -70,11 +72,8 @@\n           <div v-else class=\"file-result\">\n             <div class=\"file-info\">\n               <van-icon name=\"description\" size=\"48\" />\n               <div class=\"file-name\">生成结果文件</div>\n-              <van-button type=\"primary\" size=\"small\" @click=\"downloadFile\">\n-                下载文件\n-              </van-button>\n             </div>\n           </div>\n \n           <!-- 操作按钮 -->\n"
                },
                {
                    "date": 1752504315700,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -302,13 +302,22 @@\n }\n \n .image-result {\n   text-align: center;\n+  width: 100%;\n }\n \n+.result-image {\n+  width: 100%;\n+  max-height: 400px;\n+  border-radius: 8px;\n+  overflow: hidden;\n+  cursor: pointer;\n+}\n+\n .image-result .van-image {\n-  max-width: 100%;\n-  max-height: 300px;\n+  width: 100%;\n+  max-height: 400px;\n   border-radius: 8px;\n   overflow: hidden;\n   cursor: pointer;\n }\n"
                },
                {
                    "date": 1752504330160,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -330,11 +330,21 @@\n   color: #969799;\n   padding: 40px 20px;\n }\n \n+.video-result {\n+  width: 100%;\n+}\n+\n+.result-video {\n+  width: 100%;\n+  max-height: 400px;\n+  border-radius: 8px;\n+}\n+\n .video-result video {\n   width: 100%;\n-  max-height: 300px;\n+  max-height: 400px;\n   border-radius: 8px;\n }\n \n .file-result {\n"
                },
                {
                    "date": 1752504346182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <template>\n   <van-popup\n     v-model:show=\"visible\"\n     position=\"center\"\n-    :style=\"{ width: '90%', maxWidth: '400px' }\"\n+    :style=\"{ width: '95%', maxWidth: '500px' }\"\n     round\n     closeable\n     close-icon-position=\"top-right\"\n   >\n"
                },
                {
                    "date": 1752504643087,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n             </van-button>\n           </van-empty>\n         </div>\n \n-        <div v-else-if=\"resultData?.mediaUrl\" class=\"result-content\">\n+        <div v-else class=\"result-content\">\n           <!-- 图片结果 -->\n           <div v-if=\"isImage\" class=\"image-result\">\n             <van-image\n               :src=\"resultData.mediaUrl\"\n"
                },
                {
                    "date": 1752504673128,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,62 +32,70 @@\n           </van-empty>\n         </div>\n \n         <div v-else class=\"result-content\">\n-          <!-- 图片结果 -->\n-          <div v-if=\"isImage\" class=\"image-result\">\n-            <van-image\n-              :src=\"resultData.mediaUrl\"\n-              fit=\"contain\"\n-              :show-loading=\"true\"\n-              :show-error=\"true\"\n-              @click=\"previewImage\"\n-              class=\"result-image\"\n-            >\n-              <template #loading>\n-                <van-loading type=\"spinner\" size=\"20\" />\n-              </template>\n-              <template #error>\n-                <div class=\"image-error\">\n-                  <van-icon name=\"photo-fail\" size=\"32\" />\n-                  <div>图片加载失败</div>\n-                </div>\n-              </template>\n-            </van-image>\n-          </div>\n+          <!-- 有媒体URL时显示内容 -->\n+          <div v-if=\"resultData?.mediaUrl\">\n+            <!-- 图片结果 -->\n+            <div v-if=\"isImage\" class=\"image-result\">\n+              <van-image\n+                :src=\"resultData.mediaUrl\"\n+                fit=\"contain\"\n+                :show-loading=\"true\"\n+                :show-error=\"true\"\n+                @click=\"previewImage\"\n+                class=\"result-image\"\n+              >\n+                <template #loading>\n+                  <van-loading type=\"spinner\" size=\"20\" />\n+                </template>\n+                <template #error>\n+                  <div class=\"image-error\">\n+                    <van-icon name=\"photo-fail\" size=\"32\" />\n+                    <div>图片加载失败</div>\n+                  </div>\n+                </template>\n+              </van-image>\n+            </div>\n \n-          <!-- 视频结果 -->\n-          <div v-else-if=\"isVideo\" class=\"video-result\">\n-            <video\n-              :src=\"resultData.mediaUrl\"\n-              controls\n-              preload=\"metadata\"\n-              @error=\"handleMediaError\"\n-              class=\"result-video\"\n-            >\n-              您的浏览器不支持视频播放\n-            </video>\n-          </div>\n+            <!-- 视频结果 -->\n+            <div v-else-if=\"isVideo\" class=\"video-result\">\n+              <video\n+                :src=\"resultData.mediaUrl\"\n+                controls\n+                preload=\"metadata\"\n+                @error=\"handleMediaError\"\n+                class=\"result-video\"\n+              >\n+                您的浏览器不支持视频播放\n+              </video>\n+            </div>\n \n-          <!-- 其他文件类型 -->\n-          <div v-else class=\"file-result\">\n-            <div class=\"file-info\">\n-              <van-icon name=\"description\" size=\"48\" />\n-              <div class=\"file-name\">生成结果文件</div>\n+            <!-- 其他文件类型 -->\n+            <div v-else class=\"file-result\">\n+              <div class=\"file-info\">\n+                <van-icon name=\"description\" size=\"48\" />\n+                <div class=\"file-name\">生成结果文件</div>\n+              </div>\n             </div>\n+\n+            <!-- 操作按钮 -->\n+            <div class=\"result-actions\">\n+              <van-button\n+                type=\"primary\"\n+                size=\"small\"\n+                @click=\"downloadFile\"\n+                icon=\"down\"\n+                block\n+              >\n+                下载\n+              </van-button>\n+            </div>\n           </div>\n \n-          <!-- 操作按钮 -->\n-          <div class=\"result-actions\">\n-            <van-button\n-              type=\"primary\"\n-              size=\"small\"\n-              @click=\"downloadFile\"\n-              icon=\"down\"\n-              block\n-            >\n-              下载\n-            </van-button>\n+          <!-- 无媒体URL时显示提示 -->\n+          <div v-else class=\"no-result\">\n+            <van-empty description=\"暂无结果数据\" />\n           </div>\n         </div>\n \n         <div v-else class=\"no-result\">\n"
                },
                {
                    "date": 1752504754169,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -137,9 +137,11 @@\n // 计算媒体类型\n const isImage = computed(() => {\n   if (!props.resultData?.mediaUrl) return false\n   const url = props.resultData.mediaUrl.toLowerCase()\n-  return /\\.(jpg|jpeg|png|gif|webp|bmp)(\\?.*)?$/i.test(url)\n+  // 如果是视频格式则返回false，否则默认当作图片处理\n+  const isVideoFormat = /\\.(mp4|webm|ogg|avi|mov)(\\?.*)?$/i.test(url)\n+  return !isVideoFormat\n })\n \n const isVideo = computed(() => {\n   if (!props.resultData?.mediaUrl) return false\n"
                },
                {
                    "date": 1752504962009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,23 +36,33 @@\n           <!-- 有媒体URL时显示内容 -->\n           <div v-if=\"resultData?.mediaUrl\">\n             <!-- 图片结果 -->\n             <div v-if=\"isImage\" class=\"image-result\">\n+              <!-- 调试信息 -->\n+              <div v-if=\"false\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n+                <div>URL: {{ resultData.mediaUrl }}</div>\n+                <div>isImage: {{ isImage }}</div>\n+                <div>isVideo: {{ isVideo }}</div>\n+              </div>\n+\n               <van-image\n                 :src=\"resultData.mediaUrl\"\n                 fit=\"contain\"\n                 :show-loading=\"true\"\n                 :show-error=\"true\"\n                 @click=\"previewImage\"\n                 class=\"result-image\"\n+                @load=\"handleImageLoad\"\n+                @error=\"handleImageError\"\n               >\n                 <template #loading>\n                   <van-loading type=\"spinner\" size=\"20\" />\n                 </template>\n                 <template #error>\n                   <div class=\"image-error\">\n                     <van-icon name=\"photo-fail\" size=\"32\" />\n                     <div>图片加载失败</div>\n+                    <div style=\"font-size: 10px; margin-top: 4px;\">{{ resultData.mediaUrl }}</div>\n                   </div>\n                 </template>\n               </van-image>\n             </div>\n"
                },
                {
                    "date": 1752504983403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -236,8 +236,19 @@\n   error.value = true\n   Toast.fail('媒体文件加载失败')\n }\n \n+// 处理图片加载成功\n+const handleImageLoad = () => {\n+  console.log('图片加载成功:', props.resultData?.mediaUrl)\n+}\n+\n+// 处理图片加载失败\n+const handleImageError = () => {\n+  console.error('图片加载失败:', props.resultData?.mediaUrl)\n+  Toast.fail('图片加载失败')\n+}\n+\n // 重试加载\n const retryLoad = () => {\n   error.value = false\n   loading.value = true\n"
                },
                {
                    "date": 1752505009766,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,9 +37,9 @@\n           <div v-if=\"resultData?.mediaUrl\">\n             <!-- 图片结果 -->\n             <div v-if=\"isImage\" class=\"image-result\">\n               <!-- 调试信息 -->\n-              <div v-if=\"false\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n+              <div v-if=\"true\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n                 <div>URL: {{ resultData.mediaUrl }}</div>\n                 <div>isImage: {{ isImage }}</div>\n                 <div>isVideo: {{ isVideo }}</div>\n               </div>\n"
                },
                {
                    "date": 1752505058812,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,12 +106,8 @@\n           <div v-else class=\"no-result\">\n             <van-empty description=\"暂无结果数据\" />\n           </div>\n         </div>\n-\n-        <div v-else class=\"no-result\">\n-          <van-empty description=\"暂无结果数据\" />\n-        </div>\n       </div>\n     </div>\n   </van-popup>\n </template>\n"
                },
                {
                    "date": 1752505077254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -258,10 +258,16 @@\n watch(() => props.show, (newVal) => {\n   if (newVal) {\n     error.value = false\n     loading.value = false\n+    console.log('ResultModal 打开，数据:', props.resultData)\n   }\n })\n+\n+// 监听resultData变化\n+watch(() => props.resultData, (newVal) => {\n+  console.log('ResultModal resultData 变化:', newVal)\n+}, { deep: true })\n </script>\n \n <style scoped>\n .result-modal {\n"
                },
                {
                    "date": 1752505110105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,9 +37,9 @@\n           <div v-if=\"resultData?.mediaUrl\">\n             <!-- 图片结果 -->\n             <div v-if=\"isImage\" class=\"image-result\">\n               <!-- 调试信息 -->\n-              <div v-if=\"true\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n+              <div v-if=\"false\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n                 <div>URL: {{ resultData.mediaUrl }}</div>\n                 <div>isImage: {{ isImage }}</div>\n                 <div>isVideo: {{ isVideo }}</div>\n               </div>\n"
                },
                {
                    "date": 1752505133332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,9 +43,22 @@\n                 <div>isImage: {{ isImage }}</div>\n                 <div>isVideo: {{ isVideo }}</div>\n               </div>\n \n+              <!-- 直接使用img标签测试 -->\n+              <img\n+                v-if=\"resultData.mediaUrl\"\n+                :src=\"resultData.mediaUrl\"\n+                :alt=\"resultData.description || '生成结果'\"\n+                class=\"result-image-direct\"\n+                @click=\"previewImage\"\n+                @load=\"handleImageLoad\"\n+                @error=\"handleImageError\"\n+              />\n+\n+              <!-- 备用：van-image组件 -->\n               <van-image\n+                v-else\n                 :src=\"resultData.mediaUrl\"\n                 fit=\"contain\"\n                 :show-loading=\"true\"\n                 :show-error=\"true\"\n"
                },
                {
                    "date": 1752505152399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -359,8 +359,17 @@\n   overflow: hidden;\n   cursor: pointer;\n }\n \n+.result-image-direct {\n+  width: 100%;\n+  max-height: 400px;\n+  border-radius: 8px;\n+  cursor: pointer;\n+  object-fit: contain;\n+  display: block;\n+}\n+\n .image-result .van-image {\n   width: 100%;\n   max-height: 400px;\n   border-radius: 8px;\n"
                },
                {
                    "date": 1752505510781,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n         </div>\n \n         <div v-else class=\"result-content\">\n           <!-- 有媒体URL时显示内容 -->\n-          <div v-if=\"resultData?.mediaUrl\">\n+          <div v-if=\"resultData?.mediaUrl\" class=\"media-container\">\n             <!-- 图片结果 -->\n             <div v-if=\"isImage\" class=\"image-result\">\n               <!-- 调试信息 -->\n               <div v-if=\"false\" style=\"background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 12px;\">\n@@ -99,28 +99,28 @@\n                 <van-icon name=\"description\" size=\"48\" />\n                 <div class=\"file-name\">生成结果文件</div>\n               </div>\n             </div>\n-\n-            <!-- 操作按钮 -->\n-            <div class=\"result-actions\">\n-              <van-button\n-                type=\"primary\"\n-                size=\"small\"\n-                @click=\"downloadFile\"\n-                icon=\"down\"\n-                block\n-              >\n-                下载\n-              </van-button>\n-            </div>\n           </div>\n \n           <!-- 无媒体URL时显示提示 -->\n           <div v-else class=\"no-result\">\n             <van-empty description=\"暂无结果数据\" />\n           </div>\n         </div>\n+\n+        <!-- 固定在底部的操作按钮 -->\n+        <div v-if=\"resultData?.mediaUrl\" class=\"modal-footer\">\n+          <van-button\n+            type=\"primary\"\n+            size=\"small\"\n+            @click=\"downloadFile\"\n+            icon=\"down\"\n+            block\n+          >\n+            下载\n+          </van-button>\n+        </div>\n       </div>\n     </div>\n   </van-popup>\n </template>\n"
                },
                {
                    "date": 1752505534874,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -284,9 +284,9 @@\n \n <style scoped>\n .result-modal {\n   padding: 0;\n-  max-height: 70vh;\n+  max-height: 80vh;\n   overflow: hidden;\n   display: flex;\n   flex-direction: column;\n   background: rgba(10, 10, 20, 0.95);\n"
                },
                {
                    "date": 1752505552919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -328,11 +328,24 @@\n \n .modal-content {\n   flex: 1;\n   overflow-y: auto;\n-  padding: 12px 16px 16px;\n+  padding: 12px 16px 0;\n+  min-height: 0;\n }\n \n+.media-container {\n+  padding-bottom: 16px;\n+}\n+\n+.modal-footer {\n+  padding: 16px;\n+  border-top: 1px solid rgba(30, 30, 60, 0.5);\n+  background: rgba(15, 15, 30, 0.8);\n+  backdrop-filter: blur(10px);\n+  flex-shrink: 0;\n+}\n+\n .loading-state,\n .error-state,\n .no-result {\n   display: flex;\n"
                },
                {
                    "date": 1752505568161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -431,16 +431,10 @@\n   font-size: 14px;\n   color: #646566;\n }\n \n-.result-actions {\n-  display: flex;\n-  gap: 8px;\n-  justify-content: center;\n-  flex-wrap: wrap;\n-  margin-top: 16px;\n-}\n \n+\n /* 深色主题适配 */\n @media (prefers-color-scheme: dark) {\n   .modal-header {\n     border-bottom-color: #3a3a3c;\n"
                }
            ],
            "date": 1752389916378,
            "name": "Commit-0",
            "content": "<template>\n  <van-popup\n    v-model:show=\"visible\"\n    position=\"center\"\n    :style=\"{ width: '90%', maxWidth: '400px' }\"\n    round\n    closeable\n    close-icon-position=\"top-right\"\n  >\n    <div class=\"result-modal\">\n      <div class=\"modal-header\">\n        <h3>生成结果</h3>\n        <div class=\"result-info\">\n          <div class=\"result-desc\">{{ resultData?.description }}</div>\n          <div class=\"result-time\">{{ formatDate(resultData?.createdAt) }}</div>\n        </div>\n      </div>\n\n      <div class=\"modal-content\">\n        <div v-if=\"loading\" class=\"loading-state\">\n          <van-loading size=\"24px\" vertical>加载中...</van-loading>\n        </div>\n\n        <div v-else-if=\"error\" class=\"error-state\">\n          <van-empty\n            image=\"error\"\n            description=\"加载失败\"\n          >\n            <van-button type=\"primary\" size=\"small\" @click=\"retryLoad\">\n              重试\n            </van-button>\n          </van-empty>\n        </div>\n\n        <div v-else-if=\"resultData?.mediaUrl\" class=\"result-content\">\n          <!-- 图片结果 -->\n          <div v-if=\"isImage\" class=\"image-result\">\n            <van-image\n              :src=\"resultData.mediaUrl\"\n              fit=\"contain\"\n              :show-loading=\"true\"\n              :show-error=\"true\"\n              @click=\"previewImage\"\n            >\n              <template #loading>\n                <van-loading type=\"spinner\" size=\"20\" />\n              </template>\n              <template #error>\n                <div class=\"image-error\">\n                  <van-icon name=\"photo-fail\" size=\"32\" />\n                  <div>图片加载失败</div>\n                </div>\n              </template>\n            </van-image>\n          </div>\n\n          <!-- 视频结果 -->\n          <div v-else-if=\"isVideo\" class=\"video-result\">\n            <video\n              :src=\"resultData.mediaUrl\"\n              controls\n              preload=\"metadata\"\n              @error=\"handleMediaError\"\n            >\n              您的浏览器不支持视频播放\n            </video>\n          </div>\n\n          <!-- 其他文件类型 -->\n          <div v-else class=\"file-result\">\n            <div class=\"file-info\">\n              <van-icon name=\"description\" size=\"48\" />\n              <div class=\"file-name\">生成结果文件</div>\n              <van-button type=\"primary\" size=\"small\" @click=\"downloadFile\">\n                下载文件\n              </van-button>\n            </div>\n          </div>\n\n          <!-- 操作按钮 -->\n          <div class=\"result-actions\">\n            <van-button\n              v-if=\"isImage\"\n              type=\"primary\"\n              size=\"small\"\n              @click=\"previewImage\"\n              icon=\"eye-o\"\n            >\n              预览\n            </van-button>\n            <van-button\n              type=\"default\"\n              size=\"small\"\n              @click=\"downloadFile\"\n              icon=\"down\"\n            >\n              下载\n            </van-button>\n            <van-button\n              type=\"default\"\n              size=\"small\"\n              @click=\"shareResult\"\n              icon=\"share-o\"\n            >\n              分享\n            </van-button>\n          </div>\n        </div>\n\n        <div v-else class=\"no-result\">\n          <van-empty description=\"暂无结果数据\" />\n        </div>\n      </div>\n    </div>\n  </van-popup>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport { Toast, ImagePreview } from 'vant'\n\n// Props\nconst props = defineProps({\n  show: {\n    type: Boolean,\n    default: false\n  },\n  resultData: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\n// Emits\nconst emit = defineEmits(['update:show'])\n\n// 响应式数据\nconst visible = computed({\n  get: () => props.show,\n  set: (value) => emit('update:show', value)\n})\n\nconst loading = ref(false)\nconst error = ref(false)\n\n// 计算媒体类型\nconst isImage = computed(() => {\n  if (!props.resultData?.mediaUrl) return false\n  const url = props.resultData.mediaUrl.toLowerCase()\n  return /\\.(jpg|jpeg|png|gif|webp|bmp)(\\?.*)?$/i.test(url)\n})\n\nconst isVideo = computed(() => {\n  if (!props.resultData?.mediaUrl) return false\n  const url = props.resultData.mediaUrl.toLowerCase()\n  return /\\.(mp4|webm|ogg|avi|mov)(\\?.*)?$/i.test(url)\n})\n\n// 格式化日期\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleString('zh-CN', {\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit'\n  })\n}\n\n// 预览图片\nconst previewImage = () => {\n  if (!isImage.value) return\n\n  ImagePreview({\n    images: [props.resultData.mediaUrl],\n    showIndex: false,\n    closeable: true\n  })\n}\n\n// 下载文件\nconst downloadFile = () => {\n  if (!props.resultData?.mediaUrl) {\n    Toast.fail('文件地址无效')\n    return\n  }\n\n  try {\n    const link = document.createElement('a')\n    link.href = props.resultData.mediaUrl\n    link.download = `result_${Date.now()}`\n    link.target = '_blank'\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n    Toast.success('开始下载')\n  } catch (error) {\n    console.error('下载失败:', error)\n    Toast.fail('下载失败')\n  }\n}\n\n// 分享结果\nconst shareResult = () => {\n  if (navigator.share && props.resultData?.mediaUrl) {\n    navigator.share({\n      title: '我的AI生成结果',\n      text: props.resultData.description,\n      url: props.resultData.mediaUrl\n    }).catch(() => {\n      copyToClipboard()\n    })\n  } else {\n    copyToClipboard()\n  }\n}\n\n// 复制到剪贴板\nconst copyToClipboard = () => {\n  if (!props.resultData?.mediaUrl) return\n\n  navigator.clipboard.writeText(props.resultData.mediaUrl).then(() => {\n    Toast.success('链接已复制到剪贴板')\n  }).catch(() => {\n    Toast.fail('复制失败')\n  })\n}\n\n// 处理媒体错误\nconst handleMediaError = () => {\n  error.value = true\n  Toast.fail('媒体文件加载失败')\n}\n\n// 重试加载\nconst retryLoad = () => {\n  error.value = false\n  loading.value = true\n\n  setTimeout(() => {\n    loading.value = false\n  }, 1000)\n}\n\n// 监听显示状态\nwatch(() => props.show, (newVal) => {\n  if (newVal) {\n    error.value = false\n    loading.value = false\n  }\n})\n</script>\n\n<style scoped>\n.result-modal {\n  padding: 0;\n  max-height: 70vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  background: rgba(10, 10, 20, 0.95);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  border: 1px solid rgba(30, 30, 60, 0.5);\n  border-radius: 16px;\n}\n\n.modal-header {\n  padding: 20px 20px 16px;\n  border-bottom: 1px solid #f0f0f0;\n  flex-shrink: 0;\n}\n\n.modal-header h3 {\n  margin: 0 0 8px 0;\n  font-size: 18px;\n  font-weight: 600;\n  color: #323233;\n}\n\n.result-info {\n  margin-top: 8px;\n}\n\n.result-desc {\n  font-size: 14px;\n  color: #646566;\n  margin-bottom: 4px;\n}\n\n.result-time {\n  font-size: 12px;\n  color: #969799;\n}\n\n.modal-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px 20px 20px;\n}\n\n.loading-state,\n.error-state,\n.no-result {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 200px;\n}\n\n.result-content {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.image-result {\n  text-align: center;\n}\n\n.image-result .van-image {\n  max-width: 100%;\n  max-height: 300px;\n  border-radius: 8px;\n  overflow: hidden;\n  cursor: pointer;\n}\n\n.image-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 8px;\n  color: #969799;\n  padding: 40px 20px;\n}\n\n.video-result video {\n  width: 100%;\n  max-height: 300px;\n  border-radius: 8px;\n}\n\n.file-result {\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.file-info {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n}\n\n.file-name {\n  font-size: 14px;\n  color: #646566;\n}\n\n.result-actions {\n  display: flex;\n  gap: 8px;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n/* 深色主题适配 */\n@media (prefers-color-scheme: dark) {\n  .modal-header {\n    border-bottom-color: #3a3a3c;\n  }\n\n  .modal-header h3 {\n    color: #ffffff;\n  }\n\n  .result-desc {\n    color: #8e8e93;\n  }\n\n  .result-time {\n    color: #6d6d70;\n  }\n\n  .file-name {\n    color: #8e8e93;\n  }\n}\n</style>\n"
        }
    ]
}