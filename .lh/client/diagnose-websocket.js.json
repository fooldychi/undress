{
    "sourceFile": "client/diagnose-websocket.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752924021365,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752924021365,
            "name": "Commit-0",
            "content": "// WebSocketæœåŠ¡å™¨é”å®šæœºåˆ¶è¯Šæ–­è„šæœ¬\n// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œæ­¤è„šæœ¬\n\nconsole.log('ğŸ” å¼€å§‹è¯Šæ–­WebSocketæœåŠ¡å™¨é”å®šæœºåˆ¶...');\n\n// 1. æ£€æŸ¥å…¨å±€å‡½æ•°æ˜¯å¦å¯ç”¨\nconsole.log('\\n1ï¸âƒ£ æ£€æŸ¥å…¨å±€å‡½æ•°å¯ç”¨æ€§:');\nconst requiredFunctions = [\n  'getWebSocketServerStatus',\n  'debugWebSocketLock',\n  'resetWebSocketServer',\n  'getApiBaseUrl'\n];\n\nrequiredFunctions.forEach(funcName => {\n  if (typeof window[funcName] === 'function') {\n    console.log(`âœ… ${funcName} å¯ç”¨`);\n  } else {\n    console.log(`âŒ ${funcName} ä¸å¯ç”¨`);\n  }\n});\n\n// 2. æ£€æŸ¥å½“å‰WebSocketçŠ¶æ€\nconsole.log('\\n2ï¸âƒ£ æ£€æŸ¥WebSocketçŠ¶æ€:');\ntry {\n  if (typeof window.getWebSocketServerStatus === 'function') {\n    const status = window.getWebSocketServerStatus();\n    console.log('ğŸ“Š WebSocketçŠ¶æ€:', status);\n\n    // åˆ†æçŠ¶æ€\n    if (status.lockedServer) {\n      console.log(`ğŸ”’ å·²é”å®šæœåŠ¡å™¨: ${status.lockedServer}`);\n      console.log(`ğŸ• é”å®šæ—¶é—´: ${new Date(status.lockTimestamp).toLocaleString()}`);\n      console.log(`â±ï¸ é”å®šæŒç»­: ${Math.round((Date.now() - status.lockTimestamp) / 1000)}ç§’`);\n    } else {\n      console.log('âš ï¸ æ²¡æœ‰é”å®šçš„æœåŠ¡å™¨');\n    }\n\n    if (status.isConnected) {\n      console.log('âœ… WebSocketå·²è¿æ¥');\n    } else {\n      console.log('âŒ WebSocketæœªè¿æ¥');\n    }\n\n    console.log(`ğŸ“¡ è¿æ¥çŠ¶æ€: ${status.connectionState} (1=OPEN)`);\n    console.log(`ğŸ“Š å¾…å¤„ç†ä»»åŠ¡: ${status.pendingTasksCount}`);\n  } else {\n    console.log('âŒ getWebSocketServerStatus å‡½æ•°ä¸å¯ç”¨');\n  }\n} catch (error) {\n  console.error('âŒ æ£€æŸ¥WebSocketçŠ¶æ€å¤±è´¥:', error);\n}\n\n// 3. æµ‹è¯•APIåŸºç¡€URLè·å–\nconsole.log('\\n3ï¸âƒ£ æµ‹è¯•APIåŸºç¡€URLè·å–:');\nif (typeof window.getApiBaseUrl === 'function') {\n  window.getApiBaseUrl().then(url => {\n    console.log(`ğŸ”— å½“å‰APIåŸºç¡€URL: ${url}`);\n\n    // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†é”å®šçš„æœåŠ¡å™¨\n    if (typeof window.getWebSocketServerStatus === 'function') {\n      const status = window.getWebSocketServerStatus();\n      if (status.lockedServer && url === status.lockedServer) {\n        console.log('âœ… APIä½¿ç”¨äº†é”å®šçš„æœåŠ¡å™¨');\n      } else if (status.lockedServer) {\n        console.log('âš ï¸ APIæ²¡æœ‰ä½¿ç”¨é”å®šçš„æœåŠ¡å™¨');\n        console.log(`   é”å®šçš„æœåŠ¡å™¨: ${status.lockedServer}`);\n        console.log(`   APIä½¿ç”¨çš„æœåŠ¡å™¨: ${url}`);\n      } else {\n        console.log('â„¹ï¸ æ²¡æœ‰é”å®šçš„æœåŠ¡å™¨ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡');\n      }\n    }\n  }).catch(error => {\n    console.error('âŒ è·å–APIåŸºç¡€URLå¤±è´¥:', error);\n  });\n} else {\n  console.log('âŒ getApiBaseUrl å‡½æ•°ä¸å¯ç”¨');\n}\n\n// 4. è¿è¡Œè¯¦ç»†è°ƒè¯•\nconsole.log('\\n4ï¸âƒ£ è¿è¡Œè¯¦ç»†è°ƒè¯•:');\nif (typeof window.debugWebSocketLock === 'function') {\n  try {\n    const debugResult = window.debugWebSocketLock();\n    console.log('ğŸ› è°ƒè¯•ç»“æœ:', debugResult);\n  } catch (error) {\n    console.error('âŒ è°ƒè¯•å¤±è´¥:', error);\n  }\n} else {\n  console.log('âŒ debugWebSocketLock å‡½æ•°ä¸å¯ç”¨');\n}\n\n// 5. æµ‹è¯•è§£é”æ¡ä»¶æ£€æŸ¥\nconsole.log('\\n5ï¸âƒ£ æµ‹è¯•è§£é”æ¡ä»¶æ£€æŸ¥:');\nif (typeof window.checkServerUnlockCondition === 'function') {\n  try {\n    const unlocked = window.checkServerUnlockCondition();\n    console.log(`ğŸ”“ è§£é”æ£€æŸ¥ç»“æœ: ${unlocked ? 'å·²è§£é”' : 'ä¿æŒé”å®š'}`);\n  } catch (error) {\n    console.error('âŒ è§£é”æ£€æŸ¥å¤±è´¥:', error);\n  }\n} else {\n  console.log('âŒ checkServerUnlockCondition å‡½æ•°ä¸å¯ç”¨');\n}\n\n// 6. å»ºè®®ä¿®å¤æ­¥éª¤\nconsole.log('\\n6ï¸âƒ£ å»ºè®®ä¿®å¤æ­¥éª¤:');\nconsole.log('å¦‚æœå‘ç°é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ­¥éª¤:');\nconsole.log('1. æ£€æŸ¥è§£é”æ¡ä»¶: window.checkServerUnlockCondition()');\nconsole.log('2. å®‰å…¨é‡ç½®(æœ‰ä»»åŠ¡æ—¶ä¼šæç¤º): window.resetWebSocketServer()');\nconsole.log('3. å¼ºåˆ¶é‡ç½®(æ¸…ç†æ‰€æœ‰ä»»åŠ¡): window.resetWebSocketServer(true)');\nconsole.log('4. åˆ·æ–°é¡µé¢é‡æ–°å»ºç«‹è¿æ¥');\nconsole.log('5. æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒæœåŠ¡å™¨çŠ¶æ€');\n\nconsole.log('\\nğŸ” è¯Šæ–­å®Œæˆ - æ–°ç‰ˆæœ¬æ”¯æŒä»»åŠ¡å®Œæˆåè§£é”');\n"
        }
    ]
}