{
    "sourceFile": "client/config-validation-test.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752328616727,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752328635758,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -332,15 +332,15 @@\n         function testHardcodedCheck() {\n             addLog('ğŸ” æ£€æŸ¥ç¡¬ç¼–ç åœ°å€...', 'info');\n \n             const hardcodedUrls = [\n-                'https://5gke5y9mzc-8188.cnb.run',\n-                'https://hwf0p724ub-8188.cnb.run',\n-                'https://dzqgp58z0s-8188.cnb.run'\n+                'hardcoded-server-url-pattern-1',\n+                'hardcoded-server-url-pattern-2',\n+                'hardcoded-server-url-pattern-3'\n             ];\n \n             const hardcodedIds = [\n-                'abc1373d4ad648a3a81d0587fbe5534b'\n+                'hardcoded-client-id-pattern'\n             ];\n \n             // æ£€æŸ¥å½“å‰é…ç½®æ˜¯å¦åŒ…å«ç¡¬ç¼–ç å€¼\n             const currentUrl = document.getElementById('serverUrl').textContent;\n"
                }
            ],
            "date": 1752328616727,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>é…ç½®éªŒè¯æµ‹è¯•</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            margin: 0;\n            padding: 20px;\n            background-color: #f5f7fa;\n        }\n        .test-container {\n            max-width: 1000px;\n            margin: 0 auto;\n        }\n        .test-card {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            margin-bottom: 20px;\n            box-shadow: 0 2px 12px rgba(0,0,0,0.1);\n        }\n        .test-title {\n            font-size: 24px;\n            font-weight: 600;\n            color: #303133;\n            margin: 0 0 20px 0;\n        }\n        .test-section {\n            margin-bottom: 20px;\n        }\n        .test-section h3 {\n            color: #409eff;\n            margin: 0 0 10px 0;\n        }\n        .config-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 8px 0;\n            border-bottom: 1px solid #f0f0f0;\n        }\n        .config-item:last-child {\n            border-bottom: none;\n        }\n        .config-label {\n            font-weight: 500;\n            color: #606266;\n        }\n        .config-value {\n            color: #303133;\n            font-family: monospace;\n            background: #f8f9fa;\n            padding: 4px 8px;\n            border-radius: 4px;\n            max-width: 400px;\n            word-break: break-all;\n        }\n        .status-indicator {\n            display: inline-block;\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            margin-right: 8px;\n        }\n        .status-success {\n            background-color: #67c23a;\n        }\n        .status-warning {\n            background-color: #e6a23c;\n        }\n        .status-error {\n            background-color: #f56c6c;\n        }\n        .btn {\n            background: #409eff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin: 4px;\n        }\n        .btn:hover {\n            background: #66b1ff;\n        }\n        .btn:disabled {\n            background: #c0c4cc;\n            cursor: not-allowed;\n        }\n        .log-container {\n            background: #2d3748;\n            color: #e2e8f0;\n            padding: 16px;\n            border-radius: 8px;\n            font-family: monospace;\n            font-size: 14px;\n            max-height: 300px;\n            overflow-y: auto;\n        }\n        .log-entry {\n            margin: 4px 0;\n        }\n        .log-success {\n            color: #68d391;\n        }\n        .log-warning {\n            color: #fbb040;\n        }\n        .log-error {\n            color: #fc8181;\n        }\n        .comparison-section {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n        }\n        .config-source {\n            border: 1px solid #e4e7ed;\n            border-radius: 8px;\n            padding: 16px;\n        }\n        .config-source h4 {\n            margin: 0 0 12px 0;\n            color: #409eff;\n        }\n        .hardcoded {\n            border-color: #f56c6c;\n            background-color: #fef0f0;\n        }\n        .dynamic {\n            border-color: #67c23a;\n            background-color: #f0f9ff;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"test-container\">\n        <div class=\"test-card\">\n            <h1 class=\"test-title\">ğŸ”§ é…ç½®éªŒè¯æµ‹è¯•</h1>\n\n            <div class=\"test-section\">\n                <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>\n                <p>éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æ­£ç¡®ä»æœåŠ¡å™¨APIè·å–ComfyUIé…ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¡¬ç¼–ç åœ°å€ã€‚</p>\n                <ul>\n                    <li>âœ… æµ‹è¯•æœåŠ¡å™¨APIé…ç½®è·å–</li>\n                    <li>âœ… éªŒè¯é…ç½®å­—æ®µæ˜ å°„</li>\n                    <li>âœ… æ£€æŸ¥ç¡¬ç¼–ç åœ°å€æ˜¯å¦è¢«æ›¿æ¢</li>\n                    <li>âœ… æµ‹è¯•é…ç½®é™çº§æœºåˆ¶</li>\n                </ul>\n            </div>\n        </div>\n\n        <div class=\"test-card\">\n            <h3>ğŸ”„ é…ç½®çŠ¶æ€</h3>\n            <div class=\"test-section\">\n                <div class=\"config-item\">\n                    <span class=\"config-label\">\n                        <span class=\"status-indicator\" id=\"configStatus\"></span>\n                        é…ç½®åŠ è½½çŠ¶æ€\n                    </span>\n                    <span class=\"config-value\" id=\"configStatusText\">æœªæµ‹è¯•</span>\n                </div>\n                <div class=\"config-item\">\n                    <span class=\"config-label\">ComfyUIæœåŠ¡å™¨åœ°å€</span>\n                    <span class=\"config-value\" id=\"serverUrl\">-</span>\n                </div>\n                <div class=\"config-item\">\n                    <span class=\"config-label\">å®¢æˆ·ç«¯ID</span>\n                    <span class=\"config-value\" id=\"clientId\">-</span>\n                </div>\n                <div class=\"config-item\">\n                    <span class=\"config-label\">è¯·æ±‚è¶…æ—¶æ—¶é—´</span>\n                    <span class=\"config-value\" id=\"requestTimeout\">-</span>\n                </div>\n                <div class=\"config-item\">\n                    <span class=\"config-label\">é…ç½®æ¥æº</span>\n                    <span class=\"config-value\" id=\"configSource\">-</span>\n                </div>\n            </div>\n\n            <div style=\"margin-top: 16px;\">\n                <button class=\"btn\" onclick=\"testServerAPI()\">æµ‹è¯•æœåŠ¡å™¨API</button>\n                <button class=\"btn\" onclick=\"testClientConfig()\">æµ‹è¯•å®¢æˆ·ç«¯é…ç½®</button>\n                <button class=\"btn\" onclick=\"testHardcodedCheck()\">æ£€æŸ¥ç¡¬ç¼–ç </button>\n                <button class=\"btn\" onclick=\"clearLogs()\">æ¸…ç©ºæ—¥å¿—</button>\n            </div>\n        </div>\n\n        <div class=\"test-card\">\n            <h3>ğŸ“Š é…ç½®å¯¹æ¯”</h3>\n            <div class=\"comparison-section\">\n                <div class=\"config-source hardcoded\">\n                    <h4>âŒ ç¡¬ç¼–ç é…ç½®ï¼ˆåº”é¿å…ï¼‰</h4>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">æœåŠ¡å™¨åœ°å€</span>\n                        <span class=\"config-value\">ç¡¬ç¼–ç çš„æœåŠ¡å™¨åœ°å€</span>\n                    </div>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">å®¢æˆ·ç«¯ID</span>\n                        <span class=\"config-value\">ç¡¬ç¼–ç çš„å®¢æˆ·ç«¯ID</span>\n                    </div>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">é…ç½®æ¥æº</span>\n                        <span class=\"config-value\">ä»£ç ç¡¬ç¼–ç </span>\n                    </div>\n                </div>\n\n                <div class=\"config-source dynamic\">\n                    <h4>âœ… åŠ¨æ€é…ç½®ï¼ˆç›®æ ‡ï¼‰</h4>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">æœåŠ¡å™¨åœ°å€</span>\n                        <span class=\"config-value\" id=\"dynamicServerUrl\">ä»æ•°æ®åº“è·å–</span>\n                    </div>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">å®¢æˆ·ç«¯ID</span>\n                        <span class=\"config-value\" id=\"dynamicClientId\">ä»æ•°æ®åº“è·å–</span>\n                    </div>\n                    <div class=\"config-item\">\n                        <span class=\"config-label\">é…ç½®æ¥æº</span>\n                        <span class=\"config-value\">æœåŠ¡å™¨API</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"test-card\">\n            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>\n            <div class=\"log-container\" id=\"logContainer\">\n                <div class=\"log-entry\">ç­‰å¾…æµ‹è¯•...</div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // æ—¥å¿—å‡½æ•°\n        function addLog(message, type = 'info') {\n            const logContainer = document.getElementById('logContainer');\n            const timestamp = new Date().toLocaleTimeString();\n            const logEntry = document.createElement('div');\n            logEntry.className = `log-entry log-${type}`;\n            logEntry.textContent = `[${timestamp}] ${message}`;\n            logContainer.appendChild(logEntry);\n            logContainer.scrollTop = logContainer.scrollHeight;\n        }\n\n        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨\n        function updateStatus(status, text) {\n            const indicator = document.getElementById('configStatus');\n            const statusText = document.getElementById('configStatusText');\n\n            indicator.className = `status-indicator status-${status}`;\n            statusText.textContent = text;\n        }\n\n        // æ›´æ–°é…ç½®æ˜¾ç¤º\n        function updateConfigDisplay(config, source = 'unknown') {\n            document.getElementById('serverUrl').textContent = config.BASE_URL || config.COMFYUI_SERVER_URL || '-';\n            document.getElementById('clientId').textContent = config.CLIENT_ID || '-';\n            document.getElementById('requestTimeout').textContent = config.REQUEST_TIMEOUT || config.TIMEOUT ? `${config.REQUEST_TIMEOUT || config.TIMEOUT}ms` : '-';\n            document.getElementById('configSource').textContent = source;\n\n            // æ›´æ–°åŠ¨æ€é…ç½®æ˜¾ç¤º\n            document.getElementById('dynamicServerUrl').textContent = config.BASE_URL || config.COMFYUI_SERVER_URL || 'æœªè·å–';\n            document.getElementById('dynamicClientId').textContent = config.CLIENT_ID || 'æœªè·å–';\n        }\n\n        // æµ‹è¯•æœåŠ¡å™¨API\n        async function testServerAPI() {\n            addLog('ğŸŒ æµ‹è¯•æœåŠ¡å™¨é…ç½®API...', 'info');\n            updateStatus('warning', 'æµ‹è¯•ä¸­...');\n\n            try {\n                const response = await fetch('/api/config', {\n                    method: 'GET',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n\n                if (!response.ok) {\n                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n                }\n\n                const result = await response.json();\n\n                if (result.success && result.data) {\n                    addLog('âœ… æœåŠ¡å™¨APIå“åº”æˆåŠŸ', 'success');\n                    addLog(`ComfyUIæœåŠ¡å™¨: ${result.data['comfyui.server_url']}`, 'info');\n                    addLog(`å®¢æˆ·ç«¯ID: ${result.data['comfyui.client_id']}`, 'info');\n                    addLog(`è¶…æ—¶æ—¶é—´: ${result.data['comfyui.timeout']}ms`, 'info');\n\n                    updateConfigDisplay({\n                        BASE_URL: result.data['comfyui.server_url'],\n                        CLIENT_ID: result.data['comfyui.client_id'],\n                        REQUEST_TIMEOUT: result.data['comfyui.timeout']\n                    }, 'æœåŠ¡å™¨API');\n\n                    updateStatus('success', 'APIæ­£å¸¸');\n                } else {\n                    throw new Error('æœåŠ¡å™¨è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');\n                }\n            } catch (error) {\n                addLog(`âŒ æœåŠ¡å™¨APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');\n                updateStatus('error', 'APIå¤±è´¥');\n            }\n        }\n\n        // æµ‹è¯•å®¢æˆ·ç«¯é…ç½®\n        async function testClientConfig() {\n            addLog('ğŸ”§ æµ‹è¯•å®¢æˆ·ç«¯é…ç½®æ¨¡å—...', 'info');\n\n            try {\n                // æ¨¡æ‹Ÿå®¢æˆ·ç«¯é…ç½®è·å–\n                const mockConfig = {\n                    BASE_URL: 'https://demo-server.com',\n                    CLIENT_ID: 'demo-client-id',\n                    REQUEST_TIMEOUT: 30000\n                };\n\n                addLog('âœ… å®¢æˆ·ç«¯é…ç½®æ¨¡å—æ­£å¸¸', 'success');\n                updateConfigDisplay(mockConfig, 'å®¢æˆ·ç«¯æ¨¡å—');\n\n            } catch (error) {\n                addLog(`âŒ å®¢æˆ·ç«¯é…ç½®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');\n            }\n        }\n\n        // æ£€æŸ¥ç¡¬ç¼–ç \n        function testHardcodedCheck() {\n            addLog('ğŸ” æ£€æŸ¥ç¡¬ç¼–ç åœ°å€...', 'info');\n\n            const hardcodedUrls = [\n                'https://5gke5y9mzc-8188.cnb.run',\n                'https://hwf0p724ub-8188.cnb.run',\n                'https://dzqgp58z0s-8188.cnb.run'\n            ];\n\n            const hardcodedIds = [\n                'abc1373d4ad648a3a81d0587fbe5534b'\n            ];\n\n            // æ£€æŸ¥å½“å‰é…ç½®æ˜¯å¦åŒ…å«ç¡¬ç¼–ç å€¼\n            const currentUrl = document.getElementById('serverUrl').textContent;\n            const currentId = document.getElementById('clientId').textContent;\n\n            let hasHardcoded = false;\n\n            if (hardcodedUrls.includes(currentUrl)) {\n                addLog(`âš ï¸ å‘ç°ç¡¬ç¼–ç æœåŠ¡å™¨åœ°å€: ${currentUrl}`, 'warning');\n                hasHardcoded = true;\n            }\n\n            if (hardcodedIds.includes(currentId)) {\n                addLog(`âš ï¸ å‘ç°ç¡¬ç¼–ç å®¢æˆ·ç«¯ID: ${currentId}`, 'warning');\n                hasHardcoded = true;\n            }\n\n            if (!hasHardcoded) {\n                addLog('âœ… æœªå‘ç°ç¡¬ç¼–ç é…ç½®', 'success');\n            } else {\n                addLog('âŒ æ£€æµ‹åˆ°ç¡¬ç¼–ç é…ç½®ï¼Œéœ€è¦ä¿®å¤', 'error');\n            }\n        }\n\n        // æ¸…ç©ºæ—¥å¿—\n        function clearLogs() {\n            const logContainer = document.getElementById('logContainer');\n            logContainer.innerHTML = '<div class=\"log-entry\">æ—¥å¿—å·²æ¸…ç©º</div>';\n        }\n\n        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–\n        window.onload = function() {\n            addLog('ğŸš€ é…ç½®éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');\n            addLog('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•é…ç½®è·å–åŠŸèƒ½', 'info');\n        };\n    </script>\n</body>\n</html>\n"
        }
    ]
}