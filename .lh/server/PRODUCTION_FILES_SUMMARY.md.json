{
    "sourceFile": "server/PRODUCTION_FILES_SUMMARY.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1753705857995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753705871039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n |--------|------|--------|------|\n | `.env.production` | `server/.env.production` | **必需** | 生产环境变量配置 |\n | `ecosystem.config.js` | `server/ecosystem.config.js` | **必需** | PM2进程管理配置 |\n | `production-package.json` | `server/production-package.json` | **必需** | 生产环境依赖配置 |\n-| `deploy.sh` | `server/deploy.sh` | **必需** | 自动化部署脚本 |\n+| `deploy.bat` | `server/deploy.bat` | **必需** | Windows自动化部署脚本 |\n \n ### 📋 部署指南文件\n \n | 文件名 | 路径 | 重要性 | 描述 |\n"
                },
                {
                    "date": 1753705888524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,26 +28,26 @@\n \n ## 🚀 快速部署指令\n \n ### 1. 准备上传文件包\n-```bash\n-# 在本地项目根目录执行\n+```powershell\n+# 在本地项目根目录执行 (PowerShell)\n cd server\n-mkdir -p ../aimagic-server-production\n+mkdir ..\\aimagic-server-production\n \n # 复制必需文件\n-cp -r src ../aimagic-server-production/\n-cp package.json ../aimagic-server-production/\n-cp production-package.json ../aimagic-server-production/package.json  # 覆盖为生产版本\n-cp .env.production ../aimagic-server-production/\n-cp ecosystem.config.js ../aimagic-server-production/\n-cp deploy.sh ../aimagic-server-production/\n-cp -r sql ../aimagic-server-production/  # 可选\n+Copy-Item -Recurse src ..\\aimagic-server-production\\\n+Copy-Item package.json ..\\aimagic-server-production\\\n+Copy-Item production-package.json ..\\aimagic-server-production\\package.json  # 覆盖为生产版本\n+Copy-Item .env.production ..\\aimagic-server-production\\\n+Copy-Item ecosystem.config.js ..\\aimagic-server-production\\\n+Copy-Item deploy.bat ..\\aimagic-server-production\\\n+Copy-Item -Recurse sql ..\\aimagic-server-production\\  # 可选\n \n # 创建必要目录\n-mkdir -p ../aimagic-server-production/logs\n-mkdir -p ../aimagic-server-production/uploads/images\n-mkdir -p ../aimagic-server-production/uploads/temp\n+mkdir ..\\aimagic-server-production\\logs\n+mkdir ..\\aimagic-server-production\\uploads\\images\n+mkdir ..\\aimagic-server-production\\uploads\\temp\n ```\n \n ### 2. FTP上传\n ```bash\n"
                },
                {
                    "date": 1753705905279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,26 +49,25 @@\n mkdir ..\\aimagic-server-production\\uploads\\temp\n ```\n \n ### 2. FTP上传\n-```bash\n-# 使用FTP客户端上传 aimagic-server-production/ 目录内容到:\n-# 服务器: 114.132.50.71\n-# 目标路径: /var/www/aimagic/server/\n ```\n+# 使用FTP客户端上传 aimagic-server-production\\ 目录内容到:\n+# 服务器: 114.132.50.71 (腾讯云Windows Server)\n+# 目标路径: C:\\inetpub\\wwwroot\\aimagic\\server\\\n+```\n \n ### 3. 服务器端部署\n-```bash\n-# SSH连接到服务器\n-ssh root@114.132.50.71\n-cd /var/www/aimagic/server\n+```cmd\n+# 远程桌面连接到服务器\n+# 计算机: 114.132.50.71\n+# 用户名: Administrator\n \n-# 设置权限\n-chmod +x deploy.sh\n-chmod 600 .env.production\n+# 在服务器上打开命令提示符\n+cd C:\\inetpub\\wwwroot\\aimagic\\server\n \n-# 执行部署\n-./deploy.sh\n+# 执行Windows部署脚本\n+deploy.bat\n ```\n \n ## 📊 文件重要性说明\n \n"
                }
            ],
            "date": 1753705857995,
            "name": "Commit-0",
            "content": "# AIMagic 后端服务生产环境文件总结 (Windows Server)\n\n## 📁 已创建的生产环境配置文件 (腾讯云Windows Server)\n\n### 🔧 核心配置文件\n\n| 文件名 | 路径 | 重要性 | 描述 |\n|--------|------|--------|------|\n| `.env.production` | `server/.env.production` | **必需** | 生产环境变量配置 |\n| `ecosystem.config.js` | `server/ecosystem.config.js` | **必需** | PM2进程管理配置 |\n| `production-package.json` | `server/production-package.json` | **必需** | 生产环境依赖配置 |\n| `deploy.sh` | `server/deploy.sh` | **必需** | 自动化部署脚本 |\n\n### 📋 部署指南文件\n\n| 文件名 | 路径 | 重要性 | 描述 |\n|--------|------|--------|------|\n| `FTP_UPLOAD_GUIDE.md` | `server/FTP_UPLOAD_GUIDE.md` | **必需** | 详细的FTP上传部署指南 |\n| `DEPLOYMENT_CHECKLIST.md` | `server/DEPLOYMENT_CHECKLIST.md` | **推荐** | 部署检查清单 |\n| `.ftpignore` | `server/.ftpignore` | **推荐** | FTP上传忽略文件列表 |\n\n### 🛠️ 工具脚本\n\n| 文件名 | 路径 | 重要性 | 描述 |\n|--------|------|--------|------|\n| `health-check.js` | `server/src/scripts/health-check.js` | **推荐** | 服务健康检查脚本 |\n| `init-deployment-config.js` | `server/src/scripts/init-deployment-config.js` | **必需** | 部署配置初始化脚本 |\n\n## 🚀 快速部署指令\n\n### 1. 准备上传文件包\n```bash\n# 在本地项目根目录执行\ncd server\nmkdir -p ../aimagic-server-production\n\n# 复制必需文件\ncp -r src ../aimagic-server-production/\ncp package.json ../aimagic-server-production/\ncp production-package.json ../aimagic-server-production/package.json  # 覆盖为生产版本\ncp .env.production ../aimagic-server-production/\ncp ecosystem.config.js ../aimagic-server-production/\ncp deploy.sh ../aimagic-server-production/\ncp -r sql ../aimagic-server-production/  # 可选\n\n# 创建必要目录\nmkdir -p ../aimagic-server-production/logs\nmkdir -p ../aimagic-server-production/uploads/images\nmkdir -p ../aimagic-server-production/uploads/temp\n```\n\n### 2. FTP上传\n```bash\n# 使用FTP客户端上传 aimagic-server-production/ 目录内容到:\n# 服务器: 114.132.50.71\n# 目标路径: /var/www/aimagic/server/\n```\n\n### 3. 服务器端部署\n```bash\n# SSH连接到服务器\nssh root@114.132.50.71\ncd /var/www/aimagic/server\n\n# 设置权限\nchmod +x deploy.sh\nchmod 600 .env.production\n\n# 执行部署\n./deploy.sh\n```\n\n## 📊 文件重要性说明\n\n### 🔴 必需文件 (CRITICAL)\n这些文件是服务运行的基础，缺少任何一个都会导致部署失败：\n\n- **src/** - 完整的源代码目录\n- **package.json** - 依赖管理（使用production-package.json覆盖）\n- **.env.production** - 生产环境配置\n- **ecosystem.config.js** - PM2配置\n- **deploy.sh** - 部署脚本\n\n### 🟡 推荐文件 (RECOMMENDED)\n这些文件提供额外的功能和便利性：\n\n- **health-check.js** - 服务健康监控\n- **sql/** - 数据库脚本（如需要）\n- **DEPLOYMENT_CHECKLIST.md** - 部署检查清单\n\n### 🟢 可选文件 (OPTIONAL)\n这些文件提供文档和参考：\n\n- **FTP_UPLOAD_GUIDE.md** - 详细部署指南\n- **.ftpignore** - 上传忽略列表\n- **docs/** - 项目文档\n\n## 🔧 配置要点\n\n### 数据库配置\n```env\nDB_HOST=114.132.50.71\nDB_PORT=3306\nDB_NAME=aimagic\nDB_USER=aimagic\nDB_PASSWORD=dFLJYsd82irJwHX5\n```\n\n### 服务配置\n```env\nNODE_ENV=production\nPORT=3007\nJWT_SECRET=aimagic.icomfy.co^~^\n```\n\n### CORS配置\n```env\nCORS_ORIGIN=https://your-frontend-domain.com,http://114.132.50.71:3001,http://114.132.50.71:3003\n```\n\n## 🛡️ 安全检查\n\n### 文件权限\n```bash\nchmod 755 /var/www/aimagic/server\nchmod 600 /var/www/aimagic/server/.env.production\nchmod +x /var/www/aimagic/server/deploy.sh\nchmod 755 /var/www/aimagic/server/logs\nchmod 755 /var/www/aimagic/server/uploads\n```\n\n### 环境变量安全\n- ✅ 生产环境JWT密钥已配置\n- ✅ 数据库密码已配置\n- ✅ CORS域名限制已设置\n\n## 📈 部署后验证\n\n### 服务状态检查\n```bash\n# 检查PM2状态\npm2 status\n\n# 检查服务响应\ncurl http://114.132.50.71:3007/api/health\n\n# 运行健康检查\nnode src/scripts/health-check.js\n```\n\n### API测试\n```bash\n# 基础健康检查\ncurl http://114.132.50.71:3007/api/health\n\n# 配置接口测试\ncurl http://114.132.50.71:3007/api/config\n\n# 公共配置测试\ncurl http://114.132.50.71:3007/api/public-config\n```\n\n## 🔄 更新部署\n\n### 代码更新流程\n1. 在本地修改代码\n2. 重新打包上传文件\n3. 通过FTP上传到服务器\n4. 在服务器执行: `pm2 restart aimagic-server`\n\n### 配置更新流程\n1. 修改 `.env.production`\n2. 上传到服务器\n3. 执行: `pm2 restart aimagic-server`\n\n---\n\n**部署成功标志**:\n- PM2显示服务状态为 `online`\n- 健康检查脚本返回成功\n- API接口响应正常\n- 服务地址 http://114.132.50.71:3007 可访问\n"
        }
    ]
}