{
    "sourceFile": "server/src/routes/public-config.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 10,
            "patches": [
                {
                    "date": 1752329632027,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752436822323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,10 +56,10 @@\n       console.log(`   ComfyUIä¸»æœåŠ¡å™¨: ${finalConfig['comfyui.server_url']}`);\n       console.log(`   å¤‡ç”¨æœåŠ¡å™¨: ${finalConfig['comfyui.backup_servers']}`);\n       console.log(`   è‡ªåŠ¨åˆ‡æ¢: ${finalConfig['comfyui.auto_switch']}`);\n       console.log(`   è¶…æ—¶æ—¶é—´: ${finalConfig['comfyui.timeout']}ms`);\n-      console.log(`   æ–‡ç”Ÿå›¾ç§¯åˆ†: ${finalConfig['ai.text_to_image_points']}`);\n \n+\n       res.json({\n         success: true,\n         data: finalConfig\n       });\n"
                },
                {
                    "date": 1752459900893,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,12 +14,9 @@\n       'comfyui.health_check_timeout': parseInt(process.env.COMFYUI_HEALTH_CHECK_TIMEOUT || '10000'),\n       'comfyui.timeout': parseInt(process.env.COMFYUI_TIMEOUT || '300000'),\n       'ai.text_to_image_points': parseInt(process.env.AI_TEXT_TO_IMAGE_POINTS || '20'),\n       'ai.face_swap_points': parseInt(process.env.AI_FACE_SWAP_POINTS || '20'),\n-      'ai.undress_points': parseInt(process.env.AI_UNDRESS_POINTS || '20'),\n-      'frontend.api_base_url': process.env.FRONTEND_API_BASE_URL || 'https://your-api-server.com/api',\n-      'frontend.title': process.env.FRONTEND_TITLE || 'AI Magic - AIå›¾åƒå¤„ç†å¹³å°',\n-      'frontend.version': process.env.FRONTEND_VERSION || '1.0.0'\n+      'ai.undress_points': parseInt(process.env.AI_UNDRESS_POINTS || '20')\n     };\n \n     try {\n       // å°è¯•ä»æ•°æ®åº“è·å–é…ç½®\n"
                },
                {
                    "date": 1752459916499,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n       // å°è¯•ä»æ•°æ®åº“è·å–é…ç½®\n       const configs = await query(`\n         SELECT config_key, config_value, config_type\n         FROM system_config\n-        WHERE config_group IN ('comfyui', 'ai', 'frontend')\n+        WHERE config_group IN ('comfyui', 'ai')\n         AND config_key NOT LIKE '%password%'\n         AND config_key NOT LIKE '%secret%'\n         ORDER BY config_group, config_key\n       `);\n"
                },
                {
                    "date": 1752459934307,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,9 +51,8 @@\n \n       console.log('ğŸ“‹ è¿”å›ç»™å®¢æˆ·ç«¯çš„é…ç½®:');\n       console.log(`   ComfyUIä¸»æœåŠ¡å™¨: ${finalConfig['comfyui.server_url']}`);\n       console.log(`   å¤‡ç”¨æœåŠ¡å™¨: ${finalConfig['comfyui.backup_servers']}`);\n-      console.log(`   è‡ªåŠ¨åˆ‡æ¢: ${finalConfig['comfyui.auto_switch']}`);\n       console.log(`   è¶…æ—¶æ—¶é—´: ${finalConfig['comfyui.timeout']}ms`);\n \n \n       res.json({\n"
                },
                {
                    "date": 1752514297296,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,10 +8,10 @@\n     console.log('ğŸ“¥ å®¢æˆ·ç«¯è¯·æ±‚å…¬å¼€é…ç½®...');\n \n     // ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿé»˜è®¤å€¼ä½œä¸ºå¤‡ç”¨é…ç½®\n     const defaultConfigs = {\n-      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://your-comfyui-server.com',\n-      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || '',\n+      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://l9s75ay3rp-8188.cnb.run',\n+      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || 'https://0rv00xh2vg-8188.cnb.run',\n       'comfyui.health_check_timeout': parseInt(process.env.COMFYUI_HEALTH_CHECK_TIMEOUT || '10000'),\n       'comfyui.timeout': parseInt(process.env.COMFYUI_TIMEOUT || '300000'),\n       'ai.text_to_image_points': parseInt(process.env.AI_TEXT_TO_IMAGE_POINTS || '20'),\n       'ai.face_swap_points': parseInt(process.env.AI_FACE_SWAP_POINTS || '20'),\n"
                },
                {
                    "date": 1752514316463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,10 +74,10 @@\n     console.error('âŒ è·å–å…¬å¼€é…ç½®å¤±è´¥:', error);\n \n     // æœ€åçš„å¤‡ç”¨é…ç½® - ä½¿ç”¨ç¯å¢ƒå˜é‡\n     const fallbackConfig = {\n-      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://your-comfyui-server.com',\n-      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || '',\n+      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://l9s75ay3rp-8188.cnb.run',\n+      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || 'https://0rv00xh2vg-8188.cnb.run',\n       'comfyui.health_check_timeout': parseInt(process.env.COMFYUI_HEALTH_CHECK_TIMEOUT || '10000'),\n       'comfyui.timeout': parseInt(process.env.COMFYUI_TIMEOUT || '300000'),\n       'ai.text_to_image_points': parseInt(process.env.AI_TEXT_TO_IMAGE_POINTS || '20'),\n       'ai.face_swap_points': parseInt(process.env.AI_FACE_SWAP_POINTS || '20'),\n"
                },
                {
                    "date": 1752810943290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n       // å°è¯•ä»æ•°æ®åº“è·å–é…ç½®\n       const configs = await query(`\n         SELECT config_key, config_value, config_type\n         FROM system_config\n-        WHERE config_group IN ('comfyui', 'ai')\n+        WHERE config_group IN ('comfyui', 'ai', 'workflow')\n         AND config_key NOT LIKE '%password%'\n         AND config_key NOT LIKE '%secret%'\n         ORDER BY config_group, config_key\n       `);\n"
                },
                {
                    "date": 1752810957527,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,9 +100,9 @@\n   try {\n     const { group } = req.params;\n \n     // åªå…è®¸è·å–å…¬å¼€çš„é…ç½®åˆ†ç»„\n-    const allowedGroups = ['comfyui', 'ai', 'frontend'];\n+    const allowedGroups = ['comfyui', 'ai', 'frontend', 'workflow'];\n     if (!allowedGroups.includes(group)) {\n       return res.status(403).json({\n         success: false,\n         message: 'ä¸å…è®¸è®¿é—®è¯¥é…ç½®åˆ†ç»„'\n"
                },
                {
                    "date": 1752836014776,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,12 @@\n \n // è·å–å‰ç«¯å…¬å¼€é…ç½®ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰\n router.get('/', async (req, res) => {\n   try {\n-    console.log('ğŸ“¥ å®¢æˆ·ç«¯è¯·æ±‚å…¬å¼€é…ç½®...');\n+    // ç®€åŒ–æ—¥å¿—è¾“å‡º\n+    if (process.env.NODE_ENV === 'development') {\n+      console.log('ğŸ“¥ å®¢æˆ·ç«¯è¯·æ±‚å…¬å¼€é…ç½®...');\n+    }\n \n     // ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿé»˜è®¤å€¼ä½œä¸ºå¤‡ç”¨é…ç½®\n     const defaultConfigs = {\n       'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://l9s75ay3rp-8188.cnb.run',\n"
                },
                {
                    "date": 1752836031641,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,12 +51,15 @@\n \n       // åˆå¹¶é»˜è®¤é…ç½®å’Œæ•°æ®åº“é…ç½®\n       const finalConfig = { ...defaultConfigs, ...configMap };\n \n-      console.log('ğŸ“‹ è¿”å›ç»™å®¢æˆ·ç«¯çš„é…ç½®:');\n-      console.log(`   ComfyUIä¸»æœåŠ¡å™¨: ${finalConfig['comfyui.server_url']}`);\n-      console.log(`   å¤‡ç”¨æœåŠ¡å™¨: ${finalConfig['comfyui.backup_servers']}`);\n-      console.log(`   è¶…æ—¶æ—¶é—´: ${finalConfig['comfyui.timeout']}ms`);\n+      // åªåœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é…ç½®\n+      if (process.env.NODE_ENV === 'development') {\n+        console.log('ğŸ“‹ è¿”å›ç»™å®¢æˆ·ç«¯çš„é…ç½®:');\n+        console.log(`   ComfyUIä¸»æœåŠ¡å™¨: ${finalConfig['comfyui.server_url']}`);\n+        console.log(`   å¤‡ç”¨æœåŠ¡å™¨: ${finalConfig['comfyui.backup_servers']}`);\n+        console.log(`   è¶…æ—¶æ—¶é—´: ${finalConfig['comfyui.timeout']}ms`);\n+      }\n \n \n       res.json({\n         success: true,\n"
                }
            ],
            "date": 1752329632027,
            "name": "Commit-0",
            "content": "const express = require('express');\nconst router = express.Router();\nconst { query } = require('../config/database');\n\n// è·å–å‰ç«¯å…¬å¼€é…ç½®ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰\nrouter.get('/', async (req, res) => {\n  try {\n    console.log('ğŸ“¥ å®¢æˆ·ç«¯è¯·æ±‚å…¬å¼€é…ç½®...');\n\n    // ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿé»˜è®¤å€¼ä½œä¸ºå¤‡ç”¨é…ç½®\n    const defaultConfigs = {\n      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://your-comfyui-server.com',\n      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || '',\n      'comfyui.health_check_timeout': parseInt(process.env.COMFYUI_HEALTH_CHECK_TIMEOUT || '10000'),\n      'comfyui.timeout': parseInt(process.env.COMFYUI_TIMEOUT || '300000'),\n      'ai.text_to_image_points': parseInt(process.env.AI_TEXT_TO_IMAGE_POINTS || '20'),\n      'ai.face_swap_points': parseInt(process.env.AI_FACE_SWAP_POINTS || '20'),\n      'ai.undress_points': parseInt(process.env.AI_UNDRESS_POINTS || '20'),\n      'frontend.api_base_url': process.env.FRONTEND_API_BASE_URL || 'https://your-api-server.com/api',\n      'frontend.title': process.env.FRONTEND_TITLE || 'AI Magic - AIå›¾åƒå¤„ç†å¹³å°',\n      'frontend.version': process.env.FRONTEND_VERSION || '1.0.0'\n    };\n\n    try {\n      // å°è¯•ä»æ•°æ®åº“è·å–é…ç½®\n      const configs = await query(`\n        SELECT config_key, config_value, config_type\n        FROM system_config\n        WHERE config_group IN ('comfyui', 'ai', 'frontend')\n        AND config_key NOT LIKE '%password%'\n        AND config_key NOT LIKE '%secret%'\n        ORDER BY config_group, config_key\n      `);\n\n      console.log(`ğŸ“Š ä»æ•°æ®åº“åŠ è½½äº†${configs.length}é¡¹å…¬å¼€é…ç½®`);\n\n      // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼\n      const configMap = {};\n      configs.forEach(config => {\n        let value = config.config_value;\n\n        // æ ¹æ®ç±»å‹è½¬æ¢å€¼\n        if (config.config_type === 'number') {\n          value = parseInt(value);\n        } else if (config.config_type === 'boolean') {\n          value = value === 'true' || value === '1';\n        }\n\n        configMap[config.config_key] = value;\n      });\n\n      // åˆå¹¶é»˜è®¤é…ç½®å’Œæ•°æ®åº“é…ç½®\n      const finalConfig = { ...defaultConfigs, ...configMap };\n\n      console.log('ğŸ“‹ è¿”å›ç»™å®¢æˆ·ç«¯çš„é…ç½®:');\n      console.log(`   ComfyUIä¸»æœåŠ¡å™¨: ${finalConfig['comfyui.server_url']}`);\n      console.log(`   å¤‡ç”¨æœåŠ¡å™¨: ${finalConfig['comfyui.backup_servers']}`);\n      console.log(`   è‡ªåŠ¨åˆ‡æ¢: ${finalConfig['comfyui.auto_switch']}`);\n      console.log(`   è¶…æ—¶æ—¶é—´: ${finalConfig['comfyui.timeout']}ms`);\n      console.log(`   æ–‡ç”Ÿå›¾ç§¯åˆ†: ${finalConfig['ai.text_to_image_points']}`);\n\n      res.json({\n        success: true,\n        data: finalConfig\n      });\n\n    } catch (dbError) {\n      console.error('âŒ æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', dbError.message);\n\n      res.json({\n        success: true,\n        data: defaultConfigs,\n        message: 'ä½¿ç”¨é»˜è®¤é…ç½®'\n      });\n    }\n\n  } catch (error) {\n    console.error('âŒ è·å–å…¬å¼€é…ç½®å¤±è´¥:', error);\n\n    // æœ€åçš„å¤‡ç”¨é…ç½® - ä½¿ç”¨ç¯å¢ƒå˜é‡\n    const fallbackConfig = {\n      'comfyui.server_url': process.env.COMFYUI_SERVER_URL || 'https://your-comfyui-server.com',\n      'comfyui.backup_servers': process.env.COMFYUI_BACKUP_SERVERS || '',\n      'comfyui.health_check_timeout': parseInt(process.env.COMFYUI_HEALTH_CHECK_TIMEOUT || '10000'),\n      'comfyui.timeout': parseInt(process.env.COMFYUI_TIMEOUT || '300000'),\n      'ai.text_to_image_points': parseInt(process.env.AI_TEXT_TO_IMAGE_POINTS || '20'),\n      'ai.face_swap_points': parseInt(process.env.AI_FACE_SWAP_POINTS || '20'),\n      'ai.undress_points': parseInt(process.env.AI_UNDRESS_POINTS || '20'),\n      'frontend.api_base_url': process.env.FRONTEND_API_BASE_URL || 'https://your-api-server.com/api',\n      'frontend.title': process.env.FRONTEND_TITLE || 'AI Magic - AIå›¾åƒå¤„ç†å¹³å°',\n      'frontend.version': process.env.FRONTEND_VERSION || '1.0.0'\n    };\n\n    res.json({\n      success: true,\n      data: fallbackConfig,\n      message: 'ä½¿ç”¨å¤‡ç”¨é…ç½®'\n    });\n  }\n});\n\n// è·å–ç‰¹å®šåˆ†ç»„çš„é…ç½®\nrouter.get('/:group', async (req, res) => {\n  try {\n    const { group } = req.params;\n\n    // åªå…è®¸è·å–å…¬å¼€çš„é…ç½®åˆ†ç»„\n    const allowedGroups = ['comfyui', 'ai', 'frontend'];\n    if (!allowedGroups.includes(group)) {\n      return res.status(403).json({\n        success: false,\n        message: 'ä¸å…è®¸è®¿é—®è¯¥é…ç½®åˆ†ç»„'\n      });\n    }\n\n    const configs = await query(`\n      SELECT config_key, config_value, config_type, description\n      FROM system_config\n      WHERE config_group = ?\n      AND config_key NOT LIKE '%password%'\n      AND config_key NOT LIKE '%secret%'\n      ORDER BY config_key\n    `, [group]);\n\n    // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼\n    const configMap = {};\n    configs.forEach(config => {\n      let value = config.config_value;\n\n      // æ ¹æ®ç±»å‹è½¬æ¢å€¼\n      if (config.config_type === 'number') {\n        value = parseInt(value);\n      } else if (config.config_type === 'boolean') {\n        value = value === 'true' || value === '1';\n      }\n\n      configMap[config.config_key] = {\n        value,\n        description: config.description\n      };\n    });\n\n    res.json({\n      success: true,\n      data: configMap\n    });\n  } catch (error) {\n    console.error('è·å–é…ç½®åˆ†ç»„å¤±è´¥:', error);\n    res.status(500).json({\n      success: false,\n      message: 'è·å–é…ç½®å¤±è´¥'\n    });\n  }\n});\n\nmodule.exports = router;\n\n"
        }
    ]
}