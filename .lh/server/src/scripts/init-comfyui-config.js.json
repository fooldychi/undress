{
    "sourceFile": "server/src/scripts/init-comfyui-config.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752513617991,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752513617991,
            "name": "Commit-0",
            "content": "const { query } = require('../config/database');\n\nasync function initComfyUIConfig() {\n  try {\n    console.log('ğŸ”§ åˆå§‹åŒ–ComfyUIé…ç½®...');\n\n    // ComfyUIé…ç½®é¡¹\n    const comfyuiConfigs = [\n      {\n        config_key: 'comfyui.server_url',\n        config_value: 'https://your-comfyui-server.com',\n        config_type: 'string',\n        config_group: 'comfyui',\n        description: 'ComfyUIä¸»æœåŠ¡å™¨åœ°å€',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.backup_servers',\n        config_value: '',\n        config_type: 'string',\n        config_group: 'comfyui',\n        description: 'ComfyUIå¤‡ç”¨æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªæˆ–é€—å·åˆ†éš”ï¼‰',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.request_timeout',\n        config_value: '30000',\n        config_type: 'number',\n        config_group: 'comfyui',\n        description: 'ComfyUIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.health_check_timeout',\n        config_value: '10000',\n        config_type: 'number',\n        config_group: 'comfyui',\n        description: 'ComfyUIå¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.auto_switch',\n        config_value: 'true',\n        config_type: 'boolean',\n        config_group: 'comfyui',\n        description: 'æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.client_id',\n        config_value: '',\n        config_type: 'string',\n        config_group: 'comfyui',\n        description: 'ComfyUIå®¢æˆ·ç«¯ID',\n        is_encrypted: 0\n      },\n      {\n        config_key: 'comfyui.max_retries',\n        config_value: '3',\n        config_type: 'number',\n        config_group: 'comfyui',\n        description: 'æœ€å¤§é‡è¯•æ¬¡æ•°',\n        is_encrypted: 0\n      }\n    ];\n\n    // æ£€æŸ¥å¹¶æ’å…¥é…ç½®\n    for (const config of comfyuiConfigs) {\n      // æ£€æŸ¥é…ç½®æ˜¯å¦å·²å­˜åœ¨\n      const existing = await query(\n        'SELECT id FROM system_config WHERE config_key = ?',\n        [config.config_key]\n      );\n\n      if (existing.length === 0) {\n        // æ’å…¥æ–°é…ç½®\n        await query(`\n          INSERT INTO system_config (\n            config_key, config_value, config_type, config_group,\n            description, is_encrypted, created_at\n          ) VALUES (?, ?, ?, ?, ?, ?, NOW())\n        `, [\n          config.config_key,\n          config.config_value,\n          config.config_type,\n          config.config_group,\n          config.description,\n          config.is_encrypted\n        ]);\n\n        console.log(`âœ… æ·»åŠ é…ç½®: ${config.config_key}`);\n      } else {\n        console.log(`â„¹ï¸ é…ç½®å·²å­˜åœ¨: ${config.config_key}`);\n      }\n    }\n\n    // åˆ é™¤æ—§çš„åŸºç¡€é…ç½®å’ŒAIæœåŠ¡é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n    const configsToRemove = [\n      'system.name',\n      'system.description',\n      'system.default_points',\n      'ai.face_swap_enabled',\n      'ai.clothing_swap_enabled',\n      'ai.text_to_image_enabled'\n    ];\n\n    for (const configKey of configsToRemove) {\n      const result = await query(\n        'DELETE FROM system_config WHERE config_key = ?',\n        [configKey]\n      );\n\n      if (result.affectedRows > 0) {\n        console.log(`ğŸ—‘ï¸ åˆ é™¤æ—§é…ç½®: ${configKey}`);\n      }\n    }\n\n    console.log('ğŸ‰ ComfyUIé…ç½®åˆå§‹åŒ–å®Œæˆï¼');\n\n    // æ˜¾ç¤ºå½“å‰é…ç½®\n    const allConfigs = await query(`\n      SELECT config_key, config_value, description\n      FROM system_config\n      WHERE config_group = 'comfyui'\n      ORDER BY config_key\n    `);\n\n    console.log('\\nğŸ“‹ å½“å‰ComfyUIé…ç½®:');\n    allConfigs.forEach(config => {\n      console.log(`  ${config.config_key}: ${config.config_value} (${config.description})`);\n    });\n\n  } catch (error) {\n    console.error('âŒ åˆå§‹åŒ–ComfyUIé…ç½®å¤±è´¥:', error);\n    throw error;\n  }\n}\n\n// å¦‚æœç›´æ¥è¿è¡Œæ­¤è„šæœ¬\nif (require.main === module) {\n  initComfyUIConfig()\n    .then(() => {\n      console.log('âœ… è„šæœ¬æ‰§è¡Œå®Œæˆ');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('âŒ è„šæœ¬æ‰§è¡Œå¤±è´¥:', error);\n      process.exit(1);\n    });\n}\n\nmodule.exports = { initComfyUIConfig };\n"
        }
    ]
}