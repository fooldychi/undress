{
    "sourceFile": "server/src/scripts/create-config-table-simple.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752400662011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752400662011,
            "name": "Commit-0",
            "content": "const { query } = require('../config/database');\n\nasync function createConfigTable() {\n  try {\n    console.log('ðŸ”§ å¼€å§‹åˆ›å»ºé…ç½®è¡¨...');\n\n    // 1. åˆ é™¤ admin_login_logs è¡¨\n    console.log('ðŸ—‘ï¸ åˆ é™¤ admin_login_logs è¡¨...');\n    await query('DROP TABLE IF EXISTS admin_login_logs');\n    console.log('âœ… admin_login_logs è¡¨å·²åˆ é™¤');\n\n    // 2. åˆ›å»º system_config è¡¨\n    console.log('ðŸ“ åˆ›å»º system_config è¡¨...');\n    await query(`\n      CREATE TABLE IF NOT EXISTS system_config (\n        id int(11) NOT NULL AUTO_INCREMENT,\n        config_key varchar(100) NOT NULL,\n        config_value text,\n        config_type varchar(20) DEFAULT 'string',\n        config_group varchar(50) DEFAULT 'general',\n        description varchar(255) DEFAULT NULL,\n        is_encrypted tinyint(1) DEFAULT 0,\n        created_at timestamp DEFAULT CURRENT_TIMESTAMP,\n        updated_at datetime DEFAULT NULL,\n        PRIMARY KEY (id),\n        UNIQUE KEY uk_config_key (config_key)\n      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4\n    `);\n    console.log('âœ… system_config è¡¨åˆ›å»ºæˆåŠŸ');\n\n    // 3. æ’å…¥é»˜è®¤é…ç½®\n    console.log('ðŸ“Š æ’å…¥é»˜è®¤é…ç½®...');\n    const configs = [\n      // æœåŠ¡å™¨é…ç½®\n      ['server.port', '3007', 'number', 'server', 'æœåŠ¡å™¨ç«¯å£'],\n      ['server.node_env', 'development', 'string', 'server', 'è¿è¡ŒçŽ¯å¢ƒ'],\n\n      // æ•°æ®åº“é…ç½®\n      ['database.host', '114.132.50.71', 'string', 'database', 'æ•°æ®åº“ä¸»æœº'],\n      ['database.port', '3306', 'number', 'database', 'æ•°æ®åº“ç«¯å£'],\n      ['database.name', 'aimagic', 'string', 'database', 'æ•°æ®åº“åç§°'],\n      ['database.user', 'aimagic', 'string', 'database', 'æ•°æ®åº“ç”¨æˆ·å'],\n      ['database.password', 'dFLJYsd82irJwHX5', 'string', 'database', 'æ•°æ®åº“å¯†ç '],\n\n      // JWTé…ç½®\n      ['jwt.secret', 'aimagic.icomfy.co^~^', 'string', 'jwt', 'JWTå¯†é’¥'],\n      ['jwt.expires_in', '7d', 'string', 'jwt', 'JWTè¿‡æœŸæ—¶é—´'],\n\n      // CORSé…ç½®\n      ['cors.origin', 'http://localhost:3001,http://localhost:3003', 'string', 'cors', 'å…è®¸çš„è·¨åŸŸæº'],\n\n      // ComfyUIé…ç½®\n      ['comfyui.server_url', 'https://your-comfyui-server.com', 'string', 'comfyui', 'ComfyUIä¸»æœåŠ¡å™¨åœ°å€'],\n      ['comfyui.backup_servers', '', 'string', 'comfyui', 'ComfyUIå¤‡ç”¨æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰'],\n      ['comfyui.request_timeout', '30000', 'number', 'comfyui', 'ComfyUIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰'],\n      ['comfyui.health_check_timeout', '10000', 'number', 'comfyui', 'ComfyUIå¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰'],\n      ['comfyui.auto_switch', 'true', 'boolean', 'comfyui', 'æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨'],\n      ['comfyui.client_id', '', 'string', 'comfyui', 'ComfyUIå®¢æˆ·ç«¯ID'],\n      ['comfyui.max_retries', '3', 'number', 'comfyui', 'æœ€å¤§é‡è¯•æ¬¡æ•°'],\n\n      // AIæœåŠ¡é…ç½®\n      ['ai.text_to_image_points', '10', 'number', 'ai', 'æ–‡ç”Ÿå›¾æ¶ˆè€—ç§¯åˆ†'],\n      ['ai.face_swap_points', '5', 'number', 'ai', 'æ¢è„¸æ¶ˆè€—ç§¯åˆ†'],\n      ['ai.clothing_swap_points', '8', 'number', 'ai', 'æ¢è£…æ¶ˆè€—ç§¯åˆ†'],\n\n      // å‰ç«¯é…ç½®\n      ['frontend.version', '1.0.0', 'string', 'frontend', 'å‰ç«¯ç‰ˆæœ¬'],\n      ['frontend.title', 'AI Magic', 'string', 'frontend', 'åº”ç”¨æ ‡é¢˜'],\n\n      // ä¸Šä¼ é…ç½®\n      ['upload.max_file_size', '10485760', 'number', 'upload', 'æœ€å¤§æ–‡ä»¶å¤§å°(å­—èŠ‚)'],\n      ['upload.path', 'uploads/', 'string', 'upload', 'ä¸Šä¼ è·¯å¾„'],\n\n      // æ—¥å¿—é…ç½®\n      ['log.level', 'info', 'string', 'log', 'æ—¥å¿—çº§åˆ«']\n    ];\n\n    for (const [key, value, type, group, desc] of configs) {\n      await query(`\n        INSERT INTO system_config (config_key, config_value, config_type, config_group, description)\n        VALUES (?, ?, ?, ?, ?)\n        ON DUPLICATE KEY UPDATE config_value = VALUES(config_value)\n      `, [key, value, type, group, desc]);\n    }\n\n    console.log(`âœ… æ’å…¥äº† ${configs.length} ä¸ªé…ç½®é¡¹`);\n\n    // 4. éªŒè¯ç»“æžœ\n    const result = await query('SELECT COUNT(*) as count FROM system_config');\n    console.log(`ðŸ“Š é…ç½®è¡¨ä¸­å…±æœ‰ ${result[0].count} ä¸ªé…ç½®é¡¹`);\n\n    console.log('ðŸŽ‰ é…ç½®è¡¨åˆ›å»ºå®Œæˆï¼');\n\n  } catch (error) {\n    console.error('âŒ åˆ›å»ºé…ç½®è¡¨å¤±è´¥:', error);\n    throw error;\n  }\n}\n\nif (require.main === module) {\n  createConfigTable()\n    .then(() => process.exit(0))\n    .catch(error => {\n      console.error('ðŸ’¥ å¤±è´¥:', error);\n      process.exit(1);\n    });\n}\n\nmodule.exports = { createConfigTable };\n"
        }
    ]
}