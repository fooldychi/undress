{
    "sourceFile": "server/deploy-simple.bat",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1753709854842,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1753709854842,
            "name": "Commit-0",
            "content": "@echo off\necho ========================================\necho    AIMagic Production Deploy Script\necho ========================================\necho Deploy Time: %date% %time%\necho Server: 114.132.50.71\necho ========================================\necho.\n\nREM Check required files\necho [INFO] Checking required files...\nif not exist \"package.json\" (\n    echo [ERROR] package.json not found!\n    pause\n    exit /b 1\n)\nif not exist \".env.production\" (\n    echo [ERROR] .env.production not found!\n    pause\n    exit /b 1\n)\nif not exist \"ecosystem.config.js\" (\n    echo [ERROR] ecosystem.config.js not found!\n    pause\n    exit /b 1\n)\necho [SUCCESS] All required files found\n\nREM Check Node.js\necho [INFO] Checking Node.js...\nnode --version\nif errorlevel 1 (\n    echo [ERROR] Node.js not found! Please install Node.js 16+ first\n    pause\n    exit /b 1\n)\necho [SUCCESS] Node.js found\n\nREM Check/Install PM2\necho [INFO] Checking PM2...\npm2 --version >nul 2>&1\nif errorlevel 1 (\n    echo [INFO] Installing PM2...\n    npm install -g pm2\n    if errorlevel 1 (\n        echo [ERROR] PM2 installation failed!\n        pause\n        exit /b 1\n    )\n    echo [SUCCESS] PM2 installed\n) else (\n    echo [SUCCESS] PM2 found\n)\n\nREM Create directories\necho [INFO] Creating directories...\nif not exist \"logs\" mkdir logs\nif not exist \"uploads\" mkdir uploads\nif not exist \"uploads\\images\" mkdir uploads\\images\nif not exist \"uploads\\temp\" mkdir uploads\\temp\necho [SUCCESS] Directories created\n\nREM Install dependencies\necho [INFO] Installing dependencies...\nnpm install --production --no-optional\nif errorlevel 1 (\n    echo [ERROR] Dependencies installation failed!\n    pause\n    exit /b 1\n)\necho [SUCCESS] Dependencies installed\n\nREM Run initialization if exists\necho [INFO] Running initialization...\nif exist \"src\\scripts\\init-deployment-config.js\" (\n    node src\\scripts\\init-deployment-config.js\n    echo [INFO] Initialization completed\n) else (\n    echo [INFO] No initialization script found, skipping\n)\n\nREM Stop existing services\necho [INFO] Stopping existing services...\npm2 stop aimagic-server 2>nul\npm2 delete aimagic-server 2>nul\necho [SUCCESS] Existing services stopped\n\nREM Start service\necho [INFO] Starting service...\npm2 start ecosystem.config.js --env production\nif errorlevel 1 (\n    echo [ERROR] Service start failed!\n    echo [INFO] Checking logs...\n    pm2 logs aimagic-server --lines 10\n    pause\n    exit /b 1\n)\necho [SUCCESS] Service started\n\nREM Save PM2 configuration\necho [INFO] Saving PM2 configuration...\npm2 save\npm2 startup\necho [SUCCESS] PM2 configuration saved\n\nREM Wait and check status\necho [INFO] Waiting for service to stabilize...\ntimeout /t 5 /nobreak >nul\n\necho [INFO] Checking service status...\npm2 status\n\nREM Add firewall rule\necho [INFO] Adding firewall rule...\nnetsh advfirewall firewall add rule name=\"AIMagic Server Port 3007\" dir=in action=allow protocol=TCP localport=3007 2>nul\necho [SUCCESS] Firewall rule added\n\nREM Run health check if exists\necho [INFO] Running health check...\nif exist \"src\\scripts\\health-check.js\" (\n    timeout /t 3 /nobreak >nul\n    node src\\scripts\\health-check.js\n    if errorlevel 1 (\n        echo [WARNING] Health check failed, but service may still be starting\n    ) else (\n        echo [SUCCESS] Health check passed\n    )\n) else (\n    echo [INFO] No health check script found\n)\n\necho.\necho ========================================\necho          Deployment Complete!\necho ========================================\necho Service URL: http://114.132.50.71:3007\necho Health Check: http://114.132.50.71:3007/api/health\necho.\necho Useful Commands:\necho   pm2 status          - Check service status\necho   pm2 logs            - View logs\necho   pm2 restart all     - Restart service\necho   pm2 stop all        - Stop service\necho   pm2 monit           - Monitor dashboard\necho ========================================\necho.\n\necho Press any key to exit...\npause >nul\n"
        }
    ]
}