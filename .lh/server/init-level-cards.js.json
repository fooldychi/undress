{
    "sourceFile": "server/init-level-cards.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752460587469,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752460607236,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,12 +44,12 @@\n     `);\n     console.log('âœ… ç­‰çº§å¡è¡¨åˆ›å»ºæˆåŠŸ');\n \n     // 3. æ’å…¥ç­‰çº§å¡ç±»å‹æ•°æ®ï¼ˆåŒ…å«ä½“éªŒå¡ï¼‰\n-    const existingTypes = await query('SELECT COUNT(*) as count FROM level_card_types');\n+    const existingTypes = await query('SELECT COUNT(*) as count FROM card_types');\n     if (existingTypes[0].count === 0) {\n       await query(`\n-        INSERT INTO level_card_types (name, icon, price, points, description) VALUES\n+        INSERT INTO card_types (name, icon, price, points, description) VALUES\n         ('ä½“éªŒå¡', 'ğŸ', 0.00, 20, 'å…è´¹ä½“éªŒå¡ï¼Œæ¯å¼ 20ç§¯åˆ†'),\n         ('åŸºç¡€å¡', 'ğŸ¥‰', 9.90, 300, 'é€‚åˆè½»åº¦ä½¿ç”¨çš„ç”¨æˆ·'),\n         ('é«˜çº§å¡', 'ğŸ¥ˆ', 30.00, 1000, 'é€‚åˆä¸­åº¦ä½¿ç”¨çš„ç”¨æˆ·'),\n         ('è‡³å°Šå¡', 'ğŸ¥‡', 50.00, 2000, 'é€‚åˆé‡åº¦ä½¿ç”¨çš„ç”¨æˆ·')\n@@ -61,9 +61,9 @@\n \n     console.log('ğŸ‰ ç­‰çº§å¡æ•°æ®åº“è¡¨åˆå§‹åŒ–å®Œæˆï¼');\n \n     // æ˜¾ç¤ºåˆ›å»ºçš„ç±»å‹\n-    const cardTypes = await query('SELECT * FROM level_card_types ORDER BY points ASC');\n+    const cardTypes = await query('SELECT * FROM card_types ORDER BY points ASC');\n     console.log('\\nğŸ“‹ ç­‰çº§å¡ç±»å‹åˆ—è¡¨:');\n     cardTypes.forEach(type => {\n       console.log(`${type.icon} ${type.name} - ${type.points}ç§¯åˆ† - Â¥${type.price}`);\n     });\n"
                }
            ],
            "date": 1752460587469,
            "name": "Commit-0",
            "content": "// å¿«é€Ÿåˆå§‹åŒ–ç­‰çº§å¡è¡¨\nconst { query } = require('./src/config/database');\n\nasync function initLevelCards() {\n  try {\n    console.log('ğŸ—ƒï¸ å¼€å§‹åˆ›å»ºç­‰çº§å¡ç›¸å…³æ•°æ®åº“è¡¨...');\n\n    // 1. åˆ›å»ºç­‰çº§å¡ç±»å‹è¡¨\n    console.log('ğŸ“ åˆ›å»ºç­‰çº§å¡ç±»å‹è¡¨...');\n    await query(`\n      CREATE TABLE IF NOT EXISTS card_types (\n        id INT AUTO_INCREMENT PRIMARY KEY,\n        name VARCHAR(50) NOT NULL COMMENT 'ç­‰çº§å¡åç§°',\n        icon VARCHAR(10) NOT NULL COMMENT 'ç­‰çº§å¡å›¾æ ‡',\n        price DECIMAL(10,2) NOT NULL COMMENT 'ä»·æ ¼',\n        points INT NOT NULL COMMENT 'ç§¯åˆ†æ•°é‡',\n        description TEXT COMMENT 'æè¿°',\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME NULL\n      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n    `);\n    console.log('âœ… ç­‰çº§å¡ç±»å‹è¡¨åˆ›å»ºæˆåŠŸ');\n\n    // 2. åˆ›å»ºç­‰çº§å¡è¡¨\n    console.log('ğŸ“ åˆ›å»ºç­‰çº§å¡è¡¨...');\n    await query(`\n      CREATE TABLE IF NOT EXISTS level_cards (\n        id INT AUTO_INCREMENT PRIMARY KEY,\n        card_number VARCHAR(20) UNIQUE NOT NULL COMMENT 'å¡å·',\n        card_password VARCHAR(20) NOT NULL COMMENT 'å¡å¯†',\n        type_id INT NOT NULL COMMENT 'ç­‰çº§å¡ç±»å‹ID',\n        total_points INT NOT NULL COMMENT 'æ€»ç§¯åˆ†',\n        remaining_points INT NOT NULL COMMENT 'å‰©ä½™ç§¯åˆ†',\n        status ENUM('active', 'used', 'expired', 'disabled') DEFAULT 'active' COMMENT 'çŠ¶æ€',\n        bound_user_id INT NULL COMMENT 'ç»‘å®šçš„ç”¨æˆ·ID',\n        bound_at DATETIME NULL COMMENT 'ç»‘å®šæ—¶é—´',\n        expires_at DATETIME NULL COMMENT 'è¿‡æœŸæ—¶é—´',\n        created_at DATETIME NOT NULL,\n        updated_at DATETIME NULL,\n        INDEX idx_card_number (card_number),\n        INDEX idx_bound_user (bound_user_id),\n        INDEX idx_status (status)\n      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n    `);\n    console.log('âœ… ç­‰çº§å¡è¡¨åˆ›å»ºæˆåŠŸ');\n\n    // 3. æ’å…¥ç­‰çº§å¡ç±»å‹æ•°æ®ï¼ˆåŒ…å«ä½“éªŒå¡ï¼‰\n    const existingTypes = await query('SELECT COUNT(*) as count FROM level_card_types');\n    if (existingTypes[0].count === 0) {\n      await query(`\n        INSERT INTO level_card_types (name, icon, price, points, description) VALUES\n        ('ä½“éªŒå¡', 'ğŸ', 0.00, 20, 'å…è´¹ä½“éªŒå¡ï¼Œæ¯å¼ 20ç§¯åˆ†'),\n        ('åŸºç¡€å¡', 'ğŸ¥‰', 9.90, 300, 'é€‚åˆè½»åº¦ä½¿ç”¨çš„ç”¨æˆ·'),\n        ('é«˜çº§å¡', 'ğŸ¥ˆ', 30.00, 1000, 'é€‚åˆä¸­åº¦ä½¿ç”¨çš„ç”¨æˆ·'),\n        ('è‡³å°Šå¡', 'ğŸ¥‡', 50.00, 2000, 'é€‚åˆé‡åº¦ä½¿ç”¨çš„ç”¨æˆ·')\n      `);\n      console.log('âœ… ç­‰çº§å¡ç±»å‹æ•°æ®æ’å…¥æˆåŠŸ');\n    } else {\n      console.log('â„¹ï¸ ç­‰çº§å¡ç±»å‹æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡æ’å…¥');\n    }\n\n    console.log('ğŸ‰ ç­‰çº§å¡æ•°æ®åº“è¡¨åˆå§‹åŒ–å®Œæˆï¼');\n\n    // æ˜¾ç¤ºåˆ›å»ºçš„ç±»å‹\n    const cardTypes = await query('SELECT * FROM level_card_types ORDER BY points ASC');\n    console.log('\\nğŸ“‹ ç­‰çº§å¡ç±»å‹åˆ—è¡¨:');\n    cardTypes.forEach(type => {\n      console.log(`${type.icon} ${type.name} - ${type.points}ç§¯åˆ† - Â¥${type.price}`);\n    });\n\n  } catch (error) {\n    console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);\n    throw error;\n  }\n}\n\n// æ‰§è¡Œåˆå§‹åŒ–\ninitLevelCards()\n  .then(() => {\n    console.log('âœ… åˆå§‹åŒ–å®Œæˆ');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);\n    process.exit(1);\n  });\n"
        }
    ]
}