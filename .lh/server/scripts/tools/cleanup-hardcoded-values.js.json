{
    "sourceFile": "server/scripts/tools/cleanup-hardcoded-values.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752329606009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752329606009,
            "name": "Commit-0",
            "content": "/**\n * æ¸…ç†ç¡¬ç¼–ç å€¼è„šæœ¬\n * è‡ªåŠ¨ä¿®å¤é¡¹ç›®ä¸­çš„ç¡¬ç¼–ç é—®é¢˜\n */\n\nconst fs = require('fs');\nconst path = require('path');\n\n// ç¡¬ç¼–ç æ›¿æ¢è§„åˆ™\nconst REPLACEMENT_RULES = [\n  // ComfyUIæœåŠ¡å™¨URL\n  {\n    pattern: /https:\\/\\/hwf0p724ub-8188\\.cnb\\.run/g,\n    replacement: 'https://your-comfyui-server.com',\n    description: 'ComfyUIæœåŠ¡å™¨URL (hwf0p724ub)'\n  },\n  {\n    pattern: /https:\\/\\/dzqgp58z0s-8188\\.cnb\\.run/g,\n    replacement: 'https://your-comfyui-server.com',\n    description: 'ComfyUIæœåŠ¡å™¨URL (dzqgp58z0s)'\n  },\n  \n  // ComfyUIå®¢æˆ·ç«¯ID\n  {\n    pattern: /abc1373d4ad648a3a81d0587fbe5534b/g,\n    replacement: 'your-comfyui-client-id',\n    description: 'ComfyUIå®¢æˆ·ç«¯ID'\n  },\n  \n  // æœ¬åœ°APIåœ°å€\n  {\n    pattern: /http:\\/\\/localhost:3006\\/api/g,\n    replacement: 'https://your-api-server.com/api',\n    description: 'æœ¬åœ°APIåœ°å€'\n  },\n  {\n    pattern: /http:\\/\\/localhost:3006/g,\n    replacement: 'https://your-api-server.com',\n    description: 'æœ¬åœ°æœåŠ¡å™¨åœ°å€'\n  },\n  \n  // æ•°æ®åº“IPåœ°å€\n  {\n    pattern: /114\\.132\\.50\\.71/g,\n    replacement: 'your-database-host.com',\n    description: 'æ•°æ®åº“IPåœ°å€'\n  },\n  \n  // æ•°æ®åº“å¯†ç \n  {\n    pattern: /dFLJYsd82irJwHX5/g,\n    replacement: 'your-database-password',\n    description: 'æ•°æ®åº“å¯†ç '\n  },\n  \n  // å¤‡ç”¨æœåŠ¡å™¨åœ°å€\n  {\n    pattern: /backup1\\.comfyui\\.com/g,\n    replacement: 'backup1.your-domain.com',\n    description: 'å¤‡ç”¨æœåŠ¡å™¨åœ°å€'\n  }\n];\n\n// éœ€è¦å¤„ç†çš„æ–‡ä»¶æ‰©å±•å\nconst FILE_EXTENSIONS = ['.js', '.ts', '.vue', '.json', '.md'];\n\n// æŽ’é™¤çš„ç›®å½•å’Œæ–‡ä»¶\nconst EXCLUDED_PATHS = [\n  'node_modules',\n  '.git',\n  'dist',\n  'build',\n  'coverage',\n  'logs',\n  'cleanup-hardcoded-values.js', // æŽ’é™¤è‡ªå·±\n  'check-deployment-readiness.js' // ä¿ç•™æ£€æŸ¥è„šæœ¬ä¸­çš„æ¨¡å¼\n];\n\n// æ‰«æç›®å½•èŽ·å–æ–‡ä»¶åˆ—è¡¨\nfunction scanDirectory(dir, results = []) {\n  try {\n    const files = fs.readdirSync(dir);\n\n    for (const file of files) {\n      const filePath = path.join(dir, file);\n      const relativePath = path.relative('.', filePath);\n      \n      // æ£€æŸ¥æ˜¯å¦åœ¨æŽ’é™¤åˆ—è¡¨ä¸­\n      if (EXCLUDED_PATHS.some(excluded => relativePath.includes(excluded))) {\n        continue;\n      }\n      \n      try {\n        const stat = fs.statSync(filePath);\n\n        if (stat.isDirectory()) {\n          scanDirectory(filePath, results);\n        } else {\n          const ext = path.extname(file);\n          if (FILE_EXTENSIONS.includes(ext)) {\n            results.push(filePath);\n          }\n        }\n      } catch (error) {\n        console.warn(`æ— æ³•è®¿é—®æ–‡ä»¶: ${filePath}`);\n      }\n    }\n  } catch (error) {\n    console.warn(`æ— æ³•è®¿é—®ç›®å½•: ${dir}`);\n  }\n\n  return results;\n}\n\n// å¤„ç†å•ä¸ªæ–‡ä»¶\nfunction processFile(filePath) {\n  try {\n    let content = fs.readFileSync(filePath, 'utf8');\n    let modified = false;\n    const changes = [];\n\n    for (const rule of REPLACEMENT_RULES) {\n      const matches = content.match(rule.pattern);\n      if (matches) {\n        content = content.replace(rule.pattern, rule.replacement);\n        modified = true;\n        changes.push({\n          description: rule.description,\n          count: matches.length\n        });\n      }\n    }\n\n    if (modified) {\n      fs.writeFileSync(filePath, content, 'utf8');\n      return changes;\n    }\n\n    return null;\n  } catch (error) {\n    console.warn(`å¤„ç†æ–‡ä»¶å¤±è´¥: ${filePath} - ${error.message}`);\n    return null;\n  }\n}\n\n// ä¸»å‡½æ•°\nfunction cleanupHardcodedValues() {\n  console.log('ðŸ§¹ å¼€å§‹æ¸…ç†ç¡¬ç¼–ç å€¼...\\n');\n\n  // æ‰«ææ‰€æœ‰æ–‡ä»¶\n  const allFiles = scanDirectory('.');\n  console.log(`ðŸ“ æ‰«æåˆ° ${allFiles.length} ä¸ªæ–‡ä»¶\\n`);\n\n  let processedFiles = 0;\n  let totalChanges = 0;\n  const modifiedFiles = [];\n\n  // å¤„ç†æ¯ä¸ªæ–‡ä»¶\n  for (const filePath of allFiles) {\n    const changes = processFile(filePath);\n    \n    if (changes) {\n      processedFiles++;\n      const relativePath = path.relative('.', filePath);\n      modifiedFiles.push({\n        file: relativePath,\n        changes\n      });\n      \n      const fileChanges = changes.reduce((sum, change) => sum + change.count, 0);\n      totalChanges += fileChanges;\n      \n      console.log(`âœ… ${relativePath}:`);\n      changes.forEach(change => {\n        console.log(`   - ${change.description}: ${change.count} å¤„`);\n      });\n    }\n  }\n\n  // æ˜¾ç¤ºç»“æžœ\n  console.log('\\nðŸ“Š æ¸…ç†ç»“æžœ:');\n  console.log(`   æ‰«ææ–‡ä»¶: ${allFiles.length}`);\n  console.log(`   ä¿®æ”¹æ–‡ä»¶: ${processedFiles}`);\n  console.log(`   æ€»è®¡ä¿®æ”¹: ${totalChanges} å¤„`);\n\n  if (processedFiles > 0) {\n    console.log('\\nðŸŽ‰ ç¡¬ç¼–ç å€¼æ¸…ç†å®Œæˆï¼');\n    console.log('\\nðŸ“ åŽç»­æ­¥éª¤:');\n    console.log('   1. æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶ç¡®ä¿æ­£ç¡®æ€§');\n    console.log('   2. é…ç½®çŽ¯å¢ƒå˜é‡æ–‡ä»¶');\n    console.log('   3. åœ¨åŽå°ç®¡ç†ç³»ç»Ÿä¸­è®¾ç½®æ­£ç¡®çš„é…ç½®');\n    console.log('   4. é‡æ–°è¿è¡Œéƒ¨ç½²æ£€æŸ¥: node check-deployment-readiness.js');\n  } else {\n    console.log('\\nâœ… æœªå‘çŽ°éœ€è¦æ¸…ç†çš„ç¡¬ç¼–ç å€¼');\n  }\n\n  return {\n    scannedFiles: allFiles.length,\n    modifiedFiles: processedFiles,\n    totalChanges,\n    details: modifiedFiles\n  };\n}\n\n// åˆ›å»ºç¤ºä¾‹çŽ¯å¢ƒå˜é‡æ–‡ä»¶\nfunction createExampleEnvFiles() {\n  console.log('\\nðŸ“ åˆ›å»ºç¤ºä¾‹çŽ¯å¢ƒå˜é‡æ–‡ä»¶...');\n\n  // å®¢æˆ·ç«¯çŽ¯å¢ƒå˜é‡ç¤ºä¾‹\n  const clientEnvExample = `# å®¢æˆ·ç«¯ç”Ÿäº§çŽ¯å¢ƒé…ç½®ç¤ºä¾‹\n# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env.production å¹¶ä¿®æ”¹ç›¸åº”å€¼\n\n# åº”ç”¨åŸºç¡€ä¿¡æ¯\nVITE_APP_TITLE=AI Magic - AIå›¾åƒå¤„ç†å¹³å°\nVITE_APP_VERSION=1.0.0\nVITE_APP_ENV=production\n\n# ComfyUIæœåŠ¡å™¨é…ç½®\nVITE_COMFYUI_SERVER_URL=https://your-comfyui-server.com\nVITE_COMFYUI_BACKUP_SERVERS=https://backup1.your-domain.com,https://backup2.your-domain.com\nVITE_COMFYUI_AUTO_SWITCH=true\nVITE_COMFYUI_TIMEOUT=300000\nVITE_COMFYUI_HEALTH_CHECK_TIMEOUT=10000\n\n# APIæœåŠ¡å™¨é…ç½®\nVITE_API_BASE_URL=https://your-api-server.com/api\nVITE_USE_PROXY=false\n\n# AIåŠŸèƒ½é…ç½®\nVITE_AI_TEXT_TO_IMAGE_POINTS=20\nVITE_AI_FACE_SWAP_POINTS=20\nVITE_AI_UNDRESS_POINTS=20\n`;\n\n  // æœåŠ¡ç«¯çŽ¯å¢ƒå˜é‡ç¤ºä¾‹\n  const serverEnvExample = `# æœåŠ¡ç«¯ç”Ÿäº§çŽ¯å¢ƒé…ç½®ç¤ºä¾‹\n# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env.production å¹¶ä¿®æ”¹ç›¸åº”å€¼\n\n# æœåŠ¡å™¨é…ç½®\nNODE_ENV=production\nPORT=3006\n\n# æ•°æ®åº“é…ç½®\nDB_HOST=your-database-host.com\nDB_PORT=3306\nDB_USER=your-database-user\nDB_PASSWORD=your-database-password\nDB_NAME=your-database-name\n\n# JWTé…ç½®\nJWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-chars\nJWT_EXPIRES_IN=7d\n\n# ComfyUIé…ç½®\nCOMFYUI_SERVER_URL=https://your-comfyui-server.com\nCOMFYUI_BACKUP_SERVERS=https://backup1.your-domain.com,https://backup2.your-domain.com\nCOMFYUI_AUTO_SWITCH=true\nCOMFYUI_HEALTH_CHECK_TIMEOUT=10000\nCOMFYUI_TIMEOUT=300000\n\n# å‰ç«¯é…ç½®\nFRONTEND_API_BASE_URL=https://your-api-server.com/api\nFRONTEND_TITLE=AI Magic - AIå›¾åƒå¤„ç†å¹³å°\nFRONTEND_VERSION=1.0.0\n\n# è·¨åŸŸé…ç½®\nCORS_ORIGIN=https://your-frontend-domain.com\n\n# AIåŠŸèƒ½é…ç½®\nAI_TEXT_TO_IMAGE_POINTS=20\nAI_FACE_SWAP_POINTS=20\nAI_UNDRESS_POINTS=20\n`;\n\n  try {\n    // åˆ›å»ºå®¢æˆ·ç«¯çŽ¯å¢ƒå˜é‡ç¤ºä¾‹\n    if (!fs.existsSync('client/.env.production.example')) {\n      fs.writeFileSync('client/.env.production.example', clientEnvExample);\n      console.log('âœ… åˆ›å»º client/.env.production.example');\n    }\n\n    // åˆ›å»ºæœåŠ¡ç«¯çŽ¯å¢ƒå˜é‡ç¤ºä¾‹\n    if (!fs.existsSync('server/.env.production.example')) {\n      fs.writeFileSync('server/.env.production.example', serverEnvExample);\n      console.log('âœ… åˆ›å»º server/.env.production.example');\n    }\n\n    console.log('\\nðŸ’¡ è¯·å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶å¹¶ä¿®æ”¹é…ç½®:');\n    console.log('   cp client/.env.production.example client/.env.production');\n    console.log('   cp server/.env.production.example server/.env.production');\n  } catch (error) {\n    console.error('âŒ åˆ›å»ºçŽ¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å¤±è´¥:', error.message);\n  }\n}\n\n// è¿è¡Œæ¸…ç†\nif (require.main === module) {\n  const result = cleanupHardcodedValues();\n  createExampleEnvFiles();\n  \n  // é€€å‡ºç ï¼š0è¡¨ç¤ºæˆåŠŸï¼Œ1è¡¨ç¤ºæœ‰ä¿®æ”¹\n  process.exit(result.modifiedFiles > 0 ? 1 : 0);\n}\n\nmodule.exports = { cleanupHardcodedValues, createExampleEnvFiles };\n\n"
        }
    ]
}