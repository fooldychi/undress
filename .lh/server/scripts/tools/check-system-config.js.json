{
    "sourceFile": "server/scripts/tools/check-system-config.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752329625449,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752329625449,
            "name": "Commit-0",
            "content": "require('dotenv').config({ path: './server/.env' });\nconst mysql = require('mysql2/promise');\n\nasync function checkSystemConfig() {\n  console.log('ğŸ” æ£€æŸ¥ç³»ç»Ÿé…ç½®è¡¨...\\n');\n\n  try {\n    const connection = await mysql.createConnection({\n      host: process.env.DB_HOST,\n      port: process.env.DB_PORT,\n      user: process.env.DB_USER,\n      password: process.env.DB_PASSWORD,\n      database: process.env.DB_NAME,\n      charset: 'utf8mb4'\n    });\n\n    console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ\\n');\n\n    // æ£€æŸ¥system_configè¡¨æ˜¯å¦å­˜åœ¨\n    try {\n      const [tables] = await connection.execute(`\n        SHOW TABLES LIKE 'system_config'\n      `);\n\n      if (tables.length === 0) {\n        console.log('âŒ system_configè¡¨ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»º');\n\n        // åˆ›å»ºsystem_configè¡¨\n        await connection.execute(`\n          CREATE TABLE system_config (\n            id INT AUTO_INCREMENT PRIMARY KEY,\n            config_key VARCHAR(100) NOT NULL UNIQUE,\n            config_value TEXT,\n            config_type ENUM('string', 'number', 'boolean', 'json') DEFAULT 'string',\n            config_category VARCHAR(50) DEFAULT 'general',\n            description VARCHAR(255),\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n          )\n        `);\n\n        console.log('âœ… system_configè¡¨åˆ›å»ºæˆåŠŸ');\n\n        // æ’å…¥é»˜è®¤é…ç½®\n        const defaultConfigs = [\n          // æœåŠ¡å™¨é…ç½®\n          ['server.port', '3006', 'number', 'server', 'æœåŠ¡å™¨ç«¯å£'],\n          ['server.host', 'localhost', 'string', 'server', 'æœåŠ¡å™¨ä¸»æœº'],\n\n          // æ•°æ®åº“é…ç½®\n          ['database.host', process.env.DB_HOST, 'string', 'database', 'æ•°æ®åº“ä¸»æœº'],\n          ['database.port', process.env.DB_PORT, 'number', 'database', 'æ•°æ®åº“ç«¯å£'],\n          ['database.name', process.env.DB_NAME, 'string', 'database', 'æ•°æ®åº“åç§°'],\n\n          // JWTé…ç½®\n          ['jwt.secret', process.env.JWT_SECRET || 'your-secret-key', 'string', 'jwt', 'JWTå¯†é’¥'],\n          ['jwt.expires_in', '7d', 'string', 'jwt', 'JWTè¿‡æœŸæ—¶é—´'],\n\n          // ComfyUIé…ç½®\n          ['comfyui.server_url', 'https://your-comfyui-server.com', 'string', 'comfyui', 'ComfyUIæœåŠ¡å™¨åœ°å€'],\n          ['comfyui.client_id', 'your-comfyui-client-id', 'string', 'comfyui', 'ComfyUIå®¢æˆ·ç«¯ID'],\n          ['comfyui.timeout', '300000', 'number', 'comfyui', 'ComfyUIè¯·æ±‚è¶…æ—¶æ—¶é—´(æ¯«ç§’)'],\n\n          // AIåŠŸèƒ½é…ç½®\n          ['ai.text_to_image_points', '20', 'number', 'ai', 'æ–‡ç”Ÿå›¾æ¶ˆè€—ç§¯åˆ†'],\n          ['ai.face_swap_points', '20', 'number', 'ai', 'æ¢è„¸æ¶ˆè€—ç§¯åˆ†'],\n          ['ai.undress_points', '20', 'number', 'ai', 'æ¢è¡£æ¶ˆè€—ç§¯åˆ†'],\n\n          // å‰ç«¯é…ç½®\n          ['frontend.api_base_url', 'https://your-api-server.com/api', 'string', 'frontend', 'å‰ç«¯APIåŸºç¡€åœ°å€'],\n          ['frontend.title', 'AI Magic - AIå›¾åƒå¤„ç†å¹³å°', 'string', 'frontend', 'åº”ç”¨æ ‡é¢˜'],\n          ['frontend.version', '1.0.0', 'string', 'frontend', 'åº”ç”¨ç‰ˆæœ¬'],\n\n          // CORSé…ç½®\n          ['cors.allowed_origins', 'http://localhost:3000,http://localhost:3001,http://localhost:3007', 'string', 'cors', 'å…è®¸çš„è·¨åŸŸæº'],\n\n          // æ–‡ä»¶ä¸Šä¼ é…ç½®\n          ['upload.max_file_size', '10485760', 'number', 'upload', 'æœ€å¤§æ–‡ä»¶å¤§å°(å­—èŠ‚)'],\n          ['upload.allowed_types', 'jpg,jpeg,png,gif', 'string', 'upload', 'å…è®¸çš„æ–‡ä»¶ç±»å‹'],\n\n          // æ—¥å¿—é…ç½®\n          ['log.level', 'info', 'string', 'log', 'æ—¥å¿—çº§åˆ«'],\n          ['log.file_path', './logs/app.log', 'string', 'log', 'æ—¥å¿—æ–‡ä»¶è·¯å¾„']\n        ];\n\n        for (const config of defaultConfigs) {\n          await connection.execute(`\n            INSERT INTO system_config (config_key, config_value, config_type, config_category, description)\n            VALUES (?, ?, ?, ?, ?)\n          `, config);\n        }\n\n        console.log(`âœ… æ’å…¥äº†${defaultConfigs.length}æ¡é»˜è®¤é…ç½®`);\n\n      } else {\n        console.log('âœ… system_configè¡¨å·²å­˜åœ¨');\n      }\n\n      // æŸ¥çœ‹è¡¨ç»“æ„\n      const [columns] = await connection.execute(`\n        DESCRIBE system_config\n      `);\n\n      console.log('\\nğŸ“‹ system_configè¡¨ç»“æ„:');\n      columns.forEach(col => {\n        console.log(`   ${col.Field}: ${col.Type} ${col.Null === 'YES' ? '(å¯ç©º)' : '(éç©º)'}`);\n      });\n\n      // æŸ¥è¯¢ç°æœ‰é…ç½®\n      const [configs] = await connection.execute(`\n        SELECT * FROM system_config LIMIT 10\n      `);\n\n      console.log('\\nğŸ¯ ç°æœ‰é…ç½®ç¤ºä¾‹:');\n      configs.forEach(config => {\n        console.log(`   ${config.config_key || config.key}: ${config.config_value || config.value}`);\n      });\n\n    } catch (error) {\n      console.error('âŒ æ£€æŸ¥é…ç½®è¡¨å¤±è´¥:', error.message);\n    }\n\n    await connection.end();\n\n  } catch (error) {\n    console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:', error.message);\n  }\n}\n\ncheckSystemConfig();\n\n"
        }
    ]
}