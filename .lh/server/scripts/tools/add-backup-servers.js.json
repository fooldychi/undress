{
    "sourceFile": "server/scripts/tools/add-backup-servers.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752513572231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752513572231,
            "name": "Commit-0",
            "content": "require('dotenv').config({ path: './server/.env' });\nconst mysql = require('mysql2/promise');\n\nasync function addBackupServers() {\n  console.log('ğŸ”§ æ·»åŠ ComfyUIå¤‡ç”¨æœåŠ¡å™¨é…ç½®...\\n');\n\n  try {\n    const connection = await mysql.createConnection({\n      host: process.env.DB_HOST,\n      port: process.env.DB_PORT,\n      user: process.env.DB_USER,\n      password: process.env.DB_PASSWORD,\n      database: process.env.DB_NAME,\n      charset: 'utf8mb4'\n    });\n\n    console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ\\n');\n\n    // æŸ¥çœ‹æ·»åŠ å‰çš„ComfyUIé…ç½®\n    console.log('ğŸ“‹ æ·»åŠ å‰çš„ComfyUIé…ç½®:');\n    const [beforeConfigs] = await connection.execute(`\n      SELECT config_key, config_value, description\n      FROM system_config\n      WHERE config_group = 'comfyui'\n      ORDER BY config_key\n    `);\n\n    beforeConfigs.forEach(config => {\n      console.log(`   ${config.config_key}: ${config.config_value}`);\n      console.log(`      æè¿°: ${config.description}`);\n    });\n\n    // æ·»åŠ å¤‡ç”¨æœåŠ¡å™¨é…ç½®\n    const backupConfigs = [\n      ['comfyui.backup_servers', 'https://backup1.your-domain.com,https://backup2.comfyui.com', 'string', 'comfyui', 'ComfyUIå¤‡ç”¨æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªæˆ–é€—å·åˆ†éš”ï¼‰', 0],\n      ['comfyui.auto_switch', 'true', 'boolean', 'comfyui', 'æ˜¯å¦å¯ç”¨è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨', 0],\n      ['comfyui.health_check_timeout', '10000', 'number', 'comfyui', 'æœåŠ¡å™¨å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)', 0],\n      ['comfyui.retry_attempts', '3', 'number', 'comfyui', 'æœåŠ¡å™¨é‡è¯•æ¬¡æ•°', 0],\n      ['comfyui.switch_threshold', '2', 'number', 'comfyui', 'è¿ç»­å¤±è´¥å¤šå°‘æ¬¡ååˆ‡æ¢æœåŠ¡å™¨', 0]\n    ];\n\n    console.log('\\nğŸ”§ æ·»åŠ å¤‡ç”¨æœåŠ¡å™¨é…ç½®...');\n\n    for (const config of backupConfigs) {\n      try {\n        // æ£€æŸ¥é…ç½®æ˜¯å¦å·²å­˜åœ¨\n        const [existing] = await connection.execute(`\n          SELECT config_key FROM system_config WHERE config_key = ?\n        `, [config[0]]);\n\n        if (existing.length > 0) {\n          console.log(`âš ï¸ é…ç½® ${config[0]} å·²å­˜åœ¨ï¼Œè·³è¿‡`);\n          continue;\n        }\n\n        // æ’å…¥æ–°é…ç½®\n        await connection.execute(`\n          INSERT INTO system_config (config_key, config_value, config_type, config_group, description, is_encrypted)\n          VALUES (?, ?, ?, ?, ?, ?)\n        `, config);\n\n        console.log(`âœ… æ·»åŠ é…ç½®: ${config[0]} = ${config[1]}`);\n      } catch (error) {\n        console.log(`âŒ æ·»åŠ é…ç½®å¤±è´¥: ${config[0]} - ${error.message}`);\n      }\n    }\n\n    // æŸ¥çœ‹æ·»åŠ åçš„ComfyUIé…ç½®\n    console.log('\\nğŸ“‹ æ·»åŠ åçš„ComfyUIé…ç½®:');\n    const [afterConfigs] = await connection.execute(`\n      SELECT config_key, config_value, description\n      FROM system_config\n      WHERE config_group = 'comfyui'\n      ORDER BY config_key\n    `);\n\n    afterConfigs.forEach(config => {\n      console.log(`   ${config.config_key}: ${config.config_value}`);\n      console.log(`      æè¿°: ${config.description}`);\n    });\n\n    console.log(`\\nğŸ“Š é…ç½®ç»“æœ: ${beforeConfigs.length} â†’ ${afterConfigs.length} é¡¹é…ç½®`);\n\n    await connection.end();\n\n  } catch (error) {\n    console.error('âŒ æ·»åŠ å¤±è´¥:', error.message);\n  }\n}\n\naddBackupServers();\n"
        }
    ]
}