{
    "sourceFile": "server/test-db.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752548823002,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752548823002,
            "name": "Commit-0",
            "content": "const { query, testConnection } = require('./src/config/database');\n\nasync function testDatabase() {\n  console.log('ğŸ” æµ‹è¯•æ•°æ®åº“è¿æ¥å’Œè¡¨ç»“æ„...');\n\n  try {\n    // æµ‹è¯•è¿æ¥\n    const connected = await testConnection();\n    if (!connected) {\n      console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥');\n      return;\n    }\n\n    // æ£€æŸ¥system_configè¡¨æ˜¯å¦å­˜åœ¨\n    console.log('\\nğŸ“‹ æ£€æŸ¥system_configè¡¨...');\n    try {\n      const tables = await query(\"SHOW TABLES LIKE 'system_config'\");\n      if (tables.length === 0) {\n        console.log('âŒ system_configè¡¨ä¸å­˜åœ¨');\n\n        // åˆ›å»ºè¡¨\n        console.log('ğŸ”§ åˆ›å»ºsystem_configè¡¨...');\n        await query(`\n          CREATE TABLE system_config (\n            id INT AUTO_INCREMENT PRIMARY KEY,\n            config_key VARCHAR(255) NOT NULL UNIQUE,\n            config_value TEXT,\n            config_type ENUM('string', 'number', 'boolean', 'json') DEFAULT 'string',\n            config_group VARCHAR(100) DEFAULT 'general',\n            description TEXT,\n            is_encrypted TINYINT(1) DEFAULT 0,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            INDEX idx_config_group (config_group),\n            INDEX idx_config_key (config_key)\n          ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n        console.log('âœ… system_configè¡¨åˆ›å»ºæˆåŠŸ');\n\n        // æ’å…¥é»˜è®¤é…ç½®\n        console.log('ğŸ“ æ’å…¥é»˜è®¤é…ç½®...');\n        const defaultConfigs = [\n          ['comfyui.server_url', 'https://l9s75ay3rp-8188.cnb.run', 'string', 'comfyui', 'ComfyUIä¸»æœåŠ¡å™¨åœ°å€'],\n          ['comfyui.backup_servers', 'https://0rv00xh2vg-8188.cnb.run', 'string', 'comfyui', 'ComfyUIå¤‡ç”¨æœåŠ¡å™¨åœ°å€åˆ—è¡¨'],\n          ['comfyui.health_check_timeout', '10000', 'number', 'comfyui', 'ComfyUIå¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)'],\n          ['comfyui.timeout', '300000', 'number', 'comfyui', 'ComfyUIè¯·æ±‚è¶…æ—¶æ—¶é—´(æ¯«ç§’)'],\n          ['ai.face_swap_points', '20', 'number', 'ai', 'æ¢è„¸æ¶ˆè€—ç§¯åˆ†'],\n          ['ai.undress_points', '20', 'number', 'ai', 'æ¢è¡£æ¶ˆè€—ç§¯åˆ†']\n        ];\n\n        for (const [key, value, type, group, desc] of defaultConfigs) {\n          await query(\n            'INSERT INTO system_config (config_key, config_value, config_type, config_group, description) VALUES (?, ?, ?, ?, ?)',\n            [key, value, type, group, desc]\n          );\n        }\n        console.log('âœ… é»˜è®¤é…ç½®æ’å…¥æˆåŠŸ');\n\n      } else {\n        console.log('âœ… system_configè¡¨å­˜åœ¨');\n      }\n\n      // æŸ¥è¯¢ç°æœ‰é…ç½®\n      console.log('\\nğŸ“Š å½“å‰é…ç½®:');\n      const configs = await query('SELECT * FROM system_config ORDER BY config_group, config_key');\n      configs.forEach(config => {\n        console.log(`   ${config.config_key}: ${config.config_value} (${config.config_type})`);\n      });\n\n    } catch (error) {\n      console.error('âŒ æ£€æŸ¥è¡¨ç»“æ„å¤±è´¥:', error);\n    }\n\n  } catch (error) {\n    console.error('âŒ æ•°æ®åº“æµ‹è¯•å¤±è´¥:', error);\n  }\n\n  process.exit(0);\n}\n\ntestDatabase();\n"
        }
    ]
}