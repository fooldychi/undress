{
    "sourceFile": "server/deploy.bat",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1753709245081,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753709256555,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,11 +54,11 @@\n \n REM å®‰è£…ä¾èµ–\n echo [INFO] å®‰è£…ç”Ÿäº§ä¾èµ–...\n if exist \"package-lock.json\" (\n-    npm ci --only=production\n+    npm ci --production\n ) else (\n-    npm install --only=production\n+    npm install --production\n )\n if errorlevel 1 (\n     echo [ERROR] ä¾èµ–å®‰è£…å¤±è´¥\n     pause\n"
                },
                {
                    "date": 1753709895711,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,15 @@\n @echo off\n-REM AIMagic åŽç«¯æœåŠ¡Windowséƒ¨ç½²è„šæœ¬\n-REM æœåŠ¡å™¨: 114.132.50.71 (è…¾è®¯äº‘Windows Server)\n-REM ä½œè€…: AIMagic Team\n-REM ç‰ˆæœ¬: 1.0.0\n+REM AIMagic Backend Service Windows Deployment Script\n+REM Server: 114.132.50.71 (Tencent Cloud Windows Server)\n+REM Author: AIMagic Team\n+REM Version: 2.0.0\n \n-setlocal enabledelayedexpansion\n-\n echo ========================================\n-echo        AIMagic åŽç«¯æœåŠ¡éƒ¨ç½²è„šæœ¬ v1.0.0\n+echo    AIMagic Backend Service Deploy v2.0\n echo ========================================\n-echo éƒ¨ç½²æ—¶é—´: %date% %time%\n-echo æœåŠ¡å™¨: 114.132.50.71 (Windows Server)\n+echo Deploy Time: %date% %time%\n+echo Server: 114.132.50.71 (Windows Server)\n echo ========================================\n echo.\n \n REM æ£€æŸ¥Node.jsç‰ˆæœ¬\n"
                },
                {
                    "date": 1753709911933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,21 +11,19 @@\n echo Server: 114.132.50.71 (Windows Server)\n echo ========================================\n echo.\n \n-REM æ£€æŸ¥Node.jsç‰ˆæœ¬\n-echo [INFO] æ£€æŸ¥Node.jsç‰ˆæœ¬...\n+REM Check Node.js version\n+echo [INFO] Checking Node.js version...\n node --version >nul 2>&1\n if errorlevel 1 (\n-    echo [ERROR] Node.js æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Node.js ^>= 16.0.0\n-    echo ä¸‹è½½åœ°å€: https://nodejs.org/\n+    echo [ERROR] Node.js not installed, please install Node.js ^>= 16.0.0\n+    echo Download: https://nodejs.org/\n     pause\n     exit /b 1\n )\n+echo [SUCCESS] Node.js version check passed\n \n-for /f \"tokens=*\" %%i in ('node --version') do set NODE_VERSION=%%i\n-echo [SUCCESS] Node.js ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡: !NODE_VERSION!\n-\n REM æ£€æŸ¥PM2\n echo [INFO] æ£€æŸ¥PM2...\n pm2 --version >nul 2>&1\n if errorlevel 1 (\n"
                }
            ],
            "date": 1753709245081,
            "name": "Commit-0",
            "content": "@echo off\nREM AIMagic åŽç«¯æœåŠ¡Windowséƒ¨ç½²è„šæœ¬\nREM æœåŠ¡å™¨: 114.132.50.71 (è…¾è®¯äº‘Windows Server)\nREM ä½œè€…: AIMagic Team\nREM ç‰ˆæœ¬: 1.0.0\n\nsetlocal enabledelayedexpansion\n\necho ========================================\necho        AIMagic åŽç«¯æœåŠ¡éƒ¨ç½²è„šæœ¬ v1.0.0\necho ========================================\necho éƒ¨ç½²æ—¶é—´: %date% %time%\necho æœåŠ¡å™¨: 114.132.50.71 (Windows Server)\necho ========================================\necho.\n\nREM æ£€æŸ¥Node.jsç‰ˆæœ¬\necho [INFO] æ£€æŸ¥Node.jsç‰ˆæœ¬...\nnode --version >nul 2>&1\nif errorlevel 1 (\n    echo [ERROR] Node.js æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Node.js ^>= 16.0.0\n    echo ä¸‹è½½åœ°å€: https://nodejs.org/\n    pause\n    exit /b 1\n)\n\nfor /f \"tokens=*\" %%i in ('node --version') do set NODE_VERSION=%%i\necho [SUCCESS] Node.js ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡: !NODE_VERSION!\n\nREM æ£€æŸ¥PM2\necho [INFO] æ£€æŸ¥PM2...\npm2 --version >nul 2>&1\nif errorlevel 1 (\n    echo [WARNING] PM2 æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…...\n    npm install -g pm2\n    if errorlevel 1 (\n        echo [ERROR] PM2 å®‰è£…å¤±è´¥\n        pause\n        exit /b 1\n    )\n    echo [SUCCESS] PM2 å®‰è£…å®Œæˆ\n) else (\n    for /f \"tokens=*\" %%i in ('pm2 --version') do set PM2_VERSION=%%i\n    echo [SUCCESS] PM2 å·²å®‰è£…: !PM2_VERSION!\n)\n\nREM åˆ›å»ºå¿…è¦ç›®å½•\necho [INFO] åˆ›å»ºå¿…è¦ç›®å½•...\nif not exist \"logs\" mkdir logs\nif not exist \"uploads\" mkdir uploads\nif not exist \"uploads\\images\" mkdir uploads\\images\nif not exist \"uploads\\temp\" mkdir uploads\\temp\necho [SUCCESS] ç›®å½•åˆ›å»ºå®Œæˆ\n\nREM å®‰è£…ä¾èµ–\necho [INFO] å®‰è£…ç”Ÿäº§ä¾èµ–...\nif exist \"package-lock.json\" (\n    npm ci --only=production\n) else (\n    npm install --only=production\n)\nif errorlevel 1 (\n    echo [ERROR] ä¾èµ–å®‰è£…å¤±è´¥\n    pause\n    exit /b 1\n)\necho [SUCCESS] ä¾èµ–å®‰è£…å®Œæˆ\n\nREM æ•°æ®åº“åˆå§‹åŒ–\necho [INFO] åˆå§‹åŒ–æ•°æ®åº“é…ç½®...\nif exist \"src\\scripts\\init-deployment-config.js\" (\n    node src\\scripts\\init-deployment-config.js\n    if errorlevel 1 (\n        echo [WARNING] æ•°æ®åº“é…ç½®åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥\n    ) else (\n        echo [SUCCESS] æ•°æ®åº“é…ç½®åˆå§‹åŒ–å®Œæˆ\n    )\n) else (\n    echo [WARNING] æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ä¸å­˜åœ¨ï¼Œè·³è¿‡æ­¤æ­¥éª¤\n)\n\nREM åœæ­¢çŽ°æœ‰æœåŠ¡\necho [INFO] åœæ­¢çŽ°æœ‰æœåŠ¡...\npm2 list | findstr \"aimagic-server\" >nul 2>&1\nif not errorlevel 1 (\n    pm2 stop aimagic-server\n    pm2 delete aimagic-server\n    echo [SUCCESS] çŽ°æœ‰æœåŠ¡å·²åœæ­¢\n) else (\n    echo [INFO] æ²¡æœ‰è¿è¡Œä¸­çš„æœåŠ¡\n)\n\nREM å¯åŠ¨æœåŠ¡\necho [INFO] å¯åŠ¨ç”Ÿäº§æœåŠ¡...\npm2 start ecosystem.config.js --env production\nif errorlevel 1 (\n    echo [ERROR] æœåŠ¡å¯åŠ¨å¤±è´¥\n    pause\n    exit /b 1\n)\npm2 save\necho [SUCCESS] æœåŠ¡å¯åŠ¨å®Œæˆ\n\nREM ç­‰å¾…æœåŠ¡å¯åŠ¨\necho [INFO] ç­‰å¾…æœåŠ¡å¯åŠ¨...\ntimeout /t 3 /nobreak >nul\n\nREM æ£€æŸ¥æœåŠ¡çŠ¶æ€\necho [INFO] æ£€æŸ¥æœåŠ¡çŠ¶æ€...\npm2 list | findstr \"aimagic-server.*online\" >nul 2>&1\nif not errorlevel 1 (\n    echo [SUCCESS] æœåŠ¡è¿è¡Œæ­£å¸¸\n    pm2 show aimagic-server\n) else (\n    echo [ERROR] æœåŠ¡å¯åŠ¨å¤±è´¥\n    pm2 logs aimagic-server --lines 20\n    pause\n    exit /b 1\n)\n\nREM è®¾ç½®å¼€æœºè‡ªå¯\necho [INFO] è®¾ç½®å¼€æœºè‡ªå¯...\npm2 startup\npm2 save\necho [SUCCESS] å¼€æœºè‡ªå¯è®¾ç½®å®Œæˆ\n\nREM é…ç½®Windowsé˜²ç«å¢™\necho [INFO] é…ç½®Windowsé˜²ç«å¢™...\nnetsh advfirewall firewall show rule name=\"AIMagic Server Port 3007\" >nul 2>&1\nif errorlevel 1 (\n    netsh advfirewall firewall add rule name=\"AIMagic Server Port 3007\" dir=in action=allow protocol=TCP localport=3007\n    echo [SUCCESS] é˜²ç«å¢™è§„åˆ™å·²æ·»åŠ \n) else (\n    echo [INFO] é˜²ç«å¢™è§„åˆ™å·²å­˜åœ¨\n)\n\necho.\necho ========================================\necho [SUCCESS] ðŸŽ‰ éƒ¨ç½²å®Œæˆï¼\necho ========================================\necho ðŸŒ æœåŠ¡åœ°å€: http://114.132.50.71:3007\necho ðŸ“Š ç›‘æŽ§å‘½ä»¤: pm2 monit\necho ðŸ“‹ æŸ¥çœ‹æ—¥å¿—: pm2 logs aimagic-server\necho ðŸ”„ é‡å¯æœåŠ¡: pm2 restart aimagic-server\necho â¹ï¸  åœæ­¢æœåŠ¡: pm2 stop aimagic-server\necho ========================================\necho.\n\nREM è¿è¡Œå¥åº·æ£€æŸ¥\nif exist \"src\\scripts\\health-check.js\" (\n    echo [INFO] è¿è¡Œå¥åº·æ£€æŸ¥...\n    node src\\scripts\\health-check.js\n)\n\necho æŒ‰ä»»æ„é”®é€€å‡º...\npause >nul\n"
        }
    ]
}