{
    "sourceFile": "server/deploy.bat",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1753709245081,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753709256555,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,11 +54,11 @@\n \n REM 安装依赖\n echo [INFO] 安装生产依赖...\n if exist \"package-lock.json\" (\n-    npm ci --only=production\n+    npm ci --production\n ) else (\n-    npm install --only=production\n+    npm install --production\n )\n if errorlevel 1 (\n     echo [ERROR] 依赖安装失败\n     pause\n"
                },
                {
                    "date": 1753709895711,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,15 @@\n @echo off\n-REM AIMagic 后端服务Windows部署脚本\n-REM 服务器: 114.132.50.71 (腾讯云Windows Server)\n-REM 作者: AIMagic Team\n-REM 版本: 1.0.0\n+REM AIMagic Backend Service Windows Deployment Script\n+REM Server: 114.132.50.71 (Tencent Cloud Windows Server)\n+REM Author: AIMagic Team\n+REM Version: 2.0.0\n \n-setlocal enabledelayedexpansion\n-\n echo ========================================\n-echo        AIMagic 后端服务部署脚本 v1.0.0\n+echo    AIMagic Backend Service Deploy v2.0\n echo ========================================\n-echo 部署时间: %date% %time%\n-echo 服务器: 114.132.50.71 (Windows Server)\n+echo Deploy Time: %date% %time%\n+echo Server: 114.132.50.71 (Windows Server)\n echo ========================================\n echo.\n \n REM 检查Node.js版本\n"
                },
                {
                    "date": 1753709911933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,21 +11,19 @@\n echo Server: 114.132.50.71 (Windows Server)\n echo ========================================\n echo.\n \n-REM 检查Node.js版本\n-echo [INFO] 检查Node.js版本...\n+REM Check Node.js version\n+echo [INFO] Checking Node.js version...\n node --version >nul 2>&1\n if errorlevel 1 (\n-    echo [ERROR] Node.js 未安装，请先安装 Node.js ^>= 16.0.0\n-    echo 下载地址: https://nodejs.org/\n+    echo [ERROR] Node.js not installed, please install Node.js ^>= 16.0.0\n+    echo Download: https://nodejs.org/\n     pause\n     exit /b 1\n )\n+echo [SUCCESS] Node.js version check passed\n \n-for /f \"tokens=*\" %%i in ('node --version') do set NODE_VERSION=%%i\n-echo [SUCCESS] Node.js 版本检查通过: !NODE_VERSION!\n-\n REM 检查PM2\n echo [INFO] 检查PM2...\n pm2 --version >nul 2>&1\n if errorlevel 1 (\n"
                }
            ],
            "date": 1753709245081,
            "name": "Commit-0",
            "content": "@echo off\nREM AIMagic 后端服务Windows部署脚本\nREM 服务器: 114.132.50.71 (腾讯云Windows Server)\nREM 作者: AIMagic Team\nREM 版本: 1.0.0\n\nsetlocal enabledelayedexpansion\n\necho ========================================\necho        AIMagic 后端服务部署脚本 v1.0.0\necho ========================================\necho 部署时间: %date% %time%\necho 服务器: 114.132.50.71 (Windows Server)\necho ========================================\necho.\n\nREM 检查Node.js版本\necho [INFO] 检查Node.js版本...\nnode --version >nul 2>&1\nif errorlevel 1 (\n    echo [ERROR] Node.js 未安装，请先安装 Node.js ^>= 16.0.0\n    echo 下载地址: https://nodejs.org/\n    pause\n    exit /b 1\n)\n\nfor /f \"tokens=*\" %%i in ('node --version') do set NODE_VERSION=%%i\necho [SUCCESS] Node.js 版本检查通过: !NODE_VERSION!\n\nREM 检查PM2\necho [INFO] 检查PM2...\npm2 --version >nul 2>&1\nif errorlevel 1 (\n    echo [WARNING] PM2 未安装，正在安装...\n    npm install -g pm2\n    if errorlevel 1 (\n        echo [ERROR] PM2 安装失败\n        pause\n        exit /b 1\n    )\n    echo [SUCCESS] PM2 安装完成\n) else (\n    for /f \"tokens=*\" %%i in ('pm2 --version') do set PM2_VERSION=%%i\n    echo [SUCCESS] PM2 已安装: !PM2_VERSION!\n)\n\nREM 创建必要目录\necho [INFO] 创建必要目录...\nif not exist \"logs\" mkdir logs\nif not exist \"uploads\" mkdir uploads\nif not exist \"uploads\\images\" mkdir uploads\\images\nif not exist \"uploads\\temp\" mkdir uploads\\temp\necho [SUCCESS] 目录创建完成\n\nREM 安装依赖\necho [INFO] 安装生产依赖...\nif exist \"package-lock.json\" (\n    npm ci --only=production\n) else (\n    npm install --only=production\n)\nif errorlevel 1 (\n    echo [ERROR] 依赖安装失败\n    pause\n    exit /b 1\n)\necho [SUCCESS] 依赖安装完成\n\nREM 数据库初始化\necho [INFO] 初始化数据库配置...\nif exist \"src\\scripts\\init-deployment-config.js\" (\n    node src\\scripts\\init-deployment-config.js\n    if errorlevel 1 (\n        echo [WARNING] 数据库配置初始化失败，请检查数据库连接\n    ) else (\n        echo [SUCCESS] 数据库配置初始化完成\n    )\n) else (\n    echo [WARNING] 数据库初始化脚本不存在，跳过此步骤\n)\n\nREM 停止现有服务\necho [INFO] 停止现有服务...\npm2 list | findstr \"aimagic-server\" >nul 2>&1\nif not errorlevel 1 (\n    pm2 stop aimagic-server\n    pm2 delete aimagic-server\n    echo [SUCCESS] 现有服务已停止\n) else (\n    echo [INFO] 没有运行中的服务\n)\n\nREM 启动服务\necho [INFO] 启动生产服务...\npm2 start ecosystem.config.js --env production\nif errorlevel 1 (\n    echo [ERROR] 服务启动失败\n    pause\n    exit /b 1\n)\npm2 save\necho [SUCCESS] 服务启动完成\n\nREM 等待服务启动\necho [INFO] 等待服务启动...\ntimeout /t 3 /nobreak >nul\n\nREM 检查服务状态\necho [INFO] 检查服务状态...\npm2 list | findstr \"aimagic-server.*online\" >nul 2>&1\nif not errorlevel 1 (\n    echo [SUCCESS] 服务运行正常\n    pm2 show aimagic-server\n) else (\n    echo [ERROR] 服务启动失败\n    pm2 logs aimagic-server --lines 20\n    pause\n    exit /b 1\n)\n\nREM 设置开机自启\necho [INFO] 设置开机自启...\npm2 startup\npm2 save\necho [SUCCESS] 开机自启设置完成\n\nREM 配置Windows防火墙\necho [INFO] 配置Windows防火墙...\nnetsh advfirewall firewall show rule name=\"AIMagic Server Port 3007\" >nul 2>&1\nif errorlevel 1 (\n    netsh advfirewall firewall add rule name=\"AIMagic Server Port 3007\" dir=in action=allow protocol=TCP localport=3007\n    echo [SUCCESS] 防火墙规则已添加\n) else (\n    echo [INFO] 防火墙规则已存在\n)\n\necho.\necho ========================================\necho [SUCCESS] 🎉 部署完成！\necho ========================================\necho 🌐 服务地址: http://114.132.50.71:3007\necho 📊 监控命令: pm2 monit\necho 📋 查看日志: pm2 logs aimagic-server\necho 🔄 重启服务: pm2 restart aimagic-server\necho ⏹️  停止服务: pm2 stop aimagic-server\necho ========================================\necho.\n\nREM 运行健康检查\nif exist \"src\\scripts\\health-check.js\" (\n    echo [INFO] 运行健康检查...\n    node src\\scripts\\health-check.js\n)\n\necho 按任意键退出...\npause >nul\n"
        }
    ]
}