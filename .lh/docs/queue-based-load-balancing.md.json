{
    "sourceFile": "docs/queue-based-load-balancing.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752896694938,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752896708414,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,11 @@\n ```javascript\n // 1. ç­›é€‰å¥åº·æœåŠ¡å™¨\n const healthyServers = serverList.filter(s => s.healthy === true)\n \n-// 2. æŒ‰ä¼˜å…ˆçº§å’Œé˜Ÿåˆ—æ•°é‡æ’åº\n+// 2. ä»…æŒ‰é˜Ÿåˆ—æ•°é‡æ’åºï¼ˆä¸è€ƒè™‘ä¼˜å…ˆçº§ï¼‰\n const sortedServers = healthyServers.sort((a, b) => {\n-  // ä¼˜å…ˆçº§æ¯”è¾ƒ\n-  const priorityOrder = { 'primary': 0, 'backup': 1, 'default': 2 }\n-  const priorityDiff = priorityOrder[a.type] - priorityOrder[b.type]\n-  if (priorityDiff !== 0) return priorityDiff\n-\n-  // é˜Ÿåˆ—æ•°é‡æ¯”è¾ƒ\n+  // é€‰æ‹©é˜Ÿåˆ—æœ€å°‘çš„æœåŠ¡å™¨\n   return a.queueInfo.total - b.queueInfo.total\n })\n \n // 3. é€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨\n"
                },
                {
                    "date": 1752896722776,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -122,9 +122,9 @@\n ## ğŸ‰ ä½¿ç”¨æ•ˆæœ\n \n ### è´Ÿè½½å‡è¡¡æ•ˆæœ\n - **æ™ºèƒ½åˆ†é…** - è‡ªåŠ¨é€‰æ‹©é˜Ÿåˆ—æœ€å°‘çš„æœåŠ¡å™¨\n-- **ä¼˜å…ˆçº§ä¿è¯** - ä¸»æœåŠ¡å™¨ä¼˜å…ˆï¼Œå¤‡ç”¨æœåŠ¡å™¨è¡¥å……\n+- **å…¬å¹³è°ƒåº¦** - ä¸è€ƒè™‘æœåŠ¡å™¨ç±»å‹ï¼Œçº¯ç²¹åŸºäºé˜Ÿåˆ—æ•°é‡é€‰æ‹©\n - **å®æ—¶è°ƒæ•´** - æ ¹æ®é˜Ÿåˆ—å˜åŒ–åŠ¨æ€è°ƒæ•´é€‰æ‹©\n \n ### æ—¥å¿—è¾“å‡ºä¼˜åŒ–\n - **ç®€æ´æ˜äº†** - é»˜è®¤åªæ˜¾ç¤ºå…³é”®ä¿¡æ¯\n"
                }
            ],
            "date": 1752896694938,
            "name": "Commit-0",
            "content": "# åŸºäºé˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡å®ç°\n\n## ğŸ¯ åŠŸèƒ½æ¦‚è¿°\n\nå®ç°äº†åŸºäºComfyUIæœåŠ¡å™¨é˜Ÿåˆ—æ•°é‡çš„æ™ºèƒ½è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œä¼˜å…ˆé€‰æ‹©é˜Ÿåˆ—æœ€å°‘çš„å¥åº·æœåŠ¡å™¨ï¼Œç¡®ä¿ä»»åŠ¡åˆ†é…çš„å‡è¡¡æ€§å’Œæ•ˆç‡ã€‚\n\n## ğŸ”§ æ ¸å¿ƒç‰¹æ€§\n\n### 1. é˜Ÿåˆ—ä¿¡æ¯æ”¶é›†\n- **å®æ—¶é˜Ÿåˆ—ç›‘æ§** - è·å–æ¯ä¸ªæœåŠ¡å™¨çš„è¿è¡Œé˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—æ•°é‡\n- **ç³»ç»Ÿä¿¡æ¯æ”¶é›†** - æ”¶é›†ComfyUIç‰ˆæœ¬ã€ç³»ç»Ÿèµ„æºç­‰ä¿¡æ¯\n- **å¥åº·çŠ¶æ€è·Ÿè¸ª** - æŒç»­ç›‘æ§æœåŠ¡å™¨å¯ç”¨æ€§\n\n### 2. æ™ºèƒ½è´Ÿè½½å‡è¡¡\n- **é˜Ÿåˆ—ä¼˜å…ˆ** - ä»…æ ¹æ®é˜Ÿåˆ—æ•°é‡é€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨\n- **æœ€å°‘é˜Ÿåˆ—** - å§‹ç»ˆé€‰æ‹©é˜Ÿåˆ—æ•°é‡æœ€å°‘çš„å¥åº·æœåŠ¡å™¨\n- **åŠ¨æ€è°ƒæ•´** - æ ¹æ®å®æ—¶é˜Ÿåˆ—çŠ¶å†µè‡ªåŠ¨è°ƒæ•´é€‰æ‹©\n\n### 3. ç®€åŒ–æ—¥å¿—è¾“å‡º\n- **é»˜è®¤ç®€æ´æ¨¡å¼** - åªæ˜¾ç¤ºå…³é”®çŠ¶æ€ä¿¡æ¯\n- **è¯¦ç»†æ—¥å¿—å¼€å…³** - å¯æŒ‰éœ€å¯ç”¨è¯¦ç»†è°ƒè¯•ä¿¡æ¯\n- **çŠ¶æ€æ‘˜è¦** - æ¸…æ™°æ˜¾ç¤ºå¯ç”¨æœåŠ¡å™¨å’Œé˜Ÿåˆ—æƒ…å†µ\n\n## ğŸ“Š è´Ÿè½½å‡è¡¡ç®—æ³•\n\n### æœåŠ¡å™¨é€‰æ‹©é€»è¾‘\n```javascript\n// 1. ç­›é€‰å¥åº·æœåŠ¡å™¨\nconst healthyServers = serverList.filter(s => s.healthy === true)\n\n// 2. æŒ‰ä¼˜å…ˆçº§å’Œé˜Ÿåˆ—æ•°é‡æ’åº\nconst sortedServers = healthyServers.sort((a, b) => {\n  // ä¼˜å…ˆçº§æ¯”è¾ƒ\n  const priorityOrder = { 'primary': 0, 'backup': 1, 'default': 2 }\n  const priorityDiff = priorityOrder[a.type] - priorityOrder[b.type]\n  if (priorityDiff !== 0) return priorityDiff\n\n  // é˜Ÿåˆ—æ•°é‡æ¯”è¾ƒ\n  return a.queueInfo.total - b.queueInfo.total\n})\n\n// 3. é€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨\nreturn sortedServers[0].url\n```\n\n### é˜Ÿåˆ—ä¿¡æ¯è§£æ\n```javascript\nparseQueueInfo(data) {\n  const running = Array.isArray(data.queue_running) ? data.queue_running.length : 0\n  const pending = Array.isArray(data.queue_pending) ? data.queue_pending.length : 0\n\n  return {\n    running,   // æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æ•°\n    pending,   // ç­‰å¾…ä¸­çš„ä»»åŠ¡æ•°\n    total: running + pending  // æ€»é˜Ÿåˆ—æ•°\n  }\n}\n```\n\n## ğŸ” å¥åº·æ£€æµ‹ä¼˜åŒ–\n\n### ç®€åŒ–æ—¥å¿—æ¨¡å¼\n- **é»˜è®¤å…³é—­è¯¦ç»†æ—¥å¿—** - å‡å°‘æ§åˆ¶å°å™ªéŸ³\n- **å…³é”®ä¿¡æ¯çªå‡º** - åªæ˜¾ç¤ºæœåŠ¡å™¨å¯ç”¨æ€§å’Œé˜Ÿåˆ—çŠ¶æ€\n- **çŠ¶æ€æ‘˜è¦æ˜¾ç¤º** - ä¸€ç›®äº†ç„¶çš„æ•´ä½“çŠ¶å†µ\n\n### æ—¥å¿—è¾“å‡ºç¤ºä¾‹\n```\nğŸ“Š åŠ è½½äº† 2 ä¸ªæœåŠ¡å™¨\nâœ… æœåŠ¡å™¨çŠ¶æ€: 2/2 å¯ç”¨\n  ğŸ“Š primary: é˜Ÿåˆ—: 1è¿è¡Œ/2ç­‰å¾…\n  ğŸ“Š backup: é˜Ÿåˆ—: ç©ºé—²\nğŸ¯ é€‰æ‹©æœåŠ¡å™¨: https://backup-server.com (é˜Ÿåˆ—: 0)\n```\n\n## ğŸ§ª æµ‹è¯•å·¥å…·\n\n### 1. é˜Ÿåˆ—è´Ÿè½½å‡è¡¡æµ‹è¯•é¡µé¢\n**è®¿é—®åœ°å€**: `http://localhost:3002/test-queue-balancer.html`\n\n**åŠŸèƒ½ç‰¹æ€§**:\n- å¯è§†åŒ–æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º\n- å®æ—¶é˜Ÿåˆ—ä¿¡æ¯ç›‘æ§\n- è´Ÿè½½å‡è¡¡æ•ˆæœæµ‹è¯•\n- è¯¦ç»†æ—¥å¿—å¼€å…³æ§åˆ¶\n\n### 2. æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•\n```javascript\n// åŸºæœ¬åŠŸèƒ½æµ‹è¯•\ntestSimpleLoadBalancer()\n\n// è´Ÿè½½å‡è¡¡æ•ˆæœæµ‹è¯•\ntestLoadBalancing(10)\n\n// å¯ç”¨è¯¦ç»†æ—¥å¿—\nloadBalancer.setVerboseLogging(true)\n```\n\n### 3. æ¨¡æ‹Ÿå¤šæ¬¡è¯·æ±‚æµ‹è¯•\n```javascript\n// æ¨¡æ‹Ÿ10æ¬¡è¯·æ±‚ï¼Œè§‚å¯Ÿè´Ÿè½½åˆ†é…\nfor (let i = 0; i < 10; i++) {\n  const server = await loadBalancer.getOptimalServer()\n  console.log(`ç¬¬${i+1}æ¬¡é€‰æ‹©: ${server}`)\n}\n```\n\n## ğŸ“‹ é…ç½®æ›´æ–°\n\n### 1. ComfyUIé…ç½®å¢å¼º\n**æ–‡ä»¶**: `client/src/config/comfyui.config.js`\n\n**æ–°å¢åŠŸèƒ½**:\n- `parseQueueInfo()` - é˜Ÿåˆ—ä¿¡æ¯è§£æ\n- `parseSystemInfo()` - ç³»ç»Ÿä¿¡æ¯è§£æ\n- å“åº”éªŒè¯å¢å¼º\n\n### 2. è´Ÿè½½å‡è¡¡å™¨é‡æ„\n**æ–‡ä»¶**: `client/src/services/loadBalancer.js`\n\n**ä¸»è¦æ”¹è¿›**:\n- é˜Ÿåˆ—ä¿¡æ¯æ”¶é›†å’Œå­˜å‚¨\n- åŸºäºé˜Ÿåˆ—çš„æœåŠ¡å™¨é€‰æ‹©ç®—æ³•\n- ç®€åŒ–æ—¥å¿—è¾“å‡º\n- è¯¦ç»†æ—¥å¿—å¼€å…³æ§åˆ¶\n\n## ğŸ‰ ä½¿ç”¨æ•ˆæœ\n\n### è´Ÿè½½å‡è¡¡æ•ˆæœ\n- **æ™ºèƒ½åˆ†é…** - è‡ªåŠ¨é€‰æ‹©é˜Ÿåˆ—æœ€å°‘çš„æœåŠ¡å™¨\n- **ä¼˜å…ˆçº§ä¿è¯** - ä¸»æœåŠ¡å™¨ä¼˜å…ˆï¼Œå¤‡ç”¨æœåŠ¡å™¨è¡¥å……\n- **å®æ—¶è°ƒæ•´** - æ ¹æ®é˜Ÿåˆ—å˜åŒ–åŠ¨æ€è°ƒæ•´é€‰æ‹©\n\n### æ—¥å¿—è¾“å‡ºä¼˜åŒ–\n- **ç®€æ´æ˜äº†** - é»˜è®¤åªæ˜¾ç¤ºå…³é”®ä¿¡æ¯\n- **æŒ‰éœ€è¯¦ç»†** - å¯å¯ç”¨è¯¦ç»†æ—¥å¿—è¿›è¡Œè°ƒè¯•\n- **çŠ¶æ€æ¸…æ™°** - æœåŠ¡å™¨çŠ¶æ€å’Œé˜Ÿåˆ—æƒ…å†µä¸€ç›®äº†ç„¶\n\n### ç›‘æ§èƒ½åŠ›\n- **å®æ—¶é˜Ÿåˆ—ç›‘æ§** - æŒç»­è·Ÿè¸ªæ¯ä¸ªæœåŠ¡å™¨çš„é˜Ÿåˆ—çŠ¶å†µ\n- **å¥åº·çŠ¶æ€è·Ÿè¸ª** - è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†æœåŠ¡å™¨æ•…éšœ\n- **æ€§èƒ½æŒ‡æ ‡æ”¶é›†** - æ”¶é›†ç³»ç»Ÿä¿¡æ¯ç”¨äºç›‘æ§åˆ†æ\n\n## ğŸ”„ å·¥ä½œæµç¨‹\n\n1. **åˆå§‹åŒ–** - åŠ è½½æœåŠ¡å™¨åˆ—è¡¨ï¼Œå»ºç«‹è¿æ¥\n2. **å¥åº·æ£€æµ‹** - å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œé˜Ÿåˆ—ä¿¡æ¯\n3. **è´Ÿè½½å‡è¡¡** - æ ¹æ®é˜Ÿåˆ—æƒ…å†µé€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨\n4. **çŠ¶æ€æ›´æ–°** - å®æ—¶æ›´æ–°æœåŠ¡å™¨çŠ¶æ€å’Œé˜Ÿåˆ—ä¿¡æ¯\n5. **æ•…éšœå¤„ç†** - è‡ªåŠ¨åˆ‡æ¢åˆ°å¥åº·çš„å¤‡ç”¨æœåŠ¡å™¨\n\nè¿™ä¸ªåŸºäºé˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡æœºåˆ¶ç¡®ä¿äº†ComfyUIä»»åŠ¡çš„é«˜æ•ˆåˆ†é…å’Œå¤„ç†ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½ã€‚\n"
        }
    ]
}