{
    "sourceFile": "test-api.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1752979517538,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752979534114,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,18 +58,30 @@\n \n // æµ‹è¯•è·å–å¡ç‰‡ç±»å‹\n async function testGetCardTypes(token) {\n   try {\n-    const response = await axios.get('http://localhost:3007/api/admin/card-types', {\n+    const options = {\n+      hostname: 'localhost',\n+      port: 3007,\n+      path: '/api/admin/card-types',\n+      method: 'GET',\n       headers: {\n-        'Authorization': `Bearer ${token}`\n+        'Authorization': `Bearer ${token}`,\n+        'Content-Type': 'application/json'\n       }\n-    });\n+    };\n \n-    console.log('âœ… è·å–å¡ç‰‡ç±»å‹æˆåŠŸ:', response.data.data.cardTypes.length, 'ä¸ªç±»å‹');\n-    return response.data.data.cardTypes;\n+    const response = await makeRequest(options);\n+\n+    if (response.status === 200 && response.data.success) {\n+      console.log('âœ… è·å–å¡ç‰‡ç±»å‹æˆåŠŸ:', response.data.data.cardTypes.length, 'ä¸ªç±»å‹');\n+      return response.data.data.cardTypes;\n+    } else {\n+      console.error('âŒ è·å–å¡ç‰‡ç±»å‹å¤±è´¥:', response.data);\n+      return null;\n+    }\n   } catch (error) {\n-    console.error('âŒ è·å–å¡ç‰‡ç±»å‹å¤±è´¥:', error.response?.data || error.message);\n+    console.error('âŒ è·å–å¡ç‰‡ç±»å‹å¤±è´¥:', error.message);\n     return null;\n   }\n }\n \n"
                },
                {
                    "date": 1752979550631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,22 +87,34 @@\n \n // æµ‹è¯•ç”Ÿæˆç­‰çº§å¡\n async function testGenerateCards(token, cardTypeId) {\n   try {\n-    const response = await axios.post('http://localhost:3007/api/admin/generate-cards', {\n+    const options = {\n+      hostname: 'localhost',\n+      port: 3007,\n+      path: '/api/admin/generate-cards',\n+      method: 'POST',\n+      headers: {\n+        'Authorization': `Bearer ${token}`,\n+        'Content-Type': 'application/json'\n+      }\n+    };\n+\n+    const response = await makeRequest(options, {\n       cardTypeId: cardTypeId,\n       count: 2\n-    }, {\n-      headers: {\n-        'Authorization': `Bearer ${token}`\n-      }\n     });\n \n-    console.log('âœ… ç”Ÿæˆç­‰çº§å¡æˆåŠŸ:', response.data.message);\n-    console.log('ğŸ“Š ç”Ÿæˆçš„å¡ç‰‡:', response.data.data.cards);\n-    return true;\n+    if (response.status === 200 && response.data.success) {\n+      console.log('âœ… ç”Ÿæˆç­‰çº§å¡æˆåŠŸ:', response.data.message);\n+      console.log('ğŸ“Š ç”Ÿæˆçš„å¡ç‰‡:', response.data.data.cards);\n+      return true;\n+    } else {\n+      console.error('âŒ ç”Ÿæˆç­‰çº§å¡å¤±è´¥:', response.data);\n+      return false;\n+    }\n   } catch (error) {\n-    console.error('âŒ ç”Ÿæˆç­‰çº§å¡å¤±è´¥:', error.response?.data || error.message);\n+    console.error('âŒ ç”Ÿæˆç­‰çº§å¡å¤±è´¥:', error.message);\n     return false;\n   }\n }\n \n"
                }
            ],
            "date": 1752979517538,
            "name": "Commit-0",
            "content": "const http = require('http');\n\n// HTTPè¯·æ±‚è¾…åŠ©å‡½æ•°\nfunction makeRequest(options, data = null) {\n  return new Promise((resolve, reject) => {\n    const req = http.request(options, (res) => {\n      let body = '';\n      res.on('data', (chunk) => body += chunk);\n      res.on('end', () => {\n        try {\n          const parsed = JSON.parse(body);\n          resolve({ status: res.statusCode, data: parsed });\n        } catch (e) {\n          resolve({ status: res.statusCode, data: body });\n        }\n      });\n    });\n\n    req.on('error', reject);\n\n    if (data) {\n      req.write(JSON.stringify(data));\n    }\n    req.end();\n  });\n}\n\n// æµ‹è¯•ç®¡ç†å‘˜ç™»å½•\nasync function testAdminLogin() {\n  try {\n    const options = {\n      hostname: 'localhost',\n      port: 3007,\n      path: '/api/admin-auth/login',\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n\n    const response = await makeRequest(options, {\n      username: 'admin',\n      password: 'admin123'\n    });\n\n    if (response.status === 200 && response.data.success) {\n      console.log('âœ… ç™»å½•æˆåŠŸ');\n      return response.data.data.token;\n    } else {\n      console.error('âŒ ç™»å½•å¤±è´¥:', response.data);\n      return null;\n    }\n  } catch (error) {\n    console.error('âŒ ç™»å½•å¤±è´¥:', error.message);\n    return null;\n  }\n}\n\n// æµ‹è¯•è·å–å¡ç‰‡ç±»å‹\nasync function testGetCardTypes(token) {\n  try {\n    const response = await axios.get('http://localhost:3007/api/admin/card-types', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    console.log('âœ… è·å–å¡ç‰‡ç±»å‹æˆåŠŸ:', response.data.data.cardTypes.length, 'ä¸ªç±»å‹');\n    return response.data.data.cardTypes;\n  } catch (error) {\n    console.error('âŒ è·å–å¡ç‰‡ç±»å‹å¤±è´¥:', error.response?.data || error.message);\n    return null;\n  }\n}\n\n// æµ‹è¯•ç”Ÿæˆç­‰çº§å¡\nasync function testGenerateCards(token, cardTypeId) {\n  try {\n    const response = await axios.post('http://localhost:3007/api/admin/generate-cards', {\n      cardTypeId: cardTypeId,\n      count: 2\n    }, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    console.log('âœ… ç”Ÿæˆç­‰çº§å¡æˆåŠŸ:', response.data.message);\n    console.log('ğŸ“Š ç”Ÿæˆçš„å¡ç‰‡:', response.data.data.cards);\n    return true;\n  } catch (error) {\n    console.error('âŒ ç”Ÿæˆç­‰çº§å¡å¤±è´¥:', error.response?.data || error.message);\n    return false;\n  }\n}\n\n// ä¸»æµ‹è¯•å‡½æ•°\nasync function runTests() {\n  console.log('ğŸš€ å¼€å§‹æµ‹è¯•APIæ¥å£...\\n');\n\n  // 1. æµ‹è¯•ç™»å½•\n  console.log('1. æµ‹è¯•ç®¡ç†å‘˜ç™»å½•...');\n  const token = await testAdminLogin();\n  if (!token) {\n    console.log('âŒ æ— æ³•è·å–ä»¤ç‰Œï¼Œåœæ­¢æµ‹è¯•');\n    return;\n  }\n  console.log('');\n\n  // 2. æµ‹è¯•è·å–å¡ç‰‡ç±»å‹\n  console.log('2. æµ‹è¯•è·å–å¡ç‰‡ç±»å‹...');\n  const cardTypes = await testGetCardTypes(token);\n  if (!cardTypes || cardTypes.length === 0) {\n    console.log('âŒ æ— æ³•è·å–å¡ç‰‡ç±»å‹ï¼Œåœæ­¢æµ‹è¯•');\n    return;\n  }\n  console.log('');\n\n  // 3. æµ‹è¯•ç”Ÿæˆç­‰çº§å¡\n  console.log('3. æµ‹è¯•ç”Ÿæˆç­‰çº§å¡...');\n  const firstCardType = cardTypes[0];\n  console.log(`ä½¿ç”¨å¡ç‰‡ç±»å‹: ${firstCardType.name} (ID: ${firstCardType.id})`);\n  const success = await testGenerateCards(token, firstCardType.id);\n  console.log('');\n\n  if (success) {\n    console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç­‰çº§å¡ç”ŸæˆåŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚');\n  } else {\n    console.log('âŒ æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•ã€‚');\n  }\n}\n\n// è¿è¡Œæµ‹è¯•\nrunTests().catch(console.error);\n"
        }
    ]
}