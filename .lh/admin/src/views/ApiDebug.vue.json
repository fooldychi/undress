{
    "sourceFile": "admin/src/views/ApiDebug.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752405758207,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752405786690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -169,8 +169,60 @@\n     testing.value = false\n   }\n }\n \n+// æµ‹è¯•ä»£ç†\n+const testProxy = async () => {\n+  testing.value = true\n+  try {\n+    console.log('ğŸ”— æµ‹è¯•ä»£ç†é…ç½®...')\n+\n+    // æµ‹è¯•å¤šä¸ªç«¯ç‚¹\n+    const endpoints = [\n+      '/api/health',\n+      '/api/admin-auth/login',\n+      '/api/admin/config'\n+    ]\n+\n+    const results = []\n+\n+    for (const endpoint of endpoints) {\n+      try {\n+        console.log(`ğŸ§ª æµ‹è¯•ç«¯ç‚¹: ${endpoint}`)\n+\n+        const response = await fetch(endpoint, {\n+          method: 'GET',\n+          headers: {\n+            'Content-Type': 'application/json'\n+          }\n+        })\n+\n+        console.log(`ğŸ“Š ${endpoint} å“åº”çŠ¶æ€:`, response.status)\n+\n+        results.push({\n+          endpoint,\n+          status: response.status,\n+          ok: response.ok,\n+          url: response.url\n+        })\n+      } catch (error) {\n+        console.error(`âŒ ${endpoint} æµ‹è¯•å¤±è´¥:`, error)\n+        results.push({\n+          endpoint,\n+          error: error.message\n+        })\n+      }\n+    }\n+\n+    testResult.value = { type: 'proxy', success: true, results }\n+  } catch (error) {\n+    console.error('âŒ ä»£ç†æµ‹è¯•å¤±è´¥:', error)\n+    testResult.value = { type: 'proxy', success: false, error: error.message, details: error }\n+  } finally {\n+    testing.value = false\n+  }\n+}\n+\n onMounted(() => {\n   checkAuth()\n   baseURL.value = request.defaults.baseURL || 'æœªè®¾ç½®'\n })\n"
                }
            ],
            "date": 1752405758207,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"api-debug-page\">\n    <h1>APIè°ƒè¯•é¡µé¢</h1>\n\n    <el-card style=\"margin-bottom: 20px;\">\n      <template #header>\n        <span>è®¤è¯çŠ¶æ€</span>\n      </template>\n      <div>\n        <p><strong>Token:</strong> {{ authToken || 'æœªæ‰¾åˆ°' }}</p>\n        <p><strong>ç”¨æˆ·:</strong> {{ userInfo ? JSON.stringify(userInfo) : 'æœªç™»å½•' }}</p>\n        <el-button @click=\"checkAuth\">åˆ·æ–°è®¤è¯çŠ¶æ€</el-button>\n        <el-button @click=\"forceLogin\" type=\"primary\">å¼ºåˆ¶ç™»å½•</el-button>\n      </div>\n    </el-card>\n\n    <el-card style=\"margin-bottom: 20px;\">\n      <template #header>\n        <span>APIæµ‹è¯•</span>\n      </template>\n      <div>\n        <el-button @click=\"testGetConfig\" :loading=\"testing\">æµ‹è¯•è·å–é…ç½®</el-button>\n        <el-button @click=\"testSaveConfig\" :loading=\"testing\">æµ‹è¯•ä¿å­˜é…ç½®</el-button>\n        <el-button @click=\"testDirectFetch\" :loading=\"testing\">ç›´æ¥Fetchæµ‹è¯•</el-button>\n        <el-button @click=\"testProxy\" :loading=\"testing\">æµ‹è¯•ä»£ç†</el-button>\n      </div>\n\n      <div v-if=\"testResult\" style=\"margin-top: 20px;\">\n        <h3>æµ‹è¯•ç»“æœ:</h3>\n        <pre style=\"background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;\">{{ JSON.stringify(testResult, null, 2) }}</pre>\n      </div>\n    </el-card>\n\n    <el-card>\n      <template #header>\n        <span>ç½‘ç»œä¿¡æ¯</span>\n      </template>\n      <div>\n        <p><strong>å½“å‰URL:</strong> {{ window.location.href }}</p>\n        <p><strong>Base URL:</strong> {{ baseURL }}</p>\n        <p><strong>API Base:</strong> /api</p>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getToken, getUser, setToken, setUser } from '@/utils/auth'\nimport { getSystemConfig, saveSystemConfig } from '@/api/config'\nimport request from '@/utils/request'\n\nconst authToken = ref('')\nconst userInfo = ref(null)\nconst testing = ref(false)\nconst testResult = ref(null)\nconst baseURL = ref('')\n\n// æ£€æŸ¥è®¤è¯çŠ¶æ€\nconst checkAuth = () => {\n  authToken.value = getToken()\n  userInfo.value = getUser()\n  console.log('ğŸ”‘ è®¤è¯çŠ¶æ€:', { token: authToken.value, user: userInfo.value })\n}\n\n// å¼ºåˆ¶ç™»å½•\nconst forceLogin = async () => {\n  try {\n    console.log('ğŸ” å¼ºåˆ¶ç™»å½•...')\n    const response = await request({\n      url: '/admin-auth/login',\n      method: 'post',\n      data: {\n        username: 'admin',\n        password: 'admin123456'\n      }\n    })\n\n    if (response.success) {\n      setToken(response.data.token)\n      setUser(response.data.admin)\n      checkAuth()\n      testResult.value = { type: 'login', success: true, data: response }\n    } else {\n      testResult.value = { type: 'login', success: false, error: response.message }\n    }\n  } catch (error) {\n    console.error('âŒ å¼ºåˆ¶ç™»å½•å¤±è´¥:', error)\n    testResult.value = { type: 'login', success: false, error: error.message, details: error }\n  }\n}\n\n// æµ‹è¯•è·å–é…ç½®\nconst testGetConfig = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ” æµ‹è¯•è·å–é…ç½®...')\n    const response = await getSystemConfig()\n    console.log('ğŸ“Š è·å–é…ç½®å“åº”:', response)\n    testResult.value = { type: 'getConfig', success: true, data: response }\n  } catch (error) {\n    console.error('âŒ è·å–é…ç½®å¤±è´¥:', error)\n    testResult.value = { type: 'getConfig', success: false, error: error.message, details: error }\n  } finally {\n    testing.value = false\n  }\n}\n\n// æµ‹è¯•ä¿å­˜é…ç½®\nconst testSaveConfig = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ’¾ æµ‹è¯•ä¿å­˜é…ç½®...')\n\n    const configs = [\n      {\n        config_key: 'comfyui.server_url',\n        config_value: 'https://l6ur4u3zbw-8188.cnb.run/',\n        config_type: 'string',\n        config_group: 'comfyui'\n      }\n    ]\n\n    console.log('ğŸ“‹ è¦ä¿å­˜çš„é…ç½®:', configs)\n    const response = await saveSystemConfig(configs)\n    console.log('ğŸ“Š ä¿å­˜é…ç½®å“åº”:', response)\n    testResult.value = { type: 'saveConfig', success: true, data: response }\n  } catch (error) {\n    console.error('âŒ ä¿å­˜é…ç½®å¤±è´¥:', error)\n    testResult.value = { type: 'saveConfig', success: false, error: error.message, details: error }\n  } finally {\n    testing.value = false\n  }\n}\n\n// ç›´æ¥Fetchæµ‹è¯•\nconst testDirectFetch = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ§ª ç›´æ¥Fetchæµ‹è¯•...')\n\n    const token = getToken()\n    console.log('ğŸ”‘ ä½¿ç”¨Token:', token)\n\n    const response = await fetch('/api/admin/config', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      }\n    })\n\n    console.log('ğŸ“Š Fetchå“åº”çŠ¶æ€:', response.status)\n    console.log('ğŸ“Š Fetchå“åº”å¤´:', Object.fromEntries(response.headers.entries()))\n\n    if (response.ok) {\n      const data = await response.json()\n      console.log('ğŸ“‹ Fetchå“åº”æ•°æ®:', data)\n      testResult.value = { type: 'directFetch', success: true, status: response.status, data }\n    } else {\n      const errorText = await response.text()\n      console.log('âŒ Fetchå“åº”é”™è¯¯:', errorText)\n      testResult.value = { type: 'directFetch', success: false, status: response.status, error: errorText }\n    }\n  } catch (error) {\n    console.error('âŒ ç›´æ¥Fetchå¤±è´¥:', error)\n    testResult.value = { type: 'directFetch', success: false, error: error.message, details: error }\n  } finally {\n    testing.value = false\n  }\n}\n\nonMounted(() => {\n  checkAuth()\n  baseURL.value = request.defaults.baseURL || 'æœªè®¾ç½®'\n})\n</script>\n\n<style scoped>\n.api-debug-page {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\npre {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  max-height: 400px;\n  overflow-y: auto;\n}\n</style>\n"
        }
    ]
}