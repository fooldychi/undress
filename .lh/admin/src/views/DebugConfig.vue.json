{
    "sourceFile": "admin/src/views/DebugConfig.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752403125147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752403125147,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"debug-config-page\">\n    <h1>é…ç½®è°ƒè¯•é¡µé¢</h1>\n\n    <el-card style=\"margin-bottom: 20px;\">\n      <template #header>\n        <span>è®¤è¯çŠ¶æ€æ£€æŸ¥</span>\n      </template>\n      <div>\n        <p><strong>Token:</strong> {{ authToken || 'æœªæ‰¾åˆ°' }}</p>\n        <p><strong>ç”¨æˆ·ä¿¡æ¯:</strong> {{ userInfo ? JSON.stringify(userInfo) : 'æœªæ‰¾åˆ°' }}</p>\n        <el-button @click=\"checkAuth\">åˆ·æ–°è®¤è¯çŠ¶æ€</el-button>\n        <el-button @click=\"forceLogin\" type=\"primary\">å¼ºåˆ¶ç™»å½•</el-button>\n      </div>\n    </el-card>\n\n    <el-card style=\"margin-bottom: 20px;\">\n      <template #header>\n        <span>APIè°ƒç”¨æµ‹è¯•</span>\n      </template>\n      <div>\n        <el-button @click=\"testDirectAPI\" :loading=\"testing\">ç›´æ¥è°ƒç”¨API</el-button>\n        <el-button @click=\"testVueAPI\" :loading=\"testing\">é€šè¿‡Vue APIè°ƒç”¨</el-button>\n        <el-button @click=\"testWithAuth\" :loading=\"testing\">å¸¦è®¤è¯è°ƒç”¨</el-button>\n      </div>\n\n      <div v-if=\"apiResult\" style=\"margin-top: 20px;\">\n        <h3>APIè°ƒç”¨ç»“æœ:</h3>\n        <pre style=\"background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;\">{{ JSON.stringify(apiResult, null, 2) }}</pre>\n      </div>\n    </el-card>\n\n    <el-card>\n      <template #header>\n        <span>é…ç½®æ•°æ®å¤„ç†æµ‹è¯•</span>\n      </template>\n      <div>\n        <el-button @click=\"testDataProcessing\" :loading=\"processing\">æµ‹è¯•æ•°æ®å¤„ç†</el-button>\n      </div>\n\n      <div v-if=\"processedData\" style=\"margin-top: 20px;\">\n        <h3>å¤„ç†åçš„é…ç½®æ•°æ®:</h3>\n        <div v-for=\"(value, key) in processedData\" :key=\"key\" style=\"margin: 5px 0;\">\n          <strong>{{ key }}:</strong> {{ value }}\n        </div>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getToken, getUser } from '@/utils/auth'\nimport { getSystemConfig } from '@/api/config'\nimport request from '@/utils/request'\n\nconst authToken = ref('')\nconst userInfo = ref(null)\nconst testing = ref(false)\nconst processing = ref(false)\nconst apiResult = ref(null)\nconst processedData = ref(null)\n\n// æ£€æŸ¥è®¤è¯çŠ¶æ€\nconst checkAuth = () => {\n  authToken.value = getToken()\n  userInfo.value = getUser()\n  console.log('ğŸ”‘ è®¤è¯çŠ¶æ€:', { token: authToken.value, user: userInfo.value })\n}\n\n// å¼ºåˆ¶ç™»å½•\nconst forceLogin = async () => {\n  try {\n    const response = await request({\n      url: '/admin-auth/login',\n      method: 'post',\n      data: {\n        username: 'admin',\n        password: 'admin123456'\n      }\n    })\n\n    console.log('ğŸ” ç™»å½•å“åº”:', response)\n\n    if (response.success) {\n      // åˆ·æ–°é¡µé¢ä»¥æ›´æ–°è®¤è¯çŠ¶æ€\n      window.location.reload()\n    }\n  } catch (error) {\n    console.error('âŒ ç™»å½•å¤±è´¥:', error)\n  }\n}\n\n// ç›´æ¥è°ƒç”¨API\nconst testDirectAPI = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ“¡ ç›´æ¥è°ƒç”¨API...')\n    console.log('ğŸ”‘ ä½¿ç”¨Token:', authToken.value)\n\n    const response = await fetch('/api/admin/config', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${authToken.value}`\n      }\n    })\n\n    console.log('ğŸ“Š å“åº”çŠ¶æ€:', response.status)\n    console.log('ğŸ“Š å“åº”å¤´:', Object.fromEntries(response.headers.entries()))\n\n    const data = await response.json()\n    console.log('ğŸ“Š ç›´æ¥APIå“åº”:', data)\n    apiResult.value = {\n      status: response.status,\n      headers: Object.fromEntries(response.headers.entries()),\n      data: data\n    }\n\n  } catch (error) {\n    console.error('âŒ ç›´æ¥APIè°ƒç”¨å¤±è´¥:', error)\n    apiResult.value = { error: error.message }\n  } finally {\n    testing.value = false\n  }\n}\n\n// é€šè¿‡Vue APIè°ƒç”¨\nconst testVueAPI = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ“¡ é€šè¿‡Vue APIè°ƒç”¨...')\n\n    const response = await getSystemConfig()\n    console.log('ğŸ“Š Vue APIå“åº”:', response)\n    apiResult.value = response\n\n  } catch (error) {\n    console.error('âŒ Vue APIè°ƒç”¨å¤±è´¥:', error)\n    apiResult.value = { error: error.message }\n  } finally {\n    testing.value = false\n  }\n}\n\n// å¸¦è®¤è¯è°ƒç”¨\nconst testWithAuth = async () => {\n  testing.value = true\n  try {\n    console.log('ğŸ“¡ å¸¦è®¤è¯è°ƒç”¨API...')\n\n    const response = await request({\n      url: '/admin/config',\n      method: 'get'\n    })\n\n    console.log('ğŸ“Š å¸¦è®¤è¯APIå“åº”:', response)\n    apiResult.value = response\n\n  } catch (error) {\n    console.error('âŒ å¸¦è®¤è¯APIè°ƒç”¨å¤±è´¥:', error)\n    apiResult.value = { error: error.message }\n  } finally {\n    testing.value = false\n  }\n}\n\n// æµ‹è¯•æ•°æ®å¤„ç†\nconst testDataProcessing = async () => {\n  processing.value = true\n  try {\n    console.log('ğŸ”„ æµ‹è¯•æ•°æ®å¤„ç†...')\n\n    // å…ˆè·å–æ•°æ®\n    const response = await getSystemConfig()\n    console.log('ğŸ“Š åŸå§‹æ•°æ®:', response)\n\n    if (response.success && response.data) {\n      const configData = response.data\n\n      // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n      const flatConfig = {}\n\n      // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n      Object.keys(configData).forEach(groupName => {\n        const groupConfigs = configData[groupName]\n        if (Array.isArray(groupConfigs)) {\n          groupConfigs.forEach(item => {\n            flatConfig[item.config_key] = item.config_value\n          })\n        }\n      })\n\n      // åªæ˜¾ç¤ºComfyUIé…ç½®\n      const comfyuiConfig = {}\n      Object.keys(flatConfig).filter(key => key.startsWith('comfyui.')).forEach(key => {\n        comfyuiConfig[key] = flatConfig[key]\n      })\n\n      console.log('ğŸ”§ å¤„ç†åçš„ComfyUIé…ç½®:', comfyuiConfig)\n      processedData.value = comfyuiConfig\n    }\n\n  } catch (error) {\n    console.error('âŒ æ•°æ®å¤„ç†å¤±è´¥:', error)\n    processedData.value = { error: error.message }\n  } finally {\n    processing.value = false\n  }\n}\n\nonMounted(() => {\n  checkAuth()\n})\n</script>\n\n<style scoped>\n.debug-config-page {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\npre {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n  max-height: 400px;\n  overflow-y: auto;\n}\n</style>\n"
        }
    ]
}