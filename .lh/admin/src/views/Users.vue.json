{
    "sourceFile": "admin/src/views/Users.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1752314123169,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752314185061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -173,51 +173,22 @@\n // 加载用户列表\n const loadUsers = async () => {\n   loading.value = true\n   try {\n-    // const params = {\n-    //   page: pagination.page,\n-    //   size: pagination.size,\n-    //   ...searchForm,\n-    //   ...sortInfo\n-    // }\n-    // const response = await getUserList(params)\n-    // if (response.success) {\n-    //   userList.value = response.data.list\n-    //   pagination.total = response.data.total\n-    // }\n-\n-    // 模拟数据\n-    userList.value = [\n-      {\n-        id: 1,\n-        username: 'user001',\n-        email: 'user001@example.com',\n-        points: 1500,\n-        status: 'active',\n-        created_at: '2024-01-15T10:30:00Z',\n-        last_login: '2024-01-20T15:45:00Z'\n-      },\n-      {\n-        id: 2,\n-        username: 'user002',\n-        email: 'user002@example.com',\n-        points: 800,\n-        status: 'active',\n-        created_at: '2024-01-16T09:20:00Z',\n-        last_login: '2024-01-19T14:30:00Z'\n-      },\n-      {\n-        id: 3,\n-        username: 'user003',\n-        email: 'user003@example.com',\n-        points: 0,\n-        status: 'inactive',\n-        created_at: '2024-01-17T11:15:00Z',\n-        last_login: null\n-      }\n-    ]\n-    pagination.total = 3\n+    const params = {\n+      page: pagination.page,\n+      pageSize: pagination.size,\n+      search: searchForm.username || searchForm.email,\n+      status: searchForm.status\n+    }\n+    const response = await getUserList(params)\n+    if (response.success) {\n+      userList.value = response.data.items.map(user => ({\n+        ...user,\n+        points: user.total_points || 0\n+      }))\n+      pagination.total = response.data.total\n+    }\n   } catch (error) {\n     console.error('加载用户列表失败:', error)\n     ElMessage.error('加载用户列表失败')\n   } finally {\n"
                },
                {
                    "date": 1752316875626,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,13 +251,13 @@\n         type: 'warning'\n       }\n     )\n \n-    // const newStatus = user.status === 'active' ? 'inactive' : 'active'\n-    // await updateUserStatus(user.id, newStatus)\n+    const newStatus = user.status === 'active' ? 'inactive' : 'active'\n+    await updateUserStatus(user.id, newStatus)\n \n-    // 模拟更新\n-    user.status = user.status === 'active' ? 'inactive' : 'active'\n+    // 更新本地状态\n+    user.status = newStatus\n \n     ElMessage.success(`${action}成功`)\n   } catch (error) {\n     if (error !== 'cancel') {\n"
                },
                {
                    "date": 1752320407788,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,9 +251,9 @@\n         type: 'warning'\n       }\n     )\n \n-    const newStatus = user.status === 'active' ? 'inactive' : 'active'\n+    const newStatus = user.status === 'active' ? 'banned' : 'active'\n     await updateUserStatus(user.id, newStatus)\n \n     // 更新本地状态\n     user.status = newStatus\n@@ -329,4 +329,5 @@\n     margin-bottom: 16px;\n   }\n }\n </style>\n+\n"
                }
            ],
            "date": 1752314123169,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"users-page\">\n    <div class=\"page-header\">\n      <h1 class=\"page-title\">用户管理</h1>\n      <div class=\"page-actions\">\n        <el-button type=\"primary\" @click=\"loadUsers\">\n          <el-icon><Refresh /></el-icon>\n          刷新\n        </el-button>\n      </div>\n    </div>\n\n    <!-- 搜索筛选 -->\n    <el-card class=\"search-card\">\n      <el-form :model=\"searchForm\" inline>\n        <el-form-item label=\"用户名\">\n          <el-input\n            v-model=\"searchForm.username\"\n            placeholder=\"请输入用户名\"\n            clearable\n            @keyup.enter=\"handleSearch\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"邮箱\">\n          <el-input\n            v-model=\"searchForm.email\"\n            placeholder=\"请输入邮箱\"\n            clearable\n            @keyup.enter=\"handleSearch\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"状态\">\n          <el-select v-model=\"searchForm.status\" placeholder=\"请选择状态\" clearable>\n            <el-option label=\"全部\" value=\"\" />\n            <el-option label=\"正常\" value=\"active\" />\n            <el-option label=\"禁用\" value=\"inactive\" />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">\n            <el-icon><Search /></el-icon>\n            搜索\n          </el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n\n    <!-- 用户列表 -->\n    <el-card class=\"table-card\">\n      <el-table\n        v-loading=\"loading\"\n        :data=\"userList\"\n        class=\"admin-table\"\n        @sort-change=\"handleSortChange\"\n      >\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" sortable=\"custom\" />\n\n        <el-table-column prop=\"username\" label=\"用户名\" min-width=\"120\">\n          <template #default=\"{ row }\">\n            <el-link type=\"primary\" @click=\"viewUserDetail(row.id)\">\n              {{ row.username }}\n            </el-link>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"email\" label=\"邮箱\" min-width=\"180\" />\n\n        <el-table-column prop=\"points\" label=\"积分\" width=\"100\" sortable=\"custom\">\n          <template #default=\"{ row }\">\n            <el-tag type=\"warning\">{{ row.points || 0 }}</el-tag>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\n          <template #default=\"{ row }\">\n            <el-tag :type=\"row.status === 'active' ? 'success' : 'danger'\">\n              {{ row.status === 'active' ? '正常' : '禁用' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"created_at\" label=\"注册时间\" width=\"180\" sortable=\"custom\">\n          <template #default=\"{ row }\">\n            {{ formatDate(row.created_at) }}\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"last_login\" label=\"最后登录\" width=\"180\">\n          <template #default=\"{ row }\">\n            {{ row.last_login ? formatDate(row.last_login) : '从未登录' }}\n          </template>\n        </el-table-column>\n\n        <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\n          <template #default=\"{ row }\">\n            <el-button\n              type=\"text\"\n              size=\"small\"\n              @click=\"viewUserDetail(row.id)\"\n            >\n              查看\n            </el-button>\n            <el-button\n              type=\"text\"\n              size=\"small\"\n              :class=\"row.status === 'active' ? 'danger' : 'success'\"\n              @click=\"toggleUserStatus(row)\"\n            >\n              {{ row.status === 'active' ? '禁用' : '启用' }}\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <!-- 分页 -->\n      <div class=\"pagination-container\">\n        <el-pagination\n          v-model:current-page=\"pagination.page\"\n          v-model:page-size=\"pagination.size\"\n          :total=\"pagination.total\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { getUserList, updateUserStatus } from '@/api/users'\n\nconst router = useRouter()\nconst loading = ref(false)\n\n// 搜索表单\nconst searchForm = reactive({\n  username: '',\n  email: '',\n  status: ''\n})\n\n// 分页信息\nconst pagination = reactive({\n  page: 1,\n  size: 20,\n  total: 0\n})\n\n// 排序信息\nconst sortInfo = reactive({\n  prop: '',\n  order: ''\n})\n\n// 用户列表\nconst userList = ref([])\n\n// 格式化日期\nconst formatDate = (date) => {\n  if (!date) return ''\n  return new Date(date).toLocaleString()\n}\n\n// 加载用户列表\nconst loadUsers = async () => {\n  loading.value = true\n  try {\n    // const params = {\n    //   page: pagination.page,\n    //   size: pagination.size,\n    //   ...searchForm,\n    //   ...sortInfo\n    // }\n    // const response = await getUserList(params)\n    // if (response.success) {\n    //   userList.value = response.data.list\n    //   pagination.total = response.data.total\n    // }\n\n    // 模拟数据\n    userList.value = [\n      {\n        id: 1,\n        username: 'user001',\n        email: 'user001@example.com',\n        points: 1500,\n        status: 'active',\n        created_at: '2024-01-15T10:30:00Z',\n        last_login: '2024-01-20T15:45:00Z'\n      },\n      {\n        id: 2,\n        username: 'user002',\n        email: 'user002@example.com',\n        points: 800,\n        status: 'active',\n        created_at: '2024-01-16T09:20:00Z',\n        last_login: '2024-01-19T14:30:00Z'\n      },\n      {\n        id: 3,\n        username: 'user003',\n        email: 'user003@example.com',\n        points: 0,\n        status: 'inactive',\n        created_at: '2024-01-17T11:15:00Z',\n        last_login: null\n      }\n    ]\n    pagination.total = 3\n  } catch (error) {\n    console.error('加载用户列表失败:', error)\n    ElMessage.error('加载用户列表失败')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 搜索\nconst handleSearch = () => {\n  pagination.page = 1\n  loadUsers()\n}\n\n// 重置搜索\nconst resetSearch = () => {\n  Object.assign(searchForm, {\n    username: '',\n    email: '',\n    status: ''\n  })\n  pagination.page = 1\n  loadUsers()\n}\n\n// 排序变化\nconst handleSortChange = ({ prop, order }) => {\n  sortInfo.prop = prop\n  sortInfo.order = order\n  loadUsers()\n}\n\n// 分页大小变化\nconst handleSizeChange = (size) => {\n  pagination.size = size\n  pagination.page = 1\n  loadUsers()\n}\n\n// 当前页变化\nconst handleCurrentChange = (page) => {\n  pagination.page = page\n  loadUsers()\n}\n\n// 查看用户详情\nconst viewUserDetail = (id) => {\n  router.push(`/users/${id}`)\n}\n\n// 切换用户状态\nconst toggleUserStatus = async (user) => {\n  const action = user.status === 'active' ? '禁用' : '启用'\n  try {\n    await ElMessageBox.confirm(\n      `确定要${action}用户 \"${user.username}\" 吗？`,\n      '确认操作',\n      {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }\n    )\n\n    // const newStatus = user.status === 'active' ? 'inactive' : 'active'\n    // await updateUserStatus(user.id, newStatus)\n\n    // 模拟更新\n    user.status = user.status === 'active' ? 'inactive' : 'active'\n\n    ElMessage.success(`${action}成功`)\n  } catch (error) {\n    if (error !== 'cancel') {\n      console.error('更新用户状态失败:', error)\n      ElMessage.error(`${action}失败`)\n    }\n  }\n}\n\nonMounted(() => {\n  loadUsers()\n})\n</script>\n\n<style scoped>\n.users-page {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.page-title {\n  font-size: 24px;\n  font-weight: 600;\n  color: #303133;\n  margin: 0;\n}\n\n.search-card {\n  margin-bottom: 20px;\n}\n\n.table-card {\n  .el-table {\n    margin-bottom: 20px;\n  }\n}\n\n.pagination-container {\n  display: flex;\n  justify-content: center;\n  padding: 20px 0;\n}\n\n.el-button.danger {\n  color: #f56c6c;\n}\n\n.el-button.success {\n  color: #67c23a;\n}\n\n@media (max-width: 768px) {\n  .page-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 16px;\n  }\n\n  .el-form--inline .el-form-item {\n    display: block;\n    margin-right: 0;\n    margin-bottom: 16px;\n  }\n}\n</style>\n"
        }
    ]
}