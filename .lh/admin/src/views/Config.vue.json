{
    "sourceFile": "admin/src/views/Config.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 38,
            "patches": [
                {
                    "date": 1752325471997,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752325524355,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -121,23 +121,196 @@\n   </div>\n </template>\n \n <script setup>\n-import { reactive } from 'vue'\n-import { ElMessage } from 'element-plus'\n+import { ref, reactive, onMounted } from 'vue'\n+import { ElMessage, ElMessageBox } from 'element-plus'\n+import { Check, Connection } from '@element-plus/icons-vue'\n+import { getSystemConfig, saveSystemConfig } from '@/api/config'\n \n+const loading = ref(false)\n+const saving = ref(false)\n+const testing = ref(false)\n+const configForm = ref(null)\n+const connectionStatus = ref(null)\n+\n+// é…ç½®æ•°æ®\n const config = reactive({\n-  systemName: 'iComfy AIå›¾åƒå¤„ç†å¹³å°',\n-  systemDesc: 'ä¸“ä¸šçš„AIå›¾åƒå¤„ç†æœåŠ¡å¹³å°',\n-  defaultPoints: 100,\n-  faceSwapEnabled: true,\n-  clothingSwapEnabled: true,\n-  textToImageEnabled: true\n+  serverUrl: '',\n+  backupServers: '',\n+  requestTimeout: 30000,\n+  healthCheckTimeout: 10000,\n+  autoSwitch: true,\n+  clientId: '',\n+  maxRetries: 3\n })\n \n-const saveConfig = () => {\n-  ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ')\n+// è¡¨å•éªŒè¯è§„åˆ™\n+const rules = {\n+  serverUrl: [\n+    { required: true, message: 'è¯·è¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€', trigger: 'blur' },\n+    {\n+      pattern: /^https?:\\/\\/.+/,\n+      message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€',\n+      trigger: 'blur'\n+    }\n+  ],\n+  requestTimeout: [\n+    { required: true, message: 'è¯·è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´', trigger: 'blur' },\n+    {\n+      type: 'number',\n+      min: 5000,\n+      max: 600000,\n+      message: 'è¯·æ±‚è¶…æ—¶æ—¶é—´åº”åœ¨5000-600000æ¯«ç§’ä¹‹é—´',\n+      trigger: 'blur'\n+    }\n+  ],\n+  healthCheckTimeout: [\n+    { required: true, message: 'è¯·è®¾ç½®å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´', trigger: 'blur' },\n+    {\n+      type: 'number',\n+      min: 1000,\n+      max: 30000,\n+      message: 'å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´åº”åœ¨1000-30000æ¯«ç§’ä¹‹é—´',\n+      trigger: 'blur'\n+    }\n+  ]\n }\n+\n+// åŠ è½½é…ç½®\n+const loadConfig = async () => {\n+  loading.value = true\n+  try {\n+    const response = await getSystemConfig()\n+    if (response.success && response.data) {\n+      const configData = response.data\n+\n+      // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n+      config.serverUrl = configData['comfyui.server_url'] || ''\n+      config.backupServers = configData['comfyui.backup_servers'] || ''\n+      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n+      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n+      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n+      config.clientId = configData['comfyui.client_id'] || ''\n+      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n+\n+      ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n+    }\n+  } catch (error) {\n+    console.error('åŠ è½½é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')\n+  } finally {\n+    loading.value = false\n+  }\n+}\n+\n+// ä¿å­˜é…ç½®\n+const saveConfig = async () => {\n+  if (!configForm.value) return\n+\n+  try {\n+    await configForm.value.validate()\n+  } catch (error) {\n+    ElMessage.warning('è¯·æ£€æŸ¥è¡¨å•è¾“å…¥')\n+    return\n+  }\n+\n+  saving.value = true\n+  try {\n+    // æ„å»ºé…ç½®æ•°æ®\n+    const configs = [\n+      {\n+        config_key: 'comfyui.server_url',\n+        config_value: config.serverUrl,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.backup_servers',\n+        config_value: config.backupServers,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.request_timeout',\n+        config_value: config.requestTimeout.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.health_check_timeout',\n+        config_value: config.healthCheckTimeout.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.auto_switch',\n+        config_value: config.autoSwitch.toString(),\n+        config_type: 'boolean',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.client_id',\n+        config_value: config.clientId,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.max_retries',\n+        config_value: config.maxRetries.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      }\n+    ]\n+\n+    const response = await saveSystemConfig(configs)\n+    if (response.success) {\n+      ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ')\n+      connectionStatus.value = null // é‡ç½®è¿æ¥çŠ¶æ€\n+    } else {\n+      ElMessage.error(response.message || 'é…ç½®ä¿å­˜å¤±è´¥')\n+    }\n+  } catch (error) {\n+    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥')\n+  } finally {\n+    saving.value = false\n+  }\n+}\n+\n+// æµ‹è¯•è¿æ¥\n+const testConnection = async () => {\n+  if (!config.serverUrl) {\n+    ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€')\n+    return\n+  }\n+\n+  testing.value = true\n+  connectionStatus.value = { type: 'warning', text: 'æµ‹è¯•ä¸­...' }\n+\n+  try {\n+    // æ¨¡æ‹Ÿæµ‹è¯•è¿æ¥ï¼ˆå®é™…åº”è¯¥è°ƒç”¨åç«¯APIï¼‰\n+    await new Promise(resolve => setTimeout(resolve, 2000))\n+\n+    // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æµ‹è¯•è¿æ¥API\n+    // const response = await testComfyUIConnection(config.serverUrl)\n+\n+    // æ¨¡æ‹ŸæˆåŠŸç»“æœ\n+    connectionStatus.value = { type: 'success', text: 'è¿æ¥æ­£å¸¸' }\n+    ElMessage.success('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•æˆåŠŸ')\n+  } catch (error) {\n+    console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error)\n+    connectionStatus.value = { type: 'danger', text: 'è¿æ¥å¤±è´¥' }\n+    ElMessage.error('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•å¤±è´¥')\n+  } finally {\n+    testing.value = false\n+  }\n+}\n+\n+// é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n+onMounted(() => {\n+  loadConfig()\n+})\n </script>\n \n <style scoped>\n .config-page {\n"
                },
                {
                    "date": 1752325551808,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -315,8 +315,9 @@\n <style scoped>\n .config-page {\n   max-width: 1200px;\n   margin: 0 auto;\n+  padding: 20px;\n }\n \n .page-header {\n   display: flex;\n@@ -324,11 +325,50 @@\n   align-items: center;\n   margin-bottom: 20px;\n }\n \n+.header-actions {\n+  display: flex;\n+  gap: 12px;\n+}\n+\n .page-title {\n   font-size: 24px;\n   font-weight: 600;\n   color: #303133;\n   margin: 0;\n }\n+\n+.card-header {\n+  display: flex;\n+  justify-content: space-between;\n+  align-items: center;\n+  width: 100%;\n+}\n+\n+.form-tip {\n+  font-size: 12px;\n+  color: #909399;\n+  margin-top: 4px;\n+  line-height: 1.4;\n+}\n+\n+:deep(.el-form-item__label) {\n+  font-weight: 500;\n+}\n+\n+:deep(.el-input-group__prepend) {\n+  background-color: #f5f7fa;\n+  color: #909399;\n+  border-color: #dcdfe6;\n+}\n+\n+:deep(.el-divider__text) {\n+  font-weight: 500;\n+  color: #606266;\n+}\n+\n+.el-card {\n+  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n+  border-radius: 8px;\n+}\n </style>\n"
                },
                {
                    "date": 1752325660995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n import { Check, Connection } from '@element-plus/icons-vue'\n-import { getSystemConfig, saveSystemConfig } from '@/api/config'\n+import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n \n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n"
                },
                {
                    "date": 1752325684460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -287,17 +287,17 @@\n   testing.value = true\n   connectionStatus.value = { type: 'warning', text: 'æµ‹è¯•ä¸­...' }\n \n   try {\n-    // æ¨¡æ‹Ÿæµ‹è¯•è¿æ¥ï¼ˆå®é™…åº”è¯¥è°ƒç”¨åç«¯APIï¼‰\n-    await new Promise(resolve => setTimeout(resolve, 2000))\n+    const response = await testComfyUIConnection(config.serverUrl, config.healthCheckTimeout)\n \n-    // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æµ‹è¯•è¿æ¥API\n-    // const response = await testComfyUIConnection(config.serverUrl)\n-\n-    // æ¨¡æ‹ŸæˆåŠŸç»“æœ\n-    connectionStatus.value = { type: 'success', text: 'è¿æ¥æ­£å¸¸' }\n-    ElMessage.success('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•æˆåŠŸ')\n+    if (response.success) {\n+      connectionStatus.value = { type: 'success', text: 'è¿æ¥æ­£å¸¸' }\n+      ElMessage.success(response.message || 'ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•æˆåŠŸ')\n+    } else {\n+      connectionStatus.value = { type: 'danger', text: 'è¿æ¥å¤±è´¥' }\n+      ElMessage.error(response.message || 'ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•å¤±è´¥')\n+    }\n   } catch (error) {\n     console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error)\n     connectionStatus.value = { type: 'danger', text: 'è¿æ¥å¤±è´¥' }\n     ElMessage.error('ComfyUIæœåŠ¡å™¨è¿æ¥æµ‹è¯•å¤±è´¥')\n"
                },
                {
                    "date": 1752402399700,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -180,25 +180,56 @@\n const loadConfig = async () => {\n   loading.value = true\n   try {\n     const response = await getSystemConfig()\n+    console.log('ğŸ” APIå“åº”:', response)\n+\n     if (response.success && response.data) {\n       const configData = response.data\n+      console.log('ğŸ“Š é…ç½®æ•°æ®:', configData)\n \n+      // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n+      const flatConfig = {}\n+\n+      // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n+      Object.keys(configData).forEach(groupName => {\n+        const groupConfigs = configData[groupName]\n+        if (Array.isArray(groupConfigs)) {\n+          groupConfigs.forEach(item => {\n+            flatConfig[item.config_key] = item.config_value\n+          })\n+        }\n+      })\n+\n+      console.log('ğŸ”§ è½¬æ¢åçš„é…ç½®:', flatConfig)\n+\n       // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n-      config.serverUrl = configData['comfyui.server_url'] || ''\n-      config.backupServers = configData['comfyui.backup_servers'] || ''\n-      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n-      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n-      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n-      config.clientId = configData['comfyui.client_id'] || ''\n-      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n+      config.serverUrl = flatConfig['comfyui.server_url'] || ''\n+      config.backupServers = flatConfig['comfyui.backup_servers'] || ''\n+      config.requestTimeout = parseInt(flatConfig['comfyui.request_timeout']) || 30000\n+      config.healthCheckTimeout = parseInt(flatConfig['comfyui.health_check_timeout']) || 10000\n+      config.autoSwitch = flatConfig['comfyui.auto_switch'] === 'true' || flatConfig['comfyui.auto_switch'] === true\n+      config.clientId = flatConfig['comfyui.client_id'] || ''\n+      config.maxRetries = parseInt(flatConfig['comfyui.max_retries']) || 3\n \n+      console.log('âœ… è¡¨å•é…ç½®å·²æ›´æ–°:', {\n+        serverUrl: config.serverUrl,\n+        backupServers: config.backupServers,\n+        requestTimeout: config.requestTimeout,\n+        healthCheckTimeout: config.healthCheckTimeout,\n+        autoSwitch: config.autoSwitch,\n+        clientId: config.clientId,\n+        maxRetries: config.maxRetries\n+      })\n+\n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n+    } else {\n+      console.error('âŒ APIå“åº”æ ¼å¼é”™è¯¯:', response)\n+      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯')\n     }\n   } catch (error) {\n-    console.error('åŠ è½½é…ç½®å¤±è´¥:', error)\n-    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')\n+    console.error('âŒ åŠ è½½é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n   } finally {\n     loading.value = false\n   }\n }\n"
                },
                {
                    "date": 1752403004590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -338,9 +338,14 @@\n }\n \n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n-  loadConfig()\n+  console.log('ğŸ”„ Configé¡µé¢å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½é…ç½®...')\n+\n+  // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿è®¤è¯çŠ¶æ€å·²ç»è®¾ç½®\n+  setTimeout(() => {\n+    loadConfig()\n+  }, 500)\n })\n </script>\n \n <style scoped>\n"
                },
                {
                    "date": 1752403021511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,12 @@\n   <div class=\"config-page\">\n     <div class=\"page-header\">\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n+        <el-button @click=\"loadConfig\" :loading=\"loading\">\n+          <el-icon><Refresh /></el-icon>\n+          åˆ·æ–°é…ç½®\n+        </el-button>\n         <el-button @click=\"testConnection\" :loading=\"testing\">\n           <el-icon><Connection /></el-icon>\n           æµ‹è¯•è¿æ¥\n         </el-button>\n"
                },
                {
                    "date": 1752403046730,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -127,9 +127,9 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection } from '@element-plus/icons-vue'\n+import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n \n const loading = ref(false)\n const saving = ref(false)\n"
                },
                {
                    "date": 1752403740729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,12 +2,8 @@\n   <div class=\"config-page\">\n     <div class=\"page-header\">\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n-        <el-button @click=\"loadConfig\" :loading=\"loading\">\n-          <el-icon><Refresh /></el-icon>\n-          åˆ·æ–°é…ç½®\n-        </el-button>\n         <el-button @click=\"testConnection\" :loading=\"testing\">\n           <el-icon><Connection /></el-icon>\n           æµ‹è¯•è¿æ¥\n         </el-button>\n@@ -127,9 +123,9 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n+import { Check, Connection } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n \n const loading = ref(false)\n const saving = ref(false)\n@@ -184,56 +180,25 @@\n const loadConfig = async () => {\n   loading.value = true\n   try {\n     const response = await getSystemConfig()\n-    console.log('ğŸ” APIå“åº”:', response)\n-\n     if (response.success && response.data) {\n       const configData = response.data\n-      console.log('ğŸ“Š é…ç½®æ•°æ®:', configData)\n \n-      // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n-      const flatConfig = {}\n-\n-      // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n-      Object.keys(configData).forEach(groupName => {\n-        const groupConfigs = configData[groupName]\n-        if (Array.isArray(groupConfigs)) {\n-          groupConfigs.forEach(item => {\n-            flatConfig[item.config_key] = item.config_value\n-          })\n-        }\n-      })\n-\n-      console.log('ğŸ”§ è½¬æ¢åçš„é…ç½®:', flatConfig)\n-\n       // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n-      config.serverUrl = flatConfig['comfyui.server_url'] || ''\n-      config.backupServers = flatConfig['comfyui.backup_servers'] || ''\n-      config.requestTimeout = parseInt(flatConfig['comfyui.request_timeout']) || 30000\n-      config.healthCheckTimeout = parseInt(flatConfig['comfyui.health_check_timeout']) || 10000\n-      config.autoSwitch = flatConfig['comfyui.auto_switch'] === 'true' || flatConfig['comfyui.auto_switch'] === true\n-      config.clientId = flatConfig['comfyui.client_id'] || ''\n-      config.maxRetries = parseInt(flatConfig['comfyui.max_retries']) || 3\n+      config.serverUrl = configData['comfyui.server_url'] || ''\n+      config.backupServers = configData['comfyui.backup_servers'] || ''\n+      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n+      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n+      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n+      config.clientId = configData['comfyui.client_id'] || ''\n+      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n \n-      console.log('âœ… è¡¨å•é…ç½®å·²æ›´æ–°:', {\n-        serverUrl: config.serverUrl,\n-        backupServers: config.backupServers,\n-        requestTimeout: config.requestTimeout,\n-        healthCheckTimeout: config.healthCheckTimeout,\n-        autoSwitch: config.autoSwitch,\n-        clientId: config.clientId,\n-        maxRetries: config.maxRetries\n-      })\n-\n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n-    } else {\n-      console.error('âŒ APIå“åº”æ ¼å¼é”™è¯¯:', response)\n-      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯')\n     }\n   } catch (error) {\n-    console.error('âŒ åŠ è½½é…ç½®å¤±è´¥:', error)\n-    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n+    console.error('åŠ è½½é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')\n   } finally {\n     loading.value = false\n   }\n }\n@@ -342,14 +307,9 @@\n }\n \n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n-  console.log('ğŸ”„ Configé¡µé¢å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½é…ç½®...')\n-\n-  // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿è®¤è¯çŠ¶æ€å·²ç»è®¾ç½®\n-  setTimeout(() => {\n-    loadConfig()\n-  }, 500)\n+  loadConfig()\n })\n </script>\n \n <style scoped>\n"
                },
                {
                    "date": 1752403903614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,12 @@\n   <div class=\"config-page\">\n     <div class=\"page-header\">\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n+        <el-button @click=\"loadConfig\" :loading=\"loading\">\n+          <el-icon><Refresh /></el-icon>\n+          åˆ·æ–°é…ç½®\n+        </el-button>\n         <el-button @click=\"testConnection\" :loading=\"testing\">\n           <el-icon><Connection /></el-icon>\n           æµ‹è¯•è¿æ¥\n         </el-button>\n@@ -123,9 +127,9 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection } from '@element-plus/icons-vue'\n+import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n \n const loading = ref(false)\n const saving = ref(false)\n@@ -180,25 +184,56 @@\n const loadConfig = async () => {\n   loading.value = true\n   try {\n     const response = await getSystemConfig()\n+    console.log('ğŸ” APIå“åº”:', response)\n+\n     if (response.success && response.data) {\n       const configData = response.data\n+      console.log('ğŸ“Š é…ç½®æ•°æ®:', configData)\n \n+      // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n+      const flatConfig = {}\n+\n+      // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n+      Object.keys(configData).forEach(groupName => {\n+        const groupConfigs = configData[groupName]\n+        if (Array.isArray(groupConfigs)) {\n+          groupConfigs.forEach(item => {\n+            flatConfig[item.config_key] = item.config_value\n+          })\n+        }\n+      })\n+\n+      console.log('ğŸ”§ è½¬æ¢åçš„é…ç½®:', flatConfig)\n+\n       // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n-      config.serverUrl = configData['comfyui.server_url'] || ''\n-      config.backupServers = configData['comfyui.backup_servers'] || ''\n-      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n-      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n-      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n-      config.clientId = configData['comfyui.client_id'] || ''\n-      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n+      config.serverUrl = flatConfig['comfyui.server_url'] || ''\n+      config.backupServers = flatConfig['comfyui.backup_servers'] || ''\n+      config.requestTimeout = parseInt(flatConfig['comfyui.request_timeout']) || 30000\n+      config.healthCheckTimeout = parseInt(flatConfig['comfyui.health_check_timeout']) || 10000\n+      config.autoSwitch = flatConfig['comfyui.auto_switch'] === 'true' || flatConfig['comfyui.auto_switch'] === true\n+      config.clientId = flatConfig['comfyui.client_id'] || ''\n+      config.maxRetries = parseInt(flatConfig['comfyui.max_retries']) || 3\n \n+      console.log('âœ… è¡¨å•é…ç½®å·²æ›´æ–°:', {\n+        serverUrl: config.serverUrl,\n+        backupServers: config.backupServers,\n+        requestTimeout: config.requestTimeout,\n+        healthCheckTimeout: config.healthCheckTimeout,\n+        autoSwitch: config.autoSwitch,\n+        clientId: config.clientId,\n+        maxRetries: config.maxRetries\n+      })\n+\n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n+    } else {\n+      console.error('âŒ APIå“åº”æ ¼å¼é”™è¯¯:', response)\n+      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯')\n     }\n   } catch (error) {\n-    console.error('åŠ è½½é…ç½®å¤±è´¥:', error)\n-    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')\n+    console.error('âŒ åŠ è½½é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n   } finally {\n     loading.value = false\n   }\n }\n@@ -307,9 +342,14 @@\n }\n \n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n-  loadConfig()\n+  console.log('ğŸ”„ Configé¡µé¢å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½é…ç½®...')\n+\n+  // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿è®¤è¯çŠ¶æ€å·²ç»è®¾ç½®\n+  setTimeout(() => {\n+    loadConfig()\n+  }, 500)\n })\n </script>\n \n <style scoped>\n"
                },
                {
                    "date": 1752404134179,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -183,15 +183,28 @@\n // åŠ è½½é…ç½®\n const loadConfig = async () => {\n   loading.value = true\n   try {\n+    console.log('ğŸ”„ å¼€å§‹åŠ è½½é…ç½®...')\n+    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n+    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n+\n     const response = await getSystemConfig()\n     console.log('ğŸ” APIå“åº”:', response)\n \n     if (response.success && response.data) {\n       const configData = response.data\n       console.log('ğŸ“Š é…ç½®æ•°æ®:', configData)\n \n+      // æ£€æŸ¥ComfyUIé…ç½®æ˜¯å¦å­˜åœ¨\n+      if (!configData.comfyui) {\n+        console.error('âŒ æ²¡æœ‰æ‰¾åˆ°ComfyUIé…ç½®åˆ†ç»„')\n+        ElMessage.error('æ²¡æœ‰æ‰¾åˆ°ComfyUIé…ç½®')\n+        return\n+      }\n+\n+      console.log('ğŸ”§ ComfyUIé…ç½®é¡¹:', configData.comfyui)\n+\n       // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n       const flatConfig = {}\n \n       // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n@@ -227,9 +240,9 @@\n \n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n     } else {\n       console.error('âŒ APIå“åº”æ ¼å¼é”™è¯¯:', response)\n-      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯')\n+      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯: ' + (response.message || 'æœªçŸ¥é”™è¯¯'))\n     }\n   } catch (error) {\n     console.error('âŒ åŠ è½½é…ç½®å¤±è´¥:', error)\n     ElMessage.error('åŠ è½½é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n"
                },
                {
                    "date": 1752404148915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -129,8 +129,9 @@\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n+import { getToken, getUser } from '@/utils/auth'\n \n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n"
                },
                {
                    "date": 1752404181529,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -358,8 +358,21 @@\n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n   console.log('ğŸ”„ Configé¡µé¢å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½é…ç½®...')\n \n+  // æ£€æŸ¥è®¤è¯çŠ¶æ€\n+  const token = getToken()\n+  const user = getUser()\n+\n+  if (!token) {\n+    console.log('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢')\n+    ElMessage.warning('è¯·å…ˆç™»å½•')\n+    router.push('/login')\n+    return\n+  }\n+\n+  console.log('âœ… è®¤è¯çŠ¶æ€æ­£å¸¸ï¼Œå¼€å§‹åŠ è½½é…ç½®')\n+\n   // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿è®¤è¯çŠ¶æ€å·²ç»è®¾ç½®\n   setTimeout(() => {\n     loadConfig()\n   }, 500)\n"
                },
                {
                    "date": 1752404197385,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -130,8 +130,9 @@\n import { ElMessage, ElMessageBox } from 'element-plus'\n import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n import { getToken, getUser } from '@/utils/auth'\n+import { useRouter } from 'vue-router'\n \n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n"
                },
                {
                    "date": 1752404212326,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,8 +132,9 @@\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n import { getToken, getUser } from '@/utils/auth'\n import { useRouter } from 'vue-router'\n \n+const router = useRouter()\n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n const configForm = ref(null)\n"
                },
                {
                    "date": 1752404232816,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,12 @@\n   <div class=\"config-page\">\n     <div class=\"page-header\">\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n+        <el-button @click=\"forceLogin\" type=\"warning\">\n+          <el-icon><User /></el-icon>\n+          å¼ºåˆ¶ç™»å½•\n+        </el-button>\n         <el-button @click=\"loadConfig\" :loading=\"loading\">\n           <el-icon><Refresh /></el-icon>\n           åˆ·æ–°é…ç½®\n         </el-button>\n"
                },
                {
                    "date": 1752404247421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,9 +131,9 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection, Refresh } from '@element-plus/icons-vue'\n+import { Check, Connection, Refresh, User } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n import { getToken, getUser } from '@/utils/auth'\n import { useRouter } from 'vue-router'\n \n"
                },
                {
                    "date": 1752404264042,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -133,10 +133,11 @@\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n import { Check, Connection, Refresh, User } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n-import { getToken, getUser } from '@/utils/auth'\n+import { getToken, getUser, setToken, setUser } from '@/utils/auth'\n import { useRouter } from 'vue-router'\n+import request from '@/utils/request'\n \n const router = useRouter()\n const loading = ref(false)\n const saving = ref(false)\n"
                },
                {
                    "date": 1752404287266,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -332,8 +332,36 @@\n     saving.value = false\n   }\n }\n \n+// å¼ºåˆ¶ç™»å½•\n+const forceLogin = async () => {\n+  try {\n+    console.log('ğŸ” å¼ºåˆ¶ç™»å½•...')\n+    const response = await request({\n+      url: '/admin-auth/login',\n+      method: 'post',\n+      data: {\n+        username: 'admin',\n+        password: 'admin123456'\n+      }\n+    })\n+\n+    if (response.success) {\n+      setToken(response.data.token)\n+      setUser(response.data.admin)\n+      ElMessage.success('ç™»å½•æˆåŠŸ')\n+      console.log('âœ… ç™»å½•æˆåŠŸï¼Œå¼€å§‹åŠ è½½é…ç½®')\n+      await loadConfig()\n+    } else {\n+      ElMessage.error('ç™»å½•å¤±è´¥: ' + response.message)\n+    }\n+  } catch (error) {\n+    console.error('âŒ å¼ºåˆ¶ç™»å½•å¤±è´¥:', error)\n+    ElMessage.error('ç™»å½•å¤±è´¥')\n+  }\n+}\n+\n // æµ‹è¯•è¿æ¥\n const testConnection = async () => {\n   if (!config.serverUrl) {\n     ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€')\n"
                },
                {
                    "date": 1752404723842,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,8 +271,12 @@\n   }\n \n   saving.value = true\n   try {\n+    console.log('ğŸ’¾ å¼€å§‹ä¿å­˜é…ç½®...')\n+    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n+    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n+\n     // æ„å»ºé…ç½®æ•°æ®\n     const configs = [\n       {\n         config_key: 'comfyui.server_url',\n@@ -317,18 +321,23 @@\n         config_group: 'comfyui'\n       }\n     ]\n \n+    console.log('ğŸ“‹ è¦ä¿å­˜çš„é…ç½®:', configs)\n+\n     const response = await saveSystemConfig(configs)\n+    console.log('ğŸ“Š ä¿å­˜å“åº”:', response)\n+\n     if (response.success) {\n       ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ')\n       connectionStatus.value = null // é‡ç½®è¿æ¥çŠ¶æ€\n     } else {\n       ElMessage.error(response.message || 'é…ç½®ä¿å­˜å¤±è´¥')\n     }\n   } catch (error) {\n-    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error)\n-    ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥')\n+    console.error('âŒ ä¿å­˜é…ç½®å¤±è´¥:', error)\n+    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n+    ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n   } finally {\n     saving.value = false\n   }\n }\n"
                },
                {
                    "date": 1752405122681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -406,12 +406,15 @@\n   // æ£€æŸ¥è®¤è¯çŠ¶æ€\n   const token = getToken()\n   const user = getUser()\n \n+  console.log('ğŸ”‘ å½“å‰Token:', token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨')\n+  console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', user ? user.username : 'æœªç™»å½•')\n+\n   if (!token) {\n-    console.log('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢')\n-    ElMessage.warning('è¯·å…ˆç™»å½•')\n-    router.push('/login')\n+    console.log('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œæ˜¾ç¤ºå¼ºåˆ¶ç™»å½•æç¤º')\n+    ElMessage.warning('è¯·ç‚¹å‡»\"å¼ºåˆ¶ç™»å½•\"æŒ‰é’®è¿›è¡Œç™»å½•')\n+    // ä¸è·³è½¬ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»å¼ºåˆ¶ç™»å½•\n     return\n   }\n \n   console.log('âœ… è®¤è¯çŠ¶æ€æ­£å¸¸ï¼Œå¼€å§‹åŠ è½½é…ç½®')\n"
                },
                {
                    "date": 1752405143648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,12 @@\n         <el-button @click=\"forceLogin\" type=\"warning\">\n           <el-icon><User /></el-icon>\n           å¼ºåˆ¶ç™»å½•\n         </el-button>\n+        <el-button @click=\"testAPI\" type=\"info\">\n+          <el-icon><Tools /></el-icon>\n+          æµ‹è¯•API\n+        </el-button>\n         <el-button @click=\"loadConfig\" :loading=\"loading\">\n           <el-icon><Refresh /></el-icon>\n           åˆ·æ–°é…ç½®\n         </el-button>\n"
                },
                {
                    "date": 1752405159443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,9 +135,9 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection, Refresh, User } from '@element-plus/icons-vue'\n+import { Check, Connection, Refresh, User, Tools } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n import { getToken, getUser, setToken, setUser } from '@/utils/auth'\n import { useRouter } from 'vue-router'\n import request from '@/utils/request'\n"
                },
                {
                    "date": 1752405182306,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -373,8 +373,35 @@\n     ElMessage.error('ç™»å½•å¤±è´¥')\n   }\n }\n \n+// æµ‹è¯•APIè¿æ¥\n+const testAPI = async () => {\n+  try {\n+    console.log('ğŸ§ª æµ‹è¯•APIè¿æ¥...')\n+    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n+    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n+\n+    // æµ‹è¯•ç®€å•çš„APIè°ƒç”¨\n+    const response = await request({\n+      url: '/admin/stats',\n+      method: 'get'\n+    })\n+\n+    console.log('ğŸ“Š APIæµ‹è¯•å“åº”:', response)\n+\n+    if (response.success) {\n+      ElMessage.success('APIè¿æ¥æ­£å¸¸')\n+    } else {\n+      ElMessage.error('APIè¿æ¥å¤±è´¥: ' + response.message)\n+    }\n+  } catch (error) {\n+    console.error('âŒ APIæµ‹è¯•å¤±è´¥:', error)\n+    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n+    ElMessage.error('APIè¿æ¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n+  }\n+}\n+\n // æµ‹è¯•è¿æ¥\n const testConnection = async () => {\n   if (!config.serverUrl) {\n     ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€')\n"
                },
                {
                    "date": 1752405426514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -47,14 +47,12 @@\n           <el-col :span=\"12\">\n             <el-form-item label=\"ä¸»æœåŠ¡å™¨åœ°å€\" prop=\"serverUrl\" required>\n               <el-input\n                 v-model=\"config.serverUrl\"\n-                placeholder=\"https://your-comfyui-server.com\"\n+                placeholder=\"ä¾‹å¦‚: https://your-server.com æˆ– http://localhost:8188\"\n                 clearable\n-              >\n-                <template #prepend>HTTPS://</template>\n-              </el-input>\n-              <div class=\"form-tip\">ComfyUIä¸»æœåŠ¡å™¨çš„å®Œæ•´åœ°å€</div>\n+              />\n+              <div class=\"form-tip\">ComfyUIæœåŠ¡å™¨çš„å®Œæ•´åœ°å€ï¼ŒåŒ…å«åè®®(http://æˆ–https://)</div>\n             </el-form-item>\n \n             <el-form-item label=\"å¤‡ç”¨æœåŠ¡å™¨åœ°å€\" prop=\"backupServers\">\n               <el-input\n"
                },
                {
                    "date": 1752406022609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,12 @@\n         <el-button @click=\"testAPI\" type=\"info\">\n           <el-icon><Tools /></el-icon>\n           æµ‹è¯•API\n         </el-button>\n+        <el-button @click=\"saveConfigDirect\" type=\"success\" :loading=\"saving\">\n+          <el-icon><Check /></el-icon>\n+          ç›´æ¥ä¿å­˜\n+        </el-button>\n         <el-button @click=\"loadConfig\" :loading=\"loading\">\n           <el-icon><Refresh /></el-icon>\n           åˆ·æ–°é…ç½®\n         </el-button>\n"
                },
                {
                    "date": 1752406038216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -139,8 +139,9 @@\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n import { Check, Connection, Refresh, User, Tools } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n+import { saveSystemConfigDirect } from '@/api/direct-config'\n import { getToken, getUser, setToken, setUser } from '@/utils/auth'\n import { useRouter } from 'vue-router'\n import request from '@/utils/request'\n \n"
                },
                {
                    "date": 1752406063397,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -265,8 +265,90 @@\n     loading.value = false\n   }\n }\n \n+// ç›´æ¥ä¿å­˜é…ç½®ï¼ˆç»•è¿‡ä»£ç†ï¼‰\n+const saveConfigDirect = async () => {\n+  if (!configForm.value) return\n+\n+  try {\n+    await configForm.value.validate()\n+  } catch (error) {\n+    ElMessage.warning('è¯·æ£€æŸ¥è¡¨å•è¾“å…¥')\n+    return\n+  }\n+\n+  saving.value = true\n+  try {\n+    console.log('ğŸ’¾ ä½¿ç”¨ç›´æ¥è¿æ¥ä¿å­˜é…ç½®...')\n+    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n+\n+    // æ„å»ºé…ç½®æ•°æ®\n+    const configs = [\n+      {\n+        config_key: 'comfyui.server_url',\n+        config_value: config.serverUrl,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.backup_servers',\n+        config_value: config.backupServers,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.request_timeout',\n+        config_value: config.requestTimeout.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.health_check_timeout',\n+        config_value: config.healthCheckTimeout.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.auto_switch',\n+        config_value: config.autoSwitch.toString(),\n+        config_type: 'boolean',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.client_id',\n+        config_value: config.clientId,\n+        config_type: 'string',\n+        config_group: 'comfyui'\n+      },\n+      {\n+        config_key: 'comfyui.max_retries',\n+        config_value: config.maxRetries.toString(),\n+        config_type: 'number',\n+        config_group: 'comfyui'\n+      }\n+    ]\n+\n+    console.log('ğŸ“‹ è¦ä¿å­˜çš„é…ç½®:', configs)\n+\n+    const response = await saveSystemConfigDirect(configs)\n+    console.log('ğŸ“Š ç›´æ¥ä¿å­˜å“åº”:', response)\n+\n+    if (response.success) {\n+      ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸï¼ˆç›´æ¥è¿æ¥ï¼‰')\n+      connectionStatus.value = null // é‡ç½®è¿æ¥çŠ¶æ€\n+    } else {\n+      ElMessage.error(response.message || 'é…ç½®ä¿å­˜å¤±è´¥')\n+    }\n+  } catch (error) {\n+    console.error('âŒ ç›´æ¥ä¿å­˜é…ç½®å¤±è´¥:', error)\n+    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n+    ElMessage.error('ç›´æ¥ä¿å­˜é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n+  } finally {\n+    saving.value = false\n+  }\n+}\n+\n // ä¿å­˜é…ç½®\n const saveConfig = async () => {\n   if (!configForm.value) return\n \n"
                },
                {
                    "date": 1752406876085,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,24 +2,8 @@\n   <div class=\"config-page\">\n     <div class=\"page-header\">\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n-        <el-button @click=\"forceLogin\" type=\"warning\">\n-          <el-icon><User /></el-icon>\n-          å¼ºåˆ¶ç™»å½•\n-        </el-button>\n-        <el-button @click=\"testAPI\" type=\"info\">\n-          <el-icon><Tools /></el-icon>\n-          æµ‹è¯•API\n-        </el-button>\n-        <el-button @click=\"saveConfigDirect\" type=\"success\" :loading=\"saving\">\n-          <el-icon><Check /></el-icon>\n-          ç›´æ¥ä¿å­˜\n-        </el-button>\n-        <el-button @click=\"loadConfig\" :loading=\"loading\">\n-          <el-icon><Refresh /></el-icon>\n-          åˆ·æ–°é…ç½®\n-        </el-button>\n         <el-button @click=\"testConnection\" :loading=\"testing\">\n           <el-icon><Connection /></el-icon>\n           æµ‹è¯•è¿æ¥\n         </el-button>\n@@ -51,12 +35,14 @@\n           <el-col :span=\"12\">\n             <el-form-item label=\"ä¸»æœåŠ¡å™¨åœ°å€\" prop=\"serverUrl\" required>\n               <el-input\n                 v-model=\"config.serverUrl\"\n-                placeholder=\"ä¾‹å¦‚: https://your-server.com æˆ– http://localhost:8188\"\n+                placeholder=\"https://your-comfyui-server.com\"\n                 clearable\n-              />\n-              <div class=\"form-tip\">ComfyUIæœåŠ¡å™¨çš„å®Œæ•´åœ°å€ï¼ŒåŒ…å«åè®®(http://æˆ–https://)</div>\n+              >\n+                <template #prepend>HTTPS://</template>\n+              </el-input>\n+              <div class=\"form-tip\">ComfyUIä¸»æœåŠ¡å™¨çš„å®Œæ•´åœ°å€</div>\n             </el-form-item>\n \n             <el-form-item label=\"å¤‡ç”¨æœåŠ¡å™¨åœ°å€\" prop=\"backupServers\">\n               <el-input\n@@ -137,16 +123,11 @@\n \n <script setup>\n import { ref, reactive, onMounted } from 'vue'\n import { ElMessage, ElMessageBox } from 'element-plus'\n-import { Check, Connection, Refresh, User, Tools } from '@element-plus/icons-vue'\n+import { Check, Connection } from '@element-plus/icons-vue'\n import { getSystemConfig, saveSystemConfig, testComfyUIConnection } from '@/api/config'\n-import { saveSystemConfigDirect } from '@/api/direct-config'\n-import { getToken, getUser, setToken, setUser } from '@/utils/auth'\n-import { useRouter } from 'vue-router'\n-import request from '@/utils/request'\n \n-const router = useRouter()\n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n const configForm = ref(null)\n@@ -198,157 +179,31 @@\n // åŠ è½½é…ç½®\n const loadConfig = async () => {\n   loading.value = true\n   try {\n-    console.log('ğŸ”„ å¼€å§‹åŠ è½½é…ç½®...')\n-    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n-    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n-\n     const response = await getSystemConfig()\n-    console.log('ğŸ” APIå“åº”:', response)\n-\n     if (response.success && response.data) {\n       const configData = response.data\n-      console.log('ğŸ“Š é…ç½®æ•°æ®:', configData)\n \n-      // æ£€æŸ¥ComfyUIé…ç½®æ˜¯å¦å­˜åœ¨\n-      if (!configData.comfyui) {\n-        console.error('âŒ æ²¡æœ‰æ‰¾åˆ°ComfyUIé…ç½®åˆ†ç»„')\n-        ElMessage.error('æ²¡æœ‰æ‰¾åˆ°ComfyUIé…ç½®')\n-        return\n-      }\n-\n-      console.log('ğŸ”§ ComfyUIé…ç½®é¡¹:', configData.comfyui)\n-\n-      // å°†åˆ†ç»„æ ¼å¼çš„é…ç½®æ•°æ®è½¬æ¢ä¸ºæ‰å¹³çš„é”®å€¼å¯¹æ ¼å¼\n-      const flatConfig = {}\n-\n-      // éå†æ‰€æœ‰é…ç½®åˆ†ç»„\n-      Object.keys(configData).forEach(groupName => {\n-        const groupConfigs = configData[groupName]\n-        if (Array.isArray(groupConfigs)) {\n-          groupConfigs.forEach(item => {\n-            flatConfig[item.config_key] = item.config_value\n-          })\n-        }\n-      })\n-\n-      console.log('ğŸ”§ è½¬æ¢åçš„é…ç½®:', flatConfig)\n-\n       // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n-      config.serverUrl = flatConfig['comfyui.server_url'] || ''\n-      config.backupServers = flatConfig['comfyui.backup_servers'] || ''\n-      config.requestTimeout = parseInt(flatConfig['comfyui.request_timeout']) || 30000\n-      config.healthCheckTimeout = parseInt(flatConfig['comfyui.health_check_timeout']) || 10000\n-      config.autoSwitch = flatConfig['comfyui.auto_switch'] === 'true' || flatConfig['comfyui.auto_switch'] === true\n-      config.clientId = flatConfig['comfyui.client_id'] || ''\n-      config.maxRetries = parseInt(flatConfig['comfyui.max_retries']) || 3\n+      config.serverUrl = configData['comfyui.server_url'] || ''\n+      config.backupServers = configData['comfyui.backup_servers'] || ''\n+      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n+      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n+      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n+      config.clientId = configData['comfyui.client_id'] || ''\n+      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n \n-      console.log('âœ… è¡¨å•é…ç½®å·²æ›´æ–°:', {\n-        serverUrl: config.serverUrl,\n-        backupServers: config.backupServers,\n-        requestTimeout: config.requestTimeout,\n-        healthCheckTimeout: config.healthCheckTimeout,\n-        autoSwitch: config.autoSwitch,\n-        clientId: config.clientId,\n-        maxRetries: config.maxRetries\n-      })\n-\n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n-    } else {\n-      console.error('âŒ APIå“åº”æ ¼å¼é”™è¯¯:', response)\n-      ElMessage.error('é…ç½®æ•°æ®æ ¼å¼é”™è¯¯: ' + (response.message || 'æœªçŸ¥é”™è¯¯'))\n     }\n   } catch (error) {\n-    console.error('âŒ åŠ è½½é…ç½®å¤±è´¥:', error)\n-    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n+    console.error('åŠ è½½é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('åŠ è½½é…ç½®å¤±è´¥')\n   } finally {\n     loading.value = false\n   }\n }\n \n-// ç›´æ¥ä¿å­˜é…ç½®ï¼ˆç»•è¿‡ä»£ç†ï¼‰\n-const saveConfigDirect = async () => {\n-  if (!configForm.value) return\n-\n-  try {\n-    await configForm.value.validate()\n-  } catch (error) {\n-    ElMessage.warning('è¯·æ£€æŸ¥è¡¨å•è¾“å…¥')\n-    return\n-  }\n-\n-  saving.value = true\n-  try {\n-    console.log('ğŸ’¾ ä½¿ç”¨ç›´æ¥è¿æ¥ä¿å­˜é…ç½®...')\n-    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n-\n-    // æ„å»ºé…ç½®æ•°æ®\n-    const configs = [\n-      {\n-        config_key: 'comfyui.server_url',\n-        config_value: config.serverUrl,\n-        config_type: 'string',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.backup_servers',\n-        config_value: config.backupServers,\n-        config_type: 'string',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.request_timeout',\n-        config_value: config.requestTimeout.toString(),\n-        config_type: 'number',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.health_check_timeout',\n-        config_value: config.healthCheckTimeout.toString(),\n-        config_type: 'number',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.auto_switch',\n-        config_value: config.autoSwitch.toString(),\n-        config_type: 'boolean',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.client_id',\n-        config_value: config.clientId,\n-        config_type: 'string',\n-        config_group: 'comfyui'\n-      },\n-      {\n-        config_key: 'comfyui.max_retries',\n-        config_value: config.maxRetries.toString(),\n-        config_type: 'number',\n-        config_group: 'comfyui'\n-      }\n-    ]\n-\n-    console.log('ğŸ“‹ è¦ä¿å­˜çš„é…ç½®:', configs)\n-\n-    const response = await saveSystemConfigDirect(configs)\n-    console.log('ğŸ“Š ç›´æ¥ä¿å­˜å“åº”:', response)\n-\n-    if (response.success) {\n-      ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸï¼ˆç›´æ¥è¿æ¥ï¼‰')\n-      connectionStatus.value = null // é‡ç½®è¿æ¥çŠ¶æ€\n-    } else {\n-      ElMessage.error(response.message || 'é…ç½®ä¿å­˜å¤±è´¥')\n-    }\n-  } catch (error) {\n-    console.error('âŒ ç›´æ¥ä¿å­˜é…ç½®å¤±è´¥:', error)\n-    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n-    ElMessage.error('ç›´æ¥ä¿å­˜é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n-  } finally {\n-    saving.value = false\n-  }\n-}\n-\n // ä¿å­˜é…ç½®\n const saveConfig = async () => {\n   if (!configForm.value) return\n \n@@ -360,12 +215,8 @@\n   }\n \n   saving.value = true\n   try {\n-    console.log('ğŸ’¾ å¼€å§‹ä¿å­˜é…ç½®...')\n-    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n-    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n-\n     // æ„å»ºé…ç½®æ•°æ®\n     const configs = [\n       {\n         config_key: 'comfyui.server_url',\n@@ -410,83 +261,23 @@\n         config_group: 'comfyui'\n       }\n     ]\n \n-    console.log('ğŸ“‹ è¦ä¿å­˜çš„é…ç½®:', configs)\n-\n     const response = await saveSystemConfig(configs)\n-    console.log('ğŸ“Š ä¿å­˜å“åº”:', response)\n-\n     if (response.success) {\n       ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ')\n       connectionStatus.value = null // é‡ç½®è¿æ¥çŠ¶æ€\n     } else {\n       ElMessage.error(response.message || 'é…ç½®ä¿å­˜å¤±è´¥')\n     }\n   } catch (error) {\n-    console.error('âŒ ä¿å­˜é…ç½®å¤±è´¥:', error)\n-    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n-    ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n+    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error)\n+    ElMessage.error('ä¿å­˜é…ç½®å¤±è´¥')\n   } finally {\n     saving.value = false\n   }\n }\n \n-// å¼ºåˆ¶ç™»å½•\n-const forceLogin = async () => {\n-  try {\n-    console.log('ğŸ” å¼ºåˆ¶ç™»å½•...')\n-    const response = await request({\n-      url: '/admin-auth/login',\n-      method: 'post',\n-      data: {\n-        username: 'admin',\n-        password: 'admin123456'\n-      }\n-    })\n-\n-    if (response.success) {\n-      setToken(response.data.token)\n-      setUser(response.data.admin)\n-      ElMessage.success('ç™»å½•æˆåŠŸ')\n-      console.log('âœ… ç™»å½•æˆåŠŸï¼Œå¼€å§‹åŠ è½½é…ç½®')\n-      await loadConfig()\n-    } else {\n-      ElMessage.error('ç™»å½•å¤±è´¥: ' + response.message)\n-    }\n-  } catch (error) {\n-    console.error('âŒ å¼ºåˆ¶ç™»å½•å¤±è´¥:', error)\n-    ElMessage.error('ç™»å½•å¤±è´¥')\n-  }\n-}\n-\n-// æµ‹è¯•APIè¿æ¥\n-const testAPI = async () => {\n-  try {\n-    console.log('ğŸ§ª æµ‹è¯•APIè¿æ¥...')\n-    console.log('ğŸ”‘ å½“å‰Token:', getToken())\n-    console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', getUser())\n-\n-    // æµ‹è¯•ç®€å•çš„APIè°ƒç”¨\n-    const response = await request({\n-      url: '/admin/stats',\n-      method: 'get'\n-    })\n-\n-    console.log('ğŸ“Š APIæµ‹è¯•å“åº”:', response)\n-\n-    if (response.success) {\n-      ElMessage.success('APIè¿æ¥æ­£å¸¸')\n-    } else {\n-      ElMessage.error('APIè¿æ¥å¤±è´¥: ' + response.message)\n-    }\n-  } catch (error) {\n-    console.error('âŒ APIæµ‹è¯•å¤±è´¥:', error)\n-    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response || error)\n-    ElMessage.error('APIè¿æ¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n-  }\n-}\n-\n // æµ‹è¯•è¿æ¥\n const testConnection = async () => {\n   if (!config.serverUrl) {\n     ElMessage.warning('è¯·å…ˆè¾“å…¥ä¸»æœåŠ¡å™¨åœ°å€')\n@@ -516,30 +307,9 @@\n }\n \n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n-  console.log('ğŸ”„ Configé¡µé¢å·²æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½é…ç½®...')\n-\n-  // æ£€æŸ¥è®¤è¯çŠ¶æ€\n-  const token = getToken()\n-  const user = getUser()\n-\n-  console.log('ğŸ”‘ å½“å‰Token:', token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨')\n-  console.log('ğŸ‘¤ å½“å‰ç”¨æˆ·:', user ? user.username : 'æœªç™»å½•')\n-\n-  if (!token) {\n-    console.log('âŒ æœªæ‰¾åˆ°è®¤è¯Tokenï¼Œæ˜¾ç¤ºå¼ºåˆ¶ç™»å½•æç¤º')\n-    ElMessage.warning('è¯·ç‚¹å‡»\"å¼ºåˆ¶ç™»å½•\"æŒ‰é’®è¿›è¡Œç™»å½•')\n-    // ä¸è·³è½¬ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»å¼ºåˆ¶ç™»å½•\n-    return\n-  }\n-\n-  console.log('âœ… è®¤è¯çŠ¶æ€æ­£å¸¸ï¼Œå¼€å§‹åŠ è½½é…ç½®')\n-\n-  // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿è®¤è¯çŠ¶æ€å·²ç»è®¾ç½®\n-  setTimeout(() => {\n-    loadConfig()\n-  }, 500)\n+  loadConfig()\n })\n </script>\n \n <style scoped>\n"
                },
                {
                    "date": 1752409400962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -186,13 +186,13 @@\n \n       // æ˜ å°„é…ç½®æ•°æ®åˆ°è¡¨å•\n       config.serverUrl = configData['comfyui.server_url'] || ''\n       config.backupServers = configData['comfyui.backup_servers'] || ''\n-      config.requestTimeout = parseInt(configData['comfyui.request_timeout']) || 30000\n-      config.healthCheckTimeout = parseInt(configData['comfyui.health_check_timeout']) || 10000\n-      config.autoSwitch = configData['comfyui.auto_switch'] === 'true' || configData['comfyui.auto_switch'] === true\n+      config.requestTimeout = configData['comfyui.request_timeout'] || 30000\n+      config.healthCheckTimeout = configData['comfyui.health_check_timeout'] || 10000\n+      config.autoSwitch = Boolean(configData['comfyui.auto_switch'])\n       config.clientId = configData['comfyui.client_id'] || ''\n-      config.maxRetries = parseInt(configData['comfyui.max_retries']) || 3\n+      config.maxRetries = configData['comfyui.max_retries'] || 3\n \n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n     }\n   } catch (error) {\n"
                },
                {
                    "date": 1752410284026,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,11 +37,9 @@\n               <el-input\n                 v-model=\"config.serverUrl\"\n                 placeholder=\"https://your-comfyui-server.com\"\n                 clearable\n-              >\n-                <template #prepend>HTTPS://</template>\n-              </el-input>\n+              />\n               <div class=\"form-tip\">ComfyUIä¸»æœåŠ¡å™¨çš„å®Œæ•´åœ°å€</div>\n             </el-form-item>\n \n             <el-form-item label=\"å¤‡ç”¨æœåŠ¡å™¨åœ°å€\" prop=\"backupServers\">\n@@ -371,4 +369,5 @@\n   box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n   border-radius: 8px;\n }\n </style>\n+\n"
                },
                {
                    "date": 1752459510525,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,10 +4,14 @@\n       <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n       <div class=\"header-actions\">\n         <el-button @click=\"testConnection\" :loading=\"testing\">\n           <el-icon><Connection /></el-icon>\n-          æµ‹è¯•è¿æ¥\n+          æµ‹è¯•ä¸»æœåŠ¡å™¨\n         </el-button>\n+        <el-button @click=\"testAllServers\" :loading=\"testingAll\" type=\"success\">\n+          <el-icon><Connection /></el-icon>\n+          æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨\n+        </el-button>\n         <el-button type=\"primary\" @click=\"saveConfig\" :loading=\"saving\">\n           <el-icon><Check /></el-icon>\n           ä¿å­˜é…ç½®\n         </el-button>\n"
                },
                {
                    "date": 1752459525601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,10 +131,12 @@\n \n const loading = ref(false)\n const saving = ref(false)\n const testing = ref(false)\n+const testingAll = ref(false)\n const configForm = ref(null)\n const connectionStatus = ref(null)\n+const allServersStatus = ref([])\n \n // é…ç½®æ•°æ®\n const config = reactive({\n   serverUrl: '',\n"
                },
                {
                    "date": 1752459557476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -309,8 +309,115 @@\n     testing.value = false\n   }\n }\n \n+// æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨\n+const testAllServers = async () => {\n+  // æ”¶é›†æ‰€æœ‰æœåŠ¡å™¨åœ°å€\n+  const servers = []\n+\n+  // ä¸»æœåŠ¡å™¨\n+  if (config.serverUrl) {\n+    servers.push({ url: config.serverUrl, type: 'primary', name: 'ä¸»æœåŠ¡å™¨' })\n+  }\n+\n+  // å¤‡ç”¨æœåŠ¡å™¨\n+  if (config.backupServers) {\n+    const backupUrls = config.backupServers.split('\\n')\n+      .map(url => url.trim())\n+      .filter(url => url && url.startsWith('http'))\n+\n+    backupUrls.forEach((url, index) => {\n+      servers.push({ url, type: 'backup', name: `å¤‡ç”¨æœåŠ¡å™¨${index + 1}` })\n+    })\n+  }\n+\n+  if (servers.length === 0) {\n+    ElMessage.warning('è¯·å…ˆé…ç½®æœåŠ¡å™¨åœ°å€')\n+    return\n+  }\n+\n+  testingAll.value = true\n+  allServersStatus.value = []\n+\n+  ElMessage.info(`å¼€å§‹æµ‹è¯• ${servers.length} ä¸ªæœåŠ¡å™¨...`)\n+\n+  // å¹¶å‘æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨\n+  const testPromises = servers.map(async (server) => {\n+    try {\n+      const startTime = Date.now()\n+      const response = await testComfyUIConnection(server.url, config.healthCheckTimeout)\n+      const responseTime = Date.now() - startTime\n+\n+      return {\n+        ...server,\n+        success: response.success,\n+        message: response.message,\n+        responseTime,\n+        data: response.data\n+      }\n+    } catch (error) {\n+      return {\n+        ...server,\n+        success: false,\n+        message: error.message,\n+        responseTime: config.healthCheckTimeout,\n+        error: error.message\n+      }\n+    }\n+  })\n+\n+  try {\n+    const results = await Promise.all(testPromises)\n+    allServersStatus.value = results\n+\n+    const successCount = results.filter(r => r.success).length\n+    const failCount = results.length - successCount\n+\n+    if (successCount === results.length) {\n+      ElMessage.success(`æ‰€æœ‰ ${results.length} ä¸ªæœåŠ¡å™¨è¿æ¥æ­£å¸¸`)\n+    } else if (successCount > 0) {\n+      ElMessage.warning(`${successCount} ä¸ªæœåŠ¡å™¨æ­£å¸¸ï¼Œ${failCount} ä¸ªæœåŠ¡å™¨å¼‚å¸¸`)\n+    } else {\n+      ElMessage.error(`æ‰€æœ‰ ${results.length} ä¸ªæœåŠ¡å™¨è¿æ¥å¤±è´¥`)\n+    }\n+\n+    // æ˜¾ç¤ºè¯¦ç»†ç»“æœ\n+    showServerTestResults(results)\n+\n+  } catch (error) {\n+    console.error('æ‰¹é‡æµ‹è¯•å¤±è´¥:', error)\n+    ElMessage.error('æ‰¹é‡æµ‹è¯•å¤±è´¥')\n+  } finally {\n+    testingAll.value = false\n+  }\n+}\n+\n+// æ˜¾ç¤ºæœåŠ¡å™¨æµ‹è¯•ç»“æœ\n+const showServerTestResults = (results) => {\n+  const resultHtml = results.map(result => {\n+    const statusIcon = result.success ? 'âœ…' : 'âŒ'\n+    const statusText = result.success ? 'æ­£å¸¸' : 'å¼‚å¸¸'\n+    const responseTime = result.responseTime ? `${result.responseTime}ms` : 'è¶…æ—¶'\n+\n+    return `\n+      <div style=\"margin-bottom: 10px; padding: 8px; border-radius: 4px; background: ${result.success ? '#f0f9ff' : '#fef2f2'};\">\n+        <strong>${statusIcon} ${result.name}</strong><br>\n+        <small style=\"color: #666;\">\n+          åœ°å€: ${result.url}<br>\n+          çŠ¶æ€: ${statusText} | å“åº”æ—¶é—´: ${responseTime}<br>\n+          ${result.message || ''}\n+        </small>\n+      </div>\n+    `\n+  }).join('')\n+\n+  ElMessageBox.alert(resultHtml, 'æœåŠ¡å™¨æµ‹è¯•ç»“æœ', {\n+    dangerouslyUseHTMLString: true,\n+    customClass: 'server-test-results'\n+  })\n+}\n+\n // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®\n onMounted(() => {\n   loadConfig()\n })\n"
                },
                {
                    "date": 1752459594555,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,16 +80,9 @@\n               />\n               <div class=\"form-tip\">å•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®è®¾ç½®ä¸º5000-15000</div>\n             </el-form-item>\n \n-            <el-form-item label=\"è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨\">\n-              <el-switch\n-                v-model=\"config.autoSwitch\"\n-                active-text=\"å¯ç”¨\"\n-                inactive-text=\"ç¦ç”¨\"\n-              />\n-              <div class=\"form-tip\">ä¸»æœåŠ¡å™¨æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨</div>\n-            </el-form-item>\n+\n           </el-col>\n         </el-row>\n \n         <el-divider content-position=\"left\">é«˜çº§è®¾ç½®</el-divider>\n"
                },
                {
                    "date": 1752459611666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,9 +135,8 @@\n   serverUrl: '',\n   backupServers: '',\n   requestTimeout: 30000,\n   healthCheckTimeout: 10000,\n-  autoSwitch: true,\n   clientId: '',\n   maxRetries: 3\n })\n \n"
                },
                {
                    "date": 1752459628069,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -184,9 +184,8 @@\n       config.serverUrl = configData['comfyui.server_url'] || ''\n       config.backupServers = configData['comfyui.backup_servers'] || ''\n       config.requestTimeout = configData['comfyui.request_timeout'] || 30000\n       config.healthCheckTimeout = configData['comfyui.health_check_timeout'] || 10000\n-      config.autoSwitch = Boolean(configData['comfyui.auto_switch'])\n       config.clientId = configData['comfyui.client_id'] || ''\n       config.maxRetries = configData['comfyui.max_retries'] || 3\n \n       ElMessage.success('é…ç½®åŠ è½½æˆåŠŸ')\n"
                },
                {
                    "date": 1752459645632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,14 +237,8 @@\n         config_type: 'number',\n         config_group: 'comfyui'\n       },\n       {\n-        config_key: 'comfyui.auto_switch',\n-        config_value: config.autoSwitch.toString(),\n-        config_type: 'boolean',\n-        config_group: 'comfyui'\n-      },\n-      {\n         config_key: 'comfyui.client_id',\n         config_value: config.clientId,\n         config_type: 'string',\n         config_group: 'comfyui'\n"
                }
            ],
            "date": 1752325471997,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"config-page\">\n    <div class=\"page-header\">\n      <h1 class=\"page-title\">ç³»ç»Ÿé…ç½®</h1>\n      <div class=\"header-actions\">\n        <el-button @click=\"testConnection\" :loading=\"testing\">\n          <el-icon><Connection /></el-icon>\n          æµ‹è¯•è¿æ¥\n        </el-button>\n        <el-button type=\"primary\" @click=\"saveConfig\" :loading=\"saving\">\n          <el-icon><Check /></el-icon>\n          ä¿å­˜é…ç½®\n        </el-button>\n      </div>\n    </div>\n\n    <el-card>\n      <template #header>\n        <div class=\"card-header\">\n          <span>ğŸ–¥ï¸ ComfyUIæœåŠ¡å™¨é…ç½®</span>\n          <el-tag v-if=\"connectionStatus\" :type=\"connectionStatus.type\" size=\"small\">\n            {{ connectionStatus.text }}\n          </el-tag>\n        </div>\n      </template>\n\n      <el-form\n        :model=\"config\"\n        :rules=\"rules\"\n        ref=\"configForm\"\n        label-width=\"180px\"\n        v-loading=\"loading\"\n      >\n        <el-row :gutter=\"20\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"ä¸»æœåŠ¡å™¨åœ°å€\" prop=\"serverUrl\" required>\n              <el-input\n                v-model=\"config.serverUrl\"\n                placeholder=\"https://your-comfyui-server.com\"\n                clearable\n              >\n                <template #prepend>HTTPS://</template>\n              </el-input>\n              <div class=\"form-tip\">ComfyUIä¸»æœåŠ¡å™¨çš„å®Œæ•´åœ°å€</div>\n            </el-form-item>\n\n            <el-form-item label=\"å¤‡ç”¨æœåŠ¡å™¨åœ°å€\" prop=\"backupServers\">\n              <el-input\n                v-model=\"config.backupServers\"\n                type=\"textarea\"\n                :rows=\"3\"\n                placeholder=\"https://backup1.example.com&#10;https://backup2.example.com\"\n                clearable\n              />\n              <div class=\"form-tip\">æ¯è¡Œä¸€ä¸ªå¤‡ç”¨æœåŠ¡å™¨åœ°å€ï¼Œä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢</div>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"12\">\n            <el-form-item label=\"è¯·æ±‚è¶…æ—¶æ—¶é—´\" prop=\"requestTimeout\" required>\n              <el-input-number\n                v-model=\"config.requestTimeout\"\n                :min=\"5000\"\n                :max=\"600000\"\n                :step=\"1000\"\n                style=\"width: 100%\"\n              />\n              <div class=\"form-tip\">å•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®è®¾ç½®ä¸º30000-300000</div>\n            </el-form-item>\n\n            <el-form-item label=\"å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´\" prop=\"healthCheckTimeout\" required>\n              <el-input-number\n                v-model=\"config.healthCheckTimeout\"\n                :min=\"1000\"\n                :max=\"30000\"\n                :step=\"1000\"\n                style=\"width: 100%\"\n              />\n              <div class=\"form-tip\">å•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®è®¾ç½®ä¸º5000-15000</div>\n            </el-form-item>\n\n            <el-form-item label=\"è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æœåŠ¡å™¨\">\n              <el-switch\n                v-model=\"config.autoSwitch\"\n                active-text=\"å¯ç”¨\"\n                inactive-text=\"ç¦ç”¨\"\n              />\n              <div class=\"form-tip\">ä¸»æœåŠ¡å™¨æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨</div>\n            </el-form-item>\n          </el-col>\n        </el-row>\n\n        <el-divider content-position=\"left\">é«˜çº§è®¾ç½®</el-divider>\n\n        <el-row :gutter=\"20\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"å®¢æˆ·ç«¯ID\" prop=\"clientId\">\n              <el-input\n                v-model=\"config.clientId\"\n                placeholder=\"your-comfyui-client-id\"\n                clearable\n              />\n              <div class=\"form-tip\">ComfyUIå®¢æˆ·ç«¯æ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼‰</div>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"12\">\n            <el-form-item label=\"æœ€å¤§é‡è¯•æ¬¡æ•°\" prop=\"maxRetries\">\n              <el-input-number\n                v-model=\"config.maxRetries\"\n                :min=\"0\"\n                :max=\"10\"\n                style=\"width: 100%\"\n              />\n              <div class=\"form-tip\">è¯·æ±‚å¤±è´¥æ—¶çš„æœ€å¤§é‡è¯•æ¬¡æ•°</div>\n            </el-form-item>\n          </el-col>\n        </el-row>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { reactive } from 'vue'\nimport { ElMessage } from 'element-plus'\n\nconst config = reactive({\n  systemName: 'iComfy AIå›¾åƒå¤„ç†å¹³å°',\n  systemDesc: 'ä¸“ä¸šçš„AIå›¾åƒå¤„ç†æœåŠ¡å¹³å°',\n  defaultPoints: 100,\n  faceSwapEnabled: true,\n  clothingSwapEnabled: true,\n  textToImageEnabled: true\n})\n\nconst saveConfig = () => {\n  ElMessage.success('é…ç½®ä¿å­˜æˆåŠŸ')\n}\n</script>\n\n<style scoped>\n.config-page {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.page-title {\n  font-size: 24px;\n  font-weight: 600;\n  color: #303133;\n  margin: 0;\n}\n</style>\n"
        }
    ]
}