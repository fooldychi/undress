# AIMagic åç«¯æœåŠ¡éƒ¨ç½²æ£€æŸ¥æ¸…å• (Windows Server)

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### ğŸ”§ è…¾è®¯äº‘WindowsæœåŠ¡å™¨ç¯å¢ƒ
- [ ] Node.js >= 16.0.0 å·²å®‰è£… (ä» https://nodejs.org/ ä¸‹è½½)
- [ ] PM2 å·²å®‰è£… (`npm install -g pm2`)
- [ ] PM2 WindowsæœåŠ¡æ”¯æŒ (`npm install -g pm2-windows-startup`)
- [ ] MySQL 8.0+ è¿è¡Œæ­£å¸¸
- [ ] Windowsé˜²ç«å¢™å·²å¼€æ”¾ç«¯å£ 3007
- [ ] æœåŠ¡å™¨ç£ç›˜ç©ºé—´å……è¶³ (>2GB)
- [ ] è¿œç¨‹æ¡Œé¢è¿æ¥æ­£å¸¸

### ğŸ—„ï¸ æ•°æ®åº“å‡†å¤‡
- [ ] æ•°æ®åº“ `aimagic` å·²åˆ›å»º
- [ ] æ•°æ®åº“ç”¨æˆ· `aimagic` å·²åˆ›å»ºå¹¶æˆæƒ
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¿…è¦çš„è¡¨ç»“æ„å·²åˆ›å»º

### ğŸ“ æ–‡ä»¶å‡†å¤‡
- [ ] æ‰€æœ‰å¿…éœ€æ–‡ä»¶å·²å‡†å¤‡å®Œæ¯•
- [ ] `.env.production` é…ç½®æ­£ç¡®
- [ ] `deploy.bat` Windowsæ‰¹å¤„ç†è„šæœ¬å‡†å¤‡å°±ç»ª
- [ ] æ’é™¤äº†å¼€å‘æ–‡ä»¶ (node_modules, .gitç­‰)

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ–‡ä»¶ä¸Šä¼ 
- [ ] é€šè¿‡FTPä¸Šä¼ æ‰€æœ‰å¿…éœ€æ–‡ä»¶åˆ° `C:\inetpub\wwwroot\aimagic\server\`
- [ ] éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
- [ ] ç¡®è®¤Windowsè·¯å¾„æ ¼å¼æ­£ç¡®

### 2. ç¯å¢ƒé…ç½®
- [ ] å¤åˆ¶ `.env.production` ä¸ºç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] åˆ›å»ºå¿…è¦ç›®å½• (`logs\`, `uploads\`)
- [ ] é…ç½®Windowsé˜²ç«å¢™è§„åˆ™

### 3. ä¾èµ–å®‰è£…
- [ ] è¿è¡Œ `npm install --production`
- [ ] éªŒè¯ä¾èµ–å®‰è£…æˆåŠŸ

### 4. æ•°æ®åº“åˆå§‹åŒ–
- [ ] è¿è¡Œ `node src\scripts\init-deployment-config.js`
- [ ] éªŒè¯ç³»ç»Ÿé…ç½®è¡¨åˆ›å»ºæˆåŠŸ

### 5. æœåŠ¡å¯åŠ¨
- [ ] è¿è¡Œ `pm2 start ecosystem.config.js --env production`
- [ ] éªŒè¯æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] è®¾ç½®Windowså¼€æœºè‡ªå¯ `pm2-startup install && pm2 save`

## âœ… éƒ¨ç½²åéªŒè¯

### ğŸŒ æœåŠ¡çŠ¶æ€æ£€æŸ¥
- [ ] `pm2 status` æ˜¾ç¤ºæœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] `curl http://localhost:3007/api/health` è¿”å›æ­£å¸¸
- [ ] æœåŠ¡æ—¥å¿—æ— é”™è¯¯ `pm2 logs aimagic-server`

### ğŸ”— APIæ¥å£æµ‹è¯•
- [ ] å¥åº·æ£€æŸ¥æ¥å£: `GET /api/health`
- [ ] é…ç½®æ¥å£: `GET /api/config`
- [ ] ç”¨æˆ·æ³¨å†Œæ¥å£: `POST /api/auth/register`
- [ ] ç”¨æˆ·ç™»å½•æ¥å£: `POST /api/auth/login`

### ğŸ—„ï¸ æ•°æ®åº“è¿æ¥æµ‹è¯•
- [ ] è¿è¡Œ `node src/scripts/health-check.js`
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç³»ç»Ÿé…ç½®è¯»å–æ­£å¸¸

### ğŸ”’ å®‰å…¨æ£€æŸ¥
- [ ] `.env.production` æ–‡ä»¶æƒé™ä¸º 600
- [ ] JWTå¯†é’¥å·²ä¿®æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒå¯†é’¥
- [ ] æ•°æ®åº“å¯†ç å®‰å…¨
- [ ] CORSé…ç½®æ­£ç¡®

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 è¿›ç¨‹ç®¡ç†
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs aimagic-server

# é‡å¯æœåŠ¡
pm2 restart aimagic-server

# åœæ­¢æœåŠ¡
pm2 stop aimagic-server

# åˆ é™¤æœåŠ¡
pm2 delete aimagic-server

# ç›‘æ§é¢æ¿
pm2 monit
```

### å¥åº·æ£€æŸ¥
```bash
# è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬
node src/scripts/health-check.js

# æ£€æŸ¥æœåŠ¡å“åº”
curl http://114.132.50.71:3007/api/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h 114.132.50.71 -u aimagic -p aimagic
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# PM2 æ—¥å¿—
pm2 logs aimagic-server --lines 50

# ç³»ç»Ÿæ—¥å¿—
tail -f /var/log/syslog

# åº”ç”¨æ—¥å¿—
tail -f logs/combined.log
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3007
netstat -tulpn | grep 3007

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 [PID]
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€: `systemctl status mysql`
- éªŒè¯è¿æ¥ä¿¡æ¯: `.env.production` é…ç½®
- æµ‹è¯•è¿æ¥: `mysql -h 114.132.50.71 -u aimagic -p`

#### 3. æƒé™é—®é¢˜
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
chown -R www-data:www-data /var/www/aimagic/server
chmod 755 /var/www/aimagic/server
chmod 600 /var/www/aimagic/server/.env.production
```

#### 4. å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
top

# é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜
pm2 restart aimagic-server
```

#### 5. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
pm2 flush
find logs/ -name "*.log" -mtime +7 -delete
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- æŠ€æœ¯æ”¯æŒ: [æŠ€æœ¯æ”¯æŒé‚®ç®±]
- æ–‡æ¡£åœ°å€: [æ–‡æ¡£é“¾æ¥]
- é—®é¢˜åé¦ˆ: [é—®é¢˜åé¦ˆåœ°å€]

### ç›‘æ§å’ŒæŠ¥è­¦
- æœåŠ¡ç›‘æ§: PM2 Monit
- æ—¥å¿—ç›‘æ§: åº”ç”¨æ—¥å¿— + ç³»ç»Ÿæ—¥å¿—
- æ€§èƒ½ç›‘æ§: å¥åº·æ£€æŸ¥è„šæœ¬

---

**éƒ¨ç½²å®Œæˆæ ‡å¿—**: æ‰€æœ‰æ£€æŸ¥é¡¹éƒ½å·²å®Œæˆ âœ…
