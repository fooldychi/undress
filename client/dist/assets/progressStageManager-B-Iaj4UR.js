const t={UPLOADING:"uploading",SUBMITTING:"submitting",QUEUING:"queuing",PROCESSING:"processing",COMPLETED:"completed",ERROR:"error"},o={[t.UPLOADING]:"å›¾ç‰‡ä¸Šä¼ ä¸­...",[t.SUBMITTING]:"æäº¤ä»»åŠ¡ä¸­...",[t.QUEUING]:"é˜Ÿåˆ—ä¸­...",[t.PROCESSING]:"å·¥ä½œæµæ‰§è¡Œä¸­...",[t.COMPLETED]:"å¤„ç†å®Œæˆ",[t.ERROR]:"å¤„ç†å¤±è´¥"};class l{constructor(){this.currentStage=null,this.workflowProgress={currentNode:0,totalNodes:0,percentage:0},this.callbacks=new Set,this.executedNodes=new Set,this.allNodeIds=[]}addCallback(e){this.callbacks.add(e)}removeCallback(e){this.callbacks.delete(e)}_notifyCallbacks(){const e=this.getCurrentMessage();setTimeout(()=>{this.callbacks.forEach(s=>{try{s(this.currentStage,e,{...this.workflowProgress})}catch(r){console.error("è¿›åº¦å›è°ƒæ‰§è¡Œé”™è¯¯:",r)}})},0)}setStage(e){this.currentStage!==e&&(this.currentStage=e,console.log(`ğŸ”„ è¿›åº¦é˜¶æ®µæ›´æ–°: ${e}`),e!==t.PROCESSING&&(this.workflowProgress={currentNode:0,totalNodes:0,percentage:0},this.executedNodes.clear()),this._notifyCallbacks())}updateWorkflowProgress(e,s){this.currentStage=t.PROCESSING,this.workflowProgress={currentNode:Math.max(0,e),totalNodes:Math.max(0,s),percentage:s>0?Math.round(e/s*100):0},console.log(`ğŸ“Š å·¥ä½œæµè¿›åº¦: ${e}/${s} (${this.workflowProgress.percentage}%)`),this._notifyCallbacks()}setWorkflowNodes(e){this.allNodeIds=[...e],this.workflowProgress.totalNodes=e.length,console.log(`ğŸ“Š è®¾ç½®å·¥ä½œæµèŠ‚ç‚¹åˆ—è¡¨: ${e.length}ä¸ªèŠ‚ç‚¹`,e)}updateFromNodeExecution(e){if(!e)return;this.executedNodes.add(e);const s=this.executedNodes.size,r=this.workflowProgress.totalNodes||this.allNodeIds.length;r>0?this.updateWorkflowProgress(s,r):(this.currentStage=t.PROCESSING,this.workflowProgress.currentNode=s,console.log(`ğŸ“Š å·¥ä½œæµæ‰§è¡ŒèŠ‚ç‚¹: ${e} (å·²æ‰§è¡Œ: ${s})`),this._notifyCallbacks())}getCurrentMessage(){if(this.currentStage===t.PROCESSING&&this.workflowProgress.totalNodes>0){const{currentNode:e,totalNodes:s,percentage:r}=this.workflowProgress;return`${r}%ï¼ˆ${e}/${s}ï¼‰`}else return o[this.currentStage]||"å¤„ç†ä¸­..."}getCurrentState(){return{stage:this.currentStage,message:this.getCurrentMessage(),workflowProgress:{...this.workflowProgress},isWorkflowStage:this.currentStage===t.PROCESSING&&this.workflowProgress.totalNodes>0}}reset(){this.currentStage=null,this.workflowProgress={currentNode:0,totalNodes:0,percentage:0},this.executedNodes.clear(),this.allNodeIds=[],console.log("ğŸ”„ è¿›åº¦çŠ¶æ€å·²é‡ç½®")}setError(e="å¤„ç†å¤±è´¥"){this.currentStage=t.ERROR,this.errorMessage=e,console.log(`âŒ è¿›åº¦é”™è¯¯: ${e}`),this._notifyCallbacks()}setCompleted(){this.currentStage=t.COMPLETED,console.log("âœ… è¿›åº¦å®Œæˆ"),this._notifyCallbacks()}}function c(){return new l}export{t as PROGRESS_STAGES,l as ProgressStageManager,o as STAGE_TEXTS,c as createProgressStageManager};
