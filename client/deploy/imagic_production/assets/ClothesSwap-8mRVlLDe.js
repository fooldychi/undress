import{r as t,j as A,k as $,a as o,o as l,d as s,b as u,i as X,l as z,m as j,f as k,t as p,n as M,p as x,q as F,_ as G}from"./index-gs9uwCed.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"feature-page"},J={class:"container"},K={class:"page-header"},O={class:"page-content"},Q={key:0,class:"upload-section"},W={class:"upload-card"},Y={for:"image-upload",class:"upload-area"},Z={key:0,class:"upload-placeholder"},ee={key:1,class:"image-preview"},se=["src"],ae={key:0,class:"action-section"},te=["disabled"],oe={key:0,class:"loading"},le={key:1,class:"prompt-id"},ne={key:1,class:"result-section"},ie={class:"result-card"},re={class:"comparison-wrapper"},ce={class:"image-layer original-layer"},de=["src"],ue=["src"],ve={class:"process-info"},me={class:"info-item"},pe={class:"info-value"},ge={key:0,class:"info-item"},fe={class:"info-value"},_e={class:"toast-content"},he={class:"toast-message"},ye={__name:"ClothesSwap",setup(be){let h=null;const T=async()=>{try{return h=(await G(()=>import("./comfyui-G2arkMwc.js"),[],import.meta.url)).processUndressImage,console.log("ComfyUI服务加载成功"),!0}catch(a){return console.error("ComfyUI服务加载失败:",a),!1}},c=t(null),n=t(null),g=t(!1),i=t(""),v=t(""),y=t(""),d=t(50),b=t(!1),w=t(null),f=t(null),_=t(!1),C=t(""),I=t("success"),U=a=>{const e=a.target.files[0];if(e){if(e.size>10*1024*1024){alert("文件大小不能超过10MB");return}const r=new FileReader;r.onload=m=>{c.value=m.target.result,n.value=null},r.readAsDataURL(e)}},P=async()=>{if(c.value){g.value=!0,i.value="正在加载服务...",f.value=Date.now();try{if(console.log("🚀 开始一键换衣处理"),!h&&(i.value="正在加载ComfyUI服务...",!await T()))throw new Error("ComfyUI服务加载失败");i.value="开始处理图片...";const a=await h(c.value);if(a&&a.success){if(n.value=a.resultImage,v.value=a.promptId||"",i.value="",f.value){const e=Math.round((Date.now()-f.value)/1e3);y.value=`${e}秒`}S("🎉 处理完成！可以拖拽中间线对比效果","success"),console.log("🎉 换衣处理成功")}else throw new Error((a==null?void 0:a.error)||"处理失败")}catch(a){console.error("❌ 处理失败:",a),i.value=`❌ 处理失败: ${a.message}`;let e="处理失败，请重试";a.message.includes("上传")?e="图片上传失败，请检查网络连接":a.message.includes("超时")?e="处理超时，请稍后重试":a.message.includes("工作流")?e="服务器处理失败，请稍后重试":a.message.includes("网络")?e="网络连接失败，请检查网络":a.message.includes("加载")&&(e="服务加载失败，请刷新页面重试"),alert(e)}finally{g.value=!1}}},S=(a,e="success")=>{C.value=a,I.value=e,_.value=!0,setTimeout(()=>{_.value=!1},3e3)},E=a=>{a.preventDefault(),b.value=!0;const e=m=>{if(!b.value||!w.value)return;const D=w.value.getBoundingClientRect(),R=(m.clientX||m.touches&&m.touches[0].clientX)-D.left,V=Math.max(0,Math.min(100,R/D.width*100));d.value=V},r=()=>{b.value=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",r)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),document.addEventListener("touchmove",e),document.addEventListener("touchend",r)},B=()=>{if(!n.value)return;const a=document.createElement("a");a.href=n.value,a.download=`clothes-swap-result-${Date.now()}.jpg`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},N=()=>{c.value=null,n.value=null,i.value="",v.value="",y.value="",d.value=50,f.value=null;const a=document.getElementById("image-upload");a&&(a.value="")},L=a=>{n.value&&(a.key==="ArrowLeft"?d.value=Math.max(0,d.value-5):a.key==="ArrowRight"&&(d.value=Math.min(100,d.value+5)))};return A(()=>{document.addEventListener("keydown",L)}),$(()=>{document.removeEventListener("keydown",L)}),(a,e)=>{const r=j("router-link");return l(),o("div",H,[s("div",J,[s("header",K,[X(r,{to:"/",class:"back-btn"},{default:z(()=>e[1]||(e[1]=[s("span",{class:"back-icon"},"←",-1),k(" 返回首页 ")])),_:1,__:[1]}),e[2]||(e[2]=s("h1",{class:"page-title"},[s("span",{class:"page-icon"},"👔"),k(" 一键换衣 ")],-1)),e[3]||(e[3]=s("p",{class:"page-description"},"上传人物照片，AI将为您智能更换服装",-1))]),s("main",O,[n.value?u("",!0):(l(),o("div",Q,[s("div",W,[s("input",{type:"file",accept:"image/*",onChange:U,id:"image-upload",class:"hidden"},null,32),s("label",Y,[c.value?(l(),o("div",ee,[s("img",{src:c.value,alt:"预览图",class:"preview-image"},null,8,se),e[5]||(e[5]=s("div",{class:"image-overlay"},[s("span",null,"点击更换图片")],-1))])):(l(),o("div",Z,e[4]||(e[4]=[s("div",{class:"upload-icon"},"📷",-1),s("h3",null,"选择图片",-1),s("p",null,"支持 JPG、PNG 格式，建议尺寸 512x512 以上",-1)])))])]),c.value?(l(),o("div",ae,[s("button",{onClick:P,disabled:g.value,class:"btn btn-primary process-btn"},[g.value?(l(),o("span",oe)):u("",!0),k(" "+p(g.value?"处理中...":"开始换衣"),1)],8,te),i.value?(l(),o("div",{key:0,class:M(["status-message",{error:i.value.includes("失败")}])},p(i.value),3)):u("",!0),v.value?(l(),o("div",le,[s("small",null,"任务ID: "+p(v.value),1)])):u("",!0)])):u("",!0)])),n.value?(l(),o("div",ne,[s("div",ie,[e[11]||(e[11]=s("h3",{class:"result-title"},"拖拽中间线对比效果",-1)),s("div",{class:"image-comparison-container",ref_key:"comparisonContainer",ref:w},[s("div",re,[s("div",ce,[s("img",{src:c.value,alt:"原图",class:"comparison-image"},null,8,de),e[6]||(e[6]=s("div",{class:"image-label original-label"},"原图",-1))]),s("div",{class:"image-layer result-layer",style:x({clipPath:`inset(0 ${100-d.value}% 0 0)`})},[s("img",{src:n.value,alt:"处理结果",class:"comparison-image"},null,8,ue),e[7]||(e[7]=s("div",{class:"image-label result-label"},"处理结果",-1))],4),s("div",{class:"comparison-slider",style:x({left:d.value+"%"}),onMousedown:E,onTouchstart:E},e[8]||(e[8]=[F('<div class="slider-line" data-v-acba8d95></div><div class="slider-handle" data-v-acba8d95><div class="slider-arrow left" data-v-acba8d95>◀</div><div class="slider-circle" data-v-acba8d95></div><div class="slider-arrow right" data-v-acba8d95>▶</div></div>',2)]),36)])],512),s("div",{class:"result-actions"},[s("button",{onClick:B,class:"btn btn-primary download-btn"}," 📥 下载处理结果 "),s("button",{onClick:N,class:"btn btn-secondary"}," 🔄 重新选择图片 ")]),s("div",ve,[s("div",me,[e[9]||(e[9]=s("span",{class:"info-label"},"处理时间:",-1)),s("span",pe,p(y.value||"未知"),1)]),v.value?(l(),o("div",ge,[e[10]||(e[10]=s("span",{class:"info-label"},"任务ID:",-1)),s("span",fe,p(v.value),1)])):u("",!0)])])])):u("",!0)])]),_.value?(l(),o("div",{key:0,class:M(["toast",I.value])},[s("div",_e,[s("span",he,p(C.value),1),s("button",{onClick:e[0]||(e[0]=m=>_.value=!1),class:"toast-close"},"×")])],2)):u("",!0)])}}},Ie=q(ye,[["__scopeId","data-v-acba8d95"]]);export{Ie as default};
